function character(){var d=[[0,1,10,98,16,16,16,16,0,0,24,15,15,24,0,0],[1,4,7,2,16,16,24,24,0,0,7,5,5,7,0,1],[2,5,1,3,4,4,2,2,4,4,5,5,5,5,0,0],[3,6,2,3,8,8,6,6,4,4,5,5,5,5,0,0],[4,19,4,2,8,8,6,6,14,14,7,5,5,7,0,10],[5,8,1,3,8,8,8,8,4,4,5,5,5,5,0,0],[6,9,2,1,8,8,16,16,13,13,5,5,5,5,0,0],[7,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[8,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[9,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[10,4,10,0,8,8,8,8,21,21,7,15,15,7,1,0],[11,15,10,0,8,8,8,8,21,21,7,15,15,7,1,0],[12,5,1,3,4,4,2,2,18,18,5,5,5,5,0,0],[13,14,3,1,8,8,4,4,20,20,5,5,5,5,0,0],[14,20,70,2,16,16,24,24,0,0,35,5,5,35,0,50],[15,12,70,2,16,16,24,24,0,0,35,5,5,35,0,50],[16,13,99,0,80,16,160,32,0,0,5,5,5,5,0,0],[17,13,99,5,80,16,160,32,26,26,5,5,5,5,0,0],[18,16,0,5,112,16,0,0,28,28,28,5,5,5,0,0],[19,17,0,5,16,48,0,0,29,29,29,5,5,5,0,0],[20,18,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[20,26,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[21,14,1,1,8,8,-99,-99,31,31,5,5,5,5,0,0],[22,8,1,3,8,8,16,16,33,33,5,5,5,5,0,0],[23,21,5,1,8,16,6,6,45,45,5,5,5,5,0,0],[24,23,5,3,8,8,6,6,49,49,5,5,5,5,0,0],[25,31,1,4,8,8,16,16,30,30,5,5,5,5,0,1],[26,32,1,4,8,8,16,16,30,30,5,5,5,5,0,5],[27,33,1,4,8,8,16,16,30,30,5,5,5,5,0,10],[100,8,1,3,8,8,6,6,100,100,5,5,5,5,0,0],[101,8,1,3,8,8,6,6,101,101,5,5,5,5,0,0],[102,8,1,3,8,8,6,6,102,102,5,5,5,5,0,0],[103,8,1,3,8,8,6,6,103,103,5,5,5,5,0,0],[104,8,1,3,8,8,6,6,104,104,5,5,5,5,0,0],[106,8,1,3,8,8,6,6,105,105,5,5,5,5,0,0]],c=[];for(var e in d){var a=d[e],b={};b.mp=a[1];b.hp=a[2];b.type=a[3];b.center_x=a[4];b.center_y=a[5];b.size_x=a[6];b.size_y=a[7];b.senario=[a[8],a[9],a[10],a[11],a[12],a[13]];b.id=a[14];b.score=a[15];c[a[0]]=b}return c}function sce_common_vset(a){this.init=function(c,b){b.vset(a)};this.move=function(b,a){return a.sc_move()}}function sce_common_signal(a){this.init=function(b,a){a.vset(0);a.normal_draw_enable=false;a.custom_draw_enable=false;a.x=a.gt.world_x+1;a.y=a.gt.world_y+1};this.move=function(c,b){b.x=b.gt.world_x+1;b.y=b.gt.world_y+1;if(b.frame==0)b.SIGNAL(a);else{b.SIGNAL(0);b.status=0}b.frame++;return b.sc_move()}}function deviceControl(){var b=new Screen("b_canvas"),a=new Screen("a_canvas"),c=new TextScreen("text_div"),f=new inputControl("a_canvas"),d=new inputKeyboard,e=new geometoryTrance;this.graphics=a;this.graphics1=a;this.graphics2=b;this.text=c;this.canvas=a;this.canvas1=a;this.canvas2=b;this.gs=e;this.layout=new gameLayout;this.mouse_state=f;this.key_state=d}function sce_effect_vanish(){this.init=function(b,a){a.type=5;a.status=5};this.move=function(){return-1}}function sce_effect_bomb(){this.init=function(b,a){a.vset(1);a.mp=10;a.type=5;a.status=5;a.frame=0;a.alpha=254};this.move=function(b,a){switch(a.frame){case 90:a.status=0}a.frame++;if(a.frame>30)a.alpha-=3;return a.sc_move()}}function sce_effect_billboard(a){this.init=function(c,b){b.vector=a;b.vset(2)};this.move=function(b,a){if(a.alpha>10)a.alpha-=5;else return-1;return a.sc_move()}}function sce_effect_bombcircle(a){this.init=function(b,a){a.vset(0);a.circle_r=20;a.type=5;a.normal_draw_enable=false;a.custom_draw_enable=true};this.move=function(b,a){if(a.frame>10)a.status=0;a.circle_r+=(a.frame+1)*10;a.frame++;return a.sc_move()};this.draw=function(e,c){var b={},d=c.gt.worldtoView(c.x,c.y);b.x=d.x;b.y=d.y;b.r=c.circle_r;b.draw=function(b){b.beginPath();b.globalCompositeOperation="lighter";b.arc(this.x,this.y,this.r,0,Math.PI*2,false);b.fillStyle=a;b.fill();b.globalCompositeOperation="source-over"};e.putFunc(b)}}function sce_effect_warnning_mark(){this.init=function(b,a){a.vset(0);a.type=5;a.mp=28};this.move=function(b,a){if(a.frame>30)a.status=0;a.frame++;return a.sc_move()}}function sce_friend_rotate(){this.init=function(b,a){a.vector=Math.floor(Math.random()*360);a.vset(0);a.get_target(98);a.startflag=true;a.shot=0;a.triger=0};this.move=function(e,a){if(!a.config.option)a.status=0;var c=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);var b=0;for(var d in a.item)if(d==7)b=a.item[d];if(b!=9)a.status=0;a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}if(eval(a.mouse_state.button)==0)if(a.shot==0){a.shot=1;a.config.sideshot&&a.set_object_ex(10,a.x,a.y,a.vector,41);a.triger=10}if(this.status==0)c=1;a.x=a.target.x+Math.cos((a.vector-90)*(Math.PI/180))*25;a.y=a.target.y+Math.sin((a.vector-90)*(Math.PI/180))*25;a.vector=(a.vector+12+360)%360;return c}}function sce_friend_start(){this.init=function(b,a){a.vset(0)};this.move=function(b,a){if(!a.config.option)a.status=0;a.hp=10;switch(a.frame){case 30:a.vector=180;a.get_target(98);break;case 58:case 59:a.vector=a.target_v();case 60:a.vset(0);a.change_sce(21)}a.frame++;return a.sc_move()}}function sce_friend_sidearm(){this.init=function(b,a){a.vset(0);a.triger=15;a.m_trig=0;a.frame=60};this.move=function(f,a){if(!a.config.option)a.status=0;var c=a.vector;a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}var b=0;for(var e in a.item)if(e==7)b=a.item[e];if(b<10)a.mp=15;else a.mp=24;if(eval(a.mouse_state.button)==0){if(a.shot==0){a.shot=1;(b>=3&&b<=4||b>=8)&&a.set_object_ex(6,a.x,a.y,a.vector>180?a.vector+87:a.vector-87,13);a.m_trig=1-a.m_trig;if(b>=5)a.m_trig==0&&a.set_object(13);if(a.frame>45)if(b>=10){a.set_object(23);a.frame=0}a.triger=15;if(b>=7)a.triger=5}c=a.vector}var d=0;a.target.type!=98&&a.change_sce(7);if(this.status==0)d=1;a.x=a.target.x+Math.cos((c-90)*(Math.PI/180))*32;a.y=a.target.y+Math.sin((c-90)*(Math.PI/180))*32;a.frame++;return d}}function sce_friend_passive(){this.init=function(b,a){a.vset(0);a.triger=15;a.m_trig=0;a.frame=60;a.get_target(98);a.startflag=true;a.movCount=0;a.selection=false;a.pickup=false;a.coin=[]};this.move=function(f,a){var c=0;for(var b in a.coin)c=c+a.coin[b];a.display_size=1+.05*c;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);if(a.movCount>0){a.movCount--;if(a.movCount==0)a.selection=false}a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}if(eval(a.mouse_state.button)==0)if(a.shot==0){if(a.selection){a.movCount=a.target_d(a.target.x,a.target.y);a.target.line_draw=false;a.selection=false;a.vector=a.target_v();var e=a.movCount/20;if(e>8)e=8;a.vset(e)}var d=a.gt.worldtoView(a.x,a.y);if(Math.abs(d.x-a.mouse_state.x)<a.hit_x+10&&Math.abs(d.y-a.mouse_state.y)<a.hit_y+10){a.target.line_x=a.x;a.target.line_y=a.y;a.pickup=false;a.selection=true;a.target.line_draw=true}a.shot=1;a.triger=10}if(eval(a.mouse_state.button)==1)if(a.shot==0){if(a.pickup)a.pickup=false;else{var d=a.gt.worldtoView(a.x,a.y);if(Math.abs(d.x-a.mouse_state.x)<a.hit_x+10&&Math.abs(d.y-a.mouse_state.y)<a.hit_y+10)a.pickup=true}a.shot=1;a.triger=10}if(a.selection){a.target.line_x=a.x;a.target.line_y=a.y;a.target.mp=3}else if(a.pickup){a.target.mp=3;if(a.config.fullpower){var d=a.gt.viewtoWorld(a.mouse_state.x,a.mouse_state.y);a.x=d.x;a.y=d.y}if(c>0)for(var b in a.coin){if(b==20)continue;a.rel_item(b,a.coin[b]);for(j=1;j<=a.coin[b];j++){wr=Math.floor(Math.random()*360);this.set_object_ex(b,a.x+a.Cos(wr)*30,a.y+a.Sin(wr)*30,Math.floor(Math.random()*360),"common_vset4")}a.coin[b]=0}if(!a.config.fullpower)a.pickup=false}a.movCount<0&&a.vset(0);if(a.mapCollision!=true){a.x+=a.vx;a.y+=a.vy}else{if(this.mapColX)this.vx*=-1;if(this.mapColY)this.vy*=-1}if(a.config.option)c-=5;if(c>20){a.change_sce(7);var c=0;for(var b in a.coin){c=c+a.coin[b];a.rel_item(b,a.coin[b])}for(b=1;b<=c;b++)this.set_object_ex(20,a.x,a.y,Math.floor(Math.random()*360),"common_vset4")}return 0}}function gameScene(b){var d=b.graphics1,e=b.graphics2;this.init=v;this.reset=t;this.step=x;this.draw=u;this.score=0;this.result;this.config;var a,c,r,y=0,h=0,s=[],n=[],o=[],z=false,j=true,m=0,f=0,k=0,g=false,l=0,q=0,p=0;this.score_load=function(){if(Boolean(localStorage)){var a=false;if(Boolean(localStorage.getItem("highscore"))){a=true;this.result.highscore=parseInt(localStorage.getItem("highscore"))}}};function v(){a=new gObjectControl(d,b);c=new mapSceControl;c.init();this.result={};this.result.highscore=0;this.result.score=0;this.result.item=a.item;this.result.combo=a.combo;this.result.nowstage=1;this.result.loop=0;this.result.time=0;g=false}function t(b){a.config=this.config;if(!Boolean(b))b=false;g=false;if(b){a.reset(true);if(this.config.cold)h=2}else{a.reset(false);c.change(this.config.startstage);this.result.nowstage=this.config.startstage;c.reset();h=2;this.result.loop=0;j=true;m=0;f=0;k=0}p=0;if((b=true)&&!this.config.cold){w=c.stage;w++;if(w>5){this.result.loop++;w=1}c.change(w);var d=a.score;a.reset(false);a.score=d;c.reset();a.item=[];this.result.nowstage=w;this.result.time=0;f=0;k=0}s=c.bgImage();n=c.mapChip();o=c.bgPtn();e.clear("darkgreen");e.reset();r=new gs_score_effect(a.score);ehighscore=new gs_score_effect(this.result.highscore)}function x(){if(a.interrapt){if(a.SIGNAL==1){c.enable=false;c.counter_runnning=false}if(a.SIGNAL==6055){if(f==0)j=false;c.enable=true;c.counter_runnning=false}if(a.SIGNAL==835){a.score+=this.result.time;this.result.score=a.score;this.result.item=a.item;this.result.combo=a.combo;this.result.combomax=a.combomax;this.result.obCount=a.obCount;this.result.total=a.total;this.result.hidan=a.hidan;this.config.cold=false;a.interrapt=false;a.SIGNAL=0;a.draw(e);g=true;return 5}if(a.SIGNAL==4649){h++;if(h<3){if(this.config.itemreset)a.item=[];a.combo=[];a.restart()}else{this.result.score=a.score;this.result.item=a.item;this.result.combo=a.combo;this.result.combomax=a.combomax;this.result.obCount=a.obCount;this.result.total=a.total;this.result.hidan=a.hidan;a.draw(e);g=true;Boolean(localStorage)&&localStorage.setItem("highscore",new String(this.result.highscore));return 3}}}else{j=true;c.enable=true;c.counter_runnning=true}var m=0,d=1;for(i in a.combo){if(i==2)m=a.combo[i];if(i==4)d=a.combo[i]}if(l!=m){l=m;if(l>=2)p=60}if(q!=d)q=d;if(!a.interrapt){a.move(c);c.step(a)}else if(a.SIGNAL!=1){a.move(c);c.step(a)}else var n=b.mouse_state.check_last();if(j)f++;if(f>480){f=0;k=1-k}if(this.result.highscore<a.score)this.result.highscore=a.score;return 0}function u(){g=true;if(m!=b.gs.world_x||f!=b.gs.world_y){g=false;m=b.gs.world_x;f=b.gs.world_y}if(!g){for(var i in n){var k=n[i];if(b.gs.in_stage_range(k.x,k.y,k.w,k.h)){k.view=true;var q=b.gs.worldtoView(k.x,k.y);if(k.visible)if(Boolean(o[k.no]))e.putPattern(s,o[k.no],q.x,q.y,k.w,k.h);else{var l={};l.x=q.x;l.y=q.y;l.w=k.w;l.h=k.h;l.draw=function(a){a.beginPath();a.strokeStyle="green";a.lineWidth=1;a.rect(this.x,this.y,this.w,this.h);a.stroke()};e.putFunc(l)}}else k.view=false}e.clear("black");e.draw();e.reset()}a.draw();var j=[];wt=ehighscore.read(this.result.highscore);d.putchr("Hi-Sc:"+wt,b.layout.hiscore_x,b.layout.hiscore_y);wt=r.read(a.score);d.putchr("Score:"+wt,b.layout.score_x,b.layout.score_y);d.put("Boardm",b.layout.combo_x+32,b.layout.combo_y);var u=190+10*this.result.nowstage+this.result.loop*50;d.putchr(u+".",b.layout.combo_x+64,b.layout.combo_y-16);var p=0;for(i in a.item){if(i==25)p+=a.item[i]*1;if(i==26)p+=a.item[i]*5;if(i==27)p+=a.item[i]*10}d.putchr(p+".",b.layout.combo_x+64,b.layout.combo_y);d.putchr("Time:"+Math.floor((7200-c.flame)/60),b.layout.combo_x,b.layout.combo_y+16);if(p>=u){this.result.time=Math.floor((7200-c.flame)/60);a.interrapt=true;a.SIGNAL=835}if(this.config.debug){j.push("o:"+a.cnt()+"/"+a.num()+"/"+a.nonmove);j.push("f:"+c.flame);if(a.interrapt)j.push("interrapt:"+a.SIGNAL);else j.push("running:"+a.SIGNAL);j.push("dead:"+h);if(Boolean(a.item[7])){var t=a.item[7];if(t>=10)t="max";j.push("powerup:"+t)}}for(var i=0;i<2-h;i++)d.put("Ship",b.layout.zanki_x+i*32,b.layout.zanki_y);if(this.config.debug){for(i in a.item)j.push("item["+i+"]:"+a.item[i]);for(i in a.combo)j.push("combo["+i+"]:"+a.combo[i]);for(i in a.combomax)j.push("combomax["+i+"]:"+a.combomax[i]);var v=0;for(i in a.total)if(i==2)v=a.total[i];var w=1;for(i in a.obCount)if(i==2)w=a.obCount[i];j.push("rate:"+Math.floor(v/w*100)+"par");j.push("hidan:"+a.hidan);j.push("wx,wy:"+Math.floor(b.gs.world_x)+","+Math.floor(b.gs.world_y));var p=0;for(i in a.item){if(i==25)p+=a.item[i]*1;if(i==26)p+=a.item[i]*5;if(i==27)p+=a.item[i]*10}j.push("en:"+p);var l={};l.x=0;l.y=0;l.w=b.gs.viewwidth;l.h=b.gs.viewheight;l.draw=function(a){a.beginPath();a.strokeStyle="red";a.lineWidth=1;a.rect(150,150,130,180);a.stroke();a.beginPath();a.strokeStyle="red";a.lineWidth=1;a.rect(0,0,420,480);a.stroke();a.strokeStyle="red";a.lineWidth=1;a.rect(0,0,this.w,this.h);a.stroke()};d.putFunc(l)}for(var x in j)d.putchr8(j[x],b.layout.status_x,b.layout.status_y+8*x)}}function gs_score_effect(b){var a=b;this.read=function(d){if(d<=a)a=d;else if(d-a>100){c=1;ws_work=a;ts_work=d;for(var b=0;b<7;b++){if(ws_work<ts_work)a+=c;c*=10;ws_work=Math.floor(ws_work/10);ts_work=Math.floor(ts_work/10)}}else a++;var e=a,f=[],g="";for(b=0;b<7;b++){var c=e%10;f[7-b]=c;e=(e-c)/10}for(b in f)g=g+""+f[b];return g}}function geometoryTrance(){this.worldwidth=1024;this.worldheight=1024;this.stagewidth=740;this.stageheight=580;this.viewwidth=640;this.viewheight=480;this.world_x=0;this.world_y=0;var h=this.worldwidth,g=this.worldheight,d=this.stagewidth,c=this.stageheight,b=this.viewwidth,a=this.viewheight,e=this.world_x,f=this.world_y;this.viewtoWorld=function(b,c){var a={};a.x=this.world_x+b;a.y=this.world_y+c;return a};this.worldtoView=function(b,c){var a={};a.x=b-this.world_x;a.y=c-this.world_y;return a};this.viewpos=function(c,d){if(c<0)c=0;if(d<0)d=0;if(c>h-b)c=h-b;if(d>g-a)d=g-a;e=c;f=d};this.commit=function(){this.world_x=e;this.world_y=f};this.nowstagepos=function(){var e={};e.ltx=this.world_x+b/2-d/2;e.lty=this.world_y+a/2-c/2;e.rtx=this.world_x+b/2+d/2;e.rty=this.world_y+a/2-c/2;e.lbx=this.world_x+b/2-d/2;e.lby=this.world_y+a/2+c/2;e.rbx=this.world_x+b/2+d/2;e.rby=this.world_y+a/2+c/2;e.x=e.ltx;e.y=e.lty;e.w=d;e.h=c;return e};this.in_stage=function(f,g){var e=false;if(this.world_x+b/2-d/2<=f&&this.world_x+b/2+d/2>=f&&this.world_y+a/2-c/2<=g&&this.world_y+a/2+c/2>=g)e=true;return e};this.in_view=function(d,e){var c=false;if(this.world_x<=d&&this.world_x+b>=d&&this.world_y<=e&&this.world_y+a>=e)c=true;return c};this.in_view_range=function(f,g,e,d){var c=false;if(Math.abs(this.world_x+b/2-(f+e/2))<(b+e)/2&&Math.abs(this.world_y+a/2-(g+d/2))<(a+d)/2)c=true;return c};this.in_stage_range=function(f,g,e,b){var a=false;if(Math.abs(this.world_x+d/2-(f+e/2))<(d+e)/2&&Math.abs(this.world_y+c/2-(g+b/2))<(c+b)/2)a=true;return a}}function gObjectClass(){this.x;this.y;this.vx;this.vy;this.mp;this.vector;this.visible=false;this.center_x;this.center_y;this.hit_x;this.hit_y;this.mp_cnt_frm=0;this.mp_cnt_anm=0;this.type;this.chr;this.frame=0;this.scenario=[];this.status=0;this.hp;this.target=-1;this.crash=-1;this.id;this.score=0;this.triger=0;this.shot=0;this.alpha=255;this.display_size=1;this.message=[];this.normal_draw_enable=true;this.custom_draw_enable=false;this.damegeflag=false;this.mapCollision=false;this.mapColX=false;this.mapColY=false;this.alive=600;this.reset=function(){status=0;type=5;visible=false;mp_cnt_frm=0;mp_cnt_anm=0;scenario=[];this.normal_draw_enable=true;this.custom_draw_enable=false;damegeflag=false};this.init=b;this.move=c;this.draw=a;this.custom_draw=null;this.vset=function(a){this.vx=Math.cos(Math.PI/180*(this.vector-90))*a;this.vy=Math.sin(Math.PI/180*(this.vector-90))*a};this.set_object=function(c,b){var a={};a.cmd="set_object";a.src=c;a.dst=b;this.message.push(a)};this.set_object_ex=function(d,g,h,f,c,e){var b={},a={};a.x=g;a.y=h;a.vector=f;a.sce=c;a.id=e;b.cmd="set_object_ex";b.src=d;b.dst=a;this.message.push(b)};this.get_target=function(c,b){var a={};a.cmd="get_target";a.src=c;a.dst=b;this.message.push(a)};this.change_sce=function(c,b){var a={};a.cmd="change_sce";a.src=c;a.dst=b;this.frame=0;this.normal_draw_enable=true;this.custom_draw_enable=false;this.message.push(a)};this.add_score=function(c,b){var a={};a.cmd="add_score";a.src=c;a.dst=b;this.message.push(a)};this.get_item=function(c,b){var a={};a.cmd="get_item";a.src=c;a.dst=b;this.message.push(a)};this.rel_item=function(c,b){var a={};a.cmd="rel_item";a.src=c;a.dst=b;this.message.push(a)};this.bomb=function(c,b){var a={};a.cmd="bomb";a.src=c;a.dst=b;this.message.push(a)};this.bomb2=function(c,b){var a={};a.cmd="bomb2";a.src=c;a.dst=b;this.message.push(a)};this.bomb3=function(c,b){var a={};a.cmd="bomb3";a.src=c;a.dst=b;this.message.push(a)};this.collect=function(c,b){var a={};a.cmd="collect";a.src=c;a.dst=b;this.message.push(a)};this.SIGNAL=function(c,b){var a={};a.cmd="SIGNAL";a.src=c;a.dst=b;this.message.push(a)};this.reset_combo=function(c,b){var a={};a.cmd="reset_combo";a.src=c;a.dst=b;this.message.push(a)};this.sc_move=function(){var a=0;if(this.status==2)switch(this.type){case 1:case 3:this.change_sce(7);break;case 2:this.display_size*=2;this.change_sce(7);var b=this.chr==14?7:20;this.set_object_ex(b,this.x,this.y,Math.floor(Math.random()*360),36);this.add_score(this.score);break;case 4:this.change_sce(6);if(Boolean(this.crash.coin[this.chr]))this.crash.coin[this.chr]++;else this.crash.coin[this.chr]=1;this.get_item(this.chr)}if(this.status==0)a=1;if(this.mapCollision!=true){this.x+=this.vx;this.y+=this.vy}else switch(this.type){case 1:case 3:a=1;break;default:if(this.mapColX)this.vx*=-1;if(this.mapColY)this.vy*=-1}if(this.x<0||this.x>this.gt.ww)a=2;if(this.y<0||this.y>this.gt.wh)a=2;if(a!=0){a==2&&this.reset_combo(this.type);return-1}this.damageflag=false;return 0};this.target_r=function(e,f){var g=this.x,h=this.y,a,b=e-g,c=f-h;if(b==0)if(c>=0)a=180;else a=0;else{a=d(Math.atan(c/b));if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a};this.target_v=function(){return!Boolean(this.target)?this.vector:this.target_r(this.target.x,this.target.y)};this.target_rotate_r=function(c){if(!Boolean(this.target))return;var a=this.target_r(this.target.x,this.target.y),b=a;if(b>179)b=-360+b;w=this.vector;if(w>179)w=-360+w;a=b-w;if(Math.abs(a)>100){w=(this.vector+180)%360;if(w>179)w=-360+w;a=(b-w)*-1}if(Math.abs(a)<c)c=a;if(a!=0)this.vector=this.vector+a/Math.abs(a)*c;if(this.vector<0)this.vector=360+this.vector;if(this.vector>359)this.vector=this.vector-360};this.target_d=function(a,b){var c=this.x,d=this.y;return Math.sqrt(Math.abs(a-c)*Math.abs(a-c)+Math.abs(b-d)*Math.abs(b-d))};this.Sin=function(a){return Math.sin((a-90)*(Math.PI/180))};this.Cos=function(a){return Math.cos((a-90)*(Math.PI/180))};function d(a){return a*(180/Math.PI)}function b(b,a){a.vset(5)}function a(b,a){b.print(a.mp+"",a.x,a.y)}function c(c,a){a.x+=a.vx;a.y+=a.vy;var b=0;if(a.x<0||a.x>c.cw)b=1;if(a.y<0||a.y>c.ch)b=1;return b!=0?-1:0}}function gObjectControl(h,k){delobj=0;this.score=0;this.config={};this.interrapt=false;this.SIGNAL=0;this.item=[];this.combo=[];this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;this.nonmove=0;var j=0,f,l,m,c=character(),d=motionPattern(),g=scenario(),a=[],e=[];e[0]=[0,0,1,1,1,0];e[1]=[0,0,1,0,0,0];e[2]=[1,1,1,0,0,0];e[3]=[1,0,0,0,0,0];e[4]=[2,0,0,0,0,0];e[5]=[0,0,0,0,0,0];this.reset=function(b){delobj=0;j=0;if(this.config.cold){this.score=0;this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;this.combo=[];this.item=[]}if(!b){this.interrapt=false;this.SIGNAL=0;a=[];this.config.cold=true}if(this.config.fullpower)this.item[7]=10};this.move=function(u){f=u;var B=k.mouse_state.check_last();this.nonmove=0;for(var i in a){var c=a[i];c.alive--;var p=c.gt.in_stage_range(c.x-c.hit_x/2,c.y-c.hit_y/2,c.hit_x,c.hit_y);p=true;if(!p){this.nonmove++;c.state_moving=false;if(c.type==1||c.type==3)c.status=0}if(!c.state_moving&&c.type!=5){c.state_moving=true;continue}c.mouse_state=B;if(c.move(h,c,u)!=0){delete a[i];delobj++}for(var D in c.message){var d=c.message[D];if(d.cmd=="add_score")this.score+=d.src;if(d.cmd=="get_item"){if(Boolean(this.item[d.src]))this.item[d.src]++;else this.item[d.src]=1;var s=1;if(d.src==20)s=this.combo_sub(4);this.score+=c.score*s;var F=d.src==7?"Powerup!":c.score*s+"pts.";f.add(c.x,c.y,0,20,43+(d.src==7?1:0),F)}if(d.cmd=="rel_item")if(Boolean(this.item[d.src]))this.item[d.src]-=d.dst;if(d.cmd=="reset_combo")for(var x in this.combo)if(d.src==x)this.combo[x]=0;if(d.cmd=="SIGNAL")if(this.interrapt){this.interrapt=false;this.SIGNAL=0}else{this.interrapt=true;this.SIGNAL=d.src;if(d.src==0)this.interrapt=false}if(d.cmd=="bomb2"||d.cmd=="bomb3")if(Boolean(this.item[7]))if(this.item[7]>0)this.item[7]--;b[d.cmd](c,d.src,d.dst)}c.message=[]}var t=f.mapChip(),r=[],v=0;for(var G in t){var g=t[G];if(g.c){r[v]=g;v++}}var o=[];for(i in a){o[i]=0;c=a[i];c.crash=null;var p=c.gt.in_stage_range(c.x-c.hit_x/2,c.y-c.hit_y/2,c.hit_x,c.hit_y);p=true;if(!p)continue;if(c.type==98)continue;var z=c.type==98?0:c.type;for(var q in a){var n=a[q];if(o[q]!=0)continue;if(i==q)continue;if(n.type==98)continue;var A=n.type==98?0:n.type,C=e[z][A];if(C==0)continue;if(Math.abs(c.x-n.x)<(c.hit_x+n.hit_x)/2&&Math.abs(c.y-n.y)<(c.hit_y+n.hit_y)/2){c.status=2;n.status=2;c.crash=n;n.crash=c;o[q]=1;o[i]=1}}c.mapCollision=false;c.mapColX=false;c.mapColY=false;for(var H in r){var g=r[H];if(Math.abs(c.x+c.vx-(g.x+g.w/2))<(c.hit_x+g.w)/2&&Math.abs(c.y+c.vy-(g.y+g.h/2))<(c.hit_y+g.h)/2)c.mapCollision=true;if(Math.abs(c.x+c.vx-(g.x+g.w/2))<(c.hit_x+g.w)/2&&Math.abs(c.y-(g.y+g.h/2))<(c.hit_y+g.h)/2)c.mapColX=true;if(Math.abs(c.x-(g.x+g.w/2))<(c.hit_x+g.w)/2&&Math.abs(c.y+c.vy-(g.y+g.h/2))<(c.hit_y+g.h)/2)c.mapColY=true}}for(i in a){c=a[i];var p=c.gt.in_stage_range(c.x-c.hit_x/2,c.y-c.hit_y/2,c.hit_x,c.hit_y);if(!p)continue;if(o[i]!=0)if(!(c.type==1||c.type==3)){var w=true;if(c.type==c.crash.type){c.status=1;c.crash.status=1;c.vector=(c.vector+180)%360;w=false}if(w){var E=c.hp;if(c.type==4)c.hp=0;if(c.crash.type!=4)c.hp-=c.crash.hp>0?c.crash.hp:1;if(c.hp>0){c.status=1;if(E!=c.hp){if(c.type==98)this.hidan++;c.damageflag=true}c.crash=null}else c.type==2&&this.combo_sub(2)}}}var y=0;for(i in a)if(a[i].type==0)y++;if(y==0){j++;if(j>90){l=this.interrapt;m=this.SIGNAL;this.interrapt=true;this.SIGNAL=4649}}};this.combo_sub=function(a){if(!Boolean(this.combo[a]))this.combo[a]=1;else this.combo[a]++;if(!Boolean(this.combomax[a]))this.combomax[a]=this.combo[a];else if(this.combo[a]>this.combomax[a])this.combomax[a]=this.combo[a];if(!Boolean(this.total[a]))this.total[a]=1;else this.total[a]++;return this.combo[a]};this.restart=function(){f.start(false);j=0;this.interrapt=l;this.SIGNAL=m};var b=[];b.set_object=function(a,b){f.add(a.x,a.y,a.vector,b)};b.set_object_ex=function(c,b,a){f.add(a.x,a.y,a.vector,b,a.sce,a.id)};b.get_target=function(b,f){var h=1,d=99999;b.target=null;for(var g in a){var c=a[g];if(c.type!=f)continue;var e=c.target_d(b.x,b.y);if(e<d){b.target=c;d=e}}};b.change_sce=function(a,b){a.init=g.init[b];a.move=g.move[b];a.custom_draw=g.draw[b];a.init(h,a)};b.add_score=function(c,a){return a};b.get_item=function(c,a){return a};b.rel_item=function(c,a){return a};b.bomb=function(){for(i in a)a[i].type==3&&a[i].change_sce(7)};b.bomb2=function(b){for(i in a){b=a[i];if(b.type==3){b.type=4;b.mp=18;b.score=8;if(b.chr!=7){var c=[18,22,26,27,29,30];b.mp=c[Math.floor(Math.random()*c.length)]}b.change_sce(30)}}};b.bomb3=function(){for(i in a){if(a[i].type==2){a[i].hp-=10;if(a[i].hp<=0)a[i].status=2}a[i].type==3&&a[i].change_sce(7)}};b.collect=function(b){for(i in a){b=a[i];if(b.type==4)if(!Boolean(b.collection_mode)){b.collection_mode=true;b.change_sce(30)}}};b.SIGNAL=function(){};b.reset_combo=function(){};this.draw=function(c){if(!Boolean(c))c=h;for(var d in a){var b=a[d];if(b.visible){if(b.normal_draw_enable)k.gs.in_view(b.x,b.y)&&b.draw(c,b);b.custom_draw_enable&&b.custom_draw(c,b)}}};this.set_s=o;function o(m,o,l,d,e,j){var b=new gObjectClass;b.reset();b.scrn=h;b.mouse_state=k.mouse_state.check_last();b.gt=k.gs;b.item=this.item;b.config=this.config;b.x=m;b.y=o;b.vector=l;b.chr=d;b.visible=true;b.mp=c[d].mp;b.hp=c[d].hp;b.maxhp=b.hp;b.type=c[d].type;b.center_x=c[d].center_x;b.center_y=c[d].center_y;b.hit_x=c[d].size_x;b.hit_y=c[d].size_y;if(!Boolean(j))j=c[d].id;b.id=j;b.score=c[d].score;b.status=1;if(!Boolean(e))e=c[d].senario[0];b.init=g.init[e];b.move=g.move[e];b.draw=n;b.custom_draw=g.draw[e];b.init(h,b);for(var i=-1,f=0;f<a.length;f++)if(!a[f]){i=f;break}if(i==-1)a.push(b);else a[i]=b;if(Boolean(this.obCount[b.type]))this.obCount[b.type]++;else this.obCount[b.type]=1;if(b.type==1&&b.type==3)b.alive=90}this.num=function(){return a.length};this.cnt=function(){var b=0;for(var c in a)b++;return b};function n(c,a){if(Boolean(d[a.mp].wait)){a.mp_cnt_frm++;if(a.mp_cnt_frm>d[a.mp].wait/2){a.mp_cnt_anm++;a.mp_cnt_frm=0;if(a.mp_cnt_anm>=d[a.mp].pattern.length)a.mp_cnt_anm=0}}try{var g=d[a.mp].pattern[a.mp_cnt_anm][0]}catch(h){a.mp_cnt_anm=0;g=d[a.mp].pattern[a.mp_cnt_anm][0]}var e=d[a.mp].pattern[a.mp_cnt_anm][1],f=d[a.mp].pattern[a.mp_cnt_anm][2];if(e==-1&&f==-1){e=0;f=a.vector}var b=a.gt.worldtoView(a.x,a.y);b.x>=0&&b.x<=c.cw&&b.y>=0&&b.y<=c.ch&&c.put(g,b.x,b.y,e,f,a.alpha,a.display_size)}}function inputControl(){var a,b,e,f,g=0,h=0,d,l=-1,k,i=0,j="NaN",n=0,m=0,c=document;this.o_Left=c.offsetLeft;this.o_Top=c.offsetTop;c.onmousemove=t;function t(c){x=c.clientX;y=c.clientY;if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y}c.onmousedown=function(a){d=a.button};c.onmouseup=function(){d=-1};c.onmousewheel=function(a){k=a.wheelDelta};c.addEventListener("DOMMouseScroll",s,false);function s(a){k=a.detail}c.ontouchmove=function(c){c.preventDefault();if(c.touches.length>0)for(var d=0;d<c.touches.length;d++){var e=c.touches[d];x=e.pageX;y=e.pageY}if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y};c.ontouchstart=function(a){a.preventDefault();x=a.pageX;y=a.pageY;d=0};c.ontouchend=function(a){a.preventDefault();d=-1};this.check=function(){if(m>0){m++;g=a;h=b;d=0;i=0}a=e;b=f;e=g;f=h;l=d;if(d!=0)d=-1;i=k;k=0;j=o(a,b,e,f);n=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));if(a-e==0&&b-f==0)j="NaN";var c={};c.x=g;c.y=h;c.button=l;c.wheel=i;c.deg=j;c.distance=n;return c};this.check_last=function(){var a={};a.x=g;a.y=h;a.button=l;a.wheel=i;a.deg=j;a.distance=n;return a};this.input_pause=function(a){if(wait_count>30)a=30;if(wait_count<0)a=0;m=a};this.draw=function(){var c=canvas.width,d=canvas.height,g=j;context.fillStyle="black";context.fillRect(0,0,canvas.width,canvas.height);context.fillStyle="white";context.fillRect(5,5,canvas.width-10,canvas.height-10);context.fillStyle="green";context.fillText(e+" "+f+" "+c+" "+d+" "+g,32,32);var h="OOO";switch(l){case 0:h="@OO";break;case 1:h="O@O";break;case 2:h="OO@"}context.fillText("b:"+h+" w:"+i,32,232);context.beginPath();context.moveTo(c/2,d/2);context.lineTo(e-a+c/2,f-b+d/2);context.strokeStyle="black";context.stroke();context.beginPath();context.arc(c/2,d/2,5,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();r=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));context.beginPath();context.arc(c/2,d/2,r,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();var k=0,m=0;if(g!="NaN"){g=q(g-90);k=Math.cos(g)*50;m=Math.sin(g)*50}context.beginPath();context.arc(c/2+k,d/2+m,20,0,2*Math.PI,true);context.fillStyle="orange";context.fill();var n=context.getImageData(0,0,canvas.width,canvas.height)};function o(f,g,d,e){var a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=p(Math.atan(c/b));if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a}function q(a){return a*(Math.PI/180)}function p(a){return a*(180/Math.PI)}}function inputKeyboard(){var a="NaN";window.onkeypress=function(b){a=b.keyCode};window.onkeyup=function(){a="NaN"};this.check=function(){return a}}function sce_item_direct_homing(){this.init=function(b,a){a.vector=0;a.vset(16);a.display_size=1};this.move=function(c,a){switch(a.frame){case 1:a.get_target(98);break;case 3:a.get_target(98);a.vector=a.target_v();case 4:if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);b=b<15?b+1:16;a.vset(b)}case 8:a.frame=2}a.frame++;return a.sc_move()}}function sce_item_near_homing(){this.init=function(b,a){a.vset(0);a.get_target(98)};this.move=function(c,a){!Boolean(this.target)&&a.get_target(98);if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);if(b<40){a.vector=a.target_v();a.vset(4)}}return a.sc_move()}}function sce_item_movingstop(){this.init=function(b,a){a.vset(.1)};this.move=function(b,a){a.frame>100&&a.vset(0);a.frame++;return a.sc_move()}}function gameLayout(){this.score_x=640-180;this.score_y=16;this.hiscore_x=640-180;this.hiscore_y=0;this.status_x=640-120;this.status_y=32;this.combo_x=0;this.combo_y=32;this.itemchain_x=0;this.itemchain_y=24;this.zanki_x=20;this.zanki_y=458}function main_r(){var i=60,c=new deviceControl,b=c.graphics1,a=c.graphics2,r=new sceneControl(c),x=c.mouse_state,v=c.key_state,w=new Number(0),s=new Date,g=s.getTime(),p=1,e,m,n,k,l=s.getTime(),d=0,h=0,f,o=0,q=false,t=false;j();function u(){b.readystate_check();a.readystate_check();var c=b.sprite_texture_ready,d=b.character_texture_ready,e=a.sprite_texture_ready,f=a.character_texture_ready;a.print("Load_check",0,20);st="w1s_"+(c?"ready":".");a.print(st,0,40);st="w1t_"+(d?"ready":".");a.print(st,0,60);st="w2s_"+(e?"ready":".");a.print(st,0,80);st="w2t_"+(f?"ready":".");a.print(st,0,100);var h=new Date;a.print(Math.floor((h.getTime()-g)/1e3)+".",0,120);a.clear("black");a.draw();a.reset();return c&&d&&e&&f?true:false}function j(){if(!q){e=500;t=u()}if(t){q=true;var a=new Date,B=a.getTime(),y=[];y.push("runningtime:"+m);var s=x.check(),F=v.check();if(s.wheel!=0)w+=s.wheel>0?1:-1;var D=s.x,E=s.y,z=false;if(s.button==0)z=true;s.button==1;var C="fps:"+1e3/f;f&&y.push(C.substring(0,8));for(var A in y)b.putchr8(y[A],0,0+8*A);r.step();if(z){cl={};cl.x=D;cl.y=E;o++;cl.mode=o%100;cl.draw=cursur_draw;b.putFunc(cl)}b.clear();b.draw();b.reset();r.draw();c.gs.commit();a=new Date;d++;if(d>i)d=0;k=a.getTime()-l;l=a.getTime();h+=k;p=a.getTime();if(d==0){g=a.getTime();f=h/i;h=0}m=a.getTime()-B;n=Math.round(g+d*(1e3/i));e=n-p;if(e<=0)e=1}setTimeout(j,e)}}function cursur_draw(a){a.save();a.setTransform(1,0,0,1,this.x,this.y);a.rotate(3.6*(Math.PI/180)*this.mode);for(var b=0;b<4;b++){a.beginPath();a.moveTo(0,8);a.lineTo(0,24);var c=String(255-this.mode%25*5);a.strokeStyle="rgb("+c+", 128, 255)";a.rotate(45*(Math.PI/180));a.moveTo(0,16);a.lineTo(0,21);a.stroke();a.rotate(45*(Math.PI/180))}a.beginPath();a.arc(0,0,20,0,2*Math.PI,true);a.stroke();a.restore()}function mapSceControl(){var d,f,e,b=-5;this.enable=true;this.counter_runnning=true;this.flame=b;this.stage=1;var c=[],h=[],k=[],i=[],g=[],j=[];c[1]=new Stage1;c[2]=new Stage_a;c[3]=new Stage_b;c[4]=new Stage_c;c[5]=new Stage_d;for(var a=1;a<=5;a++){h[a]=c[a].scenario();k[a]=c[a].bgImage();i[a]=c[a].bgLayout();g[a]=c[a].initial();j[a]=c[a].bgPtn()}this.change=function(a){this.stage=a;d=[];f=h[this.stage];e=g[this.stage]};this.bgImage=function(){return k[this.stage]};this.bgPtn=function(){return j[this.stage]};this.mapChip=function(){return i[this.stage]};this.init=function(){this.stage=1;d=[];f=h[this.stage];e=g[this.stage]};this.reset=function(){this.enable=true;this.counter_runnning=true;b=-5;this.start(true);this.start(false)};this.step=function(g){if(!this.enable)return;if(this.counter_runnning)b++;b=b>1e4?0:b;for(var e in f){var a=f[e];if(a.count<b)continue;if(a.count==b){if(a.x<0&&a.y<0){b=0;break}this.add(a.x,a.y,a.r,a.ch,a.sc)}if(a.count>b)break}for(e in d){var c=d[e];g.set_s(c.x,c.y,c.r,c.ch,c.sce,c.id)}d=[];this.flame=b};this.add=function(f,g,e,c,b,a){if(!this.enable)return;ev={};ev.x=f;ev.y=g;ev.r=e;ev.ch=c;ev.sce=b;if(Boolean(a))ev.id=a;d.push(ev)};this.start=function(b){for(var c in e){var a=e[c];b==a.s&&this.add(a.x,a.y,a.r,a.ch,a.sc)}}}function mapScenro(){var d=[[-1,240,608,0,8,0],[-1,208,608,0,17,10],[-1,272,608,0,17,10],[-1,240,240,0,28,18],[-1,320,320,0,29,19],[50,240,0,180,11,1],[100,440,140,225,10,1],[100,40,140,135,9,1],[120,440,140,225,10,1],[120,40,140,135,9,1],[140,440,140,225,10,1],[140,40,140,135,9,1],[160,440,140,225,10,1],[160,40,140,135,9,1],[180,440,140,225,10,1],[180,40,140,135,9,1],[250,140,0,180,2,1],[250,340,0,180,3,1],[280,140,0,180,2,1],[280,340,0,180,3,1],[310,140,0,180,2,1],[310,340,0,180,3,1],[340,140,0,180,2,1],[340,340,0,180,3,1],[390,464,200,0,"effect_warnning_mark",1],[440,479,200,270,15,1],[450,16,220,0,"effect_warnning_mark",1],[500,1,220,90,15,1],[700,240,0,180,23,14],[900,120,0,180,19,1],[900,360,0,180,19,1],[1120,480,0,180,37,2],[1500,240,40,180,34,14],[1600,480,0,180,53,2],[1700,480,0,180,54,2],[1800,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1]*.875;a.y=b[2]*.75;a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function mapBgImage(){var a=new Image;a.src="pict/sky.jpg";return a}function mapBgLayout(){var d=[[0,0,0],[0,0,480],[0,0,960]],c=[];for(var e in d){var b=d[e],a={};a.no=b[0];a.x=b[1];a.y=b[2];c.push(a)}return c}function mapInitial(){}function sce_message_billboard(b,a){this.init=function(d,c){c.vset(0);c.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;c.p_count=0;c.mes_col=0;c.mes_line=0;c.p_wait=a;c.p_endflag=false;c.p_st=b;c.x=c.gt.world_x+1;c.y=c.gt.world_y+1};this.move=function(b,a){a.x=a.gt.world_x+1;a.y=a.gt.world_y+1;a.p_count--;if(a.p_count<=0){if(a.p_endflag)a.status=0;a.mes_col++;if(a.mes_col>a.p_st[a.mes_line].length){a.mes_col=0;a.mes_line++;if(a.mes_line>a.p_st.length-1){a.mes_line=a.p_st.length-1;a.mes_col=a.p_st[a.mes_line].length;a.p_endflag=true}}a.p_count=a.p_wait+(a.p_endflag?40:0)}return a.sc_move()};this.draw=function(c,b){for(var a=0;a<=b.mes_line;a++)if(a<b.mes_line)c.putchr(b.p_st[a],95,150+16*a);else{var d=b.p_st[a].slice(0,b.mes_col+1);c.putchr(d,95,150+16*a)}}}function sce_message_small(a){this.init=function(b,a){a.vset(1);a.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;a.w_st=a.id;a.x-=a.w_st.length*8/2;a.display_size=1};this.move=function(b,a){if(a.frame>50)a.status=0;a.display_size=1+a.frame/150;a.frame++;return a.sc_move()};this.draw=function(d,b){var c=b.gt.worldtoView(b.x,b.y);d.putchr8c(b.w_st,c.x,c.y,a,b.display_size)}}function sce_message_normal(a){this.init=function(c,b){b.vset(0);b.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;b.w_st=b.id;b.x-=b.w_st.length*12/2;b.wait=a;b.display_size=1};this.move=function(c,b){if(b.frame>a)b.status=0;b.display_size=1+b.frame/60;b.frame++;return b.sc_move()};this.draw=function(c,a){var b=a.gt.worldtoView(a.x,a.y);c.putchr(a.w_st,b.x,b.y,a.display_size)}}function sce_message_bosstriger(){this.init=function(b,a){a.vset(0);a.type=5;this.normal_draw_enable=false;a.x=a.gt.world_x+1;a.y=a.gt.world_y+1};this.move=function(b,a){a.x=a.gt.world_x+1;a.y=a.gt.world_y+1;a.SIGNAL(6055);a.status=0;return a.sc_move()}}function motionPattern(){var b=[],a=0;b[a]={};b[a].wait=0;b[a].pattern=[["Space",0,0]];a=1;b[a]={};b[a].pattern=[["Ship",0,0]];a=2;b[a]={};b[a].pattern=[["Ship_r",2,0]];a=3;b[a]={};b[a].pattern=[["Ship_r",0,0]];a=4;b[a]={};b[a].wait=18;b[a].pattern=[["Enemy1",-1,-1],["Enemy2",-1,-1],["Enemy3",-1,-1]];a=5;b[a]={};b[a].wait=10;b[a].pattern=[["S_Tama",0,0],["S_Tama",2,0],["S_Tama",3,0],["S_Tama",1,0]];a=6;b[a]={};b[a].pattern=[["MoTama",0,0]];a=7;b[a]={};b[a].pattern=[["MbTama",0,0]];a=8;b[a]={};b[a].pattern=[["YaTama",-1,-1]];a=9;b[a]={};b[a].pattern=[["Zanki",-1,-1]];a=10;b[a]={};b[a].wait=10;b[a].pattern=[["Bomb3",0,0],["Bomb1",0,0],["Bomb2",0,0],["Bomb3",0,0],["Bomb4",0,0],["Bomb5",0,0]];a=11;b[a]={};b[a].wait=5;b[a].pattern=[["Powup1",0,0],["Powup2",0,0],["Powup4",0,0],["Powup3",1,0],["Powup2",1,0],["Powup1",1,0],["Powup2",1,0],["Powup3",1,0],["Powup2",0,0]];a=12;b[a]={};b[a].pattern=[["Boss",-1,-1]];a=13;b[a]={};b[a].pattern=[["Wave",0,0]];a=14;b[a]={};b[a].pattern=[["Missile",-1,-1]];a=15;b[a]={};b[a].pattern=[["Option",0,0]];a=15;b[a]={};b[a].wait=20;b[a].pattern=[["Option1",0,0],["Option1",1,0],["Option2",1,0],["Option3",0,0],["Option2",0,0]];a=16;b[a]={};b[a].pattern=[["Boardw",0,0]];a=17;b[a]={};b[a].pattern=[["Boardh",0,0]];a=18;b[a]={};b[a].pattern=[["Bonus",0,0]];a=19;b[a]={};b[a].pattern=[["MiniB",-1,-1]];a=20;b[a]={};b[a].pattern=[["Wave",-1,-1]];a=21;b[a]={};b[a].pattern=[["Laser",-1,-1]];a=22;b[a]={};b[a].pattern=[["pBall",0,0]];a=23;b[a]={};b[a].pattern=[["Laser2",-1,-1]];a=24;b[a]={};b[a].pattern=[["Gunpod",0,0]];a=25;b[a]={};b[a].pattern=[["Warn",0,0]];a=26;b[a]={};b[a].wait=5;b[a].pattern=[["Coin1",0,0],["Coin2",0,0],["Coin3",0,0],["Coin4",0,0],["Coin3",2,0],["Coin2",2,0],["Coin1",2,0]];a=27;b[a]={};b[a].pattern=[["Kobold",0,0]];a=28;b[a]={};b[a].pattern=[["Warn",0,0]];a=29;b[a]={};b[a].pattern=[["Bonus_r",0,0]];a=30;b[a]={};b[a].pattern=[["Bonus_g",0,0]];a=31;b[a]={};b[a].wait=5;b[a].pattern=[["Coin11",0,0],["Coin12",0,0],["Coin13",0,0],["Coin14",0,0],["Coin13",2,0],["Coin12",2,0],["Coin11",2,0]];a=32;b[a]={};b[a].wait=5;b[a].pattern=[["Coin51",0,0],["Coin52",0,0],["Coin53",0,0],["Coin54",0,0],["Coin53",2,0],["Coin52",2,0],["Coin51",2,0]];a=33;b[a]={};b[a].wait=5;b[a].pattern=[["Coin101",0,0],["Coin102",0,0],["Coin103",0,0],["Coin104",0,0],["Coin103",2,0],["Coin102",2,0],["Coin101",2,0]];return b}function sce_player(){this.init=function(b,a){a.triger=10;a.w_powup=-1;a.int_shot=0;a.custom_draw_enable=true;a.move_target_x=a.x;a.move_target_y=a.y;a.line_x=a.x;a.line_y=a.y;a.gt.viewpos(a.x-a.gt.viewwidth/2,a.y-a.gt.viewheight/2);a.selection=true};this.draw=a;this.move=function(c,a){a.frame++;if(a.frame<=90){a.hp=10;a.damageflag=false}if(a.mouse_state.x>=0&&a.mouse_state.x<=c.cw&&a.mouse_state.y>=0&&a.mouse_state.y<=c.ch){var d=a.gt.viewtoWorld(a.mouse_state.x,a.mouse_state.y);a.move_target_x=a.mouse_state.x;a.move_target_y=a.mouse_state.y}var f=a.gt.viewtoWorld(a.move_target_x,a.move_target_y);if(a.selection)a.vector=a.target_r(f.x,f.y);a.vset(8);var h=a.vector;a.triger--;if(a.triger<=0){a.shot=0;a.triger=5}var b=0;for(var e in a.item)if(e==7)b=a.item[e];if(b!=a.w_powup){a.w_powup=b;b==9&&a.set_object_ex(10,a.x,a.y,0,16);if(b>10){a.bomb2();a.set_object_ex(6,a.x,a.y,0,48)}}if(eval(a.mouse_state.button)==0)if(a.shot==0){a.shot=1;a.mp=1;a.triger=5}eval(a.mouse_state.button)==1;if(a.x+a.vx-a.center_x<0)a.vx=0;if(a.y+a.vy-a.center_y<0)a.vy=0;if(a.x+a.vx+a.center_x>a.gt.ww)a.vx=0;if(a.y+a.vy+a.center_y>a.gt.wh)a.vy=0;a.damageflag&&a.set_object_ex(20,a.x,a.y,0,42,"Damege!");a.damageflag=false;var d=a.gt.worldtoView(a.x,a.y);d.x<150&&a.mouse_state.x<150&&a.vx<0&&a.gt.viewpos(a.gt.world_x+a.vx,a.gt.world_y);d.x>c.cw-150&&a.mouse_state.x>c.cw-150&&a.vx>0&&a.gt.viewpos(a.gt.world_x+a.vx,a.gt.world_y);d.y<150&&a.mouse_state.y<150&&a.vy<0&&a.gt.viewpos(a.gt.world_x,a.gt.world_y+a.vy);d.y>c.ch-150&&a.mouse_state.y>c.ch-150&a.vy>0&&a.gt.viewpos(a.gt.world_x,a.gt.world_y+a.vy);var d=a.gt.viewtoWorld(a.mouse_state.x,a.mouse_state.y);a.x=d.x;a.y=d.y;var g=0;if(a.status==2){if(a.config.itemreset){if(b==0)b=1;for(e=1;e<=b;e++)this.set_object_ex(7,a.x,a.y,Math.floor(Math.random()*360),38)}a.display_size=2.5;a.change_sce(7)}if(a.status==0)g=1;return g};function a(d,a){var b={};b.x=a.move_target_x;b.y=a.move_target_y;b.sr=(360*((a.maxhp-a.hp)/a.maxhp)-90)*(Math.PI/180);b.df=a.damageflag;b.r=a.frame<90?105-a.frame:15;var c=a.gt.worldtoView(a.x,a.y);b.sx=c.x;b.sy=c.y;c=a.gt.worldtoView(a.line_x,a.line_y);b.ex=c.x;b.ey=c.y;b.d=Math.floor(a.target_d(a.line_x,a.line_y));if(b.d>255)b.d=255;b.ld=a.line_draw;b.draw=function(a){if(this.ld){a.beginPath();a.strokeStyle="rgb("+String(this.d)+" ,128, 0)";a.lineWidth="2";a.moveTo(this.sx,this.sy);a.lineTo(this.ex,this.ey);a.closePath();a.stroke()}};d.putFunc(b)}}function sce_player_start(){this.init=function(b,a){a.type=98;a.vector=0;a.vset(8);a.gt.viewpos(a.x-210,a.y-240)};this.move=function(b,a){a.hp=10;switch(a.frame){case 30:a.vector=180;a.vset(4);break;case 58:case 60:a.vset(3);a.hp=10;a.change_sce(1)}a.frame++;return a.sc_move()}}function scenario(){for(var d={},a=[],c=[],b=[],e=0;e<=37;e++){a[e]=function(b,a){a.vset(5)};b[e]=function(b,a){return a.sc_move()}}w=new sce_player;a[1]=w.init;b[1]=w.move;c[1]=w.draw;a.player=w.init;b.player=w.move;c.player=w.draw;w=new sce_common_vset(4);a[4]=w.init;b[4]=w.move;a.common_vset4=w.init;b.common_vset4=w.move;w=new sce_effect_vanish;a[6]=w.init;b[6]=w.move;a.effect_vanish=w.init;b.effect_vanish=w.move;w=new sce_effect_bomb;a[7]=w.init;b[7]=w.move;a.effect_bomb=w.init;b.effect_bomb=w.move;w=new sce_common_vset(6);a[12]=w.init;b[12]=w.move;a.common_vset6=w.init;b.common_vset6=w.move;w=new sce_common_vset(16);a[13]=w.init;b[13]=w.move;a.common_vset16=w.init;b.common_vset16=w.move;w=new sce_common_vset(0);a[22]=w.init;b[22]=w.move;a.common_vset0=w.init;b.common_vset0=w.move;w=new sce_common_vset(2);a[24]=w.init;b[24]=w.move;a.common_vset2=w.init;b.common_vset2=w.move;w=new sce_common_vset(8);a[25]=w.init;b[25]=w.move;a.common_vset8=w.init;b.common_vset8=w.move;w=new sce_common_vset(10);a[26]=w.init;b[26]=w.move;a.common_vset10=w.init;b.common_vset10=w.move;w=new sce_message_small(0);a[39]=w.init;b[39]=w.move;c[39]=w.draw;a.message_small_w=w.init;b.message_small_w=w.move;c.message_small_w=w.draw;w=new sce_message_small(1);a[42]=w.init;b[42]=w.move;c[42]=w.draw;a.message_small_r=w.init;b.message_small_r=w.move;c.message_small_r=w.draw;w=new sce_message_small(2);a[43]=w.init;b[43]=w.move;c[43]=w.draw;a.message_small_g=w.init;b.message_small_g=w.move;c.message_small_g=w.draw;w=new sce_message_small(3);a[44]=w.init;b[44]=w.move;c[44]=w.draw;a.message_small_b=w.init;b.message_small_b=w.move;c.message_small_b=w.draw;w=new sce_effect_bombcircle("rgba(255, 64, 64, 0.7)");a[47]=w.init;b[47]=w.move;c[47]=w.draw;a.effect_bombcircle_r=w.init;b.effect_bombcircle_r=w.move;c.effect_bombcircle_r=w.draw;w=new sce_effect_bombcircle("rgba(255, 255, 255, 0.7)");a[48]=w.init;b[48]=w.move;c[48]=w.draw;a.effect_bombcircle_w=w.init;b.effect_bombcircle_w=w.move;c.effect_bombcircle_w=w.draw;w=new sce_common_signal(835);a[54]=w.init;b[54]=w.move;a.common_signal_result=w.init;b.common_signal_result=w.move;w=new sce_effect_warnning_mark;a[55]=w.init;b[55]=w.move;a.effect_warnning_mark=w.init;b.effect_warnning_mark=w.move;w=new sce_message_normal(60);a[57]=w.init;b[57]=w.move;c[57]=w.draw;a.message_normal_60=w.init;b.message_normal_60=w.move;c.message_normal_60=w.draw;w=new sce_message_bosstriger;a[58]=w.init;b[58]=w.move;a.message_bosstriger=w.init;b.message_bosstriger=w.move;w=new sce_friend_passive;a.friend_passive=w.init;b.friend_passive=w.move;d.init=a;d.draw=c;d.move=b;return d}function sceneBase(a){var g=a.graphics1,f=a.graphics2;this.init=d;this.reset=b;this.step=e;this.draw=c;function d(){}function b(){}function e(){return 0}function c(){}}function sceneConfig(n){var i=n.graphics1,e=n.graphics2,b=n.text,B=n.mouse_state,A=n.key_state;this.init=x;this.reset=v;this.step=y;this.draw=w;var j;this.score=0;this.config={};var d=[],c=[],r=[],l,t=false,s=false,u,k,a=[],f=["PickUp.","---.","---.","Tough.","---.","Stage."],o=["\u771f\u3093\u4e2d\u30dc\u30bf\u30f3\u62bc\u4e0b\u3067\u6301\u3063\u3066\u79fb\u52d5\u3059\u308b :","\u672a\u4f7f\u7528 :","\u672a\u4f7f\u7528 :","\u304c\u307e\u53e3\u306e\u5897\u5f37\uff08\u5bb9\u91cf+5\u679a) :","\u672a\u4f7f\u7528 : ","\u958b\u59cb\u9762\u306e\u9078\u629e : "];c[5]=1;for(var p=60,q=180,h=0;h<f.length-1;h++){m={};m.title=f[h];m.x=p;m.y=q+h*20;m.w=120;m.h=16;m.msg=o[h];m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();return 0};a.push(m);for(var g=0;g<2;g++){m={};m.title=g==0?"  On":"  Off";m.x=p+80+80*(g+1);m.y=q+h*20;m.w=80;m.h=16;m.msg=o[h]+(g==0?"\u6709\u52b9":"\u7121\u52b9");m.sel=false;m.lamp=false;m.num=h;m.sw=g==0?true:false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();d[this.num]=this.sw;return 0};a.push(m)}}m={};m.title=f[f.length-1]+c[f.length-1];m.x=p;m.y=q+(f.length-1)*20;m.w=120;m.h=16;m.msg=o[h];m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();return 0};wm=m;a.push(m);for(var g=0;g<2;g++){m={};m.title=g==0?"  +1":"  -1";m.x=p+80+80*(g+1);m.y=q+(f.length-1)*20;m.w=80;m.h=16;m.msg=o[h];m.sel=false;m.lamp=false;m.num=f.length-1;m.sw=g==0?1:-1;m.func=function(){d[this.num]=this.sw==1?true:false;c[this.num]+=this.sw;if(c[this.num]<1)c[this.num]=1;if(c[this.num]>5)c[this.num]=5;wm.title=f[this.num]+c[this.num];b.clear();b.reset();b.print(this.msg+c[this.num]+"\u9762",100,320,"white");b.draw();return 0};a.push(m)}m={};m.title="Save.";m.x=100;m.y=360;m.w=120;m.h=16;m.jp=2;m.msg="Save.";m.sel=false;m.lamp=false;m.config=this.config;m.result=this.result;m.func=function(){t=true;j=true;return 0};a.push(m);m={};m.title="Reset.";m.x=100;m.y=380;m.w=120;m.h=16;m.jp=2;m.msg="Reset.";m.sel=false;m.lamp=false;m.func=function(){s=true;j=true;return 0};a.push(m);m={};m.title="Exit.";m.x=100;m.y=400;m.w=120;m.h=16;m.jp=2;m.msg="Exit.";m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();return this.jp};a.push(m);var z,C=new Number(0);this.config_load=function(){if(Boolean(localStorage)){for(var b=["fullpower","sideshot","itemreset","option","dummy","startstage"],e=false,a=0;a<=3;a++)if(Boolean(localStorage.getItem(b[a]))){e=true;d[a]=localStorage.getItem(b[a])=="on"?true:false;this.config[b[a]]=d[a]}if(Boolean(localStorage.getItem(b[5]))){e=true;c[5]=parseInt(localStorage.getItem(b[5]));this.config[b[5]]=c[5];wm.title=f[5]+c[5]}}};function x(){this.config.fullpower=false;this.config.sideshot=false;this.config.itemreset=false;this.config.option=false;this.config.startstage=1;this.config.cold=true;this.config.debug=false;d[0]=this.config.fullpower;d[1]=this.config.sideshot;d[2]=this.config.itemreset;d[3]=this.config.option;d[4]=false;d[5]=false;c[5]=this.config.startstage}function v(){for(var b in a){a[b].sel=false;a[b].lamp=false}u=false;k=0;z=0;e.clear("darkblue");cl={};cl.w=i.cw;cl.h=i.ch;cl.draw=function(a){var c=this.h;if(c<this.w)c=this.w;a.beginPath();for(var b=0;b<c;b+=16){a.moveTo(b,0);a.lineTo(b,this.h);a.moveTo(0,b);a.lineTo(this.w,b)}a.strokeStyle="lightgray";a.stroke()};e.putFunc(cl);e.draw();e.reset();for(b in c)if(Boolean(c[b]))r[b]=c[b];j=true}function y(){l=[];var h=B.check_last(),o=A.check(),p=h.x,q=h.y;if(h.button==0&&!j){for(var g in a)if(a[g].sel){var m=a[g].func();if(m!=0)return m}}else for(g in c)if(Boolean(c[g]))r[g]=c[g];if(h.button==-1)j=false;if(u){var i={};i.cw=e.cw;i.ch=e.ch;i.y1=e.ch/2-k;i.y2=e.ch/2+k;i.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};e.putFunc(i);e.draw();e.reset();k+=4;if(e.ch/2-k<0)return 1}var n=-1;for(g in a)if(h.x>=a[g].x&&h.x<=a[g].x+a[g].w&&h.y>=a[g].y&&h.y<=a[g].y+a[g].h){a[g].sel=true;n=g}else a[g].sel=false;l.push("== Configration ==");l.push("-----------------");for(g in d)if(d[g]){a[g*3+1].lamp=true;a[g*3+2].lamp=false}else{a[g*3+1].lamp=false;a[g*3+2].lamp=true}for(g in c)if(Boolean(c[g]))if(c[g]!=r[g]){a[g*3+1].lamp=false;a[g*3+2].lamp=false;a[g*3+1].sel=false;a[g*3+2].sel=false}this.config.fullpower=d[0];this.config.sideshot=d[1];this.config.itemreset=d[2];this.config.option=d[3];this.config.startstage=c[5];if(s){d[0]=false;d[1]=false;d[2]=false;d[3]=false;d[4]=false;d[5]=false;c[5]=1;wm.title=f[5]+c[5];b.clear();b.reset();b.print("\u8a2d\u5b9a\u521d\u671f\u5316\u3057\u307e\u3057\u305f\u3002",100,320,"white");if(Boolean(localStorage)){localStorage.clear();b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u30af\u30ea\u30a2\u3002",100,340,"white")}else b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,340,"white");b.draw();s=false}if(t){b.clear();b.reset();if(Boolean(localStorage)){localStorage.setItem("fullpower",this.config.fullpower?"on":"off");localStorage.setItem("sideshot",this.config.sideshot?"on":"off");localStorage.setItem("itemreset",this.config.itemreset?"on":"off");localStorage.setItem("option",this.config.option?"on":"off");localStorage.setItem("startstage",new String(this.config.startstage));b.print("\u8a2d\u5b9a\u3092\u30bb\u30fc\u30d6\u3057\u307e\u3057\u305f\u3002",100,320,"white")}else b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,320,"white");b.draw();t=false}return 0}function w(){for(var d in l)i.putchr(l[d],0,100+16*d);for(var b in a){if(a[b].lamp){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};i.putFunc(c)}if(a[b].sel)i.putchr(a[b].title,a[b].x-4,a[b].y-1);else i.putchr(a[b].title,a[b].x,a[b].y)}}}function sceneControl(d){var a=[];a[1]=new gameScene(d);a[2]=new sceneTitle(d);a[3]=new sceneGover(d);a[4]=new sceneConfig(d);a[5]=new sceneResult(d);for(var e in a)a[e].init();var f=a[1].result,g=a[4].config;a[1].score_load();a[4].config_load();for(var e in a){a[e].result=f;a[e].config=g}var h=a[2],c=2,b=c;this.step=function(){if(c!=0){var f=a[b].result,e=a[b].config,d=false;if(c>=10){c=c%10;d=true}b=c;a[b].reset(d);a[b].result=f;a[b].config=e}c=a[b].step()};this.draw=function(){a[b].draw()}}function sceneGover(c){var g=c.graphics1,b=c.graphics2,o=c.mouse_state,q=c.key_state;this.init=l;this.reset=j;this.step=n;this.draw=k;var f,e,i,d,h,a=[];m={};m.title="End.";m.x=320-50;m.y=180;m.w=120;m.h=16;m.sel=false;m.func=function(){return 2};a.push(m);function l(){}function j(){for(var e in a)a[e].sel=false;i=false;d=2;h=0;var m={};m.cw=b.cw;m.ch=b.ch;m.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="black";a.stroke()}};b.putFunc(m);var g=this.result.score,j=[],k="";for(e=0;e<7;e++){var l=g%10;j[7-e]=l;g=(g-l)/10}for(e in j)k=k+""+j[e];b.putchr("Score:"+k,c.layout.score_x,c.layout.score_y);g=this.result.highscore;j=[];k="";for(e=0;e<7;e++){var l=g%10;j[7-e]=l;g=(g-l)/10}for(e in j)k=k+""+j[e];b.putchr("Hi-Sc:"+k,c.layout.hiscore_x,c.layout.hiscore_y);b.draw();b.reset();this.config.cold=true;f=true}function n(){e=[];var g=o.check_last();if(g.button==0&&!f)for(var c in a)if(a[c].sel){var k=a[c].func();if(k!=0)return k}if(g.button==-1)f=false;if(i){var j={};j.cw=b.cw;j.ch=b.ch;j.y1=b.ch/2-d;j.y2=b.ch/2+d;j.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(j);b.draw();b.reset();d+=8;if(b.ch/2-d<0)return h}for(c in a)if(g.x>=a[c].x&&g.x<=a[c].x+a[c].w&&g.y>=a[c].y&&g.y<=a[c].y+a[c].h)a[c].sel=true;else a[c].sel=false;e.push("== Game Over ==");e.push("---------------");return 0}function k(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};g.putFunc(c)}g.putchr(a[b].title,a[b].x,a[b].y)}for(var d in e)g.putchr(e[d],320-72,132+16*d)}}function sceneResult(c){var i=c.graphics1,b=c.graphics2,e=c.text,p=c.mouse_state,q=c.key_state;this.init=n;this.reset=l;this.step=o;this.draw=m;var h,g,k,f,j,a=[],d={};d.title="[   ok.  ]";d.x=320-80;d.y=320;d.w=120;d.h=16;d.sel=false;d.gover=false;d.func=function(){e.clear();return this.gover?3:11};a.push(d);function n(){}function l(){for(var d in a)a[d].sel=false;k=false;f=2;j=0;var p={};p.cw=b.cw;p.ch=b.ch;p.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="darkblue";a.stroke()}};b.putFunc(p);var i=this.result.score,l=[],m="";for(d=0;d<7;d++){var o=i%10;l[7-d]=o;i=(i-o)/10}for(d in l)m=m+""+l[d];b.putchr("Score:"+m,c.layout.score_x,c.layout.score_y);i=this.result.highscore;l=[];m="";for(d=0;d<7;d++){var o=i%10;l[7-d]=o;i=(i-o)/10}for(d in l)m=m+""+l[d];b.putchr("Hi-Sc:"+m,c.layout.hiscore_x,c.layout.hiscore_y);b.draw();b.reset();var g=[],q=190+10*this.result.nowstage+this.result.loop*50;g.push("\u76ee\u6a19\u91d1\u984d\uff1a"+q);g.push("----------");g.push("\u53d6\u5f97\u786c\u8ca8 ===============================");var n=0;for(d in this.result.item){if(d==25){n+=this.result.item[d]*1;g.push("\u4e00\u5186\u786c\u8ca8 \uff58 "+this.result.item[d])}if(d==26){n+=this.result.item[d]*5;g.push("\u4e94\u5186\u786c\u8ca8 \uff58 "+this.result.item[d])}if(d==27){n+=this.result.item[d]*10;g.push("\u5341\u5186\u786c\u8ca8 \uff58 "+this.result.item[d])}}g.push("========================================");g.push("\u53d6\u5f97\u91d1\u984d : "+n);if(n>=q){g.push(" ");g.push("\u76ee\u6a19\u91d1\u984d\u9054\u6210!!");for(d in a)a[d].gover=false}else{g.push(" ");g.push("\u76ee\u6a19\u91d1\u984d\u306b\u5c4a\u304b\u305a\u3002");for(d in a)a[d].gover=true}e.reset();for(var r in g)e.print(g[r],320-150,150+16*r,"yellow");e.clear();e.draw();e.reset();h=true}function o(){g=[];var d=p.check_last();if(d.button==0&&!h)for(var c in a)if(a[c].sel){var i=a[c].func();if(i!=0)return i}if(d.button==-1)h=false;if(k){var e={};e.cw=b.cw;e.ch=b.ch;e.y1=b.ch/2-f;e.y2=b.ch/2+f;e.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(e);b.draw();b.reset();f+=8;if(b.ch/2-f<0)return j}for(c in a)if(d.x>=a[c].x&&d.x<=a[c].x+a[c].w&&d.y>=a[c].y&&d.y<=a[c].y+a[c].h)a[c].sel=true;else a[c].sel=false;var l=this.result.nowstage+this.result.loop*5;g.push(" == Stage -"+l+"- Result ==");return 0}function m(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};i.putFunc(c)}i.putchr(a[b].title,a[b].x,a[b].y)}for(var d in g)i.putchr(g[d],320-150,96+16*d)}}function sceneTitle(f){var h=f.graphics1,b=f.graphics2,t=f.mouse_state,r=f.key_state;this.init=o;this.reset=l;this.step=p;this.draw=n;for(var g,d,i,c,a=[],j=["GameStart.","Config"],s=[1,4],e=0;e<j.length;e++){m={};m.title=j[e];m.x=320-50;m.y=320+e*20;m.w=120;m.h=16;m.jp=s[e];m.sel=false;m.func=function(){return this.jp};a.push(m)}var q,k=new Number(0);function o(){k=0}function l(){for(var d in a)a[d].sel=false;i=false;c=0;q=0;b.clear("black");b.put("Enemy1",320-50,208);b.put("Coin11",320-50,240);b.put("Coin51",320-50+16,240);b.put("Coin101",320-50+32,240);b.put("Coin1",320-50,272);b.putchr("Gamaguchi",320,208-8);b.putchr("Coin",320,240-8);b.putchr("Medal",320,272-8);b.draw();b.reset();this.config.cold=true;g=true}function p(){d=[];var e=t.check_last(),l=r.check();if(e.wheel!=0)k+=e.wheel>0?1:-1;var m=e.x,n=e.y;if(e.button==0&&!g)for(var f in a)if(a[f].sel){var j=a[f].func();if(j!=0)return j}e.button==1;if(e.button==-1)g=false;if(i){var h={};h.cw=b.cw;h.ch=b.ch;h.y1=b.ch/2-c;h.y2=b.ch/2+c;h.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(h);b.draw();b.reset();c+=4;if(b.ch/2-c<0)return 1}for(f in a)if(e.x>=a[f].x&&e.x<=a[f].x+a[f].w&&e.y>=a[f].y&&e.y<=a[f].y+a[f].h)a[f].sel=true;else a[f].sel=false;d.push("== Coin Savings ==");d.push("------------------");return 0}function n(){for(var c in d)h.putchr(d[c],320-100,132+16*c);for(var b in a)if(a[b].sel)h.putchr(a[b].title,a[b].x-4,a[b].y-1);else h.putchr(a[b].title,a[b].x,a[b].y)}}function star_draw(a){a.save();a.setTransform(1,0,0,1,this.x,this.y);a.rotate(1.8*(Math.PI/180)*this.mode);a.beginPath();a.fillStyle="orange";a.fillRect(-80,-80,160,160);a.rotate(45*(Math.PI/180));a.beginPath();a.fillStyle="orange";a.fillRect(-80,-80,160,160);a.restore()}function Screen(o){var m=new Image;m.src="pict/cha.png";var e=new Image;e.src="pict/aschr.png";var a=[],h=[],b=document.createElement("canvas");b.id=o;b.width="640";b.height="480";b.style.margin="0";b.style.padding="0";b.style.position="absolute";b.style.top=0;b.style.left=0;var z=document.getElementsByTagName("body").item(0);z.appendChild(b);var c=document.getElementById(o),d=c.getContext("2d");this.cw=c.width;this.ch=c.height;var l=false,k=false;this.sprite_texture_ready=l;this.character_texture_ready=k;d.font="16px 'Arial'";m.onload=function(){l=true};e.onload=function(){k=true};this.readystate_check=function(){this.sprite_texture_ready=l;this.character_texture_ready=k};var f=spdata(),D=[];for(i=0;i<7;i++)for(j=0;j<16;j++){ptn={};ptn.x=12*j;ptn.y=16*i;ptn.w=12;ptn.h=16;h.push(ptn)}var n=[];for(i=0;i<7;i++)for(j=0;j<16;j++){ptn={};ptn.x=8*j;ptn.y=8*i+128;ptn.w=8;ptn.h=8;n.push(ptn)}for(var p=[],g=0;g<=3;g++){var q=[];for(i=0;i<7;i++)for(j=0;j<16;j++){ptn={};ptn.x=8*j+(g%2==0?0:128);ptn.y=8*i+128+(g>=2?64:0);ptn.w=8;ptn.h=8;q.push(ptn)}p[g]=q}this.lighter_enable=true;this.put=function(g,h,i,d,e,c,f){if(!Boolean(d))d=0;if(!Boolean(e))e=0;if(!Boolean(c))c=255;if(!Boolean(f))f=1;var b={};b.sp=g;b.x=h;b.y=i;b.m=d;b.r=e;b.alpha=c;b.z=f;b.draw=B;b.le=this.lighter_enable;a.push(b)};function B(a){a.save();var d=1,c=1;switch(this.m){case 1:d=-1;break;case 2:c=-1;break;case 3:d=-1;c=-1}var b=f[this.sp];a.setTransform(c,0,0,d,this.x,this.y);this.r!=0&&a.rotate(Math.PI/180*this.r);if(this.alpha==255)a.globalCompositeOperation="source-over";else if(this.le)a.globalCompositeOperation="lighter";a.globalAlpha=this.alpha*(1/255);a.drawImage(m,b.x,b.y,b.w,b.h,-b.w/2*this.z,-b.h/2*this.z,(0+b.w)*this.z,(0+b.h)*this.z);a.restore()}this.putPattern=function(d,c,g,h,f,e){var b={};b.gr=d;b.x=g;b.y=h;b.w=f;b.h=e;b.no=c;b.draw=A;a.push(b)};function A(b){var a=this.no;b.drawImage(this.gr,a.x,a.y,a.w,a.h,this.x,this.y,this.w,this.h)}this.print=function(d,e,f,c){if(!Boolean(c))c="limegreen";var b={};b.text=d;b.x=e;b.y=f;b.color=c;b.draw=y;a.push(b)};function y(a){a.fillStyle=this.color;a.fillText(this.text,this.x,this.y)}this.putchr=function(f,g,h,c){var e=false;if(!Boolean(c))c=1;else if(c!=1)e=true;for(i=0;i<f.length;i++){var d=f.charCodeAt(i);if(d>=32&&d<128){var b={};b.chrno=d-32;b.x=g+i*(12*c);b.y=h;if(!e)b.draw=x;else{b.z=c;b.draw=w}a.push(b)}}};function x(b){var a=h[this.chrno];b.drawImage(e,a.x,a.y,a.w,a.h,this.x,this.y,a.w,a.h)}function w(b){var a=h[this.chrno];b.drawImage(e,a.x,a.y,a.w,a.h,this.x,this.y,a.w*this.z,a.h*this.z)}this.putchr8=function(d,e,f){for(i=0;i<d.length;i++){var c=d.charCodeAt(i);if(c>=32&&c<128){var b={};b.chrno=c-32;b.x=e+i*8;b.y=f;b.draw=v;a.push(b)}}};function v(b){var a=n[this.chrno];b.drawImage(e,a.x,a.y,a.w,a.h,this.x,this.y,a.w,a.h)}this.putchr8c=function(e,g,h,f,c){if(!Boolean(c))c=1;for(i=0;i<e.length;i++){var d=e.charCodeAt(i);if(d>=32&&d<128){var b={};b.chrno=d-32;b.x=g+i*(8*c);b.y=h;b.c=f;b.z=c;b.draw=t;a.push(b)}}};function t(b){var a=p[this.c][this.chrno];b.drawImage(e,a.x,a.y,a.w,a.h,this.x+-a.w/2*this.z,this.y+-a.h/2*this.z,a.w*this.z,a.h*this.z)}this.putImage=function(c,d,e){var b={};b.g=c;b.x=d;b.y=e;b.draw=u;a.push(b)};function u(a){a.drawImage(this.g,this.x,this.y)}this.putImage2=function(c,f,g,e,d){var b={};b.g=c;b.x=f;b.y=g;b.w=e;b.h=d;b.draw=s;a.push(b)};function s(a){a.drawImage(this.g,this.x,this.y,this.w,this.h)}this.putImageTransform=function(g,h,i,c,d,e,f){var b={};b.g=g;b.x=h;b.y=i;b.m11=c;b.m12=d;b.m21=e;b.m22=f;b.draw=r;a.push(b)};function r(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.x,this.y);a.drawImage(this.g,0,0);a.restore()}this.transform=function(a,b,c,e){d.setTransform(a,b,c,e,0,0)};this.putFunc=function(b){a.push(b)};this.clear=function(a){d.save();d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,c.width,c.height);d.restore();if(Boolean(a)){d.fillStyle=a;d.fillRect(0,0,c.width,c.height)}};this.reset=function(){a=[]};this.draw=function(){for(var b in a)a[b].draw(d)};this.spptn_test=function(){var b=0,d=16;for(var a in f){this.put(a,b+f[a].w/2,d);b+=f[a].w;if(b+f[a].w>c.width){b=0;d+=32;if(d>c.height)d=0}}}}function soundControl(){}function spdata(){var d=[["Ship",0,0,31,31],["Ship_r",32,0,31,31],["Enemy1",64,0,31,31],["Enemy2",96,0,31,31],["Enemy3",128,0,31,31],["S_Tama",0,32,7,7],["MoTama",16,32,15,15],["MbTama",32,32,15,15],["YaTama",48,32,15,15],["Zanki",64,32,15,15],["Space",0,48,15,15],["Star1",16,48,15,15],["Star2",32,48,15,15],["Star3",48,48,15,15],["Bomb1",160,0,31,31],["Bomb2",192,0,31,31],["Bomb3",224,0,31,31],["Bomb4",256,0,31,31],["Bomb5",288,0,31,31],["Powup1",128,32,31,15],["Powup2",160,32,31,15],["Powup3",192,32,31,15],["Powup4",224,32,31,15],["Boss",0,64,31,31],["MiniB",32,64,16,16],["Wave",64,64,159,31],["Missile",80,32,15,15],["Laser",48,64,15,31],["Laser2",80,48,15,15],["Option",96,32,15,15],["Option1",96,32,15,15],["Option2",64,144,15,15],["Option3",64,160,15,15],["Gunpod",80,144,15,31],["Boardw",0,96,223,31],["Boardh",288,32,31,95],["pBall",64,48,15,15],["Bonus",112,32,15,15],["Bonus_b",112,32,15,15],["Bonus_r",0,160,15,15],["Bonus_g",16,160,15,15],["Coin1",0,32,15,15],["Coin2",16,32,15,15],["Coin3",32,32,15,15],["Coin4",48,32,15,15],["Coin11",64,32,15,15],["Coin12",80,32,15,15],["Coin13",96,32,15,15],["Coin14",112,32,15,15],["Coin51",128,32,15,15],["Coin52",144,32,15,15],["Coin53",160,32,15,15],["Coin54",176,32,15,15],["Coin101",192,32,15,15],["Coin102",208,32,15,15],["Coin103",224,32,15,15],["Coin104",240,32,15,15],["Kobold",96,48,15,15],["Warn",32,160,15,15],["Boardm",192,48,63,31],["Dummy",112,32,15,15]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}function Stage1(){this.scenario=e;this.bgImage=c;this.bgLayout=b;this.initial=d;this.bgPtn=a;function e(){var d=[[7200,480,0,180,54,2],[7210,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1];a.y=b[2];a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function c(){var a=new Image;a.src="pict/cha.png";return a}function b(){for(var c=[],b=0;b<15;b++)for(var e=0;e<15;e++){var a=[0,b*96+32,e*96+32,96,96,false,0,true];c.push(a)}var a=[11,0,0,32*31,32,true,0,false];c.push(a);var a=[11,0,32*31,32*31,32,true,0,false];c.push(a);var a=[11,0,0,32,32*31,true,0,false];c.push(a);var a=[11,32*31,0,32,32*31,true,0,false];c.push(a);for(var b=0;b<32;b++){var a=[11,b*32,0,32,32,false,0,true];c.push(a);var a=[11,b*32,32*31,32,32,false,0,true];c.push(a)}for(var b=1;b<31;b++){var a=[11,0,b*32,32,32,false,0,true];c.push(a);var a=[11,32*31,b*32,32,32,false,0,true];c.push(a)}for(var b=1;b<31;b++){var a=[11,32*11*(b%2+1),b*32,32,32,true,0,true];c.push(a)}var f=[];for(var e in c){var a=c[e],d={};d.no=a[0];d.x=a[1];d.y=a[2];d.w=a[3];d.h=a[4];d.c=a[5];d.type=a[6];d.view=false;d.visible=a[7];f.push(d)}return f}function d(){var d=[];d.push([false,320,240,0,"player",0]);for(var c=1;c<5;c++){a=[true,c*96+48,c*96+48,Math.floor(Math.random()*360),"friend_passive",10];d.push(a)}for(var c=1;c<10;c++)for(var e=1;e<10;e++){a=[true,c*96+24,e*96+24,45,"common_vset4",25+Math.floor(Math.random()*3)];d.push(a)}var f=[];for(var e in d){var a=d[e],b={};b.s=a[0];b.x=a[1];b.y=a[2];b.r=a[3];b.sc=a[4];b.ch=a[5];f.push(b)}return f}function a(){var d=[[0,0,48,95,95],[1,96,48,95,95],[2,128,128,31,31],[3,224,128,31,31],[4,256,128,31,31],[5,288,128,31,31],[6,224,160,31,31],[11,256,160,31,31],[7,288,160,31,31],[8,224,192,31,31],[9,256,192,31,31],[10,288,192,31,31],[11,96,48,31,31],[12,96,192,31,31]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}}function Stage_a(){this.scenario=e;this.bgImage=c;this.bgLayout=b;this.initial=d;this.bgPtn=a;function e(){var d=[[7200,480,0,180,54,2],[7210,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1];a.y=b[2];a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function c(){var a=new Image;a.src="pict/cha.png";return a}function b(){for(var b=[],e=0;e<15;e++)for(var d=0;d<15;d++){var a=[0,e*96+32,d*96+32,96,96,false,0,true];b.push(a)}var a=[11,0,0,32*31,32,true,0,true];b.push(a);var a=[11,32,32*31,32*31,32,true,0,true];b.push(a);var a=[11,0,32,32,32*31,true,0,true];b.push(a);var a=[11,32*31,0,32,32*31,true,0,true];b.push(a);var a=[11,32*4,32*4,32*4,32,true,0,true];b.push(a);var a=[11,32*8,32*4,32,32*4,true,0,true];b.push(a);var a=[11,32*12,32*4,32*15,32,true,0,true];b.push(a);var a=[11,32*27,32*4,32,32*23,true,0,true];b.push(a);var a=[11,32*8,32*8,32*11,32,true,0,true];b.push(a);var a=[11,32*19,32*8,32,32*8,true,0,true];b.push(a);var a=[11,32*23,32*8,32,32*15,true,0,true];b.push(a);var a=[11,32*8,32*12,32,32*15,true,0,true];b.push(a);var a=[11,32*9,32*12,32*7,32,true,0,true];b.push(a);var a=[11,32*12,32*16,32*8,32,true,0,true];b.push(a);var a=[11,32*12,32*19,32*8,32,true,0,true];b.push(a);var a=[11,32*3,32*27,32*25,32,true,0,true];b.push(a);var a=[11,32*12,32*23,32*12,32,true,0,true];b.push(a);var f=[];for(var d in b){var a=b[d],c={};c.no=a[0];c.x=a[1];c.y=a[2];c.w=a[3];c.h=a[4];c.c=a[5];c.type=a[6];c.view=false;c.visible=a[7];f.push(c)}return f}function d(){var c=[];c.push([false,320,240,0,"player",0]);for(var b=0;b<3;b++){a=[true,32*5,32*7+32*b*8,0,"friend_passive",10];c.push(a)}var d="common_vset4";for(b=0;b<10;b++){a=[true,32*30-16,32*3+b*32*3,45,d,27];c.push(a);a=[true,32*25+16,32*7+b*32*2+16,45,d,27];c.push(a);a=[true,32*5+b*32*2,32*3-16,45,d,25];c.push(a);a=[true,32*5+b*32*2,32*30-16,45,d,27];c.push(a)}for(b=0;b<5;b++){a=[true,32*10+b*32*3,32*7-16,45,d,26];c.push(a);a=[true,32*10+b*32*3,32*25+16,45,d,26];c.push(a);for(var f=0;f<2;f++){a=[true,32*10+b*32*3,32*11+32*3*f-16,45,d,25];c.push(a);a=[true,32*10+b*32*3,32*22-32*3*f-16,45,d,25];c.push(a)}}var g=[];for(var f in c){var a=c[f],e={};e.s=a[0];e.x=a[1];e.y=a[2];e.r=a[3];e.sc=a[4];e.ch=a[5];g.push(e)}return g}function a(){var d=[[0,0,48,95,95],[1,96,48,95,95],[2,128,128,31,31],[3,224,128,31,31],[4,256,128,31,31],[5,288,128,31,31],[6,224,160,31,31],[11,256,160,31,31],[7,288,160,31,31],[8,224,192,31,31],[9,256,192,31,31],[10,288,192,31,31],[11,96,48,31,31],[12,96,192,31,31]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}}function Stage_b(){this.scenario=e;this.bgImage=c;this.bgLayout=b;this.initial=d;this.bgPtn=a;function e(){var d=[[7200,480,0,180,54,2],[7210,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1];a.y=b[2];a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function c(){var a=new Image;a.src="pict/cha.png";return a}function b(){for(var b=[],d=0;d<15;d++)for(var e=0;e<15;e++){var a=[0,d*96+32,e*96+32,96,96,false,0,true];b.push(a)}var a=[11,0,0,32*31,32,true,0,true];b.push(a);var a=[11,32,32*31,32*31,32,true,0,true];b.push(a);var a=[11,0,32,32,32*31,true,0,true];b.push(a);var a=[11,32*31,0,32,32*31,true,0,true];b.push(a);for(var d=0;d<4;d++){var a=[11,32,32*6+d*32*6,32*2,32,true,0,true];b.push(a);var a=[11,32*29,32*7+d*32*6,32*2,32,true,0,true];b.push(a);var a=[11,32*8,32*4+d*32*4,32*17,32,true,0,true];b.push(a);var a=[11,32*8,32*27-d*32*4,32*17,32,true,0,true];b.push(a)}var f=[];for(var e in b){var a=b[e],c={};c.no=a[0];c.x=a[1];c.y=a[2];c.w=a[3];c.h=a[4];c.c=a[5];c.type=a[6];c.view=false;c.visible=a[7];f.push(c)}return f}function d(){var c=[];c.push([false,320,240,0,"player",0]);for(var b=0;b<3;b++){a=[true,32*5,32*7+32*b*8,0,"friend_passive",10];c.push(a)}var e="common_vset4";for(b=0;b<8;b++){a=[true,32*5+b*32*3,32*2+16,45,e,27];c.push(a);a=[true,32*5+b*32*3,32*30-16,45,e,27];c.push(a);a=[true,32*30-16,32*3+b*32*3,45,e,27];c.push(a);a=[true,32*10+b*32*2,32*7-16,45,e,26];c.push(a);a=[true,32*10+b*32*2,32*25+16,45,e,26];c.push(a);for(var f=0;f<2;f++){a=[true,32*10+b*32*2,32*11+32*3*f-16,45,e,25];c.push(a);a=[true,32*10+b*32*2,32*22-32*3*f-16,45,e,25];c.push(a)}}var g=[];for(var f in c){var a=c[f],d={};d.s=a[0];d.x=a[1];d.y=a[2];d.r=a[3];d.sc=a[4];d.ch=a[5];g.push(d)}return g}function a(){var d=[[0,0,48,95,95],[1,96,48,95,95],[2,128,128,31,31],[3,224,128,31,31],[4,256,128,31,31],[5,288,128,31,31],[6,224,160,31,31],[11,256,160,31,31],[7,288,160,31,31],[8,224,192,31,31],[9,256,192,31,31],[10,288,192,31,31],[11,96,48,31,31],[12,96,192,31,31]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}}function Stage_c(){this.scenario=e;this.bgImage=c;this.bgLayout=b;this.initial=d;this.bgPtn=a;function e(){var d=[[7200,480,0,180,54,2],[7210,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1];a.y=b[2];a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function c(){var a=new Image;a.src="pict/cha.png";return a}function b(){for(var c=[],d=0;d<15;d++)for(var e=0;e<15;e++){var a=[0,d*96+32,e*96+32,96,96,false,0,true];c.push(a)}var a=[11,0,0,32*31,32,true,0,true];c.push(a);var a=[11,32,32*31,32*31,32,true,0,true];c.push(a);var a=[11,0,32,32,32*31,true,0,true];c.push(a);var a=[11,32*31,0,32,32*31,true,0,true];c.push(a);var f=[[7,7,false,20],[11,1,false,20],[15,11,false,20],[18,1,false,20],[22,11,false,20],[26,7,false,20]];for(var d in f){var a=f[d];if(a[2]){var a=[11,a[0]*32,a[1]*32,32*a[3],32,true,0,true];c.push(a)}else{var a=[11,a[0]*32,a[1]*32,32,32*a[3],true,0,true];c.push(a)}}var g=[];for(var e in c){var a=c[e],b={};b.no=a[0];b.x=a[1];b.y=a[2];b.w=a[3];b.h=a[4];b.c=a[5];b.type=a[6];b.view=false;b.visible=a[7];g.push(b)}return g}function d(){var c=[];c.push([false,320,240,0,"player",0]);for(var e=0;e<3;e++){a=[true,32*5,32*7+32*e*8,0,"friend_passive",10];c.push(a)}var f=[[13,9,4,false,25,2],[9,13,4,false,26,3],[13,17,4,false,25,2],[9,20,4,false,27,3],[9,24,4,false,26,3],[9,29,4,false,27,3]],h="common_vset4";for(e in f){var a=f[e];for(d=0;d<a[0];d++)if(a[3]){ws=[true,32*a[1]+d*32*a[5],32*a[2],45,h,a[4]];c.push(ws)}else{ws=[true,32*a[1],32*a[2]+d*32*a[5],45,h,a[4]];c.push(ws)}}var g=[];for(var d in c){var a=c[d],b={};b.s=a[0];b.x=a[1];b.y=a[2];b.r=a[3];b.sc=a[4];b.ch=a[5];g.push(b)}return g}function a(){var d=[[0,0,48,95,95],[1,96,48,95,95],[2,128,128,31,31],[3,224,128,31,31],[4,256,128,31,31],[5,288,128,31,31],[6,224,160,31,31],[11,256,160,31,31],[7,288,160,31,31],[8,224,192,31,31],[9,256,192,31,31],[10,288,192,31,31],[11,96,48,31,31],[12,96,192,31,31]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}}function Stage_d(){this.scenario=e;this.bgImage=c;this.bgLayout=b;this.initial=d;this.bgPtn=a;function e(){var d=[[7200,480,0,180,54,2],[7210,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1];a.y=b[2];a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function c(){var a=new Image;a.src="pict/cha.png";return a}function b(){for(var c=[],d=0;d<15;d++)for(var e=0;e<15;e++){var a=[0,d*96+32,e*96+32,96,96,false,0,true];c.push(a)}var a=[11,0,0,32*31,32,true,0,true];c.push(a);var a=[11,32,32*31,32*31,32,true,0,true];c.push(a);var a=[11,0,32,32,32*31,true,0,true];c.push(a);var a=[11,32*31,0,32,32*31,true,0,true];c.push(a);var f=[[1,16,true,13],[18,15,true,13],[15,1,false,14],[16,17,false,14]];for(var d in f){var a=f[d];if(a[2]){var a=[11,a[0]*32,a[1]*32,32*a[3],32,true,0,true];c.push(a)}else{var a=[11,a[0]*32,a[1]*32,32,32*a[3],true,0,true];c.push(a)}}var g=[];for(var e in c){var a=c[e],b={};b.no=a[0];b.x=a[1];b.y=a[2];b.w=a[3];b.h=a[4];b.c=a[5];b.type=a[6];b.view=false;b.visible=a[7];g.push(b)}return g}function d(){var c=[];c.push([false,320,240,0,"player",0]);for(var e=0;e<3;e++){a=[true,32*5,32*7+32*e*8,0,"friend_passive",10];c.push(a)}var f=[[6,9,4,false,25,2],[6,11,4,false,26,2],[6,13,4,false,25,2],[6,20,4,false,27,2],[6,24,4,false,26,2],[6,28,4,false,27,2],[6,9,19,false,25,2],[6,11,19,false,26,2],[6,13,19,false,25,2],[6,20,19,false,27,2],[6,24,19,false,26,2],[6,28,19,false,27,2]],h="common_vset4";for(e in f){var a=f[e];for(d=0;d<a[0];d++)if(a[3]){ws=[true,32*a[1]+d*32*a[5],32*a[2],45,h,a[4]];c.push(ws)}else{ws=[true,32*a[1],32*a[2]+d*32*a[5],45,h,a[4]];c.push(ws)}}var g=[];for(var d in c){var a=c[d],b={};b.s=a[0];b.x=a[1];b.y=a[2];b.r=a[3];b.sc=a[4];b.ch=a[5];g.push(b)}return g}function a(){var d=[[0,0,48,95,95],[1,96,48,95,95],[2,128,128,31,31],[3,224,128,31,31],[4,256,128,31,31],[5,288,128,31,31],[6,224,160,31,31],[11,256,160,31,31],[7,288,160,31,31],[8,224,192,31,31],[9,256,192,31,31],[10,288,192,31,31],[11,96,48,31,31],[12,96,192,31,31]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}}function TextScreen(){for(var d=30,b=[],c=0;c<d;c++){var a=document.createElement("div");a.id="div"+c;a.style.position="absolute";a.style.display="inline";a.style.top=c+"px";a.style.left=c+"px";a.style.width="24px";a.style.height="20px";var f=document.getElementsByTagName("body").item(0);f.appendChild(a)}var i=0;this.print=function(d,f,g,c){if(!Boolean(c))c="green";var a={};a.text=d;a.x=f;a.y=g;a.color=c;a.draw=e;b.push(a)};function e(a){a.style.color=this.color;a.style.backgroundColor="transparent";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.width=16*this.text.length+"px";a.style.visibility="visible";a.style.display="inline";a.innerHTML=this.text}this.putFunc=function(a){b.push(a)};this.clear=function(){for(var a=0;a<d;a++){var b=document.getElementById("div"+a);b.style.visibility="hidden";b.style.display="none"}};this.reset=function(){b=[]};this.draw=function(){for(var a in b){if(a>=d)break;b[a].draw(document.getElementById("div"+a))}}}