function bench(){var j,e=Date.now(),l=0,a=[],c=[],b=0,d=0,i,h,g=0,k=256-80,f=192-16;this.start=function(){j=e;e=Date.now()};this.end=function(){i=Date.now()-e;h=e-j;if(b>d)d=b;a[b]=h;c[b]=i;b++;if(b>59)b=0;for(var k=0,f=0;f<=d;f++)k+=a[f];l++;g=parseInt(1e3/(k/(d+1)))};this.result=function(){var b={};b.fps=g;b.fps_log=a;b.load_log=c;var e={},d={};b.workload=e;b.interval=d;return b};this.draw=function(i){for(var n=0,o=999,t=0,l=0,m=999,j=0,q=0,p=0,e=0;e<=d;e++){if(n<a[e])n=a[e];if(o>a[e])o=a[e];if(l<c[e])l=c[e];if(m>c[e])m=c[e];q+=c[e];p+=a[e]}t=parseInt(p/(d+1));j=parseInt(q/(d+1));var h=[];h.push("fps : "+g);h.push("load:"+j+"ms");for(var r in h){var u=0+8*r+f;i.putchr8(h[r],k,u)}var s=false;if(s){cl={};cl.x=240;cl.y=48+f;cl.g=a;cl.s=b;cl.col="rgb(0,128,255)";cl.draw=graph_draw;i.putFunc(cl);cl={};cl.x=240;cl.y=48+f;cl.g=c;cl.s=b;cl.col="Red";cl.draw=graph_draw;i.putFunc(cl)}}}function graph_draw(a){a.beginPath();a.moveTo(this.x,this.y+1);a.lineTo(this.x+this.g.length*3,this.y+1);a.strokeStyle="rgb(255,255,255)";a.lineWidth="1";a.stroke();a.beginPath();a.strokeStyle=this.col;for(var b=0;b<this.g.length;b++){var c=(this.s+this.g.length-b)%this.g.length;a.lineTo(this.x+b*3,this.y-this.g[c])}a.stroke()}function sce_boss_0(){this.init=function(b,a){a.vset(8);a.get_target(98);a.w_cnt=0;a.custom_draw_enable=true};this.draw=sce_boss_damage_gr;this.move=function(b,a){switch(a.frame){case 15:a.get_target(98);a.vset(0);break;case 22:a.vector=a.target_v();break;case 32:a.set_object(103);break;case 60:a.frame=12;a.w_cnt++}a.frame++;if(a.w_cnt>10){a.w_cnt=5;a.vector+=Math.floor(Math.random()*180);a.vset(1);a.frame=0}return a.sc_move()}}function sce_boss_1(){this.init=function(b,a){a.vset(4);a.chr=1;a.display_size=.001;a.hit_x*=2;a.hit_y*=2;a.custom_draw_enable=false;a.wdspf=true;a.cnt=0};this.draw=sce_boss_damage_gr;this.move=function(b,a){if(a.wdspf)a.display_size=2*(a.frame/60);else{a.display_size=2;a.custom_draw_enable=true}switch(a.frame){case 13:case 14:a.vset(0);break;case 60:a.wdspf=false;if(a.hp>0){a.cnt++;if(a.cnt>7){a.cnt=0;a.set_object(30)}}a.vset(0);a.vector=(a.vector+8+360)%360;a.frame=59}if(a.status==2){a.set_object_ex(14,a.x,a.y,180,50);a.status=2}a.frame++;return a.sc_move()}}function sce_boss_2(){this.init=function(b,a){a.vset(0);a.get_target(98);a.w_cnt=0;a.display_size=.001;a.hit_x*=2;a.hit_y*=2;a.custom_draw_enable=true;a.wdspf=true};this.draw=sce_boss_damage_gr;this.move=function(d,a){if(a.wdspf)a.display_size=2*(a.frame/60);else a.display_size=2;switch(a.frame){case 60:a.wdspf=false;a.get_target(98);a.vset(0);break;case 82:a.get_target(98);a.vector=a.target_v();a.vset(0);break;case 95:a.frame=72;a.w_cnt++}a.frame++;if(a.w_cnt%10==0&&a.frame==90){a.set_object_ex(32,a.x,a.y,(a.vector+45)%360,49);a.set_object_ex(32,a.x,a.y,(a.vector+315)%360,49)}if(a.w_cnt%10==5&&a.frame==90){var b=(a.vector+90)%360,c=(a.vector+270)%360;a.set_object_ex(32,a.x+a.Cos(b)*100,a.y+a.Sin(b)*100,a.vector,51);a.set_object_ex(32,a.x,a.y,a.vector,51);a.set_object_ex(32,a.x+a.Cos(c)*100,a.y+a.Sin(c)*100,a.vector,51)}a.status==2&&a.bomb();return a.sc_move()}}function sce_boss_damage_gr(c,a){cl={};var b=a.gt.worldtoView(a.x,a.y);cl.x=b.x;cl.y=b.y;cl.sr=(360*((a.maxhp-a.hp)/a.maxhp)-90)*(Math.PI/180);cl.draw=function(a){a.beginPath();a.strokeStyle="white";a.lineWidth="5";a.beginPath();a.arc(this.x,this.y,32+10,this.sr,1.5*Math.PI,false);a.stroke();a.beginPath();a.strokeStyle="silver";a.lineWidth="1";a.arc(this.x,this.y,30+10,0,2*Math.PI,false);a.stroke();a.beginPath();a.arc(this.x,this.y,34+10,0,2*Math.PI,false);a.stroke()};c.putFunc(cl)}function character(){var d=[[0,1,10,98,8,8,16,16,0,0,24,15,15,24,0,0],[6,26,8,1,8,8,16,16,"common_vset4",13,5,5,5,5,0,0],[10,15,10,0,16,16,16,16,"friend_rotate",21,7,15,15,7,1,0],[36,35,10,0,16,24,16,16,"friend_straight",21,7,15,15,7,1,0],[37,36,3,0,8,8,16,16,"friend_boom",21,7,15,15,7,1,0],[38,37,10,0,8,8,16,16,"friend_rotate_full",21,7,15,15,7,1,0],[39,38,10,0,8,8,16,16,"friend_rotate",21,7,15,15,7,1,0],[1,3,8,2,8,8,16,16,0,0,7,5,5,7,0,10],[2,4,8,2,8,8,16,16,0,0,7,5,5,7,0,20],[3,5,8,2,8,8,16,16,0,0,7,5,5,7,0,30],[4,6,8,2,8,8,16,16,0,0,7,5,5,7,0,40],[5,7,8,2,8,8,16,16,0,0,7,5,5,7,0,50],[8,8,8,2,8,8,16,16,0,0,7,5,5,7,0,60],[9,9,8,2,8,8,16,16,0,0,7,5,5,7,0,70],[10,10,8,2,8,8,16,16,0,0,7,5,5,7,0,80],[14,4,90,2,16,16,24,24,0,0,35,5,5,35,0,50],[30,7,1,3,16,16,32,32,33,33,5,5,5,5,0,0],[33,10,70,2,16,16,24,24,0,0,35,5,5,35,0,10],[34,4,40,2,16,16,32,32,0,0,7,5,5,7,0,30],[12,7,1,3,4,4,2,2,18,18,5,5,5,5,0,0],[32,7,5,3,8,8,6,6,49,49,5,5,5,5,0,0],[7,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[15,38,1,4,8,8,16,16,30,30,5,5,5,5,0,0],[16,15,1,4,16,16,32,32,30,30,5,5,5,5,0,0],[17,37,1,4,8,8,16,16,30,30,5,5,5,5,0,0],[18,35,1,4,16,24,16,48,30,30,5,5,5,5,0,0],[19,36,1,4,8,8,16,16,30,30,5,5,5,5,0,0],[20,26,1,4,8,8,16,16,30,30,5,5,5,5,0,1],[21,1,1,4,16,16,32,32,30,30,5,5,5,5,0,100],[22,27,1,4,16,16,32,32,30,30,5,5,5,5,0,10],[23,28,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[24,29,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[25,30,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[26,33,1,4,12,12,24,24,30,30,5,5,5,5,0,10],[27,34,1,4,12,12,24,24,30,30,5,5,5,5,0,10],[35,32,1,4,8,8,16,16,30,30,5,5,5,5,0,10],[40,39,1,2,16,16,16,16,30,30,5,5,5,5,0,100],[103,8,1,3,8,8,6,6,103,103,5,5,5,5,0,0]],c=[];for(var e in d){var a=d[e],b={};b.mp=a[1];b.hp=a[2];b.type=a[3];b.center_x=a[4];b.center_y=a[5];b.size_x=a[6];b.size_y=a[7];b.senario=[a[8],a[9],a[10],a[11],a[12],a[13]];b.id=a[14];b.score=a[15];c[a[0]]=b}return c}try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{"get":function(){return true}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(b,a){Object.defineProperty(this,b,{"get":a,enumerable:true,configurable:true})}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(b,a){Object.defineProperty(this,b,{"set":a,enumerable:true,configurable:true})}})}}catch(defPropException){}function CLinear4TreeManager(){var d=0;this.level=0;this.w=0;this.h=0;this.l=0;this.t=0;this.unitW=0;this.unitH=0;this.cellNum=0;this.cellAry=null;this.dim=0;this.colList=new h;this.pow=new Array(9+1);this.pow[0]=1;for(var b=1;b<9+1;b++)this.pow[b]=this.pow[b-1]*4;function f(a){this.id=a||0;this.cell=this.obj=this.pre=this.next=null}f.prototype.remove=function(){if(!this.cell||!this.cell.onRemove(this))return false;this.pre&&(this.pre.next=this.next);this.next&&(this.next.pre=this.pre);this.pre=this.next=this.cell=null;return true};function a(){this.latest=null}a.prototype.push=function(a){if(!a)return false;if(a.cell==this)return false;if(!this.latest)this.latest=a;else{a.next=this.latest;this.latest.pre=a;this.latest=a}a.cell=this;d++;return true};a.prototype.getFirstObj=function(){return this.latest};a.prototype.onRemove=function(a){if(this.latest==a)if(this.latest)this.latest=this.latest.next;d--;return true};function h(){var a=[];a.wright=function(a,b){this.push(a);this.push(b)};return a}function j(g,c){var a=this.cellAry[g].getFirstObj();while(a){var d=a.next;while(d){this.colList.wright(a.obj,d.obj);d=d.next}for(var b=0,i=c.length;b<i;b++)this.colList.wright(a.obj,c[b]);a=a.next}for(var e=false,h=0,b=0;b<4;b++){var f=g*4+1+b;if(f<this.cellNum&&this.cellAry[f]){if(!e){a=this.cellAry[g].getFirstObj();while(a){c.push(a.obj);h++;a=a.next}}e=true;arguments.callee.call(this,f,c)}}if(e)for(var b=0;b<h;b++)c.pop();return true}function k(b){while(!this.cellAry[b]){this.cellAry[b]=new a;b=b-1>>2;if(b<0||b>=this.cellNum)break}return true}function e(d,e,b,a){var h=this.l+this.w-1,g=this.t+this.h-1;if(d>h||b<this.l||e>g||a<this.t)return 2147483647;if(d<this.l)d=this.l;if(b>h)b=h;if(e<this.t)e=this.t;if(a>g)a=g;for(var o=c.call(this,d,e),k=c.call(this,b,a),n=k^o,j=0,f=0;f<this.level;f++){var m=n>>f*2&3;if(m!=0)j=f+1}var i=k>>j*2,l=(this.pow[this.level-j]-1)/3;i+=l;return i>this.cellNum?2147483647:i}function g(a){a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;return(a|a<<1)&1431655765}function i(a,b){return g(a)|g(b)<<1}function c(a,b){return i(parseInt((a-this.l)/this.unitW),parseInt((b-this.t)/this.unitH))}this.init=function(a,b,c,e,d){if(a>=9)return false;this.cellNum=(this.pow[a+1]-1)/3;this.cellAry=new Array(this.cellNum);this.l=b;this.t=c;this.w=e-b;this.h=d-c;this.unitW=this.w/(1<<a);this.unitH=this.h/(1<<a);this.level=a;return true};this.register=function(d,g,c,b,f){var a=e.call(this,d,g,c,b);if(a<this.cellNum){!this.cellAry[a]&&k.call(this,a);return this.cellAry[a].push(f)}return false};this.getAllCollisionList=function(){var a=false;if(this.cellAry[0]){var b=[];j.call(this,0,b);a=this.colList;this.colList=new h}return a};this.createObjectForTree=function(a){return new f(a)};this.getMortonNumber=function(b,d,c,a){return e.call(this,b,d,c,a)};this.getPointElem=function(a,b){return c.call(this,a,b)};this.__defineGetter__("objectNum",function(){return d})}function sce_common_vset(a){this.init=function(c,b){b.vset(a)};this.move=function(b,a){return a.sc_move()}}function sce_common_signal(a){this.init=function(b,a){a.vset(0);a.normal_draw_enable=false;a.custom_draw_enable=false;a.x=a.gt.world_x+1;a.y=a.gt.world_y+1};this.move=function(c,b){b.x=b.gt.world_x+1;b.y=b.gt.world_y+1;if(b.frame==0)b.SIGNAL(a);else{b.SIGNAL(0);b.status=0}b.frame++;return b.sc_move()}}function Dangeon(r){MAP_W=30,MAP_H=30,MINIMUM_ROOM_SIZE=3,MARGIN_BETWEEN_RECT_ROOM=2,MINIMUM_RECT_SIZE=MINIMUM_ROOM_SIZE+MARGIN_BETWEEN_RECT_ROOM*2,COUPLE_VERTICAL=0,COUPLE_HORIZONAL=1;r=Math.floor(Math.random()*1e6);var B=new z(r);function s(){this.lx=0;this.ly=0;this.hx=MINIMUM_ROOM_SIZE;this.hy=MINIMUM_ROOM_SIZE}function n(){this.done_split_v=false;this.done_split_h=false;this.lx=0;this.ly=0;this.hx=MINIMUM_RECT_SIZE;this.hy=MINIMUM_RECT_SIZE;this.room=new s}function x(){this.v_or_h=COUPLE_HORIZONAL;this.rect0=new n;this.rect1=new n}var d=[],m=[],k=[],a=[[]],c=[[]],e=[[]],o=[[]],i=[],j=[],h=[];this.create=y;this.mapdata=a;this.room=c;this.inroom=e;this.type=o;this.ml=i;this.rl=j;this.il=h;this.mw=MAP_W;this.mh=MAP_H;function y(){for(var b=0;b<MAP_W;b++){a[b]=[];for(var c=0;c<MAP_H;c++)a[b][c]=false}d=[];m=[];k=[];g(q(0,0,MAP_W-1,MAP_H-1));v();t();u();p()}function p(){for(var d=0;d<MAP_W;d++)for(var b=0;b<MAP_H;b++)if(a[d][b])a[d][b]=false;else a[d][b]=true;for(var g=[-1,0,1,-1,1,-1,0,1],m=[-1,-1,-1,0,0,1,1,1],f=[],l=[[]],b=0;b<MAP_W;b++){c[b]=[];l[b]=[];for(var d=0;d<MAP_H;d++){var p=true,n=0,q=0;if(b==0||b==MAP_H-1||d==0||d==MAP_W-1){l[b][d]=p;c[b][d]=n;continue}for(var k in g)if(!a[b+g[k]][d+m[k]])n++;c[b][d]=n;if(a[b][d])for(var k in g)if(!a[b+g[k]][d+m[k]])p=false;l[b][d]=p}}for(var b=0;b<MAP_W;b++){o[b]=[];for(var d=0;d<MAP_H;d++){if(!a[b][d]){var f={};f.x=b;f.y=d;i.push(f)}var q=0;if(!(b==0||b==MAP_H-1||d==0||d==MAP_W-1)){var r=0;for(var k in g){if(a[b+g[k]][d+m[k]])q+=Math.pow(2,r);r++}}o[b][d]=q}}for(var b=0;b<MAP_W;b++){e[b]=[];for(var d=0;d<MAP_H;d++){if(!a[b][d]&&c[b][d]>=8)e[b][d]=true;else e[b][d]=false;if(!a[b][d]&&c[b][d]>=5)c[b][d]=true;else c[b][d]=false;if(l[b][d])a[b][d]=false}}for(var b=0;b<MAP_W;b++)for(var d=0;d<MAP_H;d++)if(c[b][d]){var f={};f.x=b;f.y=d;j.push(f)}for(var b=0;b<MAP_W;b++)for(var d=0;d<MAP_H;d++)if(e[b][d]){var f={};f.x=b;f.y=d;h.push(f)}}function u(){var d,e,g,h;for(var j in m)for(var i=m[j],l=i.lx;l<=i.hx;l++)for(var n=i.ly;n<=i.hy;n++)a[l][n]=true;for(j in k){var c=k[j];switch(c.v_or_h){case COUPLE_HORIZONAL:d=c.rect0.hx;e=b(c.rect0.room.ly+1,c.rect0.room.hy);g=c.rect1.lx;h=b(c.rect1.room.ly+1,c.rect1.room.hy);f(d,e,g,h);f(c.rect0.room.hx,e,d,e);f(c.rect1.room.lx,h,g,h);break;case COUPLE_VERTICAL:d=b(c.rect0.room.lx+1,c.rect0.room.hx);e=c.rect0.hy;g=b(c.rect1.room.lx+1,c.rect1.room.hx);h=c.rect1.ly;f(d,e,g,h);f(d,c.rect0.room.hy,d,e);f(g,c.rect1.room.ly,g,h)}}}function f(h,j,i,k){var f,d,g,e,b,c;f=Math.min(h,i);d=Math.max(h,i);g=Math.min(j,k);e=Math.max(j,k);if(h<=i&&j>=k){for(b=f;b<=d;b++)a[b][e]=true;for(c=g;c<=e;c++)a[d][c]=true;return}if(h>i&&j>k){for(b=f;b<=d;b++)a[b][g]=true;for(c=g;c<=e;c++)a[d][c]=true;return}if(h>i&&j<=k){for(b=f;b<=d;b++)a[b][g]=true;for(c=g;c<=e;c++)a[f][c]=true;return}if(h<=i&&j<k){for(b=f;b<=d;b++)a[b][e]=true;for(c=g;c<=e;c++)a[f][c]=true;return}}function g(a){var c=new n;if(a.hy-a.ly<=MINIMUM_RECT_SIZE*2)a.done_split_v=true;if(a.hx-a.lx<=MINIMUM_RECT_SIZE*2)a.done_split_h=true;if(a.done_split_v&&a.done_split_h)return;c=q(a.lx,a.ly,a.hx,a.hy);if(a.done_split_v==false){var e;e=b(a.ly+MINIMUM_RECT_SIZE,a.hy-MINIMUM_RECT_SIZE);a.hy=e;c.ly=e;a.done_split_v=true;c.done_split_v=true;l(COUPLE_VERTICAL,a,c);g(a);g(c);return}if(a.done_split_h==false){var d;d=b(a.lx+MINIMUM_RECT_SIZE,a.hx-MINIMUM_RECT_SIZE);a.hx=d;c.lx=d;a.done_split_h=true;c.done_split_h=true;l(COUPLE_HORIZONAL,a,c);g(a);g(c);return}}function v(){var f,g,e,c;for(var h in d){var a=d[h];e=b(MINIMUM_ROOM_SIZE,a.hx-a.lx-MARGIN_BETWEEN_RECT_ROOM*2+1);c=b(MINIMUM_ROOM_SIZE,a.hy-a.ly-MARGIN_BETWEEN_RECT_ROOM*2+1);f=b(a.lx+MARGIN_BETWEEN_RECT_ROOM,a.hx-MARGIN_BETWEEN_RECT_ROOM-e+1);g=b(a.ly+MARGIN_BETWEEN_RECT_ROOM,a.hy-MARGIN_BETWEEN_RECT_ROOM-c+1);a.room=w(f,g,f+e,g+c)}}function t(){rectmap=[[]];for(var c,a=0;a<MAP_W;a++){rectmap[a]=[];for(var c=0;c<MAP_H;c++)rectmap[a][c]=null}for(var f in d){var e=d[f];for(c=e.lx;c<e.hx;c++)for(a=e.ly;a<e.hy;a++)rectmap[c][a]=e}for(c=0;c<MAP_W-2;c++)for(a=0;a<MAP_H-2;a++){!Boolean(rectmap[c][a])&&alert("rectnull"+c+":"+a);if(rectmap[c][a]!=rectmap[c][a+1])b(0,64)==0&&l(COUPLE_VERTICAL,rectmap[c][a],rectmap[c][a+1]);if(rectmap[c][a]!=rectmap[c+1][a])b(0,64)==0&&l(COUPLE_HORIZONAL,rectmap[c][a],rectmap[c+1][a])}}function q(e,f,b,c){var a=new n;a.lx=e;a.ly=f;a.hx=b;a.hy=c;d.push(a);return a}function w(d,e,b,c){var a=new s;a.lx=d;a.ly=e;a.hx=b;a.hy=c;m.push(a);return a}function l(b,c,d){var a=new x;a.v_or_h=b;a.rect0=c;a.rect1=d;k.push(a);return a}function b(a,b){return Math.floor(B.next()*(b-a))+a}function z(c){var a=c;this.next=b;function b(){var b=(1103515245*a+12345)%32768;a=b;return b/32767.1}}}function deviceControl(){for(var e=4,c=[],d=0;d<e;d++)c[d]=new Screen("Layer"+d,256,192);this.graphics=c;this.canvas=c;this.text=c[3];this.gs=new geometoryTrance;this.layout=new gameLayout;this.mouse_state=new inputControl("Layer3");var f=new inputKeyboard;this.vkey_state=new vartualKeyControl;this.key_state=new keyEntryManager(this.mouse_state,f,this.vkey_state);this.sound=new soundControl;this.images=new loadingImages;var b=200,a=50,g=[[a+50,b,100,100,[38]],[a,b+50,100,100,[37]],[a+100,b+50,100,100,[39]],[a+50,b+100,100,100,[40]],[a+250,b+50,100,100,[90]],[a+350,b+50,100,100,[88]],[a+450,b+50,100,100,[67]]];this.vkey_state.init(g)}function sce_effect_vanish(){this.init=function(b,a){a.type=5;a.status=5};this.move=function(){return-1}}function sce_effect_bomb(){this.init=function(b,a){a.vset(0);a.mp=12;a.type=5;a.status=5;a.frame=0};this.move=function(b,a){switch(a.frame){case 90:a.status=0}a.frame++;if(a.frame>=30)a.status=0;return a.sc_move()}}function sce_effect_hit(){this.init=function(b,a){a.vset(0);a.mp=11;a.type=5;a.status=5;a.frame=0;a.alpha=254};this.move=function(b,a){switch(a.frame){case 60:a.status=0}a.frame++;if(a.frame>30)a.alpha-=3;return a.sc_move()}}function sce_effect_billboard(a){this.init=function(c,b){b.vector=a;b.vset(2)};this.move=function(b,a){if(a.alpha>10)a.alpha-=5;else return-1;return a.sc_move()}}function sce_effect_bombcircle(a){this.init=function(b,a){a.vset(0);a.circle_r=20;a.type=5;a.normal_draw_enable=false;a.custom_draw_enable=true};this.move=function(b,a){if(a.frame>10)a.status=0;a.circle_r+=(a.frame+1)*10;a.frame++;return a.sc_move()};this.draw=function(e,c){var b={},d=c.gt.worldtoView(c.x,c.y);b.x=d.x;b.y=d.y;b.r=c.circle_r;b.draw=function(b){b.beginPath();b.globalCompositeOperation="lighter";b.arc(this.x,this.y,this.r,0,Math.PI*2,false);b.fillStyle=a;b.fill();b.globalCompositeOperation="source-over"};e.putFunc(b)}}function sce_effect_warnning_mark(){this.init=function(b,a){a.vset(0);a.type=5;a.mp=28};this.move=function(b,a){if(a.frame>30)a.status=0;a.frame++;return a.sc_move()}}function sce_ememy_move_n(a){this.init=function(b,a){a.vset(1)};this.move=function(c,b){switch(b.frame){case 80:b.get_target(98);break;case 100:b.vector=b.target_v();b.set_object(103);break;case 110:b.set_object(3);break;case 120:b.vector+=a;b.vector=b.vector%360;b.vset(1);break;case 160:b.vector=+a;b.vector=b.vector%360;b.vset(1);break;case 200:b.vector=+a;b.vector=b.vector%360;b.vset(1);b.frame=50}b.frame++;return b.sc_move()}}function sce_ememy_turn(a){this.init=function(b,a){a.vset(4)};this.move=function(c,b){switch(b.frame){case 5:b.set_object_ex(3,b.x,b.y,b.vector+Math.floor(Math.random()*40)-20,"exev_5expansion");break;case 15:b.vector+=a;b.vset(4);break;case 25:b.vector+=a;b.vset(4);break;case 35:b.vector+=a;b.vset(4);break;case 45:b.frame=1}b.frame++;return b.sc_move()}}function sce_ememy_change_s(){this.init=function(b,a){a.vset(4);a.vector=180};this.move=function(b,a){if(a.frame==15){a.set_object(102);a.change_sce(9)}a.frame++;return a.sc_move()}}function sce_ememy_moveshot(){this.init=function(b,a){a.vset(4)};this.move=function(b,a){a.vset(4);if(a.vector>180)a.mp=5;else a.mp=4;if(a.frame%50==5)if(a.frame>3600)a.set_object_ex(5,a.x,a.y,a.vector,"en_bullet_homing");else a.set_object_ex(5,a.x,a.y,a.vector,"en_bullet_turn");a.frame++;return a.sc_move()}}function sce_ememy_randomshot(){this.init=function(b,a){a.vset(4);a.w_cnt=0;a.display_size=1.5;a.hit_x*=1.5;a.hit_y*=1.5;a.hp=20};this.move=function(b,a){if(a.vector>180)a.mp=5;else a.mp=4;switch(a.frame){case 10:a.vset(0);break;case 13:a.set_object(12);break;case 30:a.frame=12;a.w_cnt++}a.frame++;if(a.w_cnt>5){a.w_cnt=0;a.vset(2);a.frame=0}return a.sc_move()}}function sce_ememy_move_std(){this.init=function(b,a){a.vset(2);a.wmapc=false;a.colcnt=0};this.move=function(c,a){a.frame++;if(a.wmapc){var b=Math.floor(Math.random()*2)==0?1:3;a.wmapc=false;a.vector+=b*90;a.vector=a.vector%360;a.vset(2);a.colcnt=0}if(a.vector>180)a.mp=5;else a.mp=4;if(a.mapCollision){a.colcnt++;if(a.colcnt>10)a.wmapc=true}return a.sc_move()}}function sce_ememy_move_std2(){this.init=function(b,a){a.vset(1);a.wmapc=false;a.colcnt=0;a.lockon_flag=false;a.growf=true;a.get_target(98)};this.move=function(e,a){a.frame++;if(a.growf)if(a.mapCollision)a.mapCollision=false;if(Boolean(a.target)){if(a.target_d(a.target.x,a.target.y)<200)a.lockon_flag=true;a.lockon_flag=true}if(a.wmapc&&a.lockon_flag){for(var d=a.target_v(),c=0,b=45;b<320;b+=45)if(d>b-22.5&&d<=b+22.5)c=b;a.vector=c;a.vset(1);a.wmapc=false;a.colcnt=0}if(a.mapCollision){a.colcnt++;if(a.colcnt>2)a.wmapc=true}if(a.frame>16){a.lockon_flag&&a.target_rotate_r(45);a.vset(1);a.frame=0;a.get_target(98);a.growf=false}return a.sc_move()}}function sce_ememy_generator(){this.init=function(b,a){a.vset(0);a.gencnt=0;a.lockon_flag=false;a.mp=31;a.hit_x=8;a.hit_y=8;a.get_target(98);a.hp=18;a.etype=[1,2,3,4,5,8,9];a.nextcountermax=180};this.move=function(d,a){a.frame++;if(Boolean(a.target)){if(a.target_d(a.target.x,a.target.y)<200)a.lockon_flag=true;a.lockon_flag=true}if(a.frame>a.nextcountermax){if(a.lockon_flag&&a.gencnt<500){var b=a.target_v(),c=a.etype[Math.floor(Math.random()*a.etype.length)],c=a.etype[a.gencnt%a.etype.length];a.set_object_ex(c,a.x+a.Cos(b)*32,a.y+a.Sin(b)*32,b,"ememy_move_std2");a.gencnt++}a.frame=0;a.get_target(98);a.vset(0);a.nextcountermax--;if(a.nextcountermax<30)a.nextcountermax=30}return a.sc_move()}}function sce_enemy_trbox(){this.init=function(b,a){a.vset(0);a.attack=0};this.move=function(e,d){var b=0;d.frame++;if(this.status==2){this.change_sce(7);for(var a=0;a<this.pick.length;a++)this.set_object_ex(this.pick[a],this.x,this.y,Math.floor(Math.random()*360),"item_movingstop");this.add_score(this.score)}if(this.damageflag){var c=this.gt.in_view_range(this.x-this.hit_x/2,this.y-this.hit_y/2,this.hit_x,this.hit_y);c}if(this.status==0)b=1;this.damageflag=false;return b}}function sce_ememy_timeover(){this.init=function(b,a){a.vset(2);a.get_target(98);a.lifecount=0;a.cancelcol=true;a.display_size=2;a.hit_x*=2;a.hit_y*=2;a.attack=10;a.pick_enable=false};this.move=function(b,a){switch(a.frame){case 10:a.target_rotate_r(30);a.vset(2);break;case 15:a.get_target(98);a.frame=9}a.frame++;a.lifecount++;a.lifecount%300==250&&a.set_object_ex(5,a.x,a.y,a.vector,"en_bullet_homing");if(a.cancelcol)this.mapCollision=false;return a.sc_move()}}function sce_en_bullet_homing(){this.init=function(b,a){a.vset(2);a.get_target(98);a.lifecount=0;a.cancelcol=true};this.move=function(b,a){switch(a.frame){case 10:a.target_rotate_r(15);a.vset(2);break;case 15:a.frame=9}a.frame++;a.lifecount++;if(a.cancelcol)this.mapCollision=false;return a.sc_move()}}function sce_en_bullet_random(){this.init=function(c,a){var b=Math.floor(Math.random()*50)-25;a.vector=(a.vector+b+360)%360;a.vset(4)};this.move=function(b,a){return a.sc_move()}}function sce_en_bullet_accel(){this.init=function(b,a){a.vset(4)};this.move=function(b,a){switch(a.frame){case 15:a.vx/=2;a.vy/=2;break;case 23:a.vx/=2;a.vy/=2;break;case 30:a.vx/=2;a.vy/=2;break;case 90:a.vset(6)}a.frame++;return a.sc_move()}}function sce_en_bullet_hominglaser(){this.init=function(b,a){a.vset(2);a.get_target(98);a.display_size=2;a.alpha=128;a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 26:a.frame>90&&a.get_target(2);a.target_rotate_r(15+(a.frame<20?15:0));a.vset(2+(a.frame>40?4:0)+(a.frame>50?4:0));break;case 30:a.w_cnt=25}a.frame%5==0&&a.set_object_ex(32,a.x,a.y,a.vector,56);a.w_cnt++;a.frame++;return a.sc_move()}}function sce_en_bullet_infolaser(){this.init=function(b,a){a.vset(0);a.msf=false;a.display_size=2;a.alpha=0};this.move=function(b,a){switch(a.frame){case 0:a.normal_draw_enable=false;a.custom_draw_enable=true;break;case 45:a.normal_draw_enable=true;a.custom_draw_enable=false;a.msf=true}if(a.msf){a.vset(48);a.set_object_ex(32,a.x+a.vx,a.y+a.vy,a.vector,56)}a.frame++;return a.sc_move()};this.draw=function(d,b){var a={},c=b.gt.worldtoView(b.x,b.y);a.x=c.x;a.y=c.y;b.vset(800);a.tx=c.x+b.vx;a.ty=c.y+b.vy;b.vset(0);a.alpha=b.frame/30;a.alpha=a.alpha>1?1:a.alpha;a.draw=function(b){b.beginPath();b.moveTo(this.x,this.y);b.lineTo(this.tx,this.ty);b.lineWidth="1";b.strokeStyle="rgba( 255, 0, 0,"+a.alpha+")";b.stroke()};d.putFunc(a)}}function sce_en_bullet_turn(){this.init=function(b,a){a.vset(0);a.get_target(98)};this.move=function(b,a){if(a.frame==60){a.vector=a.target_v();a.vset(8)}a.frame++;return a.sc_move()}}function sce_en_bullet_laser_tail(){this.init=function(b,a){a.vset(0);a.display_size=2};this.move=function(b,a){if(a.frame>10)a.status=0;a.frame++;return a.sc_move()}}function sce_exev_3way(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-5,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+5,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5way_nallow(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-10,12);a.set_object_ex(5,a.x,a.y,a.vector-5,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+5,12);a.set_object_ex(5,a.x,a.y,a.vector+10,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5way_normal(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-30,12);a.set_object_ex(5,a.x,a.y,a.vector-15,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+15,12);a.set_object_ex(5,a.x,a.y,a.vector+30,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5expansion(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(3,a.x,a.y,a.vector,"common_vset2");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset4");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset6");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset8");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset10")};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_3way_exp(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-5,"exev_5expansion");a.set_object_ex(5,a.x,a.y,a.vector,"exev_5expansion");a.set_object_ex(5,a.x,a.y,a.vector+5,"exev_5expansion")};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_friend_rotate(){this.init=function(b,a){a.vset(0);a.get_target(98);a.startflag=true;a.startv=(a.vector+315)%360;a.vector=a.startv;a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.rotatecount=0;a.attack=1};this.move=function(c,a){var b=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(Boolean(a.target)){if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else{a.change_sce(7);return 1}}else{a.change_sce(7);return 1}if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.rotatecount++;if(a.rotatecount>10){a.vector=(a.target.vector+315)%360;a.rotatecount=0;a.status=0}a.x=a.target.x+a.Cos(a.vector)*35;a.y=a.target.y+a.Sin(a.vector)*35;a.vector=(a.vector+9)%360;if(a.status==0)b=1;return b}}function sce_friend_start(){this.init=function(b,a){a.vset(0)};this.move=function(b,a){if(!a.config.option)a.status=0;a.hp=10;switch(a.frame){case 30:a.vector=180;a.get_target(98);break;case 58:case 59:a.vector=a.target_v();case 60:a.vset(0);a.change_sce(21)}a.frame++;return a.sc_move()}}function sce_friend_sidearm(){this.init=function(b,a){a.vset(0);a.triger=15;a.m_trig=0;a.frame=60};this.move=function(f,a){if(!a.config.option)a.status=0;var c=a.vector;a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}var b=0;for(var e in a.item)if(e==7)b=a.item[e];if(b<10)a.mp=15;else a.mp=24;if(eval(a.mouse_state.button)==0){if(a.shot==0){a.shot=1;(b>=3&&b<=4||b>=8)&&a.set_object_ex(6,a.x,a.y,a.vector>180?a.vector+87:a.vector-87,13);a.m_trig=1-a.m_trig;if(b>=5)a.m_trig==0&&a.set_object(13);if(a.frame>45)if(b>=10){a.set_object(23);a.frame=0}a.triger=15;if(b>=7)a.triger=5}c=a.vector}var d=0;a.target.type!=98&&a.change_sce(7);if(this.status==0)d=1;a.x=a.target.x+Math.cos((c-90)*(Math.PI/180))*32;a.y=a.target.y+Math.sin((c-90)*(Math.PI/180))*32;a.frame++;return d}}function sce_friend_straight(){this.init=function(b,a){a.vset(0);a.get_target(98);a.startflag=true;a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.shotcount=0;a.attack=1};this.move=function(d,a){var b=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.shotcount++;if(a.shotcount>10){a.vector=(a.target.vector+315)%360;a.shotcount=0;a.status=0}var c=Math.abs(a.shotcount-5);a.x=a.target.x+a.Cos(a.vector)*(50-c);a.y=a.target.y+a.Sin(a.vector)*(50-c);if(a.status==0)b=1;return b}}function sce_friend_boom(){this.init=function(b,a){a.vset(4);a.get_target(98);a.startflag=true;a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.shotcount=0;a.bup_vector=a.vector;a.attack=1};this.move=function(c,a){a.vector=a.bup_vector;var b=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.shotcount++;if(a.shotcount>30)a.vector=a.target_v(a.target.x,a.target.y);a.vset(4);a.bup_vector=a.vector;if(a.target_d(a.target.x,a.target.y)<24||a.shotcount>180)a.status=0;a.vector=a.shotcount*5%360;a.x+=a.vx;a.y+=a.vy;if(a.status==0)b=1;if(a.states==2)b=1;return b}}function sce_friend_rotate_full(){this.init=function(b,a){a.vset(0);a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.rotatecount=0;a.attack=2};this.move=function(c,a){var b=0;if(!Boolean(a.parent)){a.change_sce(7);return 1}if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.rotatecount++;if(a.rotatecount>20){a.vector=(a.vector+18)%360;a.rotatecount=0;a.status=0}a.x=a.parent.x+a.Cos(a.vector)*35;a.y=a.parent.y+a.Sin(a.vector)*35;a.vector=(a.vector+18)%360;if(a.status==0)b=1;return b}}function gameScene(b){var c=b.System.dev,A=c.graphics[1],g=c.graphics[0],e=c.graphics[3],x=c.graphics[2];this.init=F;this.reset=D;this.step=G;this.draw=E;this.score=0;var a,d,z,I=0,f=0,s=[],m=[],o=[],J=false,k=true,r=0,h=0,l=0,j=false,p=0,y=0,v=0,u=false,n=false,t=false,q=0,C={};C.draw=function(a){a.beginPath();a.fillStyle="rgba(0,0,0,0.3)";a.fillRect(c.layout.map_x,c.layout.map_y,150,150)};var B={};B.draw=function(a){a.beginPath();a.fillStyle="rgba(0,0,0,0.5)";a.fillRect(0,480-36,640-13*13,36)};var H={hp:0,mhp:0,br:true};H.draw=function(a){a.beginPath();a.fillStyle=this.br?"skyblue":"limegreen";a.lineWidth=1;a.fillRect(c.layout.hp_x+1,c.layout.hp_y+1,this.hp,14);a.stroke();a.beginPath();a.strokeStyle="white";a.lineWidth=1;a.rect(c.layout.hp_x,c.layout.hp_y,this.mhp,15);a.stroke()};function F(){a=new gObjectControl(A,b);d=new mapSceControl;d.init();b.Result.load();b.Result.score=0;b.Game.item=a.item;b.Result.combo=a.combo;j=false}function D(i){e.clear();if(!Boolean(i))i=false;j=false;if(b.Game.cold){a.reset(false);d.init();if(i){f=2-b.Game.player.zanki;a.item=b.Game.item;a.itemstack=b.Game.itemstack}else{f=0;b.Game.nowstage=b.Config.startstage;b.Game.player.maxhp=100;b.Game.player.hp=b.Game.player.maxhp;b.Game.player.weapon=0}b.Game.player.barrier=false;d.change(b.Game.nowstage);d.reset();k=true;r=0;h=0;l=0;c.sound.change(0);c.sound.play()}v=0;if((i=true)&&!b.Game.cold){w=d.stage;w++;d.change(w);d.stage=w;b.Game.nowstage=w;var p=a.score;a.reset(false);a.score=p;d.reset();h=0;l=0}s=c.images.img[d.bgImage()];m=d.mapChip();o=d.bgPtn();g.clear("darkgreen");g.reset();z=new gs_score_effect(a.score);ehighscore=new gs_score_effect(b.Result.highscore);u=true;t=b.Config.lamp_use?true:false;n=b.Config.map_use?false:true}function G(){if(!c.sound.running())d.flame<7200;if(d.flame==7100){c.sound.change(2);c.sound.play();u=false}if(a.interrapt){if(a.SIGNAL==1){d.enable=false;d.counter_runnning=false;c.sound.volume(0)}if(a.SIGNAL==6055){if(h==0)k=false;d.enable=true;d.counter_runnning=false}if(a.SIGNAL==835){a.score+=Math.floor((7200-d.flame)/6);b.Result.score=a.score;b.Game.item=a.item;b.Game.itemstack=a.itemstack;b.Game.player.zanki=2-f;b.Result.combo=a.combo;b.Result.combomax=a.combomax;b.Result.obCount=a.obCount;b.Result.total=a.total;b.Result.hidan=a.hidan;b.Game.cold=false;a.interrapt=false;a.SIGNAL=0;a.draw(g);j=true;c.sound.change(4);c.sound.play();return 5}if(a.SIGNAL==4649){f++;if(f<3){if(b.Config.itemreset){a.item=[];a.itemstack=[]}a.combo=[];b.Game.player.hp=b.Game.player.maxhp;a.restart();d.counterReset();u=false}else{b.Result.score=a.score;b.Game.item=a.item;b.Game.itemstack=a.itemstack;b.Game.player.zanki=2-f;b.Result.combo=a.combo;b.Result.combomax=a.combomax;b.Result.obCount=a.obCount;b.Result.total=a.total;b.Result.hidan=a.hidan;a.draw(g);j=true;Boolean(localStorage)&&localStorage.setItem("highscore",new String(b.Result.highscore));c.sound.change(6);c.sound.play();return 3}}}else{k=true;d.enable=true;d.counter_runnning=true}for(i in a.item){if(i==21)if(a.item[21]>0){a.item[21]=0;f--;c.sound.effect(11)}if(i==26)if(a.item[26]>0){a.item[26]=0;t=true}if(i==27)if(a.item[27]>0){a.item[27]=0;n=false}if(i==15)if(a.item[15]>0){a.item[15]=0;b.Game.player.weapon=0}if(i==16)if(a.item[16]>0){a.item[16]=0;b.Game.player.weapon=1}if(i==17)if(a.item[17]>0){a.item[17]=0;b.Game.player.weapon=2}if(i==19)if(a.item[19]>0){a.item[19]=0;b.Game.player.weapon=3}if(i==18)if(a.item[18]>0){a.item[18]=0;b.Game.player.weapon=4}}var q=0,o=1;for(i in a.combo){if(i==2)q=a.combo[i];if(i==4)o=a.combo[i]}if(p!=q){p=q;if(p>=2)v=60}if(y!=o)y=o;if(!a.interrapt){a.move(d);d.step(a)}else if(a.SIGNAL!=1){a.move(d);d.step(a)}else{var e=c.key_state.check(),m=false;if(Boolean(e[90]))if(e[90])m=true;if(Boolean(e[32]))if(e[32])m=true;var r=false;if(Boolean(e[81]))if(e[81]){r=true;delete e[81]}if(r){b.Game.item=a.item;b.Game.itemstack=a.itemstack;b.Game.player.zanki=2-f;if(b.Game.save()==0){c.sound.volume(1);c.sound.change(9);c.sound.play();return 2}else{alert("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002\n\u4e2d\u65ad\u30bb\u30fc\u30d6\u51fa\u6765\u306a\u304b\u3063\u305f\u306e\u3067\u3001\n\u30b2\u30fc\u30e0\u7d99\u7d9a\u3057\u307e\u3059\u3002");m=true}}if(m){a.interrapt=false;a.SIGNAL=0;c.sound.volume(1)}}if(k)h++;if(h>480){h=0;l=1-l}if(b.Result.highscore<a.score)b.Result.highscore=a.score;return 0}function E(){j=true;if(r!=c.gs.world_x||h!=c.gs.world_y){j=false;r=c.gs.world_x;h=c.gs.world_y}if(!j){for(var k in m){var i=m[k];if(c.gs.in_stage_range(i.x,i.y,i.w,i.h)){i.view=true;var u=c.gs.worldtoView(i.x,i.y);if(i.visible){var w=false;if(i.type==11)w=true;if(Boolean(o[i.no]))if(w)x.putPattern(s,o[i.no],u.x,u.y-24,i.w,i.h);else g.putPattern(s,o[i.no],u.x,u.y,i.w,i.h);else{var p={};p.x=u.x;p.y=u.y;p.w=i.w;p.h=i.h;p.draw=function(a){a.beginPath();a.strokeStyle="green";a.lineWidth=1;a.rect(this.x,this.y,this.w,this.h);a.stroke()};g.putFunc(p)}}}else i.view=false}a.drawPoint(x,t);g.clear("darkblue");g.draw();g.reset()}a.draw();var v=false;q++;if(q%6==0){q=0;v=true}if(v){var l=[];e.fill(c.layout.hiscore_x+8*6,c.layout.hiscore_y,8*7,32);wt=ehighscore.read(b.Result.highscore);e.putchr8("Hi-Sc:"+wt,c.layout.hiscore_x,c.layout.hiscore_y);wt=z.read(a.score);e.putchr8("Score:"+wt,c.layout.score_x,c.layout.score_y);a.chain_cnt>1&&e.putchr8("chain:"+a.chain_cnt,c.layout.score_x+48,c.layout.score_y+8);var y=2-f;if(y<3)for(var k=0;k<2-f;k++)e.put("Nyaru1",c.layout.zanki_x+k*16,c.layout.zanki_y);else{e.put("Nyaru1",c.layout.zanki_x,c.layout.zanki_y);e.putchr8("x"+y,c.layout.zanki_x+16,c.layout.zanki_y)}e.putchr8("Time:"+Math.floor((7200-d.flame)/6),c.layout.time_x,c.layout.time_y)}if(a.interrapt&&a.SIGNAL==1){e.putchr(" == PAUSE ==",320-50,200);e.putchr("Push <Z>key or [Space] ",320-100,220);e.putchr(" Return game.",320-50,240);e.putchr("Push <Q>key /",320-100,260);e.putchr("Save and Quit.",320-50,280)}else e.fill(320-100,200,12*24,20*5);if(b.Config.debug){var l=[];l.push("o:"+a.cnt()+"/"+a.num()+"/"+a.nonmove);l.push("f:"+d.flame);if(a.interrapt)l.push("interrapt:"+a.SIGNAL);else l.push("running:"+a.SIGNAL);l.push("chain:"+a.chain_cnt);var C=0;for(k in a.total)if(k==2)C=a.total[k];var D=1;for(k in a.obCount)if(k==2)D=a.obCount[k];l.push("wx,wy:"+Math.floor(c.gs.world_x)+","+Math.floor(c.gs.world_y));l.push("play:"+Math.floor(c.sound.info())+"."+c.sound.running());for(var B in l)A.putchr8(l[B],c.layout.status_x,c.layout.status_y+8*B)}if(v){e.fill(0,192-48,256,48);e.draw();e.reset()}if(!n){e.fill(c.layout.map_x,c.layout.map_y,150,150);var p={};p.mcp=m;p.draw=function(b){for(var d=0,e=this.mcp.length;d<e;d++){var a=this.mcp[d];if(a.visible&&(a.type==11||a.type==12)){b.beginPath();b.strokeStyle=a.type==12?"orange":"blue";b.lineWidth=1;b.rect(c.layout.map_x+a.x/20,c.layout.map_y+a.y/20,2,2);b.stroke()}}};e.putFunc(p);n=true}}}function gs_score_effect(b){var a=b;this.read=function(b){if(b<=a)a=b;else{var c=Math.ceil((b-a)/5);a+=c}var d=a,e=[],f="";for(i=0;i<7;i++){var c=d%10;e[7-i]=c;d=(d-c)/10}for(i in e)f=f+""+e[i];return f}}function geometoryTrance(){this.worldwidth=640;this.worldheight=480;this.stagewidth=320;this.stageheight=240;this.viewwidth=256;this.viewheight=192;this.world_x=0;this.world_y=0;var h=this.worldwidth,g=this.worldheight,d=this.stagewidth,c=this.stageheight,b=this.viewwidth,a=this.viewheight,e=this.world_x,f=this.world_y;this.viewtoWorld=function(b,c){var a={};a.x=this.world_x+b;a.y=this.world_y+c;return a};this.worldtoView=function(b,c){var a={};a.x=b-this.world_x;a.y=c-this.world_y;return a};this.viewpos=function(c,d){if(c<0)c=0;if(d<0)d=0;if(c>h-b)c=h-b;if(d>g-a)d=g-a;e=c;f=d};this.commit=function(){this.world_x=e;this.world_y=f};this.nowstagepos=function(){var e={};e.ltx=this.world_x+b/2-d/2;e.lty=this.world_y+a/2-c/2;e.rtx=this.world_x+b/2+d/2;e.rty=this.world_y+a/2-c/2;e.lbx=this.world_x+b/2-d/2;e.lby=this.world_y+a/2+c/2;e.rbx=this.world_x+b/2+d/2;e.rby=this.world_y+a/2+c/2;e.x=e.ltx;e.y=e.lty;e.w=d;e.h=c;return e};this.in_stage=function(f,g){var e=false;if(this.world_x+b/2-d/2<=f&&this.world_x+b/2+d/2>=f&&this.world_y+a/2-c/2<=g&&this.world_y+a/2+c/2>=g)e=true;return e};this.in_view=function(d,e){var c=false;if(this.world_x<=d&&this.world_x+b>=d&&this.world_y<=e&&this.world_y+a>=e)c=true;return c};this.in_view_range=function(f,g,e,d){var c=false;if(Math.abs(this.world_x+b/2-(f+e/2))<(b+e)/2&&Math.abs(this.world_y+a/2-(g+d/2))<(a+d)/2)c=true;return c};this.in_stage_range=function(f,g,e,b){var a=false;if(Math.abs(this.world_x+d/2-(f+e/2))<(d+e)/2&&Math.abs(this.world_y+c/2-(g+b/2))<(c+b)/2)a=true;return a}}function gObjectClass(){this.x;this.y;this.vx;this.vy;this.mp;this.vector;this.visible=false;this.center_x;this.center_y;this.hit_x;this.hit_y;this.mp_cnt_frm=0;this.mp_cnt_anm=0;this.type;this.chr;this.frame=0;this.scenario=[];this.status=0;this.hp;this.target=-1;this.crash=-1;this.id;this.score=0;this.triger=0;this.shot=0;this.alpha=255;this.display_size=1;this.message=[];this.normal_draw_enable=true;this.custom_draw_enable=false;this.damegeflag=false;this.damage={count:0,vector:0,dist:0,no:0};this.attack=1;this.mapCollision=false;this.mapColX=false;this.mapColY=false;this.alive=600;this.custom_draw=null;this.old_x=this.x;this.old_y=this.y;}gObjectClass.prototype.test=function(){return 0};gObjectClass.prototype.reset=function(){status=0;type=5;visible=false;mp_cnt_frm=0;mp_cnt_anm=0;scenario=[];this.normal_draw_enable=true;this.custom_draw_enable=false;damegeflag=false};gObjectClass.prototype.init=function(b,a){a.vset(5)};gObjectClass.prototype.draw=function(b,a){b.print(a.mp+"",a.x,a.y)};gObjectClass.prototype.move=function(c,a){a.x+=a.vx;a.y+=a.vy;var b=0;if(a.x<0||a.x>c.cw)b=1;if(a.y<0||a.y>c.ch)b=1;return b!=0?-1:0};gObjectClass.prototype.vset=function(a){this.vx=Math.cos(Math.PI/180*(this.vector-90))*a;this.vy=Math.sin(Math.PI/180*(this.vector-90))*a};gObjectClass.prototype.set_object=function(c,b){var a={};a.cmd="set_object";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.set_object_ex=function(d,g,h,f,c,e){var b={},a={};a.x=g;a.y=h;a.vector=f;a.sce=c;a.id=e;b.cmd="set_object_ex";b.src=d;b.dst=a;this.message.push(b)};gObjectClass.prototype.get_target=function(c,b){var a={};a.cmd="get_target";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.change_sce=function(c,b){var a={};a.cmd="change_sce";a.src=c;a.dst=b;this.frame=0;this.normal_draw_enable=true;this.custom_draw_enable=false;this.message.push(a)};gObjectClass.prototype.add_score=function(c,b){var a={};a.cmd="add_score";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.get_item=function(c,b){var a={};a.cmd="get_item";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb=function(c,b){var a={};a.cmd="bomb";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb2=function(c,b){var a={};a.cmd="bomb2";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb3=function(c,b){var a={};a.cmd="bomb3";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb4=function(c,b){var a={};a.cmd="bomb4";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.collect=function(c,b){var a={};a.cmd="collect";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.SIGNAL=function(c,b){var a={};a.cmd="SIGNAL";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.reset_combo=function(c,b){var a={};a.cmd="reset_combo";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.target_r=function(d,e){var f=this.x,g=this.y,a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=Math.atan(c/b)*(180/Math.PI);if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a};gObjectClass.prototype.target_v=function(){return!Boolean(this.target)?this.vector:this.target_r(this.target.x,this.target.y)};gObjectClass.prototype.target_rotate_r=function(c){if(!Boolean(this.target))return;var a=this.target_r(this.target.x,this.target.y),b=a;if(b>179)b=-360+b;w=this.vector;if(w>179)w=-360+w;a=b-w;if(Math.abs(a)>100){w=(this.vector+180)%360;if(w>179)w=-360+w;a=(b-w)*-1}if(Math.abs(a)<c)c=a;if(a!=0)this.vector=this.vector+a/Math.abs(a)*c;if(this.vector<0)this.vector=360+this.vector;if(this.vector>359)this.vector=this.vector-360};gObjectClass.prototype.target_d=function(a,b){var c=this.x,d=this.y;return Math.sqrt(Math.abs(a-c)*Math.abs(a-c)+Math.abs(b-d)*Math.abs(b-d))};gObjectClass.prototype.Sin=function(a){return Math.sin((a-90)*(Math.PI/180))};gObjectClass.prototype.Cos=function(a){return Math.cos((a-90)*(Math.PI/180))};function gObjectControl(m,g){var h,r,u,d=g.System.dev;delobj=0;this.score=0;this.interrapt=false;this.SIGNAL=0;this.item=[];this.combo=[];this.obCount=[];this.combomax=[];this.total=[];this.itemstack=[];this.chain_ctype=-1;this.chain_cnt=0;this.hidan=0;this.nonmove=0;var k=0,o=0,e=1,p=0,f,s,t,c=character(),j=motionPattern(),n=scenario(),a=[],l=[];l[0]=[0,0,2,1,1,0];l[1]=[0,0,1,0,0,0];l[2]=[2,1,0,0,1,0];l[3]=[1,0,0,0,0,0];l[4]=[1,0,0,0,0,0];l[5]=[0,0,0,0,0,0];var q=true;this.reset=function(b){q=true;h=new CLinear4TreeManager;!h.init(6,0,0,3e3,3e3)&&alert("!");delobj=0;p=0;if(g.Game.cold){this.score=0;this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;this.combo=[];this.item=[];this.itemstack=[]}if(!b){this.interrapt=false;this.SIGNAL=0;a=[];g.Config.cold=true}if(g.Config.fullpower)this.item[7]=10;this.item[35]=0};this.move=function(E){f=E;var Q=d.mouse_state.check_last(),P=d.key_state.check();this.nonmove=0;for(var n in a){var c=a[n],G=c.gt.in_view_range(c.x-c.hit_x/2,c.y-c.hit_y/2,c.hit_x,c.hit_y);if(!G)if(c.type==1||c.type==3)c.status=0;if(g.Game.outviewCollision)G=true;if(!G){this.nonmove++;if(c.type!=5)continue}c.mouse_state=Q;c.key_state=P;if(c.move(m,c,E)!=0){c.colitem&&c.colitem.remove();c.colitem=null;delete a[n];delobj++}else if(c.type!=5)if(!c.firstRunning||(c.x!=c.old_x||c.y!=c.old_y)){c.colitem&&c.colitem.remove();if(!c.colitem){c.colitem=h.createObjectForTree();c.colitem.obj=c}h.register(c.x-c.hit_x/2,c.y-c.hit_y/2,c.x+c.hit_x/2,c.y+c.hit_y/2,c.colitem);c.crash=null;c.firstRunning=true}for(var F=0,C=c.message.length;F<C;F++){var j=c.message[F];if(j.cmd=="add_score")this.score+=j.src;if(j.cmd=="get_item"){if(Boolean(this.item[j.src]))this.item[j.src]++;else this.item[j.src]=1;var O=1;this.score+=c.score*O;if(j.src==35){if(o==0)o=8;k+=c.score;if(e<this.chain_cnt)e=this.chain_cnt}if(j.src==21){var v="Extend!";f.add(c.x,c.y,0,20,39,v)}if(j.src==22){var v="GetKey!";d.sound.effect(11);f.add(c.x,c.y,0,20,39,v)}var B=false;if(j.src==23||j.src==24||j.src==25)B=true;if(B){var i=j.src;this.itemstack.push(i)}}if(j.cmd=="reset_combo")for(var J in this.combo)if(j.src==J)this.combo[J]=0;if(j.cmd=="SIGNAL")if(this.interrapt){this.interrapt=false;this.SIGNAL=0}else{this.interrapt=true;this.SIGNAL=j.src;if(j.src==0)this.interrapt=false}if(j.cmd=="bomb2"||j.cmd=="bomb3")if(Boolean(this.item[7]))if(this.item[7]>0)this.item[7]--;b[j.cmd](c,j.src,j.dst)}c.message=[];c.mapCollision=false;c.mapColX=false;c.mapColY=false}if(o>0){o--;if(o==0){var z=Math.floor(this.chain_ctype/3);this.score+=k*(e-1);this.score+=k*z;var v=k*e+k*z+"pts";if(e!=1){v+="("+k+"x";if(z!=0)v+="("+e+"+"+z+")";else v+=""+e;v+=")"}f.add(128,96,0,20,39,v);k=0;e=1}}if(q){for(var I=f.mapChip(),H=0,C=I.length;H<C;H++){var i=I[H];i.colitem&&i.colitem.remove();if(i.c){if(!i.colitem){i.colitem=h.createObjectForTree();i.colitem.obj=i}h.register(i.x,i.y,i.x+i.w,i.y+i.h,i.colitem)}}q=false}var w=h.getAllCollisionList();r=w.length;for(var n=0,C=w.length;n<C;n+=2){var c=w[n],u=w[n+1],D=c.type==98?0:c.type,A=u.type==98?0:u.type;if(D>=10&&A>=10)continue;if(D<10&&A<10){var R=l[D][A];if(R==0)continue;if(Math.abs(c.x-u.x)<(c.hit_x+u.hit_x)/2&&Math.abs(c.y-u.y)<(c.hit_y+u.hit_y)/2){c.status=2;u.status=2;c.crash=u;u.crash=c}}else{if(A<10){c=w[n+1];u=w[n]}var i=u,K=false,N=c.mapCollision,L=c.mapColX,M=c.mapColY;if(i.c){if(Math.abs(c.x+c.vx-(i.x+i.w/2))<(c.hit_x+i.w)/2&&Math.abs(c.y+c.vy-(i.y+i.h/2))<(c.hit_y+i.h)/2){c.mapCollision=true;K=true}if(Math.abs(c.x+c.vx-(i.x+i.w/2))<(c.hit_x+i.w)/2&&Math.abs(c.y-(i.y+i.h/2))<(c.hit_y+i.h)/2)c.mapColX=true;if(Math.abs(c.x-(i.x+i.w/2))<(c.hit_x+i.w)/2&&Math.abs(c.y+c.vy-(i.y+i.h/2))<(c.hit_y+i.h)/2)c.mapColY=true;if(K)if(i.type==12){if(c.type==98)c.doorflag=true;c.mapCollision=N;c.mapColX=L;c.mapColY=M}}}}var X=E.cmap();for(n in a){c=a[n];var x={},y={};x.x=c.x-c.hit_x/2;x.y=c.y-c.hit_y/2;y.x=c.x+c.hit_x/2;y.y=c.y+c.hit_y/2;x.mx=Math.floor((x.x-96)/32);x.my=Math.floor((x.y-96)/32);y.mx=Math.floor((y.x-96)/32);y.my=Math.floor((y.y-96)/32);if(c.crash){var V=0,U=0,W=0;if(!(c.type==1||c.type==3)){var T=true;if(T){var S=c.hp;if(c.type==4)c.hp=0;if(c.type!=c.crash.type){if(c.crash.type!=4)c.hp-=c.crash.attack}else c.mapCollision=true;if(c.hp>0){c.status=1;if(S!=c.hp){c.damageflag=true;c.crash.damageflag=true;c.damage.vector=c.target_r(c.crash.x,c.crash.y);c.damage.dist=c.target_d(c.crash.x,c.crash.y);c.damage.no=c.crash.attack}c.crash=null}else c.type==2&&this.combo_sub(c.chr)}}}}var B=0;for(n in a)if(a[n].type==98)B++;if(B==0){p++;if(p>90){s=this.interrapt;t=this.SIGNAL;this.interrapt=true;this.SIGNAL=4649}}};this.combo_sub=function(a){if(!Boolean(this.combo[a]))this.combo[a]=1;else this.combo[a]++;if(!Boolean(this.combomax[a]))this.combomax[a]=this.combo[a];else if(this.combo[a]>this.combomax[a])this.combomax[a]=this.combo[a];if(!Boolean(this.total[a]))this.total[a]=1;else this.total[a]++;if(a==this.chain_ctype)this.chain_cnt++;else{this.chain_ctype=a;this.chain_cnt=1}return this.combo[a]};this.restart=function(){f.start(false);p=0;this.interrapt=s;this.SIGNAL=t};var b=[];b.set_object=function(a,b){f.add(a.x,a.y,a.vector,b,null,null,a)};b.set_object_ex=function(c,b,a){f.add(a.x,a.y,a.vector,b,a.sce,a.id,c)};b.get_target=function(b,f){var h=1,d=99999;b.target=null;for(var g in a){var c=a[g];if(c.type!=f)continue;var e=c.target_d(b.x,b.y);if(e<d){b.target=c;d=e}}};b.change_sce=function(a,b){a.init=n.init[b];a.move=n.move[b];a.custom_draw=n.draw[b];a.init(m,a)};b.add_score=function(c,a){return a};b.get_item=function(c,a){return a};b.bomb=function(){for(i in a)a[i].type==3&&a[i].change_sce(7)};b.bomb2=function(b){for(i in a){b=a[i];if(b.type==3){b.type=4;b.mp=18;b.score=8;if(b.chr!=7){var c=[18,22,26,27,29,30];b.mp=c[Math.floor(Math.random()*c.length)]}b.change_sce(30)}}};b.bomb3=function(c){for(i in a){var b=c.gt.in_view_range(a[i].x-a[i].hit_x/2,a[i].y-a[i].hit_y/2,a[i].hit_x,a[i].hit_y);if(b){if(a[i].type==2){a[i].hp-=10;if(a[i].hp<=0)a[i].status=2}a[i].type==3&&a[i].change_sce(7)}}};b.bomb4=function(d,b){for(i in a)if(a[i].chr==b)a[i].status=0};b.collect=function(b){for(i in a){b=a[i];if(b.type==4)if(!Boolean(b.collection_mode)){b.collection_mode=true;b.change_sce(30)}}};b.SIGNAL=function(){};b.reset_combo=function(){};this.draw=function(c){if(!Boolean(c))c=m;for(var e in a){var b=a[e];if(b.visible){if(b.normal_draw_enable)d.gs.in_view(b.x,b.y)&&b.draw(c,b);if(b.custom_draw_enable)Boolean(b.custom_draw)&&b.custom_draw(c,b)}}if(g.Config.debug){c.putchr8("obj:"+h.objectNum,300,16);c.putchr8("col:"+r/2,300,24);c.putchr8("f:"+u,300,32)}};this.drawPoint=function(c,f){var e=["skyblue","skyblue","red","orange","yellow","yellow"];e[98]="white";if(!Boolean(c))c=m;var b={};b.obj=a;b.col=e;b.draw=function(b){for(var c in this.obj){var a=this.obj[c];if(a.visible){if(a.type==1||a.type==3)continue;if(a.type!=98&&!f)continue;if(a.normal_draw_enable){b.beginPath();b.strokeStyle=this.col[a.type];b.lineWidth=2;b.rect(d.layout.map_x+a.x/20,d.layout.map_y+a.y/20,a.hit_x/20,a.hit_y/20);b.stroke()}}}};c.putFunc(b)};this.set_s=w;function w(k,l,q,e,f,j,p){var b=new gObjectClass;b.reset();b.firstRunning=false;b.parent=p;b.scrn=m;b.graphicsLayer=d.graphics;b.mouse_state=d.mouse_state.check_last();b.gt=d.gs;b.sound=d.sound;b.gameState=g.Game;b.item=this.item;b.itemstack=this.itemstack;b.config=g.Config;b.pick=[];b.pick_enable=true;b.x=k;b.y=l;b.startx=k;b.starty=l;b.vector=q;b.chr=e;b.visible=true;b.mp=c[e].mp;b.hp=c[e].hp;b.maxhp=b.hp;b.type=c[e].type;b.center_x=c[e].center_x;b.center_y=c[e].center_y;b.hit_x=c[e].size_x;b.hit_y=c[e].size_y;if(!Boolean(j))j=c[e].id;b.id=j;b.score=c[e].score;b.status=1;if(!Boolean(f))f=c[e].senario[0];b.init=n.init[f];b.move=n.move[f];b.draw=v;b.custom_draw=n.draw[f];b.attack=3;if(b.type==1||b.type==3)b.attack=b.hp;b.init(m,b);for(var i=-1,h=0,o=a.length;h<o;h++)if(!a[h]){i=h;break}if(i==-1)a[a.length]=b;else a[i]=b;if(Boolean(this.obCount[b.type]))this.obCount[b.type]++;else this.obCount[b.type]=1;if(b.type==1&&b.type==3)b.alive=90}this.num=function(){return a.length};this.cnt=function(){var b=0;for(var c in a)b++;return b};function v(c,a){if(Boolean(j[a.mp].wait)){a.mp_cnt_frm++;if(a.mp_cnt_frm>j[a.mp].wait/2){a.mp_cnt_anm++;a.mp_cnt_frm=0;if(a.mp_cnt_anm>=j[a.mp].pattern.length)a.mp_cnt_anm=0}}try{var f=j[a.mp].pattern[a.mp_cnt_anm][0]}catch(g){a.mp_cnt_anm=0;f=j[a.mp].pattern[a.mp_cnt_anm][0]}var d=j[a.mp].pattern[a.mp_cnt_anm][1],e=j[a.mp].pattern[a.mp_cnt_anm][2];if(d==-1&&e==-1){d=0;e=a.vector}var b=a.gt.worldtoView(a.x,a.y);b.x>=0&&b.x<=c.cw&&b.y>=0&&b.y<=c.ch&&c.put(f,b.x,b.y,d,e,a.alpha,a.display_size)}}function loadingImages(){var a=["cha","aschr"],b=[];this.img=b;for(var c in a){b[a[c]]=new Image;b[a[c]].src="pict/"+a[c]+".png";b[a[c]].ready=false;b[a[c]].onload=function(){this.ready=true}}this.readyStateCheck=function(){var c=[];for(var d in a)c[a[d]]=b[a[d]].ready;return c}}function inputControl(){var a,b,e,f,g=0,h=0,d,l=-1,k,i=0,j="NaN",n=0,m=0,c=document;this.o_Left=c.offsetLeft;this.o_Top=c.offsetTop;c.onmousemove=t;function t(c){x=c.clientX;y=c.clientY;if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y}c.onmousedown=function(a){d=a.button};c.onmouseup=function(){d=-1};c.onmousewheel=function(a){k=a.wheelDelta};c.addEventListener("DOMMouseScroll",s,false);function s(a){k=a.detail}c.ontouchmove=function(c){c.preventDefault();if(c.touches.length>0)for(var d=0;d<c.touches.length;d++){var e=c.touches[d];x=e.pageX;y=e.pageY}if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y};c.ontouchstart=function(a){a.preventDefault();x=a.pageX;y=a.pageY;d=0};c.ontouchend=function(a){a.preventDefault();d=-1};this.check=function(){if(m>0){m++;g=a;h=b;d=0;i=0}a=e;b=f;e=g;f=h;l=d;if(d!=0)d=-1;i=k;k=0;j=o(a,b,e,f);n=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));if(a-e==0&&b-f==0)j="NaN";var c={};c.x=g;c.y=h;c.button=l;c.wheel=i;c.deg=j;c.distance=n;return c};this.check_last=function(){var a={};a.x=g;a.y=h;a.button=l;a.wheel=i;a.deg=j;a.distance=n;return a};this.input_pause=function(a){if(wait_count>30)a=30;if(wait_count<0)a=0;m=a};this.draw=function(){var c=canvas.width,d=canvas.height,g=j;context.fillStyle="black";context.fillRect(0,0,canvas.width,canvas.height);context.fillStyle="white";context.fillRect(5,5,canvas.width-10,canvas.height-10);context.fillStyle="green";context.fillText(e+" "+f+" "+c+" "+d+" "+g,32,32);var h="OOO";switch(l){case 0:h="@OO";break;case 1:h="O@O";break;case 2:h="OO@"}context.fillText("b:"+h+" w:"+i,32,232);context.beginPath();context.moveTo(c/2,d/2);context.lineTo(e-a+c/2,f-b+d/2);context.strokeStyle="black";context.stroke();context.beginPath();context.arc(c/2,d/2,5,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();r=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));context.beginPath();context.arc(c/2,d/2,r,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();var k=0,m=0;if(g!="NaN"){g=q(g-90);k=Math.cos(g)*50;m=Math.sin(g)*50}context.beginPath();context.arc(c/2+k,d/2+m,20,0,2*Math.PI,true);context.fillStyle="orange";context.fill();var n=context.getImageData(0,0,canvas.width,canvas.height)};function o(f,g,d,e){var a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=p(Math.atan(c/b));if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a}function q(a){return a*(Math.PI/180)}function p(a){return a*(180/Math.PI)}}function inputKeyboard(){var a=[];window.onblur=function(){a=[]};window.onkeydown=function(b){a[b.keyCode]=true};window.onkeyup=function(b){a[b.keyCode]=false};this.check=function(){return a};this.state=function(){st="";for(var b in a)st+="["+b+"]"+(a[b]?"*":".");return st}}function sce_item_direct_homing(){this.init=function(b,a){a.vector=0;a.vset(16);a.display_size=1};this.move=function(c,a){switch(a.frame){case 1:a.get_target(98);break;case 3:a.get_target(98);a.vector=a.target_v();case 4:if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);b=b<15?b+1:16;a.vset(b)}case 8:a.frame=2}a.frame++;return a.sc_move()}}function sce_item_near_homing(){this.init=function(b,a){a.vset(0);a.get_target(98)};this.move=function(c,a){!Boolean(this.target)&&a.get_target(98);if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);if(b<40){a.vector=a.target_v();a.vset(4)}}return a.sc_move()}}function sce_item_movingstop(){this.init=function(b,a){a.vset(1)};this.move=function(b,a){a.frame>50&&a.vset(0);a.frame++;return a.sc_move()}}function gameLayout(){var a=256,b=192;this.score_x=a-180;this.score_y=8;this.hiscore_x=a-180;this.hiscore_y=0;this.status_x=a-120;this.status_y=32;this.combo_x=0;this.combo_y=32;this.itemchain_x=0;this.itemchain_y=24;this.zanki_x=8;this.zanki_y=b-12;this.time_x=a-8*10;this.time_y=b-1-8-16;this.stage_x=a-12*10;this.stage_y=b-1-32-16;this.map_x=0;this.map_y=0;this.hp_x=168;this.hp_y=b-32}function main_r(){var l=60,i=Date.now(),d=0;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){d++;if(d>l){d=1;i=Date.now()}var b=i+Math.round(d*(1e3/l)),e=Date.now(),a=b-e;if(a<=0)a=1;setTimeout(c,a)}}();gObjectClass.prototype.sc_move=ocl_scMove;var b=new stateControl,h=document.getElementById("debug_cb");h.checked=b.Config.debug;var a=b.System.dev,e=a.graphics[1],c=a.graphics[0],u=a.graphics[3],t=a.graphics[2],k=new sceneControl(b),s=a.mouse_state,q=a.key_state,r=new Number(0),j=false,m=false,n=Date.now(),p=false,f=new bench;g();function g(){f.start();if(h.checked){b.Config.debug=true;a.vkey_state.enable=true}else{b.Config.debug=false;a.vkey_state.enable=false}if(!j){waittime=16;m=o()}if(m){j=true;var l=[],c=s.check(),i=q.check();b.Config.debug;if(c.wheel!=0)r+=c.wheel>0?1:-1;var n=c.x,t=c.y,d=false;if(c.button==0)d=true;c.button==1;b.Config.debug;k.step();if(!p){e.clear();e.draw();e.reset();k.draw()}a.gs.commit()}f.end();b.Config.debug&&f.draw(e);requestAnimationFrame(g)}function o(){var d=[];d.push("Load_check.");d.push("");var f=a.images.readyStateCheck(),i=20,g=0;for(var e in f){d.push(e+"_"+(f[e]?"Ready":"."));g+=f[e]?1:0}d.push("sndt_"+a.sound.loadCheck());d.push("");var h=Math.floor((Date.now()-n)/1e3);d.push("count :"+h+".");for(var e in d){c.print(d[e],0,i);i+=20}c.clear("black");c.draw();c.reset();if(g>=2)if(a.sound.loadCheck()=="Ready"){b.Config.use_audio=true;return true}else if(h>=10){b.Config.use_audio=false;return true}else return false;else return false}}function mapSceControl(){for(var k=1e3,o=[],j=0;j<k;j++)o[j]=new q;var d=0,c,f,e,a=-5;this.enable=true;this.counter_runnning=true;this.flame=a;this.stage=1;this.keyuse=true;var b,h,n,l,g,m,p;this.cmap=function(){return p};i(this.stage,this.keyuse);function i(a,c){b=new Stage1(a,c);h=b.scenario();n=b.bgImage(a);l=b.bgLayout();g=b.initial(a);m=b.bgPtn();p=b.colmap}this.change=function(a){this.stage=a;c=[];d=0;i(a,this.keyuse);f=h;e=g};this.bgImage=function(){return n};this.bgPtn=function(){return m};this.mapChip=function(){return l};this.init=function(){this.stage=1;c=[];i(this.stage,this.keyuse);f=h;e=g};this.reset=function(){this.enable=true;this.counter_runnning=true;a=-5;this.start(false);this.start(true)};this.counterReset=function(){a=0};this.step=function(i){if(!this.enable)return;if(this.counter_runnning)a++;a=a>7200?7200:a;for(var g=0,h=f.length;g<h;g++){var b=f[g];if(b.count<a)continue;if(b.count==a){if(b.x<0&&b.y<0){a=0;break}this.add(b.x,b.y,b.r,b.ch,b.sc)}if(b.count>a)break}for(var g=0,h=c.length;g<h;g++){var e=c[g];i.set_s(e.x,e.y,e.r,e.ch,e.sce,e.id,e.parent)}c=[];d=0;this.flame=a};this.add=function(h,i,g,f,e,b,a){if(!this.enable)return;ev=o[d];d++;if(d>=k)d=0;ev.x=h;ev.y=i;ev.r=g;ev.ch=f;ev.sce=e;if(Boolean(b))ev.id=b;if(Boolean(a))ev.parent=a;c[c.length]=ev};this.start=function(d){for(var b=0,c=e.length;b<c;b++){var a=e[b];d==a.s&&this.add(a.x,a.y,a.r,a.ch,a.sc)}};function q(){this.x;this.y;this.r;this.ch;this.sce;this.parent}}function mapScenro(){var d=[[-1,240,608,0,8,0],[-1,208,608,0,17,10],[-1,272,608,0,17,10],[-1,240,240,0,28,18],[-1,320,320,0,29,19],[50,240,0,180,11,1],[100,440,140,225,10,1],[100,40,140,135,9,1],[120,440,140,225,10,1],[120,40,140,135,9,1],[140,440,140,225,10,1],[140,40,140,135,9,1],[160,440,140,225,10,1],[160,40,140,135,9,1],[180,440,140,225,10,1],[180,40,140,135,9,1],[250,140,0,180,2,1],[250,340,0,180,3,1],[280,140,0,180,2,1],[280,340,0,180,3,1],[310,140,0,180,2,1],[310,340,0,180,3,1],[340,140,0,180,2,1],[340,340,0,180,3,1],[390,464,200,0,"effect_warnning_mark",1],[440,479,200,270,15,1],[450,16,220,0,"effect_warnning_mark",1],[500,1,220,90,15,1],[700,240,0,180,23,14],[900,120,0,180,19,1],[900,360,0,180,19,1],[1120,480,0,180,37,2],[1500,240,40,180,34,14],[1600,480,0,180,53,2],[1700,480,0,180,54,2],[1800,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1]*.875;a.y=b[2]*.75;a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function mapBgImage(){var a=new Image;a.src="pict/sky.jpg";return a}function mapBgLayout(){var d=[[0,0,0],[0,0,480],[0,0,960]],c=[];for(var e in d){var b=d[e],a={};a.no=b[0];a.x=b[1];a.y=b[2];c.push(a)}return c}function mapInitial(){}function sce_message_billboard(b,a){this.init=function(d,c){c.vset(0);c.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;c.p_count=0;c.mes_col=0;c.mes_line=0;c.p_wait=a;c.p_endflag=false;c.p_st=b;c.x=c.gt.world_x+1;c.y=c.gt.world_y+1};this.move=function(b,a){a.x=a.gt.world_x+1;a.y=a.gt.world_y+1;a.p_count--;if(a.p_count<=0){if(a.p_endflag)a.status=0;a.mes_col++;if(a.mes_col>a.p_st[a.mes_line].length){a.mes_col=0;a.mes_line++;if(a.mes_line>a.p_st.length-1){a.mes_line=a.p_st.length-1;a.mes_col=a.p_st[a.mes_line].length;a.p_endflag=true}}a.p_count=a.p_wait+(a.p_endflag?40:0)}return a.sc_move()};this.draw=function(c,b){for(var a=0;a<=b.mes_line;a++)if(a<b.mes_line)c.putchr(b.p_st[a],95,150+16*a);else{var d=b.p_st[a].slice(0,b.mes_col+1);c.putchr(d,95,150+16*a)}}}function sce_message_small(a){this.init=function(b,a){a.vset(1);a.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;a.w_st=a.id;a.x-=a.w_st.length*8/2;a.display_size=1};this.move=function(b,a){if(a.frame>50)a.status=0;a.frame++;return a.sc_move()};this.draw=function(d,b){var c=b.gt.worldtoView(b.x,b.y);d.putchr8c(b.w_st,c.x,c.y,a,b.display_size)}}function sce_message_normal(a){this.init=function(c,b){b.vset(0);b.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;b.w_st=b.id;b.x-=b.w_st.length*12/2;b.wait=a;b.display_size=1};this.move=function(c,b){if(b.frame>a)b.status=0;b.display_size=1+b.frame/60;b.frame++;return b.sc_move()};this.draw=function(c,a){var b=a.gt.worldtoView(a.x,a.y);c.putchr(a.w_st,b.x,b.y,a.display_size)}}function sce_message_bosstriger(){this.init=function(b,a){a.vset(0);a.type=5;this.normal_draw_enable=false;a.x=a.gt.world_x+1;a.y=a.gt.world_y+1};this.move=function(b,a){a.x=a.gt.world_x+1;a.y=a.gt.world_y+1;a.SIGNAL(6055);a.status=0;return a.sc_move()}}function motionPattern(){var b=[],a=0;b[a]={};b[a].wait=0;b[a].pattern=[["Dummy",0,0]];a=1;b[a]={};b[a].wait=18;b[a].pattern=[["Nyaru4",2,0],["Nyaru5",2,0]];a=2;b[a]={};b[a].wait=18;b[a].pattern=[["Nyaru1",2,0],["Nyaru2",2,0],["Nyaru1",2,0],["Nyaru3",2,0]];a=3;b[a]={};b[a].wait=18;b[a].pattern=[["Yaki_1",0,0],["Yaki_2",0,0]];a=4;b[a]={};b[a].wait=18;b[a].pattern=[["Sira_1",0,0],["Sira_2",0,0]];a=5;b[a]={};b[a].wait=18;b[a].pattern=[["Tuki_1",0,0],["Tuki_2",0,0]];a=6;b[a]={};b[a].wait=18;b[a].pattern=[["Goul_1",0,0],["Goul_2",0,0]];a=7;b[a]={};b[a].wait=18;b[a].pattern=[["Spide1",0,0],["Spide2",0,0]];a=8;b[a]={};b[a].wait=18;b[a].pattern=[["Gagu_1",0,0],["Gagu_2",0,0]];a=9;b[a]={};b[a].wait=18;b[a].pattern=[["Tori_1",0,0],["Tori_2",0,0]];a=10;b[a]={};b[a].wait=18;b[a].pattern=[["Shogs1",0,0],["Shogs2",0,0]];a=99;b[a]={};b[a].wait=18;b[a].pattern=[["Fire1",0,0],["Fire2",0,0]];a=12;b[a]={};b[a].wait=10;b[a].pattern=[["Baal_8",0,0],["Baal_7",0,0],["Baal_6",0,0],["Baal_5",0,0],["Baal_4",0,0],["Baal_3",0,0],["Baal_2",0,0],["Baal_1",0,0]];a=11;b[a]={};b[a].wait=15;b[a].pattern=[["Zap1",0,0],["Zap2",0,0],["Zap3",0,0],["Zap4",0,0]];a=26;b[a]={};b[a].pattern=[["Fork",-1,-1]];a=27;b[a]={};b[a].pattern=[["Key",0,0]];a=28;b[a]={};b[a].wait=10;b[a].pattern=[["BallB1",0,0],["BallB2",0,0],["BallB3",0,0],["BallB2",0,0]];a=29;b[a]={};b[a].wait=10;b[a].pattern=[["BallS1",0,0],["BallS2",0,0],["BallS3",0,0],["BallS2",0,0]];a=30;b[a]={};b[a].wait=10;b[a].pattern=[["BallL1",0,0],["BallL2",0,0],["BallL3",0,0],["BallL2",0,0]];a=31;b[a]={};b[a].pattern=[["Unyuu3",0,0]];a=32;b[a]={};b[a].wait=5;b[a].pattern=[["Coin1",0,0],["Coin2",0,0],["Coin3",0,0],["Coin4",0,0],["Coin3",2,0],["Coin2",2,0],["Coin1",2,0]];a=15;b[a]={};b[a].pattern=[["Knife",-1,-1]];a=33;b[a]={};b[a].pattern=[["Lamp",0,0]];a=34;b[a]={};b[a].pattern=[["Map",0,0]];a=35;b[a]={};b[a].pattern=[["Spear",-1,-1]];a=36;b[a]={};b[a].pattern=[["Boom",-1,-1]];a=37;b[a]={};b[a].pattern=[["Axe",-1,-1]];a=38;b[a]={};b[a].pattern=[["Wand",-1,-1]];a=39;b[a]={};b[a].pattern=[["TrBox",0,0]];return b}function ocl_scMove(){var a=0;if(this.status==2)switch(this.type){case 1:case 3:this.sound.effect(12);this.change_sce("effect_hit");break;case 2:this.display_size*=2;this.change_sce(7);this.sound.effect(8);if(this.chr==14)this.set_object_ex(22,this.x,this.y,Math.floor(Math.random()*360),36);else for(var b=0,c=Math.floor(Math.random()*3)+1;b<c;b++)this.set_object_ex(35,this.x,this.y,Math.floor(Math.random()*360),"item_movingstop");for(var d=false,b=0,c=this.pick.length;b<c;b++){var e=this.pick[b];this.set_object_ex(e,this.x,this.y,Math.floor(Math.random()*360),"item_movingstop");if(e!=35)d=true}d&&this.set_object_ex(40,this.x,this.y,0,"enemy_trbox");this.add_score(this.score);break;case 4:if(Boolean(this.crash))if(this.crash.pick_enable){this.change_sce(6);if(this.crash.type==2)this.crash.pick.push(this.chr);else{this.chr!=21&&this.chr!=22&&this.sound.effect(11);this.get_item(this.chr)}}}if(this.damageflag){this.damage.count=15;var f=this.gt.in_view_range(this.x-this.hit_x/2,this.y-this.hit_y/2,this.hit_x,this.hit_y);f&&this.sound.effect(12)}var g=this.vector,h=this.vx,i=this.vy;if(this.damage.count>0){this.damage.count--;this.vector=(this.damage.vector+180)%360;this.vset(this.damage.dist/10)}if(this.status==0)a=1;if(this.mapCollision!=true){this.colcount=0;this.old_x=this.x;this.old_y=this.y;this.x+=this.vx;this.y+=this.vy;this.vector=g;this.vx=h;this.vy=i}else{if(this.colcount==0){this.x=this.old_x;this.y=this.old_y;switch(this.type){case 1:case 3:a=1;break;default:if(this.mapColX){this.vx*=-1;this.vector=360-this.vector;if(this.vector<0)this.vector=180+(180+this.vector)}if(this.mapColY){this.vy*=-1;this.vector=180+this.vector;if(this.vector>360)this.vector=360+180-this.vector;this.vector=this.vector%360}if(!this.mapColX&&!this.mapColY){this.vx*=-1;this.vy*=-1;this.vector=(this.vector+180)%360}}}this.colcount++;if(this.colcount>30){this.vector=this.target_r(this.startx,this.starty);this.vset(1);this.x+=this.vx;this.y+=this.vy}}if(this.x<0||this.x>this.gt.ww)a=2;if(this.y<0||this.y>this.gt.wh)a=2;if(a!=0){a==2&&this.reset_combo(this.type);return-1}if(this.colcount>60)if(Boolean(this.crash))this.crash.mapCollision=false;else this.colcount=Math.floor(Math.random()*60);this.damageflag=false;return 0}function sce_player(){this.init=function(b,a){a.triger=10;a.w_powup=-1;a.int_shot=0;a.custom_draw_enable=true;a.move_target_x=a.x;a.move_target_y=a.y};this.draw=a;this.move=function(b,a){a.frame++;if(a.frame<=90){a.hp=10;a.damageflag=false}if(a.mouse_state.distance>0){a.move_target_x+=Math.cos(Math.PI/180*(a.mouse_state.deg-90))*a.mouse_state.distance*1;a.move_target_y+=Math.sin(Math.PI/180*(a.mouse_state.deg-90))*a.mouse_state.distance*1;if(a.move_target_x<0)a.move_target_x=0;if(a.move_target_y<0)a.move_target_y=0;if(a.move_target_x>b.cw)a.move_target_x=b.cw;if(a.move_target_y>b.ch)a.move_target_y=b.ch}if(a.mouse_state.x>=0&&a.mouse_state.x<=b.cw&&a.mouse_state.y>=0&&a.mouse_state.y<=b.ch){a.move_target_x=a.mouse_state.x;a.move_target_y=a.mouse_state.y}a.vector=a.target_r(a.move_target_x,a.move_target_y);a.vset(8);var f=a.vector;a.mp=2;a.triger--;if(a.triger<=0){a.shot=0;a.triger=5;a.mouse_state.x<b.cw*.25&&a.collect()}var c=0;for(var e in a.item)if(e==7)c=a.item[e];if(eval(a.mouse_state.button)==0)if(a.shot==0){a.shot=1;a.vector=a.target_r(a.mouse_state.x*(256/640),a.mouse_state.y*(192/480));(c<=1||c>=4)&&a.set_object(6);a.triger=15}if(eval(a.mouse_state.button)==1)if(c>=1){a.bomb3();a.set_object_ex(6,a.x,a.y,0,47)}if(a.target_d(a.move_target_x,a.move_target_y)<=8){a.vx=0;a.vy=0;a.mp=1}a.damageflag&&a.set_object_ex(20,a.x,a.y,0,42,"Damege!");a.damageflag=false;a.x+=a.vx;a.x=24;a.y+=a.vy;var d=0;if(a.status==2){a.display_size=2.5;a.change_sce(7)}if(a.status==0)d=1;return d};function a(c,a){var b={};b.x=a.mouse_state.x*(256/640);b.y=a.mouse_state.y*(192/480);b.sr=(360*((a.maxhp-a.hp)/a.maxhp)-90)*(Math.PI/180);b.df=a.damageflag;b.r=a.frame<90?105-a.frame:15;b.draw=function(a){a.beginPath();a.strokeStyle="gray";a.lineWidth="2";a.arc(this.x,this.y,this.r,0,2*Math.PI,false);a.stroke();a.beginPath();a.lineWidth=this.df?"10":"3";a.strokeStyle=this.df?"red":"white";a.arc(this.x,this.y,this.r,this.sr,1.5*Math.PI,false);a.stroke();a.lineWidth="1"};c.putFunc(b)}}function sce_player_start(){this.init=function(b,a){a.type=98;a.vector=0;a.vset(8)};this.move=function(b,a){a.hp=10;switch(a.frame){case 30:a.vector=180;a.vset(4);break;case 58:case 60:a.vset(3);a.hp=10;a.change_sce(1)}a.frame++;return a.sc_move()}}function sce_pl_bullet_homing(){this.init=function(b,a){a.vector=a.vector>180?a.vector+80:a.vector-80;a.vset(16);a.get_target(2)};this.move=function(b,a){switch(a.frame){case 2:a.get_target(2);a.target_rotate_r(15);a.vset(16);break;case 5:a.frame=1}a.frame++;return a.sc_move()};this.draw=function(c,b){if(!Boolean(b.target))return;var a={};a.sx=b.x;a.sy=b.y;a.ex=b.target.x;a.ey=b.target.y;a.draw=function(a){a.beginPath();a.moveTo(this.sx,this.sy);a.lineTo(this.ex,this.ey);a.strokeStyle="red";a.stroke()};c.putFunc(a)}}function sce_pl_bullet_homing2(){this.init=function(b,a){a.vector=a.vector>180?a.vector-5:a.vector+5;a.vset(4);a.get_target(2);a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 2:a.frame>90&&a.get_target(2);a.target_rotate_r(15+(a.frame<20?15:0));a.vset(4+(a.frame>20?4:0)+(a.frame>25?8:0));break;case 4:a.w_cnt=1}a.w_cnt++;a.frame++;return a.sc_move()}}function sce_pl_bullet_subshot(a){this.init=function(c,b){b.vset(a);b.mp=7;b.alpha=128};this.move=function(b,a){if(a.frame>12)a.status=0;a.frame++;return a.sc_move()}}function sce_pl_bullet_laser_head(){this.init=function(b,a){a.vector=0;a.y=a.y-20;a.vset(28);a.get_target(2);a.alpha=64;a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 2:a.get_target(2);a.target_rotate_r(3);a.vset(28);break;case 4:a.w_cnt=1}a.set_object_ex(23,a.x,a.y,a.vector,46);a.w_cnt++;a.frame++;return a.sc_move()}}function sce_pl_bullet_laser_tail(){this.init=function(b,a){a.vset(0)};this.move=function(b,a){if(a.frame>10)a.status=0;a.frame++;return a.sc_move()}}function scenario(){for(var d={},a=[],c=[],b=[],e=0;e<=37;e++){a[e]=function(b,a){a.vset(5)};b[e]=function(b,a){return a.sc_move()}}w=new sce_player;a[1]=w.init;b[1]=w.move;c[1]=w.draw;a.player=w.init;b.player=w.move;c.player=w.draw;w=new sce_ememy_move_n(90,-90);a[2]=w.init;b[2]=w.move;a.ememy_move_n_r=w.init;b.ememy_move_n_r=w.move;w=new sce_ememy_move_n(90,-90);a[3]=w.init;b[3]=w.move;a.ememy_move_n_l=w.init;b.ememy_move_n_l=w.move;w=new sce_common_vset(4);a[4]=w.init;b[4]=w.move;a.common_vset4=w.init;b.common_vset4=w.move;w=new sce_effect_vanish;a[6]=w.init;b[6]=w.move;a.effect_vanish=w.init;b.effect_vanish=w.move;w=new sce_effect_bomb;a[7]=w.init;b[7]=w.move;a.effect_bomb=w.init;b.effect_bomb=w.move;w=new sce_player_start;a[8]=w.init;b[8]=w.move;a.player_start=w.init;b.player_start=w.move;w=new sce_ememy_turn(-30);a[9]=w.init;b[9]=w.move;a.ememy_turn_r=w.init;b.ememy_turn_r=w.move;w=new sce_ememy_turn(30);a[10]=w.init;b[10]=w.move;a.ememy_turn_l=w.init;b.ememy_turn_l=w.move;w=new sce_ememy_change_s;a[11]=w.init;b[11]=w.move;a.ememy_change_s=w.init;b.ememy_change_s=w.move;w=new sce_common_vset(6);a[12]=w.init;b[12]=w.move;a.common_vset6=w.init;b.common_vset6=w.move;w=new sce_common_vset(16);a[13]=w.init;b[13]=w.move;a.common_vset16=w.init;b.common_vset16=w.move;w=new sce_en_bullet_homing;a[14]=w.init;b[14]=w.move;a.en_bullet_homing=w.init;b.en_bullet_homing=w.move;w=new sce_ememy_moveshot;a[15]=w.init;b[15]=w.move;a.ememy_moveshot_1=w.init;b.ememy_moveshot_1=w.move;w=new sce_friend_rotate;a[16]=w.init;b[16]=w.move;a.friend_rotate=w.init;b.friend_rotate=w.move;w=new sce_friend_start;a[17]=w.init;b[17]=w.move;a.friend_start=w.init;b.friend_start=w.move;w=new sce_en_bullet_random;a[18]=w.init;b[18]=w.move;a.en_bullet_random=w.init;b.en_bullet_random=w.move;w=new sce_ememy_randomshot;a[19]=w.init;b[19]=w.move;a.sce_ememy_randomshot=w.init;b.sce_ememy_randomshot=w.move;w=new sce_pl_bullet_homing2;a[20]=w.init;b[20]=w.move;a.pl_bullet_homing=w.init;b.pl_bullet_homing=w.move;w=new sce_friend_sidearm;a[21]=w.init;b[21]=w.move;a.friend_sidearm=w.init;b.friend_sidearm=w.move;w=new sce_common_vset(0);a[22]=w.init;b[22]=w.move;a.common_vset0=w.init;b.common_vset0=w.move;w=new sce_boss_0;a[23]=w.init;b[23]=w.move;c[23]=w.draw;a.boss_0=w.init;b.boss_0=w.move;c.boss_0=w.draw;w=new sce_common_vset(2);a[24]=w.init;b[24]=w.move;a.common_vset2=w.init;b.common_vset2=w.move;w=new sce_common_vset(8);a[25]=w.init;b[25]=w.move;a.common_vset8=w.init;b.common_vset8=w.move;w=new sce_common_vset(10);a[26]=w.init;b[26]=w.move;a.common_vset10=w.init;b.common_vset10=w.move;w=new sce_effect_billboard(0);a[28]=w.init;b[28]=w.move;a.effect_billboard_v=w.init;b.effect_billboard_v=w.move;w=new sce_effect_billboard(90);a[29]=w.init;b[29]=w.move;a.effect_billboard_h=w.init;b.effect_billboard_h=w.move;w=new sce_item_direct_homing;a[30]=w.init;b[30]=w.move;a.item_direct_homing=w.init;b.item_direct_homing=w.move;w=new sce_en_bullet_accel;a[33]=w.init;b[33]=w.move;a.en_bullet_accel=w.init;b.en_bullet_accel=w.move;w=new sce_boss_1;a[34]=w.init;b[34]=w.move;c[34]=w.draw;a.boss_1=w.init;b.boss_1=w.move;c.boss_1=w.draw;w=new sce_item_near_homing;a[36]=w.init;b[36]=w.move;a.item_near_homing=w.init;b.item_near_homing=w.move;w=new sce_message_billboard(["Event Message Test","= WARNING MESSAGE =","!! Message Test !!!","!!! Message Test !!","= WARNING MESSAGE ="],3);a[37]=w.init;b[37]=w.move;c[37]=w.draw;a.message_billboard_wm=w.init;b.message_billboard_wm=w.move;c.message_billboard_wm=w.draw;w=new sce_item_movingstop;a[38]=w.init;b[38]=w.move;a.item_movingstop=w.init;b.item_movingstop=w.move;w=new sce_message_small(0);a[39]=w.init;b[39]=w.move;c[39]=w.draw;a.message_small_w=w.init;b.message_small_w=w.move;c.message_small_w=w.draw;w=new sce_message_small(1);a[42]=w.init;b[42]=w.move;c[42]=w.draw;a.message_small_r=w.init;b.message_small_r=w.move;c.message_small_r=w.draw;w=new sce_message_small(2);a[43]=w.init;b[43]=w.move;c[43]=w.draw;a.message_small_g=w.init;b.message_small_g=w.move;c.message_small_g=w.draw;w=new sce_message_small(3);a[44]=w.init;b[44]=w.move;c[44]=w.draw;a.message_small_b=w.init;b.message_small_b=w.move;c.message_small_b=w.draw;w=new sce_pl_bullet_subshot(8);a[40]=w.init;b[40]=w.move;a.pl_bullet_subshot_pl=w.init;b.pl_bullet_subshot_pl=w.move;w=new sce_pl_bullet_subshot(1);a[41]=w.init;b[41]=w.move;a.pl_bullet_subshot_op=w.init;b.pl_bullet_subshot_op=w.move;w=new sce_pl_bullet_laser_head;a[45]=w.init;b[45]=w.move;a.pl_bullet_laser_head=w.init;b.pl_bullet_laser_head=w.move;w=new sce_pl_bullet_laser_tail;a[46]=w.init;b[46]=w.move;a.pl_bullet_laser_tail=w.init;b.pl_bullet_laser_tail=w.move;w=new sce_effect_bombcircle("rgba(255, 64, 64, 0.7)");a[47]=w.init;b[47]=w.move;c[47]=w.draw;a.effect_bombcircle_r=w.init;b.effect_bombcircle_r=w.move;c.effect_bombcircle_r=w.draw;w=new sce_effect_bombcircle("rgba(255, 255, 255, 0.7)");a[48]=w.init;b[48]=w.move;c[48]=w.draw;a.effect_bombcircle_w=w.init;b.effect_bombcircle_w=w.move;c.effect_bombcircle_w=w.draw;w=new sce_en_bullet_hominglaser;a[49]=w.init;b[49]=w.move;a.en_bullet_hominglaser=w.init;b.en_bullet_hominglaser=w.move;w=new sce_boss_2;a[50]=w.init;b[50]=w.move;c[50]=w.draw;a.boss_2=w.init;b.boss_2=w.move;c.boss_2=w.draw;w=new sce_en_bullet_infolaser;a[51]=w.init;b[51]=w.move;c[51]=w.draw;a.en_bullet_infolaser=w.init;b.en_bullet_infolaser=w.move;c.en_bullet_infolaser=w.draw;w=new sce_en_bullet_turn;a[52]=w.init;b[52]=w.move;a.en_bullet_turn=w.init;b.en_bullet_turn=w.move;w=new sce_message_billboard(["Event Message Test","= Mission Complate.\u3000="],0);a[53]=w.init;b[53]=w.move;c[53]=w.draw;a.message_billboard_cp=w.init;b.message_billboard_cp=w.move;c.message_billboard_cp=w.draw;w=new sce_common_signal(835);a[54]=w.init;b[54]=w.move;a.common_signal_result=w.init;b.common_signal_result=w.move;w=new sce_effect_warnning_mark;a[55]=w.init;b[55]=w.move;a.effect_warnning_mark=w.init;b.effect_warnning_mark=w.move;w=new sce_en_bullet_laser_tail;a[56]=w.init;b[56]=w.move;a.en_bullet_laser_tail=w.init;b.en_bullet_laser_tail=w.move;w=new sce_message_normal(60);a[57]=w.init;b[57]=w.move;c[57]=w.draw;a.message_normal_60=w.init;b.message_normal_60=w.move;c.message_normal_60=w.draw;w=new sce_message_bosstriger;a[58]=w.init;b[58]=w.move;a.message_bosstriger=w.init;b.message_bosstriger=w.move;w=new sce_effect_hit;a.effect_hit=w.init;b.effect_hit=w.move;w=new sce_ememy_move_std;a.ememy_move_std=w.init;b.ememy_move_std=w.move;w=new sce_ememy_move_std2;a.ememy_move_std2=w.init;b.ememy_move_std2=w.move;w=new sce_ememy_generator;a.ememy_generator=w.init;b.ememy_generator=w.move;w=new sce_enemy_trbox;a.enemy_trbox=w.init;b.enemy_trbox=w.move;w=new sce_ememy_timeover;a.ememy_timeover=w.init;b.ememy_timeover=w.move;w=new sce_friend_straight;a.friend_straight=w.init;b.friend_straight=w.move;w=new sce_friend_boom;a.friend_boom=w.init;b.friend_boom=w.move;w=new sce_friend_rotate_full;a.friend_rotate_full=w.init;b.friend_rotate_full=w.move;w=new sce_exev_3way;a[100]=w.init;b[100]=w.move;a.exev_3way=w.init;b.exev_3way=w.move;w=new sce_exev_5way_nallow;a[102]=w.init;b[102]=w.move;a.exev_5way_nallow=w.init;b.exev_5way_nallow=w.move;w=new sce_exev_5way_normal;a[103]=w.init;b[103]=w.move;a.exev_5way_normal=w.init;b.exev_5way_normal=w.move;w=new sce_exev_5expansion;a[104]=w.init;b[104]=w.move;a.exev_5expansion=w.init;b.exev_5expansion=w.move;w=new sce_exev_3way_exp;a[104]=w.init;b[104]=w.move;a.exev_3way_exp=w.init;b.exev_3way_exp=w.move;d.init=a;d.draw=c;d.move=b;return d}function sceneConfig(c){var i=c.System.dev,p=i.graphics[1],s=i.graphics[0],d=i.graphics[3],K=i.mouse_state,J=i.key_state;this.init=D;this.reset=B;this.step=E;this.draw=C;var g,k=0;this.score=0;this.config=c.Config;var e=[],b=[],x=[],q,v=false,u=false,f=0,I,H,r;function n(){this.title="button";this.x=0;this.y=0;this.w=100;this.h=16;this.select=false;this.click=false;this.setup=function(b,d,e,c,a){this.title=b;this.x=d;this.y=e;this.w=c;this.h=a;this.select=false;this.click=false;this.lamp=false};this.status_reset=function(){this.select=false;this.click=false};this.func=function(){return 0}}function F(){var c,b=[];this.button=b;var e,f,h;this.setup=function(i,p,g,j,k,l,o){c=i;e=g;f=l;h=o;m=new n;m.setup(p,j,k,120,16);m.msg=g;a.push(m);b.push(m);for(var d=0;d<2;d++){m=new n;m.setup(d==0?"  On":"  Off",j+160+80*d,k,80,16);m.msg=g+(d==0?"\u6709\u52b9":"\u7121\u52b9");m.sw=d==0?true:false;m.num=i;a.push(m);b.push(m)}};this.set=function(a){c=a};this.result=function(){if(b[0].select||b[1].select||b[2].select){if(b[1].click){c=true;g=true;b[1].click=false}if(b[2].click){c=false;g=true;b[2].click=false}d.clear();d.reset();d.print(e,f,h,"white");d.draw()}if(c){b[1].lamp=true;b[2].lamp=false}else{b[1].lamp=false;b[2].lamp=true}return c}}function t(){var c,b=[];this.button=b;var f,h,i,e;this.setup=function(j,k,g,l,o,p,q){c=j;e=k;f=g;h=p;i=q;m=new n;m.setup(k,l,o,120,16);m.msg=g;a.push(m);b.push(m);for(var d=0;d<2;d++){m=new n;m.setup(d==0?"  +1":"  -1",l+160+80*d,o,80,16);m.msg=g;m.sw=d==0?1:-1;m.num=j;a.push(m);b.push(m)}};this.set=function(a){c=a;b[0].title=e+c};this.result=function(){var a=c;if(b[0].select||b[1].select||b[2].select){if(b[1].click){c+=b[1].sw;b[1].click=false;g=true;b[1].lamp=true;b[2].lamp=false}if(b[2].click){c+=b[2].sw;b[2].click=false;g=true;b[1].lamp=false;b[2].lamp=true}if(c<0)c=0;b[0].title=e+c;d.clear();d.reset();d.print(f+c,h,i,"white");d.draw()}return c}}var a=[],l=["LampUse.","MapUse.","ItemReset.","ShotFree.","SoundTest.","StartFloor."],y=["\u9762\u306e\u958b\u59cb\u304b\u3089\u30e9\u30f3\u30d7\u3092\u6240\u6301\u3059\u308b:  ","\u9762\u306e\u958b\u59cb\u304b\u3089\u5730\u56f3\u3092\u6240\u6301\u3059\u308b: ","\u6b7b\u3093\u3060\u3068\u304d\u306b\u30a2\u30a4\u30c6\u30e0\u653e\u51fa\u3059\u308b: ","\u5f3e\u3092\u6d88\u8cbb\u3057\u306a\u3044\u3002:","\u30b5\u30a6\u30f3\u30c9\u30c6\u30b9\u30c8 : ","\u958b\u59cb\u30d5\u30ed\u30a2 : "],o=[0,0,0,0,1,1];b[5]=1;for(var j=[],z=60,A=180,h=0;h<l.length;h++){if(o[h]==0){var w=new F;w.setup(h,l[h],y[h],z,A+h*20,100,320)}else{var w=new t;w.setup(h,l[h],y[h],z,A+h*20,100,320)}j.push(w)}m=new n;m.setup("Save.",100,360,120,16);m.msg="Save.";m.func=function(){v=true;g=true;return 0};a.push(m);m=new n;m.setup("Reset.",100,380,120,16);m.msg="Reset.";m.func=function(){u=true;g=true;return 0};a.push(m);m=new n;m.setup("Exit.",100,400,120,16);m.msg="Exit.";m.jp=2;m.func=function(){d.clear();d.reset();return this.jp};a.push(m);var G,L=new Number(0);function D(){c.Config.reset();c.Config.load();e[0]=c.Config.lamp_use;e[1]=c.Config.map_use;e[2]=c.Config.itemreset;e[3]=c.Config.shotfree;e[4]=false;e[5]=false;b[4]=0;b[5]=c.Config.startstage}function B(){for(var c in a){a[c].sel=false;a[c].lamp=false}I=false;H=0;G=0;s.clear("darkblue");cl={};cl.w=p.cw;cl.h=p.ch;cl.draw=function(a){var c=this.h;if(c<this.w)c=this.w;a.beginPath();for(var b=0;b<c;b+=16){a.moveTo(b,0);a.lineTo(b,this.h);a.moveTo(0,b);a.lineTo(this.w,b)}a.strokeStyle="lightgray";a.lineWidth="1";a.stroke()};s.putFunc(cl);s.draw();s.reset();for(c in b)if(Boolean(b[c]))x[c]=b[c];for(var c=0;c<o.length;c++)if(o[c]==0)j[c].set(e[c]);else{var d=new t;j[c].set(b[c])}g=true;f=0;g=10}function E(){q=[];var y=K.check_last(),m=J.check(),C=y.x,D=y.y,w=false,p=false,s=false;if(!g){if(Boolean(m[37]))if(m[37]){p=true;k=10}if(Boolean(m[39]))if(m[39]){s=true;k=10}if(Boolean(m[38]))if(m[38]){f--;if(f<l.length*3){f--;f--}if(f<0)f=a.length-1;g=true;k=10}if(m[40])if(m[40]){f++;if(f<l.length*3){f++;f++}if(f>a.length-1)f=0;g=true;k=10}var w=false;if(Boolean(m[90]))if(m[90])w=true;if(Boolean(m[32]))if(m[32])w=true;g&&i.sound.effect(9)}if((w||(p||s))&&!g)for(var h in a){a[h].click=false;if(a[h].select){a[h].click=true;var n=a[h].func();if(n!=0)return n}}else for(h in b)if(Boolean(b[h]))x[h]=b[h];if(k>0)k--;if(!w&&k==0)g=false;var A=-1,z=f;if(f<l.length*3)z=Math.floor(f/3)*3;for(h in a)if(h==z){a[h].select=true;A=h}else a[h].select=false;if((p||s)&&!g)if(f<l.length*3){var n=f;if(p)n=n+1;if(s)n=n+2;a[n].select=true}q.push("== Configration ==");q.push("-----------------%");for(h in j){e[h]=j[h].result();if(o[h]==1)b[h]=e[h]}c.Config.lamp_use=e[0];c.Config.map_use=e[1];c.Config.itemreset=e[2];c.Config.shotfree=e[3];if(!Boolean(r))r=b[4];if(r!=b[4]){if(b[4]>=0&&b[4]<14){i.sound.change(Math.floor(b[4]));i.sound.play(0)}r=b[4]}c.Config.startstage=b[5];if(u){c.Config.reset();e[0]=c.Config.lamp_use;e[1]=c.Config.map_use;e[2]=c.Config.itemreset;e[3]=c.Config.shotfree;e[4]=false;e[5]=false;b[4]=0;b[5]=c.Config.startstage;d.clear();d.reset();d.print("\u8a2d\u5b9a\u521d\u671f\u5316\u3057\u307e\u3057\u305f\u3002",100,320,"white");if(Boolean(localStorage)){localStorage.clear();d.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u30af\u30ea\u30a2\u3002",100,340,"white")}else d.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,340,"white");d.draw();for(var h=0;h<o.length;h++)if(o[h]==0)j[h].set(e[h]);else{var B=new t;j[h].set(b[h])}u=false}if(v){d.clear();d.reset();if(c.Config.save()==0)d.print("\u8a2d\u5b9a\u3092\u30bb\u30fc\u30d6\u3057\u307e\u3057\u305f\u3002",100,320,"white");else d.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,320,"white");d.draw();v=false}return 0}function n(){this.title="button";this.x=0;this.y=0;this.w=100;this.h=16;this.select=false;this.click=false;this.setup=function(b,d,e,c,a){this.title=b;this.x=d;this.y=e;this.w=c;this.h=a;this.select=false;this.lamp=false;this.click=false};this.status_reset=function(){this.select=false;this.click=false};this.func=function(){return 0}}function C(){for(var d in q)p.putchr(q[d],0,100+16*d);for(var b in a){if(a[b].lamp){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};p.putFunc(c)}if(a[b].select)p.putchr(a[b].title,a[b].x-4,a[b].y-1);else p.putchr(a[b].title,a[b].x,a[b].y)}}}function sceneControl(c){var a=[];a[1]=new gameScene(c);a[2]=new sceneTitle(c);a[3]=new sceneGover(c);a[4]=new sceneConfig(c);a[5]=new sceneResult(c);for(var e in a)a[e].init();var f=a[2],b=2,d=b;this.step=function(){if(b!=0){var c=false;if(b>=10){b=b%10;c=true}d=b;a[d].reset(c)}b=a[d].step()};this.draw=function(){a[d].draw()}}function sceneGover(k){var h=k.System.dev,i=h.graphics[1],b=h.graphics[0],s=h.mouse_state,r=h.key_state;this.init=p;this.reset=n;this.step=q;this.draw=o;var c,e=0,g,l,f,j,d,a=[];m={};m.title="End.";m.x=320-50;m.y=200;m.w=120;m.h=16;m.sel=false;m.func=function(){return 2};a.push(m);function p(){}function n(){for(var h in a)a[h].sel=false;l=false;f=2;j=0;var g={};g.cw=b.cw;g.ch=b.ch;g.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="black";a.stroke()}};b.putFunc(g);b.draw();b.reset();k.Game.cold=true;c=true;e=90;d=0}function q(){g=[];var o=s.check_last(),i=r.check(),n=false;if(!c){if(Boolean(i[38]))if(i[38]){d--;if(d<0)d=a.length-1;c=true;e=10}if(i[40])if(i[40]){d++;if(d>a.length-1)d=0;c=true;e=10}var n=false;if(Boolean(i[90]))if(i[90])n=true;if(Boolean(i[32]))if(i[32])n=true;if(o.button!=-1)if(e==0&&!c)n=true;c&&h.sound.effect(9)}if(n&&!c)for(var k in a)if(a[k].sel){var p=a[k].func();if(p!=0)return p}if(e>0)e--;if(o.button==-1)c=false;if(!n&&e==0)c=false;if(l){var m={};m.cw=b.cw;m.ch=b.ch;m.y1=b.ch/2-f;m.y2=b.ch/2+f;m.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(m);b.draw();b.reset();f+=8;if(b.ch/2-f<0)return j}for(k in a)if(k==d)a[k].sel=true;else a[k].sel=false;g.push("== Game Over ==");g.push("---------------");return 0}function o(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};i.putFunc(c)}i.putchr(a[b].title,a[b].x,a[b].y)}for(var d in g)i.putchr(g[d],0,64+16*d)}}function sceneResult(k){var d=k.System.dev,h=d.graphics[1],b=d.graphics[0],r=d.graphics[3],s=d.mouse_state,q=d.key_state;this.init=o;this.reset=m;this.step=p;this.draw=n;var g,f,l,e,i,j=0,a=[],c={};c.title="[   ok.  ]";c.x=320-80;c.y=320;c.w=120;c.h=16;c.sel=false;c.func=function(){r.clear();return 11};a.push(c);function o(){}function m(){for(var d in a)a[d].sel=false;l=false;e=2;i=0;var c={};c.cw=b.cw;c.ch=b.ch;c.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="darkblue";a.stroke()}};b.putFunc(c);b.draw();b.reset();g=true;j=0}function p(){f=[];var m=q.check(),n=false;if(Boolean(m[90]))if(m[90])n=true;j++;if(!d.sound.running())for(var h in a)if(a[h].sel){var o=a[h].func();if(o!=0)return o}if(!n)g=false;if(l){var c={};c.cw=b.cw;c.ch=b.ch;c.y1=b.ch/2-e;c.y2=b.ch/2+e;c.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(c);b.draw();b.reset();e+=8;if(b.ch/2-e<0)return i}for(h in a)if(!g)a[h].sel=true;var p=k.Game.nowstage;f.push(" == Floor -"+p+"- Clear ==");return 0}function n(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};h.putFunc(c)}h.putchr(a[b].title,a[b].x,a[b].y)}for(var d in f)h.putchr(f[d],320-150,160+16*d)}}function sceneTitle(k){var e=k.System.dev,j=e.graphics[1],b=e.graphics[0],o=e.graphics[2],x=e.mouse_state,u=e.key_state;this.init=r;this.reset=p;this.step=s;this.draw=q;for(var d,f=0,g,l,h,c=0,a=[],n=["GameStart."],v=[1],i=0;i<n.length;i++){m={};m.title=n[i];m.x=320-50;m.y=320+i*20+32;m.w=120;m.h=16;m.jp=v[i];m.sel=false;m.func=function(){return this.jp};a.push(m)}var t,w=new Number(0);function r(){w=0}function p(){e.graphics[3].clear();for(var g in a)a[g].sel=false;l=false;h=0;t=0;b.clear("black");o.clear();b.put("Nyaru1",100,96);b.putchr8("Player",116,96);b.putchr8("Click Button to Start",128-80-8,140);b.draw();b.reset();k.Game.cold=true;d=true;f=30;c=0}function s(){g=[];var p=x.check_last(),i=u.check(),n=false;if(!d){if(Boolean(i[38]))if(i[38]){c--;if(c<0)c=a.length-1;d=true;f=10}if(i[40])if(i[40]){c++;if(c>a.length-1)c=0;d=true;f=10}var n=false;if(Boolean(i[90]))if(i[90])n=true;if(Boolean(i[32]))if(i[32])n=true;if(p.button==0)n=true;d&&e.sound.effect(9)}if(n&&!d)for(var j in a)if(a[j].sel){var o=a[j].func();if(o!=0)return o}if(f>0)f--;if(!n&&f==0)d=false;if(l){var m={};m.cw=b.cw;m.ch=b.ch;m.y1=b.ch/2-h;m.y2=b.ch/2+h;m.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(m);b.draw();b.reset();h+=4;if(b.ch/2-h<0)return 1}for(j in a)if(j==c)a[j].sel=true;else a[j].sel=false;g.push("==>>733ThemaSTG===");g.push("-----------------&");!k.Config.use_audio&&g.push("audio off");return 0}function q(){for(var d in g)j.putchr(g[d],0,50+16*d);for(var b in a)if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};j.putFunc(c);j.putchr(a[b].title,a[b].x-4,a[b].y-1)}else j.putchr(a[b].title,a[b].x,a[b].y)}}function Screen(A,F,E){var s=1500,p=new Image;p.src="pict/cha.png";var i=new Image;i.src="pict/aschr.png";var a=[],v=[],f=document.getElementById(A);f.width=F;f.height=E;var c=f.getContext("2d");this.cw=f.width;this.ch=f.height;var n=false,m=false;this.sprite_texture_ready=n;this.character_texture_ready=m;c.font="16px 'Arial'";p.onload=function(){n=true};i.onload=function(){m=true};this.readystate_check=function(){this.sprite_texture_ready=n;this.character_texture_ready=m};var D=spdata(),G=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=12*j;ptn.y=16*b;ptn.w=12;ptn.h=16;v.push(ptn)}var u=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=8*j;ptn.y=8*b+128;ptn.w=8;ptn.h=8;u.push(ptn)}for(var y=[],k=0;k<=3;k++){var z=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=8*j+(k%2==0?0:128);ptn.y=8*b+128+(k>=2?64:0);ptn.w=8;ptn.h=8;z.push(ptn)}y[k]=z}for(var h=0,w=[],b=0;b<s;b++)w[b]=new d;this.lighter_enable=true;var o=0;function e(){h++;if(h>=s)h=0;return w[h]}this.put=function(o,m,n,h,i,f,d){var b=e();b.img=p;var c=D[o];if(!Boolean(c)){b.text=o;b.sx=m;b.sy=n;b.mode=l;a[a.length]=b;return}b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;if(!Boolean(h))h=0;if(!Boolean(i))i=0;if(!Boolean(f))f=255;if(!Boolean(d))d=1;var q=h==0&&i==0&&f==255;if(q){b.dx=m+-c.w/2*d;b.dy=n+-c.h/2*d;b.dw=c.w*d;b.dh=c.h*d;b.mode=g}else{b.dx=-c.w/2*d;b.dy=-c.h/2*d;b.dw=c.w*d;b.dh=c.h*d;b.tx=m;b.ty=n;d;b.alpha=f;b.r=i;var k=1,j=1;switch(h){case 1:k=-1;break;case 2:j=-1;break;case 3:k=-1;j=-1}b.m11=j;b.m12=0;b.m21=0;b.m22=k;b.light_enable=this.light_enable;b.mode=x}a[a.length]=b};this.putPattern=function(d,c,i,j,h,f){var b=e();b.img=d;b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=i;b.dy=j;b.dw=h;b.dh=f;b.mode=g;a[a.length]=b};this.print=function(d,f,g,c){if(!Boolean(c))c="limegreen";var b=e();b.text=d;b.sx=f;b.sy=g;b.color=c;b.mode=l;a[a.length]=b};this.putchr=function(k,m,n,d){var j=false;if(!Boolean(d))d=1;else if(d!=1)j=true;for(var f=0,l=k.length;f<l;f++){var h=k.charCodeAt(f);if(h>=32&&h<128){var b=e();b.img=i;var c=v[h-32];b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=m+f*(12*d);b.dy=n;if(j){b.dx+=-c.w/2*d;b.dy+=-c.h/2*d}b.dw=c.w*d;b.dh=c.h*d;b.mode=g;a[a.length]=b}}};this.putchr8=B;function B(h,j,k){for(b=0;b<h.length;b++){var f=h.charCodeAt(b);if(f>=32&&f<128){var c=e();c.img=i;var d=u[f-32];c.sx=d.x;c.sy=d.y;c.sw=d.w;c.sh=d.h;c.dx=j+b*8;c.dy=k;c.dw=d.w;c.dh=d.h;c.mode=g;a[a.length]=c}}}this.putchr8c=function(j,l,m,k,f){if(!Boolean(f))f=1;for(b=0;b<j.length;b++){var h=j.charCodeAt(b);if(h>=32&&h<128){var c=e();c.img=i;var d=y[k][h-32];c.sx=d.x;c.sy=d.y;c.sw=d.w;c.sh=d.h;c.dx=l+b*(8*f)+-d.w/2*f;c.dy=m+-d.h/2*f;c.dw=d.w*f;c.dh=d.h*f;c.mode=g;a[a.length]=c}}};this.putImage=function(c,d,f){var b=e();b.img=c;b.sx=d;b.sy=f;b.mode=t;a[a.length]=b};this.putImage2=function(c,g,h,f,d){var b=e();b.img=c;b.sx=g;b.sy=h;b.sw=f;b.sh=d;b.mode=r;a[a.length]=b};this.putImageTransform=function(h,i,j,c,d,f,g){var b=e();b.img=h;b.tx=i;b.ty=j;b.m11=c;b.m12=d;b.m21=f;b.m22=g;b.mode=q;a[a.length]=b};this.transform=function(a,b,d,e){c.setTransform(a,b,d,e,0,0)};this.putFunc=function(b){a[a.length]=b};this.clear=function(a){c.save();c.setTransform(1,0,0,1,0,0);c.clearRect(0,0,f.width,f.height);c.restore();if(Boolean(a)){c.fillStyle=a;c.fillRect(0,0,f.width,f.height)}};this.fill=function(e,f,d,b,a){if(Boolean(a)){c.fillStyle=a;c.fillRect(e,f,d,b)}else c.clearRect(e,f,d,b)};this.reset=function(){a=[];h=0};this.draw=function(){for(var b=0,d=a.length;b<d;b++)a[b].draw(c);if(o<a.length)o=a.length};this.count=function(){return o};var C=0,x=1,g=2,r=3,t=4,l=5,q=6;function d(){this.img;this.text;this.sx;this.sy;this.sw;this.sh;this.dx;this.dy;this.dw;this.dh;this.color;this.use_tranceform;this.light_enable;this.m11;this.m12;this.m21;this.m22;this.tx;this.ty;this.alpha;this.r;this.mode}d.prototype.func=[];d.prototype.func[C]=function(){};d.prototype.func[x]=function(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty);this.r!=0&&a.rotate(Math.PI/180*this.r);if(this.alpha==255)a.globalCompositeOperation="source-over";else{if(this.light_enable)a.globalCompositeOperation="lighter";a.globalAlpha=this.alpha*(1/255)}a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh);a.restore()};d.prototype.func[g]=function(a){a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh)};d.prototype.func[r]=function(a){a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh)};d.prototype.func[t]=function(a){a.drawImage(this.img,this.sx,this.sy)};d.prototype.func[l]=function(a){a.fillStyle=this.color;a.fillText(this.text,this.sx,this.sy)};d.prototype.func[q]=function(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty);a.drawImage(this.img,0,0);a.restore()};d.prototype.draw=function(a){this.func[this.mode].call(this,a)}}function soundControl(){var c=false,h;this.mute=h;var i=".mp3";if((new Audio).canPlayType("audio/ogg")=="maybe")i=".ogg";var f=["00round_start","01main","02warnning","03hurry_up","04round_clear","05miss","06gameover","07swing","08bow","09select","10use","11hit","12damage","13bomb"],a=[],o=[],n=[];for(var d in f){a[d]=new Audio("sound/"+f[d]+i);a[d].pos=0;a[d].addEventListener("timeupdate",function(){this.pos=b.currentTime/b.duration*100});a[d].stat=false;a[d].addEventListener("loadeddata",function(){this.stat=true});a[d].addEventListener("ended",function(){if(e!=-1){j(e);k(e);e=-1}})}this.loadCheck=function(){var b=0;for(var d in a)if(a[d].stat)b++;c=b>=a.length;return c?"Ready":b};var g=0,e=-1,m=false,b=new Audio("sound/"+f[0]+i);this.change=j;function j(d){if(!c)return;b.pause();b.currentTime=0;if(Boolean(f[d])){b=a[d];if(h){a[d].volume=0;a[d].muted=true}else{a[d].volume=1;a[d].muted=false}g=d}}this.play=k;function k(){if(!c)return;if(b.ended)b.currentTime=0;b.play();e=-1}this.effect=l;function l(b){if(!c)return;if(Boolean(f[b])){a[b].currentTime=0;a[b].play()}}this.next=function(a,b){if(Boolean(f[a])){e=a;m=b}};this.info=function(){return a[g].pos};this.running=function(){return!c?void 0:!a[g].ended};this.restart=function(){if(!c)return;b.currentTime=0};this.volume=function(b){if(!c)return;if(h)b=0;for(var d in a)a[d].volume=b}}function spdata(){var d=[["Nyaru1",0,0],["Nyaru2",1,0],["Nyaru3",2,0],["Nyaru4",3,0],["Nyaru5",4,0],["Yaki_1",0,1],["Yaki_2",1,1],["Sira_1",2,1],["Sira_2",3,1],["Tuki_1",4,1],["Tuki_2",5,1],["Goul_1",6,1],["Goul_2",7,1],["Spide1",8,1],["Spide2",9,1],["Gagu_1",10,1],["Gagu_2",11,1],["Tori_1",12,1],["Tori_2",13,1],["Shogs1",14,1],["Shogs2",15,1],["Baal_1",0,2],["Baal_2",1,2],["Baal_3",2,2],["Baal_4",3,2],["Baal_5",4,2],["Baal_6",5,2],["Baal_7",6,2],["Baal_8",7,2],["Coin1",2,3],["Coin2",3,3],["Coin3",4,3],["Coin4",5,3],["Zap1",8,2],["Zap2",9,2],["Zap3",10,2],["Zap4",11,2],["Fork",0,3],["Dummy",0,5]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1]*16;a.y=b[2]*16;a.w=16;a.h=16;c[b[0]]=a}return c}function Stage1(b){var k=15,j=15,m,l=[];b=Math.floor(Math.random()*1e6);var c=new i(b);this.scenario=h;this.bgImage=f;this.bgLayout=e;this.initial=g;this.bgPtn=d;var a=[];this.colmap=a;function h(){var d=[[7199,300,20,180,"ememy_timeover",33],[7199,300,60,180,"ememy_timeover",33],[7199,300,100,180,"ememy_timeover",33],[7199,300,140,180,"ememy_timeover",33],[7199,300,180,180,"ememy_timeover",33],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1];a.y=b[2];a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function f(a){var c=Math.floor((a-1)%15/5)+1,b="bg"+c;return b}function e(){var c=[];a=[];var b=[];this.colmap=a;return b}function g(){var g=[],d=[],j=g[0];d.push([false,24,96,0,"player",0]);for(var i=1,e=0;e<5;e++){a=[true,300+Math.floor(c.next()*40)-20,e*48+40,Math.floor(c.next()*4)*90,"ememy_generator",1];d.push(a)}var f=[];for(var e in d){var a=d[e],b={};b.s=a[0];b.x=a[1];b.y=a[2];b.r=a[3];b.sc=a[4];b.ch=a[5];f.push(b)}return f}function d(){var d=[[0,128-96,128-128,95,95],[1,224-96,128-128,95,95],[2,128-96,128-128,31,31],[3,224-96,128-128,31,31],[4,256-96,128-128,31,31],[5,288-96,128-128,31,31],[6,224-96,160-128,31,31],[11,256-96,160-128,31,31],[7,288-96,160-128,31,31],[8,224-96,192-128,31,31],[9,256-96,192-128,31,31],[10,288-96,192-128,31,31],[11,256-96,160-128,31,31],[12,96-96,192-128,31,31],[13,0,0,32,32]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}function i(c){var a=c;this.next=b;function b(){var b=(1103515245*a+12345)%32768;a=b;return b/32767.1}}}function stateConfig(){this.lamp_use;this.map_use;this.itemreset;this.shotfree;this.startstage;this.use_audio;this.debug;a();this.load=function(){var c=0;if(Boolean(localStorage)){for(var a=["lamp_use","map_use","itemreset","shotfree","startstage"],d=false,b=0;b<=3;b++)if(Boolean(localStorage.getItem(a[b]))){d=true;this[a[b]]=localStorage.getItem(a[b])=="on"?true:false}if(Boolean(localStorage.getItem(a[4]))){d=true;this[a[4]]=parseInt(localStorage.getItem(a[4]))}c=d?0:1}else c=2;return c};this.save=function(){var a=0;if(Boolean(localStorage)){localStorage.setItem("lamp_use",this.fullpower?"on":"off");localStorage.setItem("map_use",this.sideshot?"on":"off");localStorage.setItem("itemreset",this.itemreset?"on":"off");localStorage.setItem("shotfree",this.option?"on":"off");localStorage.setItem("startstage",new String(this.startstage))}else a=2;return a};this.reset=a;function a(){this.lamp_use=false;this.map_use=false;this.itemreset=true;this.shotfree=false;this.startstage=1;this.debug=false}}function stateControl(){this.Config=new stateConfig;this.Result=new stateResult;this.System=new stateSystem;this.Game=new stateGame}function stateGame(){this.item;this.itemstack;this.nowstage;this.cold;this.player={};this.player.zanki=2;this.player.hp=10;this.player.maxhp=this.player.hp;this.player.weapon=0;this.outviewMove=true;this.outviewCollision=true;this.outviewHit=true;this.load=function(){if(Boolean(localStorage)){var b=false;if(Boolean(localStorage.getItem("savedata"))){b=true;var a=JSON.parse(localStorage.getItem("savedata"));this.item=a.item;this.itemstack=a.itemstack;this.nowstage=a.stage;this.player=a.player}ret_code=b?0:1}else ret_code=2;return ret_code};this.save=function(){var a={};a.item=this.item;a.itemstack=this.itemstack;a.stage=this.nowstage;a.player=this.player;var c=JSON.stringify(a),b=0;if(Boolean(localStorage))localStorage.setItem("savedata",c);else b=2;return b}}function stateResult(){this.highscore=0;this.score=0;this.combo;var a=0;this.load=function(){if(Boolean(localStorage)){var b=false;if(Boolean(localStorage.getItem("highscore"))){b=true;this.highscore=parseInt(localStorage.getItem("highscore"))}a=b?0:1}else a=2;return a};this.save=function(){var a=0;if(Boolean(localStorage))localStorage.setItem("highscore",new String(this.result.highscore));else a=2;return a}}function stateSystem(){this.dev=new deviceControl}function keyEntryManager(c,e,d){var g=c,f=e,b=d,a=[];this.check=function(){b.check(g.check_last());a=b.marge(f.check());return a};this.state=function(){st="";for(var b in a)st+="["+b+"]"+(a[b]?"*":".");return st}}function vartualKeyControl(){var a=[],b=[];this.enable=true;this.lockstate=false;this.init=function(d){b=[];for(var e in d){var c=d[e],a={};a.x=c[0];a.y=c[1];a.w=c[2];a.h=c[3];a.keycode=c[4];b.push(a)}};this.check=function(d){if(!this.lockstate)a=[];if(d.button!=0){for(var e in b){var c=b[e];for(var f in c.keycode)a[c.keycode[f]]=false}return a}for(var e in b){var c=b[e];if(d.x>=c.x&&d.y>=c.y&&d.x<=c.x+c.w&&d.y<=c.y+c.h)for(var f in c.keycode)a[c.keycode[f]]=true}return a};this.shift=function(a){this.lockstate=a};this.marge=function(c){if(!this.enable)return c;var d=[];for(var b in c)d[b]=c[b];for(var b in a)if(a[b])d[b]=a[b];else if(!Boolean(c[b]))if(!c[b])d[b]=a[b];return d};this.draw=function(e){for(var h in b){var c=b[h],d={};d.x=c.x;d.y=c.y;d.w=c.w;d.h=c.h;d.draw=function(a){a.beginPath();a.strokeStyle="white";a.lineWidth=1;a.rect(this.x,this.y,this.w,this.h);a.stroke()};e.putFunc(d);var g="";for(var f in c.keycode)g+="["+c.keycode[f]+"]"+(a[c.keycode[f]]?"On":".");e.print(g,c.x,c.y)}}}