function bench(){var j,e=Date.now(),l=0,a=[],c=[],b=0,d=0,i,h,g=0,k=640-80,f=480-16;this.start=function(){j=e;e=Date.now()};this.end=function(){i=Date.now()-e;h=e-j;if(b>d)d=b;a[b]=h;c[b]=i;b++;if(b>59)b=0;for(var k=0,f=0;f<=d;f++)k+=a[f];l++;g=parseInt(1e3/(k/(d+1)))};this.result=function(){var b={};b.fps=g;b.fps_log=a;b.load_log=c;var e={},d={};b.workload=e;b.interval=d;return b};this.draw=function(i){for(var n=0,o=999,t=0,l=0,m=999,j=0,q=0,p=0,e=0;e<=d;e++){if(n<a[e])n=a[e];if(o>a[e])o=a[e];if(l<c[e])l=c[e];if(m>c[e])m=c[e];q+=c[e];p+=a[e]}t=parseInt(p/(d+1));j=parseInt(q/(d+1));var h=[];h.push("fps : "+g);h.push("load:"+j+"ms");for(var r in h){var u=0+8*r+f;i.putchr8(h[r],k,u)}var s=false;if(s){cl={};cl.x=240;cl.y=48+f;cl.g=a;cl.s=b;cl.col="rgb(0,128,255)";cl.draw=graph_draw;i.putFunc(cl);cl={};cl.x=240;cl.y=48+f;cl.g=c;cl.s=b;cl.col="Red";cl.draw=graph_draw;i.putFunc(cl)}}}function graph_draw(a){a.beginPath();a.moveTo(this.x,this.y+1);a.lineTo(this.x+this.g.length*3,this.y+1);a.strokeStyle="rgb(255,255,255)";a.lineWidth="1";a.stroke();a.beginPath();a.strokeStyle=this.col;for(var b=0;b<this.g.length;b++){var c=(this.s+this.g.length-b)%this.g.length;a.lineTo(this.x+b*3,this.y-this.g[c])}a.stroke()}function sce_boss_0(){this.init=function(b,a){a.vset(8);a.get_target(98);a.w_cnt=0;a.custom_draw_enable=true};this.draw=sce_boss_damage_gr;this.move=function(b,a){switch(a.frame){case 15:a.get_target(98);a.vset(0);break;case 22:a.vector=a.target_v();break;case 32:a.set_object(103);break;case 60:a.frame=12;a.w_cnt++}a.frame++;if(a.w_cnt>10){a.w_cnt=5;a.vector+=Math.floor(Math.random()*180);a.vset(1);a.frame=0}return a.sc_move()}}function sce_boss_1(){this.init=function(b,a){a.vset(4);a.chr=1;a.display_size=.001;a.hit_x*=2;a.hit_y*=2;a.custom_draw_enable=false;a.wdspf=true;a.cnt=0};this.draw=sce_boss_damage_gr;this.move=function(b,a){if(a.wdspf)a.display_size=2*(a.frame/60);else{a.display_size=2;a.custom_draw_enable=true}switch(a.frame){case 13:case 14:a.vset(0);break;case 60:a.wdspf=false;if(a.hp>0){a.cnt++;if(a.cnt>7){a.cnt=0;a.set_object(30)}}a.vset(0);a.vector=(a.vector+8+360)%360;a.frame=59}if(a.status==2){a.set_object_ex(14,a.x,a.y,180,50);a.status=2}a.frame++;return a.sc_move()}}function sce_boss_2(){this.init=function(b,a){a.vset(0);a.get_target(98);a.w_cnt=0;a.display_size=.001;a.hit_x*=2;a.hit_y*=2;a.custom_draw_enable=true;a.wdspf=true};this.draw=sce_boss_damage_gr;this.move=function(d,a){if(a.wdspf)a.display_size=2*(a.frame/60);else a.display_size=2;switch(a.frame){case 60:a.wdspf=false;a.get_target(98);a.vset(0);break;case 82:a.get_target(98);a.vector=a.target_v();a.vset(0);break;case 95:a.frame=72;a.w_cnt++}a.frame++;if(a.w_cnt%10==0&&a.frame==90){a.set_object_ex(32,a.x,a.y,(a.vector+45)%360,49);a.set_object_ex(32,a.x,a.y,(a.vector+315)%360,49)}if(a.w_cnt%10==5&&a.frame==90){var b=(a.vector+90)%360,c=(a.vector+270)%360;a.set_object_ex(32,a.x+a.Cos(b)*100,a.y+a.Sin(b)*100,a.vector,51);a.set_object_ex(32,a.x,a.y,a.vector,51);a.set_object_ex(32,a.x+a.Cos(c)*100,a.y+a.Sin(c)*100,a.vector,51)}a.status==2&&a.bomb();return a.sc_move()}}function sce_boss_damage_gr(c,a){cl={};var b=a.gt.worldtoView(a.x,a.y);cl.x=b.x;cl.y=b.y;cl.sr=(360*((a.maxhp-a.hp)/a.maxhp)-90)*(Math.PI/180);cl.draw=function(a){a.beginPath();a.strokeStyle="white";a.lineWidth="5";a.beginPath();a.arc(this.x,this.y,32+10,this.sr,1.5*Math.PI,false);a.stroke();a.beginPath();a.strokeStyle="silver";a.lineWidth="1";a.arc(this.x,this.y,30+10,0,2*Math.PI,false);a.stroke();a.beginPath();a.arc(this.x,this.y,34+10,0,2*Math.PI,false);a.stroke()};c.putFunc(cl)}function character(){var d=[[0,1,10,98,16,16,32,32,0,0,24,15,15,24,0,0],[6,26,8,1,16,16,16,16,"common_vset8",13,5,5,5,5,0,0],[10,15,10,0,16,16,16,16,"friend_rotate",21,7,15,15,7,1,0],[36,35,10,0,16,24,16,16,"friend_straight",21,7,15,15,7,1,0],[37,36,3,0,8,8,16,16,"friend_boom",21,7,15,15,7,1,0],[38,37,10,0,8,8,16,16,"friend_rotate_full",21,7,15,15,7,1,0],[39,38,10,0,8,8,16,16,"friend_rotate",21,7,15,15,7,1,0],[1,4,8,2,16,16,32,32,0,0,7,5,5,7,0,10],[14,4,90,2,16,16,24,24,0,0,35,5,5,35,0,50],[30,7,1,3,16,16,32,32,33,33,5,5,5,5,0,0],[33,31,70,2,16,16,24,24,0,0,35,5,5,35,0,10],[34,4,40,2,16,16,32,32,0,0,7,5,5,7,0,30],[2,7,1,3,4,4,2,2,4,4,5,5,5,5,0,0],[3,7,2,3,8,8,6,6,4,4,5,5,5,5,0,0],[4,7,4,2,8,8,6,6,14,14,7,5,5,7,0,10],[5,7,1,3,8,8,8,8,4,4,5,5,5,5,0,0],[12,7,1,3,4,4,2,2,18,18,5,5,5,5,0,0],[32,7,5,3,8,8,6,6,49,49,5,5,5,5,0,0],[7,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[15,38,1,4,8,8,16,16,30,30,5,5,5,5,0,0],[16,15,1,4,16,16,32,32,30,30,5,5,5,5,0,0],[17,37,1,4,8,8,16,16,30,30,5,5,5,5,0,0],[18,35,1,4,16,24,16,48,30,30,5,5,5,5,0,0],[19,36,1,4,8,8,16,16,30,30,5,5,5,5,0,0],[20,26,1,4,8,8,16,16,30,30,5,5,5,5,0,1],[21,1,1,4,16,16,32,32,30,30,5,5,5,5,0,100],[22,27,1,4,16,16,32,32,30,30,5,5,5,5,0,10],[23,28,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[24,29,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[25,30,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[26,33,1,4,12,12,24,24,30,30,5,5,5,5,0,10],[27,34,1,4,12,12,24,24,30,30,5,5,5,5,0,10],[35,32,1,4,8,8,16,16,30,30,5,5,5,5,0,10],[40,39,1,2,16,16,16,16,30,30,5,5,5,5,0,100],[103,8,1,3,8,8,6,6,103,103,5,5,5,5,0,0],[8,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[9,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100]],c=[];for(var e in d){var a=d[e],b={};b.mp=a[1];b.hp=a[2];b.type=a[3];b.center_x=a[4];b.center_y=a[5];b.size_x=a[6];b.size_y=a[7];b.senario=[a[8],a[9],a[10],a[11],a[12],a[13]];b.id=a[14];b.score=a[15];c[a[0]]=b}return c}try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{"get":function(){return true}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(b,a){Object.defineProperty(this,b,{"get":a,enumerable:true,configurable:true})}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(b,a){Object.defineProperty(this,b,{"set":a,enumerable:true,configurable:true})}})}}catch(defPropException){}function CLinear4TreeManager(){var d=0;this.level=0;this.w=0;this.h=0;this.l=0;this.t=0;this.unitW=0;this.unitH=0;this.cellNum=0;this.cellAry=null;this.dim=0;this.colList=new h;this.pow=new Array(9+1);this.pow[0]=1;for(var b=1;b<9+1;b++)this.pow[b]=this.pow[b-1]*4;function f(a){this.id=a||0;this.cell=this.obj=this.pre=this.next=null}f.prototype.remove=function(){if(!this.cell||!this.cell.onRemove(this))return false;this.pre&&(this.pre.next=this.next);this.next&&(this.next.pre=this.pre);this.pre=this.next=this.cell=null;return true};function a(){this.latest=null}a.prototype.push=function(a){if(!a)return false;if(a.cell==this)return false;if(!this.latest)this.latest=a;else{a.next=this.latest;this.latest.pre=a;this.latest=a}a.cell=this;d++;return true};a.prototype.getFirstObj=function(){return this.latest};a.prototype.onRemove=function(a){if(this.latest==a)if(this.latest)this.latest=this.latest.next;d--;return true};function h(){var a=[];a.wright=function(a,b){this.push(a);this.push(b)};return a}function j(g,c){var a=this.cellAry[g].getFirstObj();while(a){var d=a.next;while(d){this.colList.wright(a.obj,d.obj);d=d.next}for(var b=0,i=c.length;b<i;b++)this.colList.wright(a.obj,c[b]);a=a.next}for(var e=false,h=0,b=0;b<4;b++){var f=g*4+1+b;if(f<this.cellNum&&this.cellAry[f]){if(!e){a=this.cellAry[g].getFirstObj();while(a){c.push(a.obj);h++;a=a.next}}e=true;arguments.callee.call(this,f,c)}}if(e)for(var b=0;b<h;b++)c.pop();return true}function k(b){while(!this.cellAry[b]){this.cellAry[b]=new a;b=b-1>>2;if(b<0||b>=this.cellNum)break}return true}function e(d,e,b,a){var h=this.l+this.w-1,g=this.t+this.h-1;if(d>h||b<this.l||e>g||a<this.t)return 2147483647;if(d<this.l)d=this.l;if(b>h)b=h;if(e<this.t)e=this.t;if(a>g)a=g;for(var o=c.call(this,d,e),k=c.call(this,b,a),n=k^o,j=0,f=0;f<this.level;f++){var m=n>>f*2&3;if(m!=0)j=f+1}var i=k>>j*2,l=(this.pow[this.level-j]-1)/3;i+=l;return i>this.cellNum?2147483647:i}function g(a){a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;return(a|a<<1)&1431655765}function i(a,b){return g(a)|g(b)<<1}function c(a,b){return i(parseInt((a-this.l)/this.unitW),parseInt((b-this.t)/this.unitH))}this.init=function(a,b,c,e,d){if(a>=9)return false;this.cellNum=(this.pow[a+1]-1)/3;this.cellAry=new Array(this.cellNum);this.l=b;this.t=c;this.w=e-b;this.h=d-c;this.unitW=this.w/(1<<a);this.unitH=this.h/(1<<a);this.level=a;return true};this.register=function(d,g,c,b,f){var a=e.call(this,d,g,c,b);if(a<this.cellNum){!this.cellAry[a]&&k.call(this,a);return this.cellAry[a].push(f)}return false};this.getAllCollisionList=function(){var a=false;if(this.cellAry[0]){var b=[];j.call(this,0,b);a=this.colList;this.colList=new h}return a};this.createObjectForTree=function(a){return new f(a)};this.getMortonNumber=function(b,d,c,a){return e.call(this,b,d,c,a)};this.getPointElem=function(a,b){return c.call(this,a,b)};this.__defineGetter__("objectNum",function(){return d})}function sce_common_vset(a){this.init=function(c,b){b.vset(a)};this.move=function(b,a){return a.sc_move()}}function sce_common_signal(a){this.init=function(b,a){a.vset(0);a.normal_draw_enable=false;a.custom_draw_enable=false;a.x=a.gt.world_x+1;a.y=a.gt.world_y+1};this.move=function(c,b){b.x=b.gt.world_x+1;b.y=b.gt.world_y+1;if(b.frame==0)b.SIGNAL(a);else{b.SIGNAL(0);b.status=0}b.frame++;return b.sc_move()}}function Dangeon(r){MAP_W=30,MAP_H=30,MINIMUM_ROOM_SIZE=3,MARGIN_BETWEEN_RECT_ROOM=2,MINIMUM_RECT_SIZE=MINIMUM_ROOM_SIZE+MARGIN_BETWEEN_RECT_ROOM*2,COUPLE_VERTICAL=0,COUPLE_HORIZONAL=1;r=Math.floor(Math.random()*1e6);var B=new z(r);function s(){this.lx=0;this.ly=0;this.hx=MINIMUM_ROOM_SIZE;this.hy=MINIMUM_ROOM_SIZE}function n(){this.done_split_v=false;this.done_split_h=false;this.lx=0;this.ly=0;this.hx=MINIMUM_RECT_SIZE;this.hy=MINIMUM_RECT_SIZE;this.room=new s}function x(){this.v_or_h=COUPLE_HORIZONAL;this.rect0=new n;this.rect1=new n}var d=[],m=[],k=[],a=[[]],c=[[]],e=[[]],o=[[]],i=[],j=[],h=[];this.create=y;this.mapdata=a;this.room=c;this.inroom=e;this.type=o;this.ml=i;this.rl=j;this.il=h;this.mw=MAP_W;this.mh=MAP_H;function y(){for(var b=0;b<MAP_W;b++){a[b]=[];for(var c=0;c<MAP_H;c++)a[b][c]=false}d=[];m=[];k=[];g(q(0,0,MAP_W-1,MAP_H-1));v();t();u();p()}function p(){for(var d=0;d<MAP_W;d++)for(var b=0;b<MAP_H;b++)if(a[d][b])a[d][b]=false;else a[d][b]=true;for(var g=[-1,0,1,-1,1,-1,0,1],m=[-1,-1,-1,0,0,1,1,1],f=[],l=[[]],b=0;b<MAP_W;b++){c[b]=[];l[b]=[];for(var d=0;d<MAP_H;d++){var p=true,n=0,q=0;if(b==0||b==MAP_H-1||d==0||d==MAP_W-1){l[b][d]=p;c[b][d]=n;continue}for(var k in g)if(!a[b+g[k]][d+m[k]])n++;c[b][d]=n;if(a[b][d])for(var k in g)if(!a[b+g[k]][d+m[k]])p=false;l[b][d]=p}}for(var b=0;b<MAP_W;b++){o[b]=[];for(var d=0;d<MAP_H;d++){if(!a[b][d]){var f={};f.x=b;f.y=d;i.push(f)}var q=0;if(!(b==0||b==MAP_H-1||d==0||d==MAP_W-1)){var r=0;for(var k in g){if(a[b+g[k]][d+m[k]])q+=Math.pow(2,r);r++}}o[b][d]=q}}for(var b=0;b<MAP_W;b++){e[b]=[];for(var d=0;d<MAP_H;d++){if(!a[b][d]&&c[b][d]>=8)e[b][d]=true;else e[b][d]=false;if(!a[b][d]&&c[b][d]>=5)c[b][d]=true;else c[b][d]=false;if(l[b][d])a[b][d]=false}}for(var b=0;b<MAP_W;b++)for(var d=0;d<MAP_H;d++)if(c[b][d]){var f={};f.x=b;f.y=d;j.push(f)}for(var b=0;b<MAP_W;b++)for(var d=0;d<MAP_H;d++)if(e[b][d]){var f={};f.x=b;f.y=d;h.push(f)}}function u(){var d,e,g,h;for(var j in m)for(var i=m[j],l=i.lx;l<=i.hx;l++)for(var n=i.ly;n<=i.hy;n++)a[l][n]=true;for(j in k){var c=k[j];switch(c.v_or_h){case COUPLE_HORIZONAL:d=c.rect0.hx;e=b(c.rect0.room.ly+1,c.rect0.room.hy);g=c.rect1.lx;h=b(c.rect1.room.ly+1,c.rect1.room.hy);f(d,e,g,h);f(c.rect0.room.hx,e,d,e);f(c.rect1.room.lx,h,g,h);break;case COUPLE_VERTICAL:d=b(c.rect0.room.lx+1,c.rect0.room.hx);e=c.rect0.hy;g=b(c.rect1.room.lx+1,c.rect1.room.hx);h=c.rect1.ly;f(d,e,g,h);f(d,c.rect0.room.hy,d,e);f(g,c.rect1.room.ly,g,h)}}}function f(h,j,i,k){var f,d,g,e,b,c;f=Math.min(h,i);d=Math.max(h,i);g=Math.min(j,k);e=Math.max(j,k);if(h<=i&&j>=k){for(b=f;b<=d;b++)a[b][e]=true;for(c=g;c<=e;c++)a[d][c]=true;return}if(h>i&&j>k){for(b=f;b<=d;b++)a[b][g]=true;for(c=g;c<=e;c++)a[d][c]=true;return}if(h>i&&j<=k){for(b=f;b<=d;b++)a[b][g]=true;for(c=g;c<=e;c++)a[f][c]=true;return}if(h<=i&&j<k){for(b=f;b<=d;b++)a[b][e]=true;for(c=g;c<=e;c++)a[f][c]=true;return}}function g(a){var c=new n;if(a.hy-a.ly<=MINIMUM_RECT_SIZE*2)a.done_split_v=true;if(a.hx-a.lx<=MINIMUM_RECT_SIZE*2)a.done_split_h=true;if(a.done_split_v&&a.done_split_h)return;c=q(a.lx,a.ly,a.hx,a.hy);if(a.done_split_v==false){var e;e=b(a.ly+MINIMUM_RECT_SIZE,a.hy-MINIMUM_RECT_SIZE);a.hy=e;c.ly=e;a.done_split_v=true;c.done_split_v=true;l(COUPLE_VERTICAL,a,c);g(a);g(c);return}if(a.done_split_h==false){var d;d=b(a.lx+MINIMUM_RECT_SIZE,a.hx-MINIMUM_RECT_SIZE);a.hx=d;c.lx=d;a.done_split_h=true;c.done_split_h=true;l(COUPLE_HORIZONAL,a,c);g(a);g(c);return}}function v(){var f,g,e,c;for(var h in d){var a=d[h];e=b(MINIMUM_ROOM_SIZE,a.hx-a.lx-MARGIN_BETWEEN_RECT_ROOM*2+1);c=b(MINIMUM_ROOM_SIZE,a.hy-a.ly-MARGIN_BETWEEN_RECT_ROOM*2+1);f=b(a.lx+MARGIN_BETWEEN_RECT_ROOM,a.hx-MARGIN_BETWEEN_RECT_ROOM-e+1);g=b(a.ly+MARGIN_BETWEEN_RECT_ROOM,a.hy-MARGIN_BETWEEN_RECT_ROOM-c+1);a.room=w(f,g,f+e,g+c)}}function t(){rectmap=[[]];for(var c,a=0;a<MAP_W;a++){rectmap[a]=[];for(var c=0;c<MAP_H;c++)rectmap[a][c]=null}for(var f in d){var e=d[f];for(c=e.lx;c<e.hx;c++)for(a=e.ly;a<e.hy;a++)rectmap[c][a]=e}for(c=0;c<MAP_W-2;c++)for(a=0;a<MAP_H-2;a++){!Boolean(rectmap[c][a])&&alert("rectnull"+c+":"+a);if(rectmap[c][a]!=rectmap[c][a+1])b(0,64)==0&&l(COUPLE_VERTICAL,rectmap[c][a],rectmap[c][a+1]);if(rectmap[c][a]!=rectmap[c+1][a])b(0,64)==0&&l(COUPLE_HORIZONAL,rectmap[c][a],rectmap[c+1][a])}}function q(e,f,b,c){var a=new n;a.lx=e;a.ly=f;a.hx=b;a.hy=c;d.push(a);return a}function w(d,e,b,c){var a=new s;a.lx=d;a.ly=e;a.hx=b;a.hy=c;m.push(a);return a}function l(b,c,d){var a=new x;a.v_or_h=b;a.rect0=c;a.rect1=d;k.push(a);return a}function b(a,b){return Math.floor(B.next()*(b-a))+a}function z(c){var a=c;this.next=b;function b(){var b=(1103515245*a+12345)%32768;a=b;return b/32767.1}}}function deviceControl(){for(var e=4,c=[],d=0;d<e;d++)c[d]=new Screen("Layer"+d,640,480);this.graphics=c;this.canvas=c;this.text=c[3];this.gs=new geometoryTrance;this.layout=new gameLayout;this.mouse_state=new inputControl("Layer3");var f=new inputKeyboard;this.vkey_state=new vartualKeyControl;this.key_state=new keyEntryManager(this.mouse_state,f,this.vkey_state);this.sound=new soundControl;this.images=new loadingImages;var b=200,a=50,g=[[a+50,b,100,100,[38]],[a,b+50,100,100,[37]],[a+100,b+50,100,100,[39]],[a+50,b+100,100,100,[40]],[a+250,b+50,100,100,[90]],[a+350,b+50,100,100,[88]],[a+450,b+50,100,100,[67]]];this.vkey_state.init(g)}function sce_effect_vanish(){this.init=function(b,a){a.type=5;a.status=5};this.move=function(){return-1}}function sce_effect_bomb(){this.init=function(b,a){a.vset(0);a.mp=12;a.type=5;a.status=5;a.frame=0};this.move=function(b,a){switch(a.frame){case 90:a.status=0}a.frame++;if(a.frame>=30)a.status=0;return a.sc_move()}}function sce_effect_hit(){this.init=function(b,a){a.vset(0);a.mp=11;a.type=5;a.status=5;a.frame=0;a.alpha=254};this.move=function(b,a){switch(a.frame){case 60:a.status=0}a.frame++;if(a.frame>30)a.alpha-=3;return a.sc_move()}}function sce_effect_billboard(a){this.init=function(c,b){b.vector=a;b.vset(2)};this.move=function(b,a){if(a.alpha>10)a.alpha-=5;else return-1;return a.sc_move()}}function sce_effect_bombcircle(a){this.init=function(b,a){a.vset(0);a.circle_r=20;a.type=5;a.normal_draw_enable=false;a.custom_draw_enable=true};this.move=function(b,a){if(a.frame>10)a.status=0;a.circle_r+=(a.frame+1)*10;a.frame++;return a.sc_move()};this.draw=function(e,c){var b={},d=c.gt.worldtoView(c.x,c.y);b.x=d.x;b.y=d.y;b.r=c.circle_r;b.draw=function(b){b.beginPath();b.globalCompositeOperation="lighter";b.arc(this.x,this.y,this.r,0,Math.PI*2,false);b.fillStyle=a;b.fill();b.globalCompositeOperation="source-over"};e.putFunc(b)}}function sce_effect_warnning_mark(){this.init=function(b,a){a.vset(0);a.type=5;a.mp=28};this.move=function(b,a){if(a.frame>30)a.status=0;a.frame++;return a.sc_move()}}function sce_ememy_move_n(a){this.init=function(b,a){a.vset(1)};this.move=function(c,b){switch(b.frame){case 80:b.get_target(98);break;case 100:b.vector=b.target_v();b.set_object(103);break;case 110:b.set_object(3);break;case 120:b.vector+=a;b.vector=b.vector%360;b.vset(1);break;case 160:b.vector=+a;b.vector=b.vector%360;b.vset(1);break;case 200:b.vector=+a;b.vector=b.vector%360;b.vset(1);b.frame=50}b.frame++;return b.sc_move()}}function sce_ememy_turn(a){this.init=function(b,a){a.vset(4)};this.move=function(c,b){switch(b.frame){case 5:b.set_object_ex(3,b.x,b.y,b.vector+Math.floor(Math.random()*40)-20,"exev_5expansion");break;case 15:b.vector+=a;b.vset(4);break;case 25:b.vector+=a;b.vset(4);break;case 35:b.vector+=a;b.vset(4);break;case 45:b.frame=1}b.frame++;return b.sc_move()}}function sce_ememy_change_s(){this.init=function(b,a){a.vset(4);a.vector=180};this.move=function(b,a){if(a.frame==15){a.set_object(102);a.change_sce(9)}a.frame++;return a.sc_move()}}function sce_ememy_moveshot(){this.init=function(b,a){a.vset(4)};this.move=function(b,a){a.vset(4);if(a.vector>180)a.mp=5;else a.mp=4;if(a.frame%50==5)if(a.frame>3600)a.set_object_ex(5,a.x,a.y,a.vector,"en_bullet_homing");else a.set_object_ex(5,a.x,a.y,a.vector,"en_bullet_turn");a.frame++;return a.sc_move()}}function sce_ememy_randomshot(){this.init=function(b,a){a.vset(4);a.w_cnt=0;a.display_size=1.5;a.hit_x*=1.5;a.hit_y*=1.5;a.hp=20};this.move=function(b,a){if(a.vector>180)a.mp=5;else a.mp=4;switch(a.frame){case 10:a.vset(0);break;case 13:a.set_object(12);break;case 30:a.frame=12;a.w_cnt++}a.frame++;if(a.w_cnt>5){a.w_cnt=0;a.vset(2);a.frame=0}return a.sc_move()}}function sce_ememy_move_std(){this.init=function(b,a){a.vset(2);a.wmapc=false;a.colcnt=0};this.move=function(c,a){a.frame++;if(a.wmapc){var b=Math.floor(Math.random()*2)==0?1:3;a.wmapc=false;a.vector+=b*90;a.vector=a.vector%360;a.vset(2);a.colcnt=0}if(a.vector>180)a.mp=5;else a.mp=4;if(a.mapCollision){a.colcnt++;if(a.colcnt>10)a.wmapc=true}return a.sc_move()}}function sce_ememy_move_std2(){this.init=function(b,a){a.vset(2);a.wmapc=false;a.colcnt=0;a.lockon_flag=false;a.growf=true;a.get_target(98)};this.move=function(e,a){a.frame++;if(a.growf)if(a.mapCollision)a.mapCollision=false;if(Boolean(a.target))if(a.target_d(a.target.x,a.target.y)<200)a.lockon_flag=true;if(a.wmapc&&a.lockon_flag){for(var d=a.target_v(),c=0,b=45;b<320;b+=45)if(d>b-22.5&&d<=b+22.5)c=b;a.vector=c;a.vset(2);a.wmapc=false;a.colcnt=0}if(a.vector>300)a.mp=5;else a.mp=4;if(a.mapCollision){a.colcnt++;if(a.colcnt>2)a.wmapc=true}if(a.frame>16){a.lockon_flag&&a.target_rotate_r(45);a.vset(2);a.frame=0;a.get_target(98);a.growf=false}return a.sc_move()}}function sce_ememy_generator(){this.init=function(b,a){a.vset(0);a.gencnt=0;a.lockon_flag=false;a.mp=31;a.hit_x=8;a.hit_y=8;a.get_target(98);a.hp=18};this.move=function(c,a){a.frame++;if(Boolean(a.target))if(a.target_d(a.target.x,a.target.y)<200)a.lockon_flag=true;if(a.frame>180){if(a.lockon_flag&&a.gencnt<5){var b=a.target_v();a.set_object_ex(1,a.x+a.Cos(b)*32,a.y+a.Sin(b)*32,b,"ememy_move_std2");a.gencnt++}a.frame=0;a.get_target(98);a.vset(0)}return a.sc_move()}}function sce_enemy_trbox(){this.init=function(b,a){a.vset(0);a.attack=0};this.move=function(e,d){var b=0;d.frame++;if(this.status==2){this.change_sce(7);for(var a=0;a<this.pick.length;a++)this.set_object_ex(this.pick[a],this.x,this.y,Math.floor(Math.random()*360),"item_movingstop");this.add_score(this.score)}if(this.damageflag){var c=this.gt.in_view_range(this.x-this.hit_x/2,this.y-this.hit_y/2,this.hit_x,this.hit_y);c}if(this.status==0)b=1;this.damageflag=false;return b}}function sce_ememy_timeover(){this.init=function(b,a){a.vset(6);a.get_target(98);a.lifecount=0;a.cancelcol=true;a.display_size=2;a.hit_x*=2;a.hit_y*=2;a.attack=10;a.pick_enable=false};this.move=function(b,a){switch(a.frame){case 10:a.target_rotate_r(30);a.vset(6);break;case 15:a.get_target(98);a.frame=9}a.frame++;a.lifecount++;a.lifecount%300==250&&a.set_object_ex(5,a.x,a.y,a.vector,"en_bullet_homing");if(a.cancelcol)this.mapCollision=false;return a.sc_move()}}function sce_en_bullet_homing(){this.init=function(b,a){a.vset(2);a.get_target(98);a.lifecount=0;a.cancelcol=true};this.move=function(b,a){switch(a.frame){case 10:a.target_rotate_r(15);a.vset(2);break;case 15:a.frame=9}a.frame++;a.lifecount++;if(a.cancelcol)this.mapCollision=false;return a.sc_move()}}function sce_en_bullet_random(){this.init=function(c,a){var b=Math.floor(Math.random()*50)-25;a.vector=(a.vector+b+360)%360;a.vset(4)};this.move=function(b,a){return a.sc_move()}}function sce_en_bullet_accel(){this.init=function(b,a){a.vset(4)};this.move=function(b,a){switch(a.frame){case 15:a.vx/=2;a.vy/=2;break;case 23:a.vx/=2;a.vy/=2;break;case 30:a.vx/=2;a.vy/=2;break;case 90:a.vset(6)}a.frame++;return a.sc_move()}}function sce_en_bullet_hominglaser(){this.init=function(b,a){a.vset(2);a.get_target(98);a.display_size=2;a.alpha=128;a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 26:a.frame>90&&a.get_target(2);a.target_rotate_r(15+(a.frame<20?15:0));a.vset(2+(a.frame>40?4:0)+(a.frame>50?4:0));break;case 30:a.w_cnt=25}a.frame%5==0&&a.set_object_ex(32,a.x,a.y,a.vector,56);a.w_cnt++;a.frame++;return a.sc_move()}}function sce_en_bullet_infolaser(){this.init=function(b,a){a.vset(0);a.msf=false;a.display_size=2;a.alpha=0};this.move=function(b,a){switch(a.frame){case 0:a.normal_draw_enable=false;a.custom_draw_enable=true;break;case 45:a.normal_draw_enable=true;a.custom_draw_enable=false;a.msf=true}if(a.msf){a.vset(48);a.set_object_ex(32,a.x+a.vx,a.y+a.vy,a.vector,56)}a.frame++;return a.sc_move()};this.draw=function(d,b){var a={},c=b.gt.worldtoView(b.x,b.y);a.x=c.x;a.y=c.y;b.vset(800);a.tx=c.x+b.vx;a.ty=c.y+b.vy;b.vset(0);a.alpha=b.frame/30;a.alpha=a.alpha>1?1:a.alpha;a.draw=function(b){b.beginPath();b.moveTo(this.x,this.y);b.lineTo(this.tx,this.ty);b.lineWidth="1";b.strokeStyle="rgba( 255, 0, 0,"+a.alpha+")";b.stroke()};d.putFunc(a)}}function sce_en_bullet_turn(){this.init=function(b,a){a.vset(0);a.get_target(98)};this.move=function(b,a){if(a.frame==60){a.vector=a.target_v();a.vset(8)}a.frame++;return a.sc_move()}}function sce_en_bullet_laser_tail(){this.init=function(b,a){a.vset(0);a.display_size=2};this.move=function(b,a){if(a.frame>10)a.status=0;a.frame++;return a.sc_move()}}function sce_exev_3way(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-5,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+5,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5way_nallow(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-10,12);a.set_object_ex(5,a.x,a.y,a.vector-5,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+5,12);a.set_object_ex(5,a.x,a.y,a.vector+10,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5way_normal(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-30,12);a.set_object_ex(5,a.x,a.y,a.vector-15,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+15,12);a.set_object_ex(5,a.x,a.y,a.vector+30,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5expansion(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(3,a.x,a.y,a.vector,"common_vset2");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset4");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset6");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset8");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset10")};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_3way_exp(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-5,"exev_5expansion");a.set_object_ex(5,a.x,a.y,a.vector,"exev_5expansion");a.set_object_ex(5,a.x,a.y,a.vector+5,"exev_5expansion")};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_friend_rotate(){this.init=function(b,a){a.vset(0);a.get_target(98);a.startflag=true;a.startv=(a.vector+315)%360;a.vector=a.startv;a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.rotatecount=0;a.attack=1};this.move=function(c,a){var b=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(Boolean(a.target)){if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else{a.change_sce(7);return 1}}else{a.change_sce(7);return 1}if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.rotatecount++;if(a.rotatecount>10){a.vector=(a.target.vector+315)%360;a.rotatecount=0;a.status=0}a.x=a.target.x+a.Cos(a.vector)*35;a.y=a.target.y+a.Sin(a.vector)*35;a.vector=(a.vector+9)%360;if(a.status==0)b=1;return b}}function sce_friend_start(){this.init=function(b,a){a.vset(0)};this.move=function(b,a){if(!a.config.option)a.status=0;a.hp=10;switch(a.frame){case 30:a.vector=180;a.get_target(98);break;case 58:case 59:a.vector=a.target_v();case 60:a.vset(0);a.change_sce(21)}a.frame++;return a.sc_move()}}function sce_friend_sidearm(){this.init=function(b,a){a.vset(0);a.triger=15;a.m_trig=0;a.frame=60};this.move=function(f,a){if(!a.config.option)a.status=0;var c=a.vector;a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}var b=0;for(var e in a.item)if(e==7)b=a.item[e];if(b<10)a.mp=15;else a.mp=24;if(eval(a.mouse_state.button)==0){if(a.shot==0){a.shot=1;(b>=3&&b<=4||b>=8)&&a.set_object_ex(6,a.x,a.y,a.vector>180?a.vector+87:a.vector-87,13);a.m_trig=1-a.m_trig;if(b>=5)a.m_trig==0&&a.set_object(13);if(a.frame>45)if(b>=10){a.set_object(23);a.frame=0}a.triger=15;if(b>=7)a.triger=5}c=a.vector}var d=0;a.target.type!=98&&a.change_sce(7);if(this.status==0)d=1;a.x=a.target.x+Math.cos((c-90)*(Math.PI/180))*32;a.y=a.target.y+Math.sin((c-90)*(Math.PI/180))*32;a.frame++;return d}}function sce_friend_straight(){this.init=function(b,a){a.vset(0);a.get_target(98);a.startflag=true;a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.shotcount=0;a.attack=1};this.move=function(d,a){var b=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.shotcount++;if(a.shotcount>10){a.vector=(a.target.vector+315)%360;a.shotcount=0;a.status=0}var c=Math.abs(a.shotcount-5);a.x=a.target.x+a.Cos(a.vector)*(50-c);a.y=a.target.y+a.Sin(a.vector)*(50-c);if(a.status==0)b=1;return b}}function sce_friend_boom(){this.init=function(b,a){a.vset(4);a.get_target(98);a.startflag=true;a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.shotcount=0;a.bup_vector=a.vector;a.attack=1};this.move=function(c,a){a.vector=a.bup_vector;var b=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.shotcount++;if(a.shotcount>30)a.vector=a.target_v(a.target.x,a.target.y);a.vset(4);a.bup_vector=a.vector;if(a.target_d(a.target.x,a.target.y)<24||a.shotcount>180)a.status=0;a.vector=a.shotcount*5%360;a.x+=a.vx;a.y+=a.vy;if(a.status==0)b=1;if(a.states==2)b=1;return b}}function sce_friend_rotate_full(){this.init=function(b,a){a.vset(0);a.x+=a.Cos(a.vector)*35;a.y+=a.Sin(a.vector)*35;a.rotatecount=0;a.attack=2};this.move=function(c,a){var b=0;if(!Boolean(a.parent)){a.change_sce(7);return 1}if(a.damageflag){a.set_object_ex(6,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"effect_hit");a.damageflag=false}a.rotatecount++;if(a.rotatecount>20){a.vector=(a.vector+18)%360;a.rotatecount=0;a.status=0}a.x=a.parent.x+a.Cos(a.vector)*35;a.y=a.parent.y+a.Sin(a.vector)*35;a.vector=(a.vector+18)%360;if(a.status==0)b=1;return b}}function gameScene(c){var b=c.System.dev,A=b.graphics[1],g=b.graphics[0],d=b.graphics[3],j=b.graphics[2];this.init=D;this.reset=B;this.step=E;this.draw=C;this.score=0;var a,e,z,F=0,f=0,t=[],l=[],p=[],G=false,m=true,s=0,h=0,n=0,k=false,q=0,y=0,x=0,v=false,o=false,u=false,r=0;function D(){a=new gObjectControl(A,c);e=new mapSceControl;e.init();c.Result.load();c.Result.score=0;c.Game.item=a.item;c.Result.combo=a.combo;k=false}function B(i){d.clear();if(!Boolean(i))i=false;k=false;if(c.Game.cold){a.reset(false);e.init();if(i){f=2-c.Game.player.zanki;a.item=c.Game.item;a.itemstack=c.Game.itemstack}else{f=0;c.Game.nowstage=c.Config.startstage;c.Game.player.maxhp=100;c.Game.player.hp=c.Game.player.maxhp;c.Game.player.weapon=0}c.Game.player.barrier=false;e.change(c.Game.nowstage);e.reset();m=true;s=0;h=0;n=0;b.sound.change(0);b.sound.play()}x=0;if((i=true)&&!c.Game.cold){w=e.stage;w++;e.change(w);e.stage=w;c.Game.nowstage=w;var j=a.score;a.reset(false);a.score=j;e.reset();h=0;n=0}t=b.images.img[e.bgImage()];l=e.mapChip();p=e.bgPtn();g.clear("darkgreen");g.reset();z=new gs_score_effect(a.score);ehighscore=new gs_score_effect(c.Result.highscore);v=true;u=c.Config.lamp_use?true:false;o=c.Config.map_use?false:true}function E(){if(!b.sound.running()){if(e.flame<7200)b.sound.change(1);else b.sound.change(3);b.sound.play()}if(e.flame==7100){b.sound.change(2);b.sound.play();v=false}if(a.interrapt){if(a.SIGNAL==1){e.enable=false;e.counter_runnning=false;b.sound.volume(0)}if(a.SIGNAL==6055){if(h==0)m=false;e.enable=true;e.counter_runnning=false}if(a.SIGNAL==835){a.score+=Math.floor((7200-e.flame)/6);c.Result.score=a.score;c.Game.item=a.item;c.Game.itemstack=a.itemstack;c.Game.player.zanki=2-f;c.Result.combo=a.combo;c.Result.combomax=a.combomax;c.Result.obCount=a.obCount;c.Result.total=a.total;c.Result.hidan=a.hidan;c.Game.cold=false;a.interrapt=false;a.SIGNAL=0;a.draw(g);k=true;b.sound.change(4);b.sound.play();return 5}if(a.SIGNAL==4649){f++;if(f<3){if(c.Config.itemreset){a.item=[];a.itemstack=[]}a.combo=[];c.Game.player.hp=c.Game.player.maxhp;a.restart();e.counterReset();v=false}else{c.Result.score=a.score;c.Game.item=a.item;c.Game.itemstack=a.itemstack;c.Game.player.zanki=2-f;c.Result.combo=a.combo;c.Result.combomax=a.combomax;c.Result.obCount=a.obCount;c.Result.total=a.total;c.Result.hidan=a.hidan;a.draw(g);k=true;Boolean(localStorage)&&localStorage.setItem("highscore",new String(c.Result.highscore));b.sound.change(6);b.sound.play();return 3}}}else{m=true;e.enable=true;e.counter_runnning=true}for(i in a.item){if(i==21)if(a.item[21]>0){a.item[21]=0;f--;b.sound.effect(11)}if(i==26)if(a.item[26]>0){a.item[26]=0;u=true}if(i==27)if(a.item[27]>0){a.item[27]=0;o=false}if(i==15)if(a.item[15]>0){a.item[15]=0;c.Game.player.weapon=0}if(i==16)if(a.item[16]>0){a.item[16]=0;c.Game.player.weapon=1}if(i==17)if(a.item[17]>0){a.item[17]=0;c.Game.player.weapon=2}if(i==19)if(a.item[19]>0){a.item[19]=0;c.Game.player.weapon=3}if(i==18)if(a.item[18]>0){a.item[18]=0;c.Game.player.weapon=4}}var p=0,l=1;for(i in a.combo){if(i==2)p=a.combo[i];if(i==4)l=a.combo[i]}if(q!=p){q=p;if(q>=2)x=60}if(y!=l)y=l;if(!a.interrapt){a.move(e);e.step(a)}else if(a.SIGNAL!=1){a.move(e);e.step(a)}else{var d=b.key_state.check(),j=false;if(Boolean(d[90]))if(d[90])j=true;if(Boolean(d[32]))if(d[32])j=true;var r=false;if(Boolean(d[81]))if(d[81]){r=true;delete d[81]}if(r){c.Game.item=a.item;c.Game.itemstack=a.itemstack;c.Game.player.zanki=2-f;if(c.Game.save()==0){b.sound.volume(1);b.sound.change(9);b.sound.play();return 2}else{alert("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002\n\u4e2d\u65ad\u30bb\u30fc\u30d6\u51fa\u6765\u306a\u304b\u3063\u305f\u306e\u3067\u3001\n\u30b2\u30fc\u30e0\u7d99\u7d9a\u3057\u307e\u3059\u3002");j=true}}if(j){a.interrapt=false;a.SIGNAL=0;b.sound.volume(1)}}if(m)h++;if(h>480){h=0;n=1-n}if(c.Result.highscore<a.score)c.Result.highscore=a.score;return 0}function C(){k=true;if(s!=b.gs.world_x||h!=b.gs.world_y){k=false;s=b.gs.world_x;h=b.gs.world_y}if(!k){for(var m in l){var i=l[m];if(b.gs.in_stage_range(i.x,i.y,i.w,i.h)){i.view=true;var w=b.gs.worldtoView(i.x,i.y);if(i.visible){var D=false;if(i.type==11)D=true;if(Boolean(p[i.no]))if(D)j.putPattern(t,p[i.no],w.x,w.y-24,i.w,i.h);else g.putPattern(t,p[i.no],w.x,w.y,i.w,i.h);else{var n={};n.x=w.x;n.y=w.y;n.w=i.w;n.h=i.h;n.draw=function(a){a.beginPath();a.strokeStyle="green";a.lineWidth=1;a.rect(this.x,this.y,this.w,this.h);a.stroke()};g.putFunc(n)}}}else i.view=false}var n={};n.draw=function(a){a.beginPath();a.fillStyle="rgba(0,0,0,0.3)";a.fillRect(b.layout.map_x,b.layout.map_y,150,150)};j.putFunc(n);a.drawPoint(j,u);var n={};n.draw=function(a){a.beginPath();a.fillStyle="rgba(0,0,0,0.5)";a.fillRect(0,480-36,640-13*13,36)};j.putFunc(n);g.clear("black");g.draw();g.reset();j.clear();j.draw();j.reset()}a.draw();var y=false;r++;if(r%6==0){r=0;y=true}if(y){var v=[];d.fill(b.layout.hiscore_x+12*6,b.layout.hiscore_y,12*7,32);wt=ehighscore.read(c.Result.highscore);d.putchr("Hi-Sc:"+wt,b.layout.hiscore_x,b.layout.hiscore_y);wt=z.read(a.score);d.putchr("Score:"+wt,b.layout.score_x,b.layout.score_y);var F=2-f;if(F<3)for(var m=0;m<2-f;m++)d.put("Mayura1",b.layout.zanki_x+m*32,b.layout.zanki_y);else{d.put("Mayura1",b.layout.zanki_x,b.layout.zanki_y);d.putchr("x"+F,b.layout.zanki_x+16,b.layout.zanki_y)}if(Boolean(a.item[20])){var q=a.item[20];if(q<=8)for(var m=0;m<q;m++)d.put("Ball1",b.layout.zanki_x+m*20+288,b.layout.zanki_y-8);else{d.put("Ball1",b.layout.zanki_x+288,b.layout.zanki_y-8);d.putchr8("x"+q,b.layout.zanki_x+288+10,b.layout.zanki_y-12)}}if(Boolean(a.itemstack)){var B={20:"Ball1",23:"BallB1",24:"BallS1",25:"BallL1"},x=[];for(var m in a.itemstack){var w=a.itemstack[m];x.push(w)}d.putchr8("[X]",b.layout.zanki_x+132-16,b.layout.zanki_y-16);q=x.length;if(q>=18)q=18;for(var m=0;m<q;m++)if(m==0)d.put(B[x[x.length-1-m]],b.layout.zanki_x+m*20+132,b.layout.zanki_y);else d.put(B[x[x.length-1-m]],b.layout.zanki_x+m*20+136,b.layout.zanki_y+8)}q=0;if(Boolean(a.item[22]))q=a.item[22];q>0&&d.put("Key",b.layout.zanki_x+64,b.layout.zanki_y);var H=["Wand","Knife","Axe","Boom","Spear"];if(!Boolean(c.Game.player.weapon))c.Game.player.weapon=0;d.putchr8("[Z]",b.layout.zanki_x+96-16,b.layout.zanki_y-16);d.put(H[c.Game.player.weapon],b.layout.zanki_x+96,b.layout.zanki_y);d.putchr("Floor "+e.stage,b.layout.stage_x,b.layout.stage_y);d.putchr("Time:"+Math.floor((7200-e.flame)/6),b.layout.time_x,b.layout.time_y);var C=c.Game.player.hp>0?c.Game.player.hp:0,n={hp:C,mhp:c.Game.player.maxhp,br:c.Game.player.barrier};n.draw=function(a){a.beginPath();a.fillStyle=this.br?"skyblue":"limegreen";a.lineWidth=1;a.fillRect(b.layout.hp_x+1,b.layout.hp_y+1,this.hp,14);a.stroke();a.beginPath();a.strokeStyle="white";a.lineWidth=1;a.rect(b.layout.hp_x,b.layout.hp_y,this.mhp,15);a.stroke()};d.putFunc(n);var E="HP:"+C+"/"+c.Game.player.maxhp;if(c.Game.player.barrier)E="!!SHIELD!!";d.putchr8(E,b.layout.hp_x+8,b.layout.hp_y+4)}if(a.interrapt&&a.SIGNAL==1){d.putchr(" == PAUSE ==",320-50,200);d.putchr("Push <Z>key or [Space] ",320-100,220);d.putchr(" Return game.",320-50,240);d.putchr("Push <Q>key /",320-100,260);d.putchr("Save and Quit.",320-50,280)}else d.fill(320-100,200,12*24,20*5);if(c.Config.debug){var v=[];v.push("o:"+a.cnt()+"/"+a.num()+"/"+a.nonmove);v.push("f:"+e.flame);if(a.interrapt)v.push("interrapt:"+a.SIGNAL);else v.push("running:"+a.SIGNAL);for(m in a.item)v.push("item["+m+"]:"+a.item[m]);var I=0;for(m in a.total)if(m==2)I=a.total[m];var J=1;for(m in a.obCount)if(m==2)J=a.obCount[m];v.push("wx,wy:"+Math.floor(b.gs.world_x)+","+Math.floor(b.gs.world_y));v.push("play:"+Math.floor(b.sound.info())+"."+b.sound.running());for(var G in v)A.putchr8(v[G],b.layout.status_x,b.layout.status_y+8*G)}if(y){d.fill(0,480-48,640,48);d.draw();d.reset()}if(!o){d.fill(b.layout.map_x,b.layout.map_y,150,150);for(var m in l){var i=l[m];if(i.visible&&(i.type==11||i.type==12)){var n={};n.x=i.x/20;n.y=i.y/20;n.w=1;n.h=1;n.c=i.type==12?"orange":"blue";n.draw=function(a){a.beginPath();a.strokeStyle=this.c;a.lineWidth=1;a.rect(b.layout.map_x+this.x,b.layout.map_y+this.y,this.w,this.h);a.stroke()};d.putFunc(n)}}o=true}}}function gs_score_effect(b){var a=b;this.read=function(b){if(b<=a)a=b;else{var c=Math.ceil((b-a)/5);a+=c}var d=a,e=[],f="";for(i=0;i<7;i++){var c=d%10;e[7-i]=c;d=(d-c)/10}for(i in e)f=f+""+e[i];return f}}function geometoryTrance(){this.worldwidth=3e3;this.worldheight=3e3;this.stagewidth=700;this.stageheight=530;this.viewwidth=640;this.viewheight=480;this.world_x=0;this.world_y=0;var h=this.worldwidth,g=this.worldheight,d=this.stagewidth,c=this.stageheight,b=this.viewwidth,a=this.viewheight,e=this.world_x,f=this.world_y;this.viewtoWorld=function(b,c){var a={};a.x=this.world_x+b;a.y=this.world_y+c;return a};this.worldtoView=function(b,c){var a={};a.x=b-this.world_x;a.y=c-this.world_y;return a};this.viewpos=function(c,d){if(c<0)c=0;if(d<0)d=0;if(c>h-b)c=h-b;if(d>g-a)d=g-a;e=c;f=d};this.commit=function(){this.world_x=e;this.world_y=f};this.nowstagepos=function(){var e={};e.ltx=this.world_x+b/2-d/2;e.lty=this.world_y+a/2-c/2;e.rtx=this.world_x+b/2+d/2;e.rty=this.world_y+a/2-c/2;e.lbx=this.world_x+b/2-d/2;e.lby=this.world_y+a/2+c/2;e.rbx=this.world_x+b/2+d/2;e.rby=this.world_y+a/2+c/2;e.x=e.ltx;e.y=e.lty;e.w=d;e.h=c;return e};this.in_stage=function(f,g){var e=false;if(this.world_x+b/2-d/2<=f&&this.world_x+b/2+d/2>=f&&this.world_y+a/2-c/2<=g&&this.world_y+a/2+c/2>=g)e=true;return e};this.in_view=function(d,e){var c=false;if(this.world_x<=d&&this.world_x+b>=d&&this.world_y<=e&&this.world_y+a>=e)c=true;return c};this.in_view_range=function(f,g,e,d){var c=false;if(Math.abs(this.world_x+b/2-(f+e/2))<(b+e)/2&&Math.abs(this.world_y+a/2-(g+d/2))<(a+d)/2)c=true;return c};this.in_stage_range=function(f,g,e,b){var a=false;if(Math.abs(this.world_x+d/2-(f+e/2))<(d+e)/2&&Math.abs(this.world_y+c/2-(g+b/2))<(c+b)/2)a=true;return a}}function gObjectClass(){this.x;this.y;this.vx;this.vy;this.mp;this.vector;this.visible=false;this.center_x;this.center_y;this.hit_x;this.hit_y;this.mp_cnt_frm=0;this.mp_cnt_anm=0;this.type;this.chr;this.frame=0;this.scenario=[];this.status=0;this.hp;this.target=-1;this.crash=-1;this.id;this.score=0;this.triger=0;this.shot=0;this.alpha=255;this.display_size=1;this.message=[];this.normal_draw_enable=true;this.custom_draw_enable=false;this.damegeflag=false;this.damage={count:0,vector:0,dist:0,no:0};this.attack=1;this.mapCollision=false;this.mapColX=false;this.mapColY=false;this.alive=600;this.custom_draw=null;this.old_x=this.x;this.old_y=this.y;}gObjectClass.prototype.test=function(){return 0};gObjectClass.prototype.reset=function(){status=0;type=5;visible=false;mp_cnt_frm=0;mp_cnt_anm=0;scenario=[];this.normal_draw_enable=true;this.custom_draw_enable=false;damegeflag=false};gObjectClass.prototype.init=function(b,a){a.vset(5)};gObjectClass.prototype.draw=function(b,a){b.print(a.mp+"",a.x,a.y)};gObjectClass.prototype.move=function(c,a){a.x+=a.vx;a.y+=a.vy;var b=0;if(a.x<0||a.x>c.cw)b=1;if(a.y<0||a.y>c.ch)b=1;return b!=0?-1:0};gObjectClass.prototype.vset=function(a){this.vx=Math.cos(Math.PI/180*(this.vector-90))*a;this.vy=Math.sin(Math.PI/180*(this.vector-90))*a};gObjectClass.prototype.set_object=function(c,b){var a={};a.cmd="set_object";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.set_object_ex=function(d,g,h,f,c,e){var b={},a={};a.x=g;a.y=h;a.vector=f;a.sce=c;a.id=e;b.cmd="set_object_ex";b.src=d;b.dst=a;this.message.push(b)};gObjectClass.prototype.get_target=function(c,b){var a={};a.cmd="get_target";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.change_sce=function(c,b){var a={};a.cmd="change_sce";a.src=c;a.dst=b;this.frame=0;this.normal_draw_enable=true;this.custom_draw_enable=false;this.message.push(a)};gObjectClass.prototype.add_score=function(c,b){var a={};a.cmd="add_score";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.get_item=function(c,b){var a={};a.cmd="get_item";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb=function(c,b){var a={};a.cmd="bomb";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb2=function(c,b){var a={};a.cmd="bomb2";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb3=function(c,b){var a={};a.cmd="bomb3";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb4=function(c,b){var a={};a.cmd="bomb4";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.collect=function(c,b){var a={};a.cmd="collect";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.SIGNAL=function(c,b){var a={};a.cmd="SIGNAL";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.reset_combo=function(c,b){var a={};a.cmd="reset_combo";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.target_r=function(d,e){var f=this.x,g=this.y,a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=Math.atan(c/b)*(180/Math.PI);if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a};gObjectClass.prototype.target_v=function(){return!Boolean(this.target)?this.vector:this.target_r(this.target.x,this.target.y)};gObjectClass.prototype.target_rotate_r=function(c){if(!Boolean(this.target))return;var a=this.target_r(this.target.x,this.target.y),b=a;if(b>179)b=-360+b;w=this.vector;if(w>179)w=-360+w;a=b-w;if(Math.abs(a)>100){w=(this.vector+180)%360;if(w>179)w=-360+w;a=(b-w)*-1}if(Math.abs(a)<c)c=a;if(a!=0)this.vector=this.vector+a/Math.abs(a)*c;if(this.vector<0)this.vector=360+this.vector;if(this.vector>359)this.vector=this.vector-360};gObjectClass.prototype.target_d=function(a,b){var c=this.x,d=this.y;return Math.sqrt(Math.abs(a-c)*Math.abs(a-c)+Math.abs(b-d)*Math.abs(b-d))};gObjectClass.prototype.Sin=function(a){return Math.sin((a-90)*(Math.PI/180))};gObjectClass.prototype.Cos=function(a){return Math.cos((a-90)*(Math.PI/180))};function gObjectControl(k,e){var g,o,r,d=e.System.dev;delobj=0;this.score=0;this.interrapt=false;this.SIGNAL=0;this.item=[];this.combo=[];this.obCount=[];this.combomax=[];this.total=[];this.itemstack=[];this.hidan=0;this.nonmove=0;var m=0,f,p,q,c=character(),h=motionPattern(),l=scenario(),a=[],j=[];j[0]=[0,0,2,1,1,0];j[1]=[0,0,1,0,0,0];j[2]=[2,1,1,0,1,0];j[3]=[1,0,0,0,0,0];j[4]=[1,0,0,0,0,0];j[5]=[0,0,0,0,0,0];var n=true;this.reset=function(b){n=true;g=new CLinear4TreeManager;!g.init(6,0,0,3e3,3e3)&&alert("!");delobj=0;m=0;if(e.Game.cold){this.score=0;this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;this.combo=[];this.item=[];this.itemstack=[]}if(!b){this.interrapt=false;this.SIGNAL=0;a=[];e.Config.cold=true}if(e.Config.fullpower)this.item[7]=10;this.item[35]=0};this.move=function(C){f=C;var N=d.mouse_state.check_last(),M=d.key_state.check();this.nonmove=0;for(var s in a){var c=a[s],w=c.gt.in_view_range(c.x-c.hit_x/2,c.y-c.hit_y/2,c.hit_x,c.hit_y);if(!w)if(c.type==1||c.type==3)c.status=0;if(e.Game.outviewCollision)w=true;if(!w){this.nonmove++;if(c.type!=5)continue}c.mouse_state=N;c.key_state=M;if(c.move(k,c,C)!=0){c.colitem&&c.colitem.remove();c.colitem=null;delete a[s];delobj++}else if(c.type!=5)if(!c.firstRunning||(c.x!=c.old_x||c.y!=c.old_y)){c.colitem&&c.colitem.remove();if(!c.colitem){c.colitem=g.createObjectForTree();c.colitem.obj=c}g.register(c.x-c.hit_x/2,c.y-c.hit_y/2,c.x+c.hit_x/2,c.y+c.hit_y/2,c.colitem);c.crash=null;c.firstRunning=true}for(var D=0,z=c.message.length;D<z;D++){var i=c.message[D];if(i.cmd=="add_score")this.score+=i.src;if(i.cmd=="get_item"){if(Boolean(this.item[i.src]))this.item[i.src]++;else this.item[i.src]=1;var B=1;if(i.src==35)B=this.item[35];this.score+=c.score*B;if(i.src==35){var E=c.score*B+"pts.";f.add(c.x,c.y,0,20,39,E)}if(i.src==21){var E="Extend!";f.add(c.x,c.y,0,20,39,E)}if(i.src==22){var E="GetKey!";d.sound.effect(11);f.add(c.x,c.y,0,20,39,E)}var y=false;if(i.src==23||i.src==24||i.src==25)y=true;if(y){var h=i.src;this.itemstack.push(h)}}if(i.cmd=="reset_combo")for(var H in this.combo)if(i.src==H)this.combo[H]=0;if(i.cmd=="SIGNAL")if(this.interrapt){this.interrapt=false;this.SIGNAL=0}else{this.interrapt=true;this.SIGNAL=i.src;if(i.src==0)this.interrapt=false}if(i.cmd=="bomb2"||i.cmd=="bomb3")if(Boolean(this.item[7]))if(this.item[7]>0)this.item[7]--;b[i.cmd](c,i.src,i.dst)}c.message=[];c.mapCollision=false;c.mapColX=false;c.mapColY=false}if(n){for(var G=f.mapChip(),F=0,z=G.length;F<z;F++){var h=G[F];h.colitem&&h.colitem.remove();if(h.c){if(!h.colitem){h.colitem=g.createObjectForTree();h.colitem.obj=h}g.register(h.x,h.y,h.x+h.w,h.y+h.h,h.colitem)}}n=false}var v=g.getAllCollisionList();o=v.length;for(var s=0,z=v.length;s<z;s+=2){var c=v[s],t=v[s+1],A=c.type==98?0:c.type,x=t.type==98?0:t.type;if(A>=10&&x>=10)continue;if(A<10&&x<10){var O=j[A][x];if(O==0)continue;if(Math.abs(c.x-t.x)<(c.hit_x+t.hit_x)/2&&Math.abs(c.y-t.y)<(c.hit_y+t.hit_y)/2){c.status=2;t.status=2;c.crash=t;t.crash=c}}else{if(x<10){c=v[s+1];t=v[s]}var h=t,I=false,L=c.mapCollision,J=c.mapColX,K=c.mapColY;if(h.c){if(Math.abs(c.x+c.vx-(h.x+h.w/2))<(c.hit_x+h.w)/2&&Math.abs(c.y+c.vy-(h.y+h.h/2))<(c.hit_y+h.h)/2){c.mapCollision=true;I=true}if(Math.abs(c.x+c.vx-(h.x+h.w/2))<(c.hit_x+h.w)/2&&Math.abs(c.y-(h.y+h.h/2))<(c.hit_y+h.h)/2)c.mapColX=true;if(Math.abs(c.x-(h.x+h.w/2))<(c.hit_x+h.w)/2&&Math.abs(c.y+c.vy-(h.y+h.h/2))<(c.hit_y+h.h)/2)c.mapColY=true;if(I)if(h.type==12){if(c.type==98)c.doorflag=true;c.mapCollision=L;c.mapColX=J;c.mapColY=K}}}}var u=C.cmap();for(s in a){c=a[s];var l={},r={};l.x=c.x-c.hit_x/2;l.y=c.y-c.hit_y/2;r.x=c.x+c.hit_x/2;r.y=c.y+c.hit_y/2;l.mx=Math.floor((l.x-96)/32);l.my=Math.floor((l.y-96)/32);r.mx=Math.floor((r.x-96)/32);r.my=Math.floor((r.y-96)/32);if(l.mx<0||l.my<0||r.mx>u.length||r.my>u.length)c.mapCollision=true;else if(u[Math.floor((l.x-96)/32)][Math.floor((l.y-96)/32)]||u[Math.floor((l.x-96)/32)][Math.floor((r.y-96)/32)]||u[Math.floor((r.x-96)/32)][Math.floor((l.y-96)/32)]||u[Math.floor((r.x-96)/32)][Math.floor((r.y-96)/32)])c.mapCollision=true;var w=c.gt.in_stage_range(c.x-c.hit_x/2,c.y-c.hit_y/2,c.hit_x,c.hit_y);if(e.Game.outviewCollision)w=true;if(!w)continue;if(c.crash){var S=0,R=0,T=0;if(!(c.type==1||c.type==3)){var Q=true;if(Q){var P=c.hp;if(c.type==4)c.hp=0;if(c.type!=c.crash.type){if(c.crash.type!=4)c.hp-=c.crash.attack}else c.mapCollision=true;if(c.hp>0){c.status=1;if(P!=c.hp){c.damageflag=true;c.crash.damageflag=true;c.damage.vector=c.target_r(c.crash.x,c.crash.y);c.damage.dist=c.target_d(c.crash.x,c.crash.y);c.damage.no=c.crash.attack}c.crash=null}else c.type==2&&this.combo_sub(2)}}}}var y=0;for(s in a)if(a[s].type==98)y++;if(y==0){m++;if(m>90){p=this.interrapt;q=this.SIGNAL;this.interrapt=true;this.SIGNAL=4649}}};this.combo_sub=function(a){if(!Boolean(this.combo[a]))this.combo[a]=1;else this.combo[a]++;if(!Boolean(this.combomax[a]))this.combomax[a]=this.combo[a];else if(this.combo[a]>this.combomax[a])this.combomax[a]=this.combo[a];if(!Boolean(this.total[a]))this.total[a]=1;else this.total[a]++;return this.combo[a]};this.restart=function(){f.start(false);m=0;this.interrapt=p;this.SIGNAL=q};var b=[];b.set_object=function(a,b){f.add(a.x,a.y,a.vector,b,null,null,a)};b.set_object_ex=function(c,b,a){f.add(a.x,a.y,a.vector,b,a.sce,a.id,c)};b.get_target=function(b,f){var h=1,d=99999;b.target=null;for(var g in a){var c=a[g];if(c.type!=f)continue;var e=c.target_d(b.x,b.y);if(e<d){b.target=c;d=e}}};b.change_sce=function(a,b){a.init=l.init[b];a.move=l.move[b];a.custom_draw=l.draw[b];a.init(k,a)};b.add_score=function(c,a){return a};b.get_item=function(c,a){return a};b.bomb=function(){for(i in a)a[i].type==3&&a[i].change_sce(7)};b.bomb2=function(b){for(i in a){b=a[i];if(b.type==3){b.type=4;b.mp=18;b.score=8;if(b.chr!=7){var c=[18,22,26,27,29,30];b.mp=c[Math.floor(Math.random()*c.length)]}b.change_sce(30)}}};b.bomb3=function(c){for(i in a){var b=c.gt.in_view_range(a[i].x-a[i].hit_x/2,a[i].y-a[i].hit_y/2,a[i].hit_x,a[i].hit_y);if(b){if(a[i].type==2){a[i].hp-=10;if(a[i].hp<=0)a[i].status=2}a[i].type==3&&a[i].change_sce(7)}}};b.bomb4=function(d,b){for(i in a)if(a[i].chr==b)a[i].status=0};b.collect=function(b){for(i in a){b=a[i];if(b.type==4)if(!Boolean(b.collection_mode)){b.collection_mode=true;b.change_sce(30)}}};b.SIGNAL=function(){};b.reset_combo=function(){};this.draw=function(c){if(!Boolean(c))c=k;for(var f in a){var b=a[f];if(b.visible){if(b.normal_draw_enable)d.gs.in_view(b.x,b.y)&&b.draw(c,b);if(b.custom_draw_enable)Boolean(b.custom_draw)&&b.custom_draw(c,b)}}if(e.Config.debug){c.putchr8("obj:"+g.objectNum,300,16);c.putchr8("col:"+o/2,300,24);c.putchr8("f:"+r,300,32)}};this.drawPoint=function(e,g){var f=["skyblue","skyblue","red","orange","yellow","yellow"];f[98]="white";if(!Boolean(e))e=k;for(var h in a){var b=a[h];if(b.visible){if(b.type==1||b.type==3)continue;if(b.type!=98&&!g)continue;if(b.normal_draw_enable){var c={};c.x=b.x/20;c.y=b.y/20;c.w=b.hit_x/20;c.h=b.hit_y/20;c.c=f[b.type];c.draw=function(a){a.beginPath();a.strokeStyle=this.c;a.lineWidth=2;a.rect(d.layout.map_x+this.x,d.layout.map_y+this.y,this.w,this.h);a.stroke()};e.putFunc(c)}}}};this.set_s=t;function t(m,n,q,f,g,j,p){var b=new gObjectClass;b.reset();b.firstRunning=false;b.parent=p;b.scrn=k;b.graphicsLayer=d.graphics;b.mouse_state=d.mouse_state.check_last();b.gt=d.gs;b.sound=d.sound;b.gameState=e.Game;b.item=this.item;b.itemstack=this.itemstack;b.config=e.Config;b.pick=[];b.pick_enable=true;b.x=m;b.y=n;b.startx=m;b.starty=n;b.vector=q;b.chr=f;b.visible=true;b.mp=c[f].mp;b.hp=c[f].hp;b.maxhp=b.hp;b.type=c[f].type;b.center_x=c[f].center_x;b.center_y=c[f].center_y;b.hit_x=c[f].size_x;b.hit_y=c[f].size_y;if(!Boolean(j))j=c[f].id;b.id=j;b.score=c[f].score;b.status=1;if(!Boolean(g))g=c[f].senario[0];b.init=l.init[g];b.move=l.move[g];b.draw=s;b.custom_draw=l.draw[g];b.attack=3;if(b.type==1||b.type==3)b.attack=b.hp;b.init(k,b);for(var i=-1,h=0,o=a.length;h<o;h++)if(!a[h]){i=h;break}if(i==-1)a[a.length]=b;else a[i]=b;if(Boolean(this.obCount[b.type]))this.obCount[b.type]++;else this.obCount[b.type]=1;if(b.type==1&&b.type==3)b.alive=90}this.num=function(){return a.length};this.cnt=function(){var b=0;for(var c in a)b++;return b};function s(c,a){if(Boolean(h[a.mp].wait)){a.mp_cnt_frm++;if(a.mp_cnt_frm>h[a.mp].wait/2){a.mp_cnt_anm++;a.mp_cnt_frm=0;if(a.mp_cnt_anm>=h[a.mp].pattern.length)a.mp_cnt_anm=0}}try{var f=h[a.mp].pattern[a.mp_cnt_anm][0]}catch(g){a.mp_cnt_anm=0;f=h[a.mp].pattern[a.mp_cnt_anm][0]}var d=h[a.mp].pattern[a.mp_cnt_anm][1],e=h[a.mp].pattern[a.mp_cnt_anm][2];if(d==-1&&e==-1){d=0;e=a.vector}var b=a.gt.worldtoView(a.x,a.y);b.x>=0&&b.x<=c.cw&&b.y>=0&&b.y<=c.ch&&c.put(f,b.x,b.y,d,e,a.alpha,a.display_size)}}function loadingImages(){var a=["cha","aschr","bg1","bg2","bg3"],b=[];this.img=b;for(var c in a){b[a[c]]=new Image;b[a[c]].src="pict/"+a[c]+".png";b[a[c]].ready=false;b[a[c]].onload=function(){this.ready=true}}this.readyStateCheck=function(){var c=[];for(var d in a)c[a[d]]=b[a[d]].ready;return c}}function inputControl(){var a,b,e,f,g=0,h=0,d,l=-1,k,i=0,j="NaN",n=0,m=0,c=document;this.o_Left=c.offsetLeft;this.o_Top=c.offsetTop;c.onmousemove=t;function t(c){x=c.clientX;y=c.clientY;if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y}c.onmousedown=function(a){d=a.button};c.onmouseup=function(){d=-1};c.onmousewheel=function(a){k=a.wheelDelta};c.addEventListener("DOMMouseScroll",s,false);function s(a){k=a.detail}c.ontouchmove=function(c){c.preventDefault();if(c.touches.length>0)for(var d=0;d<c.touches.length;d++){var e=c.touches[d];x=e.pageX;y=e.pageY}if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y};c.ontouchstart=function(a){a.preventDefault();x=a.pageX;y=a.pageY;d=0};c.ontouchend=function(a){a.preventDefault();d=-1};this.check=function(){if(m>0){m++;g=a;h=b;d=0;i=0}a=e;b=f;e=g;f=h;l=d;if(d!=0)d=-1;i=k;k=0;j=o(a,b,e,f);n=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));if(a-e==0&&b-f==0)j="NaN";var c={};c.x=g;c.y=h;c.button=l;c.wheel=i;c.deg=j;c.distance=n;return c};this.check_last=function(){var a={};a.x=g;a.y=h;a.button=l;a.wheel=i;a.deg=j;a.distance=n;return a};this.input_pause=function(a){if(wait_count>30)a=30;if(wait_count<0)a=0;m=a};this.draw=function(){var c=canvas.width,d=canvas.height,g=j;context.fillStyle="black";context.fillRect(0,0,canvas.width,canvas.height);context.fillStyle="white";context.fillRect(5,5,canvas.width-10,canvas.height-10);context.fillStyle="green";context.fillText(e+" "+f+" "+c+" "+d+" "+g,32,32);var h="OOO";switch(l){case 0:h="@OO";break;case 1:h="O@O";break;case 2:h="OO@"}context.fillText("b:"+h+" w:"+i,32,232);context.beginPath();context.moveTo(c/2,d/2);context.lineTo(e-a+c/2,f-b+d/2);context.strokeStyle="black";context.stroke();context.beginPath();context.arc(c/2,d/2,5,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();r=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));context.beginPath();context.arc(c/2,d/2,r,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();var k=0,m=0;if(g!="NaN"){g=q(g-90);k=Math.cos(g)*50;m=Math.sin(g)*50}context.beginPath();context.arc(c/2+k,d/2+m,20,0,2*Math.PI,true);context.fillStyle="orange";context.fill();var n=context.getImageData(0,0,canvas.width,canvas.height)};function o(f,g,d,e){var a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=p(Math.atan(c/b));if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a}function q(a){return a*(Math.PI/180)}function p(a){return a*(180/Math.PI)}}function inputKeyboard(){var a=[];window.onblur=function(){a=[]};window.onkeydown=function(b){a[b.keyCode]=true};window.onkeyup=function(b){a[b.keyCode]=false};this.check=function(){return a};this.state=function(){st="";for(var b in a)st+="["+b+"]"+(a[b]?"*":".");return st}}function sce_item_direct_homing(){this.init=function(b,a){a.vector=0;a.vset(16);a.display_size=1};this.move=function(c,a){switch(a.frame){case 1:a.get_target(98);break;case 3:a.get_target(98);a.vector=a.target_v();case 4:if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);b=b<15?b+1:16;a.vset(b)}case 8:a.frame=2}a.frame++;return a.sc_move()}}function sce_item_near_homing(){this.init=function(b,a){a.vset(0);a.get_target(98)};this.move=function(c,a){!Boolean(this.target)&&a.get_target(98);if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);if(b<40){a.vector=a.target_v();a.vset(4)}}return a.sc_move()}}function sce_item_movingstop(){this.init=function(b,a){a.vset(1)};this.move=function(b,a){a.frame>100&&a.vset(0);a.frame++;return a.sc_move()}}function gameLayout(){this.score_x=640-180;this.score_y=16;this.hiscore_x=640-180;this.hiscore_y=0;this.status_x=640-120;this.status_y=32;this.combo_x=0;this.combo_y=32;this.itemchain_x=0;this.itemchain_y=24;this.zanki_x=20;this.zanki_y=480-16;this.time_x=640-12*10;this.time_y=479-16-16;this.stage_x=640-12*10;this.stage_y=479-32-16;this.map_x=0;this.map_y=0;this.hp_x=168;this.hp_y=480-32}function main_r(){var n=60,i=Date.now(),e=0;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){e++;if(e>n){e=1;i=Date.now()}var b=i+Math.round(e*(1e3/n)),d=Date.now(),a=b-d;if(a<=0)a=1;setTimeout(c,a)}}();gObjectClass.prototype.sc_move=ocl_scMove;var b=new stateControl,h=document.getElementById("debug_cb");h.checked=b.Config.debug;var a=b.System.dev,c=a.graphics[1],d=a.graphics[0],u=a.graphics[3],t=a.graphics[2],k=new sceneControl(b),s=a.mouse_state,l=a.key_state,m=new Number(0),j=false,o=false,p=Date.now(),r=false,f=new bench;g();function g(){f.start();if(h.checked){b.Config.debug=true;a.vkey_state.enable=true}else{b.Config.debug=false;a.vkey_state.enable=false}if(!j){waittime=16;o=q()}if(o){j=true;var e=[],d=s.check(),u=l.check();if(b.Config.debug){e.push("mousemove x:"+d.x+" y:"+d.y+" t:"+m);e.push("b:"+d.button+" w:"+d.wheel);e.push("key:"+l.state())}if(d.wheel!=0)m+=d.wheel>0?1:-1;var v=d.x,w=d.y,t=false;if(d.button==0)t=true;d.button==1;if(b.Config.debug){for(var i=0,p=a.graphics.length;i<p;i++)e.push("work"+i+":"+a.graphics[i].count());for(var n in e)c.putchr8(e[n],0,424-8*n);a.vkey_state.draw(c)}k.step();if(!r){c.clear();c.draw();c.reset();k.draw()}a.gs.commit()}f.end();b.Config.debug&&f.draw(c);requestAnimationFrame(g)}function q(){var c=[];c.push("Load_check.");c.push("");var f=a.images.readyStateCheck(),i=20,g=0;for(var e in f){c.push(e+"_"+(f[e]?"Ready":"."));g+=f[e]?1:0}c.push("sndt_"+a.sound.loadCheck());c.push("");var h=Math.floor((Date.now()-p)/1e3);c.push("count :"+h+".");for(var e in c){d.print(c[e],0,i);i+=20}d.clear("black");d.draw();d.reset();if(g>=5)if(a.sound.loadCheck()=="Ready"){b.Config.use_audio=true;return true}else if(h>=10){b.Config.use_audio=false;return true}else return false;else return false}}function mapSceControl(){var c,e,d,a=-5;this.enable=true;this.counter_runnning=true;this.flame=a;this.stage=1;this.keyuse=true;var b,g,k,i,f,j,l;this.cmap=function(){return l};h(this.stage,this.keyuse);function h(a,c){b=new Stage1(a,c);g=b.scenario();k=b.bgImage(a);i=b.bgLayout();f=b.initial(a);j=b.bgPtn();l=b.colmap}this.change=function(a){this.stage=a;c=[];h(a,this.keyuse);e=g;d=f};this.bgImage=function(){return k};this.bgPtn=function(){return j};this.mapChip=function(){return i};this.init=function(){this.stage=1;c=[];h(this.stage,this.keyuse);e=g;d=f};this.reset=function(){this.enable=true;this.counter_runnning=true;a=-5;this.start(false);this.start(true)};this.counterReset=function(){a=0};this.step=function(g){if(!this.enable)return;if(this.counter_runnning)a++;a=a>7200?7200:a;for(var f in e){var b=e[f];if(b.count<a)continue;if(b.count==a){if(b.x<0&&b.y<0){a=0;break}this.add(b.x,b.y,b.r,b.ch,b.sc)}if(b.count>a)break}for(f in c){var d=c[f];g.set_s(d.x,d.y,d.r,d.ch,d.sce,d.id,d.parent)}c=[];this.flame=a};this.add=function(g,h,f,e,d,b,a){if(!this.enable)return;ev={};ev.x=g;ev.y=h;ev.r=f;ev.ch=e;ev.sce=d;if(Boolean(b))ev.id=b;if(Boolean(a))ev.parent=a;c.push(ev)};this.start=function(b){for(var c in d){var a=d[c];b==a.s&&this.add(a.x,a.y,a.r,a.ch,a.sc)}}}function mapScenro(){var d=[[-1,240,608,0,8,0],[-1,208,608,0,17,10],[-1,272,608,0,17,10],[-1,240,240,0,28,18],[-1,320,320,0,29,19],[50,240,0,180,11,1],[100,440,140,225,10,1],[100,40,140,135,9,1],[120,440,140,225,10,1],[120,40,140,135,9,1],[140,440,140,225,10,1],[140,40,140,135,9,1],[160,440,140,225,10,1],[160,40,140,135,9,1],[180,440,140,225,10,1],[180,40,140,135,9,1],[250,140,0,180,2,1],[250,340,0,180,3,1],[280,140,0,180,2,1],[280,340,0,180,3,1],[310,140,0,180,2,1],[310,340,0,180,3,1],[340,140,0,180,2,1],[340,340,0,180,3,1],[390,464,200,0,"effect_warnning_mark",1],[440,479,200,270,15,1],[450,16,220,0,"effect_warnning_mark",1],[500,1,220,90,15,1],[700,240,0,180,23,14],[900,120,0,180,19,1],[900,360,0,180,19,1],[1120,480,0,180,37,2],[1500,240,40,180,34,14],[1600,480,0,180,53,2],[1700,480,0,180,54,2],[1800,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1]*.875;a.y=b[2]*.75;a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function mapBgImage(){var a=new Image;a.src="pict/sky.jpg";return a}function mapBgLayout(){var d=[[0,0,0],[0,0,480],[0,0,960]],c=[];for(var e in d){var b=d[e],a={};a.no=b[0];a.x=b[1];a.y=b[2];c.push(a)}return c}function mapInitial(){}function sce_message_billboard(b,a){this.init=function(d,c){c.vset(0);c.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;c.p_count=0;c.mes_col=0;c.mes_line=0;c.p_wait=a;c.p_endflag=false;c.p_st=b;c.x=c.gt.world_x+1;c.y=c.gt.world_y+1};this.move=function(b,a){a.x=a.gt.world_x+1;a.y=a.gt.world_y+1;a.p_count--;if(a.p_count<=0){if(a.p_endflag)a.status=0;a.mes_col++;if(a.mes_col>a.p_st[a.mes_line].length){a.mes_col=0;a.mes_line++;if(a.mes_line>a.p_st.length-1){a.mes_line=a.p_st.length-1;a.mes_col=a.p_st[a.mes_line].length;a.p_endflag=true}}a.p_count=a.p_wait+(a.p_endflag?40:0)}return a.sc_move()};this.draw=function(c,b){for(var a=0;a<=b.mes_line;a++)if(a<b.mes_line)c.putchr(b.p_st[a],95,150+16*a);else{var d=b.p_st[a].slice(0,b.mes_col+1);c.putchr(d,95,150+16*a)}}}function sce_message_small(a){this.init=function(b,a){a.vset(1);a.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;a.w_st=a.id;a.x-=a.w_st.length*8/2;a.display_size=1};this.move=function(b,a){if(a.frame>50)a.status=0;a.frame++;return a.sc_move()};this.draw=function(d,b){var c=b.gt.worldtoView(b.x,b.y);d.putchr8c(b.w_st,c.x,c.y,a,b.display_size)}}function sce_message_normal(a){this.init=function(c,b){b.vset(0);b.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;b.w_st=b.id;b.x-=b.w_st.length*12/2;b.wait=a;b.display_size=1};this.move=function(c,b){if(b.frame>a)b.status=0;b.display_size=1+b.frame/60;b.frame++;return b.sc_move()};this.draw=function(c,a){var b=a.gt.worldtoView(a.x,a.y);c.putchr(a.w_st,b.x,b.y,a.display_size)}}function sce_message_bosstriger(){this.init=function(b,a){a.vset(0);a.type=5;this.normal_draw_enable=false;a.x=a.gt.world_x+1;a.y=a.gt.world_y+1};this.move=function(b,a){a.x=a.gt.world_x+1;a.y=a.gt.world_y+1;a.SIGNAL(6055);a.status=0;return a.sc_move()}}function motionPattern(){var b=[],a=0;b[a]={};b[a].wait=0;b[a].pattern=[["Space",0,0]];a=1;b[a]={};b[a].wait=18;b[a].pattern=[["Mayura1",0,0],["Mayura2",0,0],["Mayura3",0,0],["Mayura4",0,0]];a=2;b[a]={};b[a].wait=18;b[a].pattern=[["Mayura1",2,0],["Mayura2",2,0],["Mayura3",2,0],["Mayura4",2,0]];a=4;b[a]={};b[a].wait=18;b[a].pattern=[["Unyuu1",0,0],["Unyuu2",0,0]];a=5;b[a]={};b[a].wait=18;b[a].pattern=[["Unyuu1",2,0],["Unyuu2",2,0]];a=7;b[a]={};b[a].wait=18;b[a].pattern=[["Fire1",0,0],["Fire2",0,0]];a=12;b[a]={};b[a].wait=10;b[a].pattern=[["Down5",0,0],["Down4",0,0],["Down3",0,0],["Down2",0,0],["Down1",0,0],["Down2",0,0],["Down3",0,0],["Down4",0,0],["Down5",0,0]];a=11;b[a]={};b[a].wait=15;b[a].pattern=[["Zap1",0,0],["Zap2",0,0],["Zap3",0,0],["Zap4",0,0]];a=26;b[a]={};b[a].wait=10;b[a].pattern=[["Ball1",0,0],["Ball2",0,0],["Ball3",0,0],["Ball2",0,0]];a=27;b[a]={};b[a].pattern=[["Key",0,0]];a=28;b[a]={};b[a].wait=10;b[a].pattern=[["BallB1",0,0],["BallB2",0,0],["BallB3",0,0],["BallB2",0,0]];a=29;b[a]={};b[a].wait=10;b[a].pattern=[["BallS1",0,0],["BallS2",0,0],["BallS3",0,0],["BallS2",0,0]];a=30;b[a]={};b[a].wait=10;b[a].pattern=[["BallL1",0,0],["BallL2",0,0],["BallL3",0,0],["BallL2",0,0]];a=31;b[a]={};b[a].pattern=[["Unyuu3",0,0]];a=32;b[a]={};b[a].wait=5;b[a].pattern=[["Coin1",0,0],["Coin2",0,0],["Coin3",0,0],["Coin4",0,0],["Coin3",2,0],["Coin2",2,0],["Coin1",2,0]];a=15;b[a]={};b[a].pattern=[["Knife",-1,-1]];a=33;b[a]={};b[a].pattern=[["Lamp",0,0]];a=34;b[a]={};b[a].pattern=[["Map",0,0]];a=35;b[a]={};b[a].pattern=[["Spear",-1,-1]];a=36;b[a]={};b[a].pattern=[["Boom",-1,-1]];a=37;b[a]={};b[a].pattern=[["Axe",-1,-1]];a=38;b[a]={};b[a].pattern=[["Wand",-1,-1]];a=39;b[a]={};b[a].pattern=[["TrBox",0,0]];return b}function ocl_scMove(){var a=0;if(this.status==2)switch(this.type){case 1:case 3:this.sound.effect(12);this.change_sce("effect_hit");break;case 2:this.display_size*=2;this.change_sce(7);this.sound.effect(8);if(this.chr==14)this.set_object_ex(22,this.x,this.y,Math.floor(Math.random()*360),36);else for(var b=0,c=Math.floor(Math.random()*3)+1;b<c;b++)this.set_object_ex(35,this.x,this.y,Math.floor(Math.random()*360),"item_movingstop");for(var d=false,b=0,c=this.pick.length;b<c;b++){var e=this.pick[b];this.set_object_ex(e,this.x,this.y,Math.floor(Math.random()*360),"item_movingstop");if(e!=35)d=true}d&&this.set_object_ex(40,this.x,this.y,0,"enemy_trbox");this.add_score(this.score);break;case 4:if(Boolean(this.crash))if(this.crash.pick_enable){this.change_sce(6);if(this.crash.type==2)this.crash.pick.push(this.chr);else{this.chr!=21&&this.chr!=22&&this.sound.effect(9);this.get_item(this.chr)}}}if(this.damageflag){this.damage.count=15;var f=this.gt.in_view_range(this.x-this.hit_x/2,this.y-this.hit_y/2,this.hit_x,this.hit_y);f&&this.sound.effect(12)}var g=this.vector,h=this.vx,i=this.vy;if(this.damage.count>0){this.damage.count--;this.vector=(this.damage.vector+180)%360;this.vset(this.damage.dist/10)}if(this.status==0)a=1;if(this.mapCollision!=true){this.colcount=0;this.old_x=this.x;this.old_y=this.y;this.x+=this.vx;this.y+=this.vy;this.vector=g;this.vx=h;this.vy=i}else{if(this.colcount==0){this.x=this.old_x;this.y=this.old_y;switch(this.type){case 1:case 3:a=1;break;default:if(this.mapColX){this.vx*=-1;this.vector=360-this.vector;if(this.vector<0)this.vector=180+(180+this.vector)}if(this.mapColY){this.vy*=-1;this.vector=180+this.vector;if(this.vector>360)this.vector=360+180-this.vector;this.vector=this.vector%360}if(!this.mapColX&&!this.mapColY){this.vx*=-1;this.vy*=-1;this.vector=(this.vector+180)%360}}}this.colcount++;if(this.colcount>30){this.vector=this.target_r(this.startx,this.starty);this.vset(1);this.x+=this.vx;this.y+=this.vy}}if(this.x<0||this.x>this.gt.ww)a=2;if(this.y<0||this.y>this.gt.wh)a=2;if(a!=0){a==2&&this.reset_combo(this.type);return-1}if(this.colcount>60)if(Boolean(this.crash))this.crash.mapCollision=false;else this.colcount=Math.floor(Math.random()*60);this.damageflag=false;return 0}function sce_player(){this.init=function(b,a){a.triger=10;a.shot=0;a.trigerSub=10;a.shotSub=0;a.custom_draw_enable=true;a.gt.viewpos(a.x-a.gt.viewwidth/2,a.y-a.gt.viewheight/2);a.old_x=a.x;a.old_y=a.y;a.hp=a.gameState.player.hp;a.maxhp=a.gameState.player.maxhp;a.barrier=a.gameState.player.barrier;a.before_hp=a.hp;a.before_weapon=a.gameState.player.weapon;a.doorflag=false;a.gameState.player.zanki>=Math.floor(a.gameState.nowstage/5)+2&&a.bomb4(21)};this.draw=a;this.move=function(A,a){a.frame++;if(a.frame<=300){a.hp=a.maxhp;a.attack=10;a.gameState.player.barrier=true}if(a.frame==301){a.hp=a.before_hp;a.attack=1;a.gameState.player.hp=a.before_hp;a.gameState.player.barrier=false}a.vset(0);var u=6,h=false,e=false,f=false,d=false;if(Boolean(a.key_state[37]))if(a.key_state[37]){f=true;a.vector=270}if(Boolean(a.key_state[38]))if(a.key_state[38]){h=true;a.vector=0}if(Boolean(a.key_state[39]))if(a.key_state[39]){d=true;a.vector=90}if(Boolean(a.key_state[40]))if(a.key_state[40]){e=true;a.vector=180}if(h&&f)a.vector=360-45;if(h&&d)a.vector=0+45;if(e&&f)a.vector=180+45;if(e&&d)a.vector=180-45;(h||e||f||d)&&a.vset(u);if(a.vector>180)a.mp=2;else a.mp=1;var B=a.vector,g=0,t=0,k=0;for(var b in a.item){if(b==20)g=a.item[b];if(b==21)t=a.item[b];if(b==22)k=a.item[b]}var j=false;if(Boolean(a.key_state[90]))if(a.key_state[90])j=true;if(Boolean(a.key_state[32]))if(a.key_state[32])j=true;var i=false;if(Boolean(a.key_state[88]))if(a.key_state[88])i=true;if(Boolean(a.key_state[17]))if(a.key_state[17])i=true;var p=false;if(Boolean(a.key_state[67]))if(a.key_state[67])p=true;var o=false;if(Boolean(a.key_state[27]))if(a.key_state[27])o=true;a.triger--;if(a.triger<=0&&!j){a.shot=0;a.triger=5}a.trigerSub--;if(a.trigerSub<=0&&!i){a.shotSub=0;a.trigerSub=5}if(j)if(a.shot==0){a.shot=1;a.sound.effect(7);a.triger=15;switch(a.gameState.player.weapon){case 0:a.set_object(39);if(g>0||a.config.shotfree){a.set_object(6);a.item[20]--;if(a.item[20]<0)a.item[20]=0;a.triger=30}break;case 1:a.set_object(10);break;case 2:a.set_object(38);break;case 3:a.set_object(37);break;case 4:a.set_object(36);break;default:a.set_object(39)}}if(i)if(a.shotSub==0){a.shotSub=1;if(a.itemstack.length>0){var c=a.itemstack.pop();if(c==23){a.sound.effect(13);a.bomb3();a.set_object_ex(6,a.x,a.y,0,47);a.item[23]--}if(c==24){a.sound.effect(10);a.before_hp=a.hp;a.frame=0;a.item[24]--}if(c==25){a.sound.effect(10);if(a.frame<=180){a.before_hp+=3;a.maxhp++;if(a.before_hp>a.maxhp)a.before_hp=a.maxhp;a.gameState.player.hp=a.before_hp}else{a.hp+=3;a.maxhp++;if(a.hp>a.maxhp)a.hp=a.maxhp;a.gameState.player.hp=a.hp}a.gameState.player.maxhp=a.maxhp;a.item[25]--;a.set_object_ex(20,a.x,a.y,0,43,"+3")}a.trigerSub=30}}if(p)if(a.shotSub==0){a.shotSub=1;if(a.itemstack.length>0){var c=a.itemstack.pop();a.item[c]--;this.set_object_ex(c,a.x+a.Cos(a.vector)*40,a.y+a.Sin(a.vector)*40,a.vector,"common_vset0")}a.trigerSub=30}if(o)if(a.shot==0){a.shot=1;a.SIGNAL(1);a.triger=30}if(a.gameState.player.weapon!=a.before_weapon){var z=[15,16,17,19,18],c=z[a.before_weapon],q=(a.vector+180)%360;this.set_object_ex(c,a.x+a.Cos(q)*40,a.y+a.Sin(q)*40,0,"common_vset0");a.before_weapon=a.gameState.player.weapon}if(a.damageflag){a.frame>180&&a.set_object_ex(20,a.x,a.y,0,42,"-"+a.damage.no);a.set_object_ex(6,a.x,a.y,a.vector,"effect_hit");a.damage.count=15;a.gameState.player.hp=a.hp}var v=this.vector,w=this.vx,x=this.vy;if(a.damage.count>0){a.damage.count--;a.vector=(a.damage.vector+180)%360;a.vset(this.damage.dist/10)}a.damageflag=false;if(a.mapCollision!=true){a.old_x=a.x;a.old_y=a.y;a.x+=a.vx;a.y+=a.vy}else{a.x=a.old_x;a.y=a.old_y}var c=a.gt.worldtoView(a.x,a.y),l=0,m=0;if(c.x<240&&a.vx<0)l=1;if(c.x>a.gt.viewwidth-240&&a.vx>0)l=1;if(c.y<240&&a.vy<0)m=1;if(c.y>a.gt.viewheight-240&&a.vy>0)m=1;a.gt.viewpos(a.gt.world_x+a.vx*l,a.gt.world_y+a.vy*m);a.vector=v;a.vx=w;a.vy=x;if(a.doorflag){if(k>0){a.item[22]=0;a.gameState.player.hp=a.hp;a.SIGNAL(835)}a.doorflag=false}var r=0;if(a.status==2){if(a.config.itemreset){var y=g>10?10:g;for(b=1;b<=y;b++)this.set_object_ex(20,a.x,a.y,Math.floor(Math.random()*360),38);var n=a.itemstack.length;if(n>10)n=10;for(b=0;b<n;b++){var s=a.itemstack.pop();this.set_object_ex(s,a.x,a.y,Math.floor(Math.random()*360),38)}k>0&&this.set_object_ex(22,a.x,a.y,Math.floor(Math.random()*360),"common_vset0")}a.display_size=2.5;a.change_sce(7);a.sound.change(5);a.sound.play(5);a.bomb4(33)}if(a.status==0)r=1;return r};function a(e,a){var d=false,b={};if(a.frame<=300){var c=a.gt.worldtoView(a.x,a.y);b.x=c.x;b.y=c.y;b.r=30+a.frame%5;b.c="rgb("+255+","+(255-a.frame)+","+(255-a.frame)+")";b.draw=function(a){a.beginPath();a.strokeStyle=this.c;a.lineWidth="1";a.arc(this.x,this.y,this.r,0,2*Math.PI,false);a.stroke()};e.putFunc(b);d=true}}}function sce_player_start(){this.init=function(b,a){a.type=98;a.vector=0;a.vset(8);a.gt.viewpos(a.x-210,a.y-240)};this.move=function(b,a){a.hp=10;switch(a.frame){case 30:a.vector=180;a.vset(4);break;case 58:case 60:a.vset(3);a.hp=10;a.change_sce(1)}a.frame++;return a.sc_move()}}function sce_pl_bullet_homing(){this.init=function(b,a){a.vector=a.vector>180?a.vector+80:a.vector-80;a.vset(16);a.get_target(2)};this.move=function(b,a){switch(a.frame){case 2:a.get_target(2);a.target_rotate_r(15);a.vset(16);break;case 5:a.frame=1}a.frame++;return a.sc_move()};this.draw=function(c,b){if(!Boolean(b.target))return;var a={};a.sx=b.x;a.sy=b.y;a.ex=b.target.x;a.ey=b.target.y;a.draw=function(a){a.beginPath();a.moveTo(this.sx,this.sy);a.lineTo(this.ex,this.ey);a.strokeStyle="red";a.stroke()};c.putFunc(a)}}function sce_pl_bullet_homing2(){this.init=function(b,a){a.vector=a.vector>180?a.vector-5:a.vector+5;a.vset(4);a.get_target(2);a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 2:a.frame>90&&a.get_target(2);a.target_rotate_r(15+(a.frame<20?15:0));a.vset(4+(a.frame>20?4:0)+(a.frame>25?8:0));break;case 4:a.w_cnt=1}a.w_cnt++;a.frame++;return a.sc_move()}}function sce_pl_bullet_subshot(a){this.init=function(c,b){b.vset(a);b.mp=7;b.alpha=128};this.move=function(b,a){if(a.frame>12)a.status=0;a.frame++;return a.sc_move()}}function sce_pl_bullet_laser_head(){this.init=function(b,a){a.vector=0;a.y=a.y-20;a.vset(28);a.get_target(2);a.alpha=64;a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 2:a.get_target(2);a.target_rotate_r(3);a.vset(28);break;case 4:a.w_cnt=1}a.set_object_ex(23,a.x,a.y,a.vector,46);a.w_cnt++;a.frame++;return a.sc_move()}}function sce_pl_bullet_laser_tail(){this.init=function(b,a){a.vset(0)};this.move=function(b,a){if(a.frame>10)a.status=0;a.frame++;return a.sc_move()}}function scenario(){for(var d={},a=[],c=[],b=[],e=0;e<=37;e++){a[e]=function(b,a){a.vset(5)};b[e]=function(b,a){return a.sc_move()}}w=new sce_player;a[1]=w.init;b[1]=w.move;c[1]=w.draw;a.player=w.init;b.player=w.move;c.player=w.draw;w=new sce_ememy_move_n(90,-90);a[2]=w.init;b[2]=w.move;a.ememy_move_n_r=w.init;b.ememy_move_n_r=w.move;w=new sce_ememy_move_n(90,-90);a[3]=w.init;b[3]=w.move;a.ememy_move_n_l=w.init;b.ememy_move_n_l=w.move;w=new sce_common_vset(4);a[4]=w.init;b[4]=w.move;a.common_vset4=w.init;b.common_vset4=w.move;w=new sce_effect_vanish;a[6]=w.init;b[6]=w.move;a.effect_vanish=w.init;b.effect_vanish=w.move;w=new sce_effect_bomb;a[7]=w.init;b[7]=w.move;a.effect_bomb=w.init;b.effect_bomb=w.move;w=new sce_player_start;a[8]=w.init;b[8]=w.move;a.player_start=w.init;b.player_start=w.move;w=new sce_ememy_turn(-30);a[9]=w.init;b[9]=w.move;a.ememy_turn_r=w.init;b.ememy_turn_r=w.move;w=new sce_ememy_turn(30);a[10]=w.init;b[10]=w.move;a.ememy_turn_l=w.init;b.ememy_turn_l=w.move;w=new sce_ememy_change_s;a[11]=w.init;b[11]=w.move;a.ememy_change_s=w.init;b.ememy_change_s=w.move;w=new sce_common_vset(6);a[12]=w.init;b[12]=w.move;a.common_vset6=w.init;b.common_vset6=w.move;w=new sce_common_vset(16);a[13]=w.init;b[13]=w.move;a.common_vset16=w.init;b.common_vset16=w.move;w=new sce_en_bullet_homing;a[14]=w.init;b[14]=w.move;a.en_bullet_homing=w.init;b.en_bullet_homing=w.move;w=new sce_ememy_moveshot;a[15]=w.init;b[15]=w.move;a.ememy_moveshot_1=w.init;b.ememy_moveshot_1=w.move;w=new sce_friend_rotate;a[16]=w.init;b[16]=w.move;a.friend_rotate=w.init;b.friend_rotate=w.move;w=new sce_friend_start;a[17]=w.init;b[17]=w.move;a.friend_start=w.init;b.friend_start=w.move;w=new sce_en_bullet_random;a[18]=w.init;b[18]=w.move;a.en_bullet_random=w.init;b.en_bullet_random=w.move;w=new sce_ememy_randomshot;a[19]=w.init;b[19]=w.move;a.sce_ememy_randomshot=w.init;b.sce_ememy_randomshot=w.move;w=new sce_pl_bullet_homing2;a[20]=w.init;b[20]=w.move;a.pl_bullet_homing=w.init;b.pl_bullet_homing=w.move;w=new sce_friend_sidearm;a[21]=w.init;b[21]=w.move;a.friend_sidearm=w.init;b.friend_sidearm=w.move;w=new sce_common_vset(0);a[22]=w.init;b[22]=w.move;a.common_vset0=w.init;b.common_vset0=w.move;w=new sce_boss_0;a[23]=w.init;b[23]=w.move;c[23]=w.draw;a.boss_0=w.init;b.boss_0=w.move;c.boss_0=w.draw;w=new sce_common_vset(2);a[24]=w.init;b[24]=w.move;a.common_vset2=w.init;b.common_vset2=w.move;w=new sce_common_vset(8);a[25]=w.init;b[25]=w.move;a.common_vset8=w.init;b.common_vset8=w.move;w=new sce_common_vset(10);a[26]=w.init;b[26]=w.move;a.common_vset10=w.init;b.common_vset10=w.move;w=new sce_effect_billboard(0);a[28]=w.init;b[28]=w.move;a.effect_billboard_v=w.init;b.effect_billboard_v=w.move;w=new sce_effect_billboard(90);a[29]=w.init;b[29]=w.move;a.effect_billboard_h=w.init;b.effect_billboard_h=w.move;w=new sce_item_direct_homing;a[30]=w.init;b[30]=w.move;a.item_direct_homing=w.init;b.item_direct_homing=w.move;w=new sce_en_bullet_accel;a[33]=w.init;b[33]=w.move;a.en_bullet_accel=w.init;b.en_bullet_accel=w.move;w=new sce_boss_1;a[34]=w.init;b[34]=w.move;c[34]=w.draw;a.boss_1=w.init;b.boss_1=w.move;c.boss_1=w.draw;w=new sce_item_near_homing;a[36]=w.init;b[36]=w.move;a.item_near_homing=w.init;b.item_near_homing=w.move;w=new sce_message_billboard(["Event Message Test","= WARNING MESSAGE =","!! Message Test !!!","!!! Message Test !!","= WARNING MESSAGE ="],3);a[37]=w.init;b[37]=w.move;c[37]=w.draw;a.message_billboard_wm=w.init;b.message_billboard_wm=w.move;c.message_billboard_wm=w.draw;w=new sce_item_movingstop;a[38]=w.init;b[38]=w.move;a.item_movingstop=w.init;b.item_movingstop=w.move;w=new sce_message_small(0);a[39]=w.init;b[39]=w.move;c[39]=w.draw;a.message_small_w=w.init;b.message_small_w=w.move;c.message_small_w=w.draw;w=new sce_message_small(1);a[42]=w.init;b[42]=w.move;c[42]=w.draw;a.message_small_r=w.init;b.message_small_r=w.move;c.message_small_r=w.draw;w=new sce_message_small(2);a[43]=w.init;b[43]=w.move;c[43]=w.draw;a.message_small_g=w.init;b.message_small_g=w.move;c.message_small_g=w.draw;w=new sce_message_small(3);a[44]=w.init;b[44]=w.move;c[44]=w.draw;a.message_small_b=w.init;b.message_small_b=w.move;c.message_small_b=w.draw;w=new sce_pl_bullet_subshot(8);a[40]=w.init;b[40]=w.move;a.pl_bullet_subshot_pl=w.init;b.pl_bullet_subshot_pl=w.move;w=new sce_pl_bullet_subshot(1);a[41]=w.init;b[41]=w.move;a.pl_bullet_subshot_op=w.init;b.pl_bullet_subshot_op=w.move;w=new sce_pl_bullet_laser_head;a[45]=w.init;b[45]=w.move;a.pl_bullet_laser_head=w.init;b.pl_bullet_laser_head=w.move;w=new sce_pl_bullet_laser_tail;a[46]=w.init;b[46]=w.move;a.pl_bullet_laser_tail=w.init;b.pl_bullet_laser_tail=w.move;w=new sce_effect_bombcircle("rgba(255, 64, 64, 0.7)");a[47]=w.init;b[47]=w.move;c[47]=w.draw;a.effect_bombcircle_r=w.init;b.effect_bombcircle_r=w.move;c.effect_bombcircle_r=w.draw;w=new sce_effect_bombcircle("rgba(255, 255, 255, 0.7)");a[48]=w.init;b[48]=w.move;c[48]=w.draw;a.effect_bombcircle_w=w.init;b.effect_bombcircle_w=w.move;c.effect_bombcircle_w=w.draw;w=new sce_en_bullet_hominglaser;a[49]=w.init;b[49]=w.move;a.en_bullet_hominglaser=w.init;b.en_bullet_hominglaser=w.move;w=new sce_boss_2;a[50]=w.init;b[50]=w.move;c[50]=w.draw;a.boss_2=w.init;b.boss_2=w.move;c.boss_2=w.draw;w=new sce_en_bullet_infolaser;a[51]=w.init;b[51]=w.move;c[51]=w.draw;a.en_bullet_infolaser=w.init;b.en_bullet_infolaser=w.move;c.en_bullet_infolaser=w.draw;w=new sce_en_bullet_turn;a[52]=w.init;b[52]=w.move;a.en_bullet_turn=w.init;b.en_bullet_turn=w.move;w=new sce_message_billboard(["Event Message Test","= Mission Complate.\u3000="],0);a[53]=w.init;b[53]=w.move;c[53]=w.draw;a.message_billboard_cp=w.init;b.message_billboard_cp=w.move;c.message_billboard_cp=w.draw;w=new sce_common_signal(835);a[54]=w.init;b[54]=w.move;a.common_signal_result=w.init;b.common_signal_result=w.move;w=new sce_effect_warnning_mark;a[55]=w.init;b[55]=w.move;a.effect_warnning_mark=w.init;b.effect_warnning_mark=w.move;w=new sce_en_bullet_laser_tail;a[56]=w.init;b[56]=w.move;a.en_bullet_laser_tail=w.init;b.en_bullet_laser_tail=w.move;w=new sce_message_normal(60);a[57]=w.init;b[57]=w.move;c[57]=w.draw;a.message_normal_60=w.init;b.message_normal_60=w.move;c.message_normal_60=w.draw;w=new sce_message_bosstriger;a[58]=w.init;b[58]=w.move;a.message_bosstriger=w.init;b.message_bosstriger=w.move;w=new sce_effect_hit;a.effect_hit=w.init;b.effect_hit=w.move;w=new sce_ememy_move_std;a.ememy_move_std=w.init;b.ememy_move_std=w.move;w=new sce_ememy_move_std2;a.ememy_move_std2=w.init;b.ememy_move_std2=w.move;w=new sce_ememy_generator;a.ememy_generator=w.init;b.ememy_generator=w.move;w=new sce_enemy_trbox;a.enemy_trbox=w.init;b.enemy_trbox=w.move;w=new sce_ememy_timeover;a.ememy_timeover=w.init;b.ememy_timeover=w.move;w=new sce_friend_straight;a.friend_straight=w.init;b.friend_straight=w.move;w=new sce_friend_boom;a.friend_boom=w.init;b.friend_boom=w.move;w=new sce_friend_rotate_full;a.friend_rotate_full=w.init;b.friend_rotate_full=w.move;w=new sce_exev_3way;a[100]=w.init;b[100]=w.move;a.exev_3way=w.init;b.exev_3way=w.move;w=new sce_exev_5way_nallow;a[102]=w.init;b[102]=w.move;a.exev_5way_nallow=w.init;b.exev_5way_nallow=w.move;w=new sce_exev_5way_normal;a[103]=w.init;b[103]=w.move;a.exev_5way_normal=w.init;b.exev_5way_normal=w.move;w=new sce_exev_5expansion;a[104]=w.init;b[104]=w.move;a.exev_5expansion=w.init;b.exev_5expansion=w.move;w=new sce_exev_3way_exp;a[104]=w.init;b[104]=w.move;a.exev_3way_exp=w.init;b.exev_3way_exp=w.move;d.init=a;d.draw=c;d.move=b;return d}function sceneConfig(c){var i=c.System.dev,p=i.graphics[1],s=i.graphics[0],d=i.graphics[3],K=i.mouse_state,J=i.key_state;this.init=D;this.reset=B;this.step=E;this.draw=C;var g,k=0;this.score=0;this.config=c.Config;var e=[],b=[],x=[],q,v=false,u=false,f=0,I,H,r;function n(){this.title="button";this.x=0;this.y=0;this.w=100;this.h=16;this.select=false;this.click=false;this.setup=function(b,d,e,c,a){this.title=b;this.x=d;this.y=e;this.w=c;this.h=a;this.select=false;this.click=false;this.lamp=false};this.status_reset=function(){this.select=false;this.click=false};this.func=function(){return 0}}function F(){var c,b=[];this.button=b;var e,f,h;this.setup=function(i,p,g,j,k,l,o){c=i;e=g;f=l;h=o;m=new n;m.setup(p,j,k,120,16);m.msg=g;a.push(m);b.push(m);for(var d=0;d<2;d++){m=new n;m.setup(d==0?"  On":"  Off",j+160+80*d,k,80,16);m.msg=g+(d==0?"\u6709\u52b9":"\u7121\u52b9");m.sw=d==0?true:false;m.num=i;a.push(m);b.push(m)}};this.set=function(a){c=a};this.result=function(){if(b[0].select||b[1].select||b[2].select){if(b[1].click){c=true;g=true;b[1].click=false}if(b[2].click){c=false;g=true;b[2].click=false}d.clear();d.reset();d.print(e,f,h,"white");d.draw()}if(c){b[1].lamp=true;b[2].lamp=false}else{b[1].lamp=false;b[2].lamp=true}return c}}function t(){var c,b=[];this.button=b;var f,h,i,e;this.setup=function(j,k,g,l,o,p,q){c=j;e=k;f=g;h=p;i=q;m=new n;m.setup(k,l,o,120,16);m.msg=g;a.push(m);b.push(m);for(var d=0;d<2;d++){m=new n;m.setup(d==0?"  +1":"  -1",l+160+80*d,o,80,16);m.msg=g;m.sw=d==0?1:-1;m.num=j;a.push(m);b.push(m)}};this.set=function(a){c=a;b[0].title=e+c};this.result=function(){var a=c;if(b[0].select||b[1].select||b[2].select){if(b[1].click){c+=b[1].sw;b[1].click=false;g=true;b[1].lamp=true;b[2].lamp=false}if(b[2].click){c+=b[2].sw;b[2].click=false;g=true;b[1].lamp=false;b[2].lamp=true}if(c<0)c=0;b[0].title=e+c;d.clear();d.reset();d.print(f+c,h,i,"white");d.draw()}return c}}var a=[],l=["LampUse.","MapUse.","ItemReset.","ShotFree.","SoundTest.","StartFloor."],y=["\u9762\u306e\u958b\u59cb\u304b\u3089\u30e9\u30f3\u30d7\u3092\u6240\u6301\u3059\u308b:  ","\u9762\u306e\u958b\u59cb\u304b\u3089\u5730\u56f3\u3092\u6240\u6301\u3059\u308b: ","\u6b7b\u3093\u3060\u3068\u304d\u306b\u30a2\u30a4\u30c6\u30e0\u653e\u51fa\u3059\u308b: ","\u5f3e\u3092\u6d88\u8cbb\u3057\u306a\u3044\u3002:","\u30b5\u30a6\u30f3\u30c9\u30c6\u30b9\u30c8 : ","\u958b\u59cb\u30d5\u30ed\u30a2 : "],o=[0,0,0,0,1,1];b[5]=1;for(var j=[],z=60,A=180,h=0;h<l.length;h++){if(o[h]==0){var w=new F;w.setup(h,l[h],y[h],z,A+h*20,100,320)}else{var w=new t;w.setup(h,l[h],y[h],z,A+h*20,100,320)}j.push(w)}m=new n;m.setup("Save.",100,360,120,16);m.msg="Save.";m.func=function(){v=true;g=true;return 0};a.push(m);m=new n;m.setup("Reset.",100,380,120,16);m.msg="Reset.";m.func=function(){u=true;g=true;return 0};a.push(m);m=new n;m.setup("Exit.",100,400,120,16);m.msg="Exit.";m.jp=2;m.func=function(){d.clear();d.reset();return this.jp};a.push(m);var G,L=new Number(0);function D(){c.Config.reset();c.Config.load();e[0]=c.Config.lamp_use;e[1]=c.Config.map_use;e[2]=c.Config.itemreset;e[3]=c.Config.shotfree;e[4]=false;e[5]=false;b[4]=0;b[5]=c.Config.startstage}function B(){for(var c in a){a[c].sel=false;a[c].lamp=false}I=false;H=0;G=0;s.clear("darkblue");cl={};cl.w=p.cw;cl.h=p.ch;cl.draw=function(a){var c=this.h;if(c<this.w)c=this.w;a.beginPath();for(var b=0;b<c;b+=16){a.moveTo(b,0);a.lineTo(b,this.h);a.moveTo(0,b);a.lineTo(this.w,b)}a.strokeStyle="lightgray";a.lineWidth="1";a.stroke()};s.putFunc(cl);s.draw();s.reset();for(c in b)if(Boolean(b[c]))x[c]=b[c];for(var c=0;c<o.length;c++)if(o[c]==0)j[c].set(e[c]);else{var d=new t;j[c].set(b[c])}g=true;f=0;g=10}function E(){q=[];var y=K.check_last(),m=J.check(),C=y.x,D=y.y,w=false,p=false,s=false;if(!g){if(Boolean(m[37]))if(m[37]){p=true;k=10}if(Boolean(m[39]))if(m[39]){s=true;k=10}if(Boolean(m[38]))if(m[38]){f--;if(f<l.length*3){f--;f--}if(f<0)f=a.length-1;g=true;k=10}if(m[40])if(m[40]){f++;if(f<l.length*3){f++;f++}if(f>a.length-1)f=0;g=true;k=10}var w=false;if(Boolean(m[90]))if(m[90])w=true;if(Boolean(m[32]))if(m[32])w=true;g&&i.sound.effect(9)}if((w||(p||s))&&!g)for(var h in a){a[h].click=false;if(a[h].select){a[h].click=true;var n=a[h].func();if(n!=0)return n}}else for(h in b)if(Boolean(b[h]))x[h]=b[h];if(k>0)k--;if(!w&&k==0)g=false;var A=-1,z=f;if(f<l.length*3)z=Math.floor(f/3)*3;for(h in a)if(h==z){a[h].select=true;A=h}else a[h].select=false;if((p||s)&&!g)if(f<l.length*3){var n=f;if(p)n=n+1;if(s)n=n+2;a[n].select=true}q.push("== Configration ==");q.push("-----------------%");for(h in j){e[h]=j[h].result();if(o[h]==1)b[h]=e[h]}c.Config.lamp_use=e[0];c.Config.map_use=e[1];c.Config.itemreset=e[2];c.Config.shotfree=e[3];if(!Boolean(r))r=b[4];if(r!=b[4]){if(b[4]>=0&&b[4]<14){i.sound.change(Math.floor(b[4]));i.sound.play(0)}r=b[4]}c.Config.startstage=b[5];if(u){c.Config.reset();e[0]=c.Config.lamp_use;e[1]=c.Config.map_use;e[2]=c.Config.itemreset;e[3]=c.Config.shotfree;e[4]=false;e[5]=false;b[4]=0;b[5]=c.Config.startstage;d.clear();d.reset();d.print("\u8a2d\u5b9a\u521d\u671f\u5316\u3057\u307e\u3057\u305f\u3002",100,320,"white");if(Boolean(localStorage)){localStorage.clear();d.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u30af\u30ea\u30a2\u3002",100,340,"white")}else d.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,340,"white");d.draw();for(var h=0;h<o.length;h++)if(o[h]==0)j[h].set(e[h]);else{var B=new t;j[h].set(b[h])}u=false}if(v){d.clear();d.reset();if(c.Config.save()==0)d.print("\u8a2d\u5b9a\u3092\u30bb\u30fc\u30d6\u3057\u307e\u3057\u305f\u3002",100,320,"white");else d.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,320,"white");d.draw();v=false}return 0}function n(){this.title="button";this.x=0;this.y=0;this.w=100;this.h=16;this.select=false;this.click=false;this.setup=function(b,d,e,c,a){this.title=b;this.x=d;this.y=e;this.w=c;this.h=a;this.select=false;this.lamp=false;this.click=false};this.status_reset=function(){this.select=false;this.click=false};this.func=function(){return 0}}function C(){for(var d in q)p.putchr(q[d],0,100+16*d);for(var b in a){if(a[b].lamp){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};p.putFunc(c)}if(a[b].select)p.putchr(a[b].title,a[b].x-4,a[b].y-1);else p.putchr(a[b].title,a[b].x,a[b].y)}}}function sceneControl(c){var a=[];a[1]=new gameScene(c);a[2]=new sceneTitle(c);a[3]=new sceneGover(c);a[4]=new sceneConfig(c);a[5]=new sceneResult(c);for(var e in a)a[e].init();var f=a[2],b=2,d=b;this.step=function(){if(b!=0){var c=false;if(b>=10){b=b%10;c=true}d=b;a[d].reset(c)}b=a[d].step()};this.draw=function(){a[d].draw()}}function sceneGover(k){var h=k.System.dev,i=h.graphics[1],b=h.graphics[0],s=h.mouse_state,r=h.key_state;this.init=p;this.reset=n;this.step=q;this.draw=o;var d,e=0,g,l,f,j,c,a=[];m={};m.title="End.";m.x=320-50;m.y=200;m.w=120;m.h=16;m.sel=false;m.func=function(){return 2};a.push(m);function p(){}function n(){for(var h in a)a[h].sel=false;l=false;f=2;j=0;var g={};g.cw=b.cw;g.ch=b.ch;g.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="black";a.stroke()}};b.putFunc(g);b.draw();b.reset();k.Game.cold=true;d=true;e=30;c=0}function q(){g=[];var p=s.check_last(),i=r.check(),n=false;if(!d){if(Boolean(i[38]))if(i[38]){c--;if(c<0)c=a.length-1;d=true;e=10}if(i[40])if(i[40]){c++;if(c>a.length-1)c=0;d=true;e=10}var n=false;if(Boolean(i[90]))if(i[90])n=true;if(Boolean(i[32]))if(i[32])n=true;d&&h.sound.effect(9)}if(n&&!d)for(var k in a)if(a[k].sel){var o=a[k].func();if(o!=0)return o}if(e>0)e--;if(!n&&e==0)d=false;if(l){var m={};m.cw=b.cw;m.ch=b.ch;m.y1=b.ch/2-f;m.y2=b.ch/2+f;m.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(m);b.draw();b.reset();f+=8;if(b.ch/2-f<0)return j}for(k in a)if(k==c)a[k].sel=true;else a[k].sel=false;g.push("== Game Over ==");g.push("---------------");return 0}function o(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};i.putFunc(c)}i.putchr(a[b].title,a[b].x,a[b].y)}for(var d in g)i.putchr(g[d],320-72,132+16*d)}}function sceneResult(k){var d=k.System.dev,h=d.graphics[1],b=d.graphics[0],r=d.graphics[3],s=d.mouse_state,q=d.key_state;this.init=o;this.reset=m;this.step=p;this.draw=n;var g,f,l,e,i,j=0,a=[],c={};c.title="[   ok.  ]";c.x=320-80;c.y=320;c.w=120;c.h=16;c.sel=false;c.func=function(){r.clear();return 11};a.push(c);function o(){}function m(){for(var d in a)a[d].sel=false;l=false;e=2;i=0;var c={};c.cw=b.cw;c.ch=b.ch;c.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="darkblue";a.stroke()}};b.putFunc(c);b.draw();b.reset();g=true;j=0}function p(){f=[];var m=q.check(),n=false;if(Boolean(m[90]))if(m[90])n=true;j++;if(!d.sound.running())for(var h in a)if(a[h].sel){var o=a[h].func();if(o!=0)return o}if(!n)g=false;if(l){var c={};c.cw=b.cw;c.ch=b.ch;c.y1=b.ch/2-e;c.y2=b.ch/2+e;c.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(c);b.draw();b.reset();e+=8;if(b.ch/2-e<0)return i}for(h in a)if(!g)a[h].sel=true;var p=k.Game.nowstage;f.push(" == Floor -"+p+"- Clear ==");return 0}function n(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};h.putFunc(c)}h.putchr(a[b].title,a[b].x,a[b].y)}for(var d in f)h.putchr(f[d],320-150,160+16*d)}}function sceneTitle(j){var e=j.System.dev,k=e.graphics[1],b=e.graphics[0],o=e.graphics[2],x=e.mouse_state,u=e.key_state;this.init=r;this.reset=p;this.step=s;this.draw=q;for(var d,f=0,g,l,h,c=0,a=[],n=["GameStart.","Continue","Config"],v=[1,11,4],i=0;i<n.length;i++){m={};m.title=n[i];m.x=320-50;m.y=320+i*20+32;m.w=120;m.h=16;m.jp=v[i];m.sel=false;m.func=function(){return this.jp};a.push(m)}var t,w=new Number(0);function r(){w=0}function p(){e.graphics[3].clear();for(var g in a)a[g].sel=false;l=false;h=0;t=0;b.clear("black");o.clear();b.put("Mayura1",320-50+8,208);b.put("Unyuu1",320-50+8,240);b.put("Ball1",320-100+0-16,272);b.put("BallB1",320-100+16-16,272);b.put("BallS1",320-100+32-16,272);b.put("BallL1",320-100+48-16,272);b.put("Lamp",320-100+72-16,272);b.put("Map",320-100+96-16,272);b.put("Key",320-50+16-8,304);b.putchr("Player",320,208-8);b.putchr("Enemy",320,240-8);b.putchr("Ball/Item",320,272-8);b.putchr("Key",320,304-8);b.putchr8("Press <z> key or [Space]key to",320-100-8,336);if(j.Game.load()==0){a[1].title="Continue";a[1].jp=11}else{a[1].title="";a[1].jp=0}b.draw();b.reset();j.Game.cold=true;d=true;f=30;c=0}function s(){g=[];var i=u.check(),n=false;if(!d){if(Boolean(i[38]))if(i[38]){c--;if(c<0)c=a.length-1;d=true;f=10}if(i[40])if(i[40]){c++;if(c>a.length-1)c=0;d=true;f=10}var n=false;if(Boolean(i[90]))if(i[90])n=true;if(Boolean(i[32]))if(i[32])n=true;d&&e.sound.effect(9)}if(n&&!d)for(var k in a)if(a[k].sel){var o=a[k].func();if(o!=0)return o}if(f>0)f--;if(!n&&f==0)d=false;if(l){var m={};m.cw=b.cw;m.ch=b.ch;m.y1=b.ch/2-h;m.y2=b.ch/2+h;m.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(m);b.draw();b.reset();h+=4;if(b.ch/2-h<0)return 1}for(k in a)if(k==c)a[k].sel=true;else a[k].sel=false;g.push("==DonichiDungeon==");g.push("-----------------&");!j.Config.use_audio&&g.push("audio off");return 0}function q(){for(var d in g)k.putchr(g[d],0,132+16*d);for(var b in a)if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};k.putFunc(c);k.putchr(a[b].title,a[b].x-4,a[b].y-1)}else k.putchr(a[b].title,a[b].x,a[b].y)}}function star_draw(a){a.save();a.setTransform(1,0,0,1,this.x,this.y);a.rotate(1.8*(Math.PI/180)*this.mode);a.rotate(45*(Math.PI/180));a.beginPath();a.fillStyle="orange";a.fillRect(-80,-80,160,160);a.restore()}function Screen(A,F,E){var r=1500,o=new Image;o.src="pict/cha.png";var i=new Image;i.src="pict/aschr.png";var a=[],u=[],f=document.getElementById(A);f.width=F;f.height=E;var c=f.getContext("2d");this.cw=f.width;this.ch=f.height;var m=false,l=false;this.sprite_texture_ready=m;this.character_texture_ready=l;c.font="16px 'Arial'";o.onload=function(){m=true};i.onload=function(){l=true};this.readystate_check=function(){this.sprite_texture_ready=m;this.character_texture_ready=l};var D=spdata(),G=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=12*j;ptn.y=16*b;ptn.w=12;ptn.h=16;u.push(ptn)}var t=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=8*j;ptn.y=8*b+128;ptn.w=8;ptn.h=8;t.push(ptn)}for(var y=[],k=0;k<=3;k++){var z=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=8*j+(k%2==0?0:128);ptn.y=8*b+128+(k>=2?64:0);ptn.w=8;ptn.h=8;z.push(ptn)}y[k]=z}for(var h=0,w=[],b=0;b<r;b++)w[b]=new d;this.lighter_enable=true;var n=0;function e(){h++;if(h>=r)h=0;return w[h]}this.put=function(k,l,m,i,j,f,d){if(!Boolean(i))i=0;if(!Boolean(j))j=0;if(!Boolean(f))f=255;if(!Boolean(d))d=1;var b=e();b.img=o;var c=D[k];b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=-c.w/2*d;b.dy=-c.h/2*d;b.dw=c.w*d;b.dh=c.h*d;b.tx=l;b.ty=m;b.alpha=f;b.r=j;var h=1,g=1;switch(i){case 1:h=-1;break;case 2:g=-1;break;case 3:h=-1;g=-1}b.m11=g;b.m12=0;b.m21=0;b.m22=h;b.light_enable=this.light_enable;b.mode=x;a[a.length]=b};this.putPattern=function(d,c,i,j,h,f){var b=e();b.img=d;b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=i;b.dy=j;b.dw=h;b.dh=f;b.mode=g;a[a.length]=b};this.print=function(d,f,g,c){if(!Boolean(c))c="limegreen";var b=e();b.text=d;b.sx=f;b.sy=g;b.color=c;b.mode=v;a[a.length]=b};this.putchr=function(k,m,n,d){var j=false;if(!Boolean(d))d=1;else if(d!=1)j=true;for(var f=0,l=k.length;f<l;f++){var h=k.charCodeAt(f);if(h>=32&&h<128){var b=e();b.img=i;var c=u[h-32];b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=m+f*(12*d);b.dy=n;if(j){b.dx+=-c.w/2*d;b.dy+=-c.h/2*d}b.dw=c.w*d;b.dh=c.h*d;b.mode=g;a[a.length]=b}}};this.putchr8=B;function B(h,j,k){for(b=0;b<h.length;b++){var f=h.charCodeAt(b);if(f>=32&&f<128){var c=e();c.img=i;var d=t[f-32];c.sx=d.x;c.sy=d.y;c.sw=d.w;c.sh=d.h;c.dx=j+b*8;c.dy=k;c.dw=d.w;c.dh=d.h;c.mode=g;a[a.length]=c}}}this.putchr8c=function(j,l,m,k,f){if(!Boolean(f))f=1;for(b=0;b<j.length;b++){var h=j.charCodeAt(b);if(h>=32&&h<128){var c=e();c.img=i;var d=y[k][h-32];c.sx=d.x;c.sy=d.y;c.sw=d.w;c.sh=d.h;c.dx=l+b*(8*f)+-d.w/2*f;c.dy=m+-d.h/2*f;c.dw=d.w*f;c.dh=d.h*f;c.mode=g;a[a.length]=c}}};this.putImage=function(c,d,f){var b=e();b.img=c;b.sx=d;b.sy=f;b.mode=s;a[a.length]=b};this.putImage2=function(c,g,h,f,d){var b=e();b.img=c;b.sx=g;b.sy=h;b.sw=f;b.sh=d;b.mode=q;a[a.length]=b};this.putImageTransform=function(h,i,j,c,d,f,g){var b=e();b.img=h;b.tx=i;b.ty=j;b.m11=c;b.m12=d;b.m21=f;b.m22=g;b.mode=p;a[a.length]=b};this.transform=function(a,b,d,e){c.setTransform(a,b,d,e,0,0)};this.putFunc=function(b){a[a.length]=b};this.clear=function(a){c.save();c.setTransform(1,0,0,1,0,0);c.clearRect(0,0,f.width,f.height);c.restore();if(Boolean(a)){c.fillStyle=a;c.fillRect(0,0,f.width,f.height)}};this.fill=function(e,f,d,b,a){if(Boolean(a)){c.fillStyle=a;c.fillRect(e,f,d,b)}else c.clearRect(e,f,d,b)};this.reset=function(){a=[];h=0};this.draw=function(){for(var b=0,d=a.length;b<d;b++)a[b].draw(c);if(n<a.length)n=a.length};this.count=function(){return n};var C=0,x=1,g=2,q=3,s=4,v=5,p=6;function d(){this.img;this.text;this.sx;this.sy;this.sw;this.sh;this.dx;this.dy;this.dw;this.dh;this.color;this.use_tranceform;this.light_enable;this.m11;this.m12;this.m21;this.m22;this.tx;this.ty;this.alpha;this.r;this.mode}d.prototype.func=[];d.prototype.func[C]=function(){};d.prototype.func[x]=function(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty);this.r!=0&&a.rotate(Math.PI/180*this.r);if(this.alpha==255)a.globalCompositeOperation="source-over";else{if(this.light_enable)a.globalCompositeOperation="lighter";a.globalAlpha=this.alpha*(1/255)}a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh);a.restore()};d.prototype.func[g]=function(a){a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh)};d.prototype.func[q]=function(a){a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh)};d.prototype.func[s]=function(a){a.drawImage(this.img,this.sx,this.sy)};d.prototype.func[v]=function(a){a.fillStyle=this.color;a.fillText(this.text,this.sx,this.sy)};d.prototype.func[p]=function(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty);a.drawImage(this.img,0,0);a.restore()};d.prototype.draw=function(a){this.func[this.mode].call(this,a)}}function soundControl(){var c=false,h;this.mute=h;var i=".mp3";if((new Audio).canPlayType("audio/ogg")=="maybe")i=".ogg";var f=["00round_start","01main","02warnning","03hurry_up","04round_clear","05miss","06gameover","07swing","08bow","09select","10use","11hit","12damage","13bomb"],a=[],o=[],n=[];for(var d in f){a[d]=new Audio("sound/"+f[d]+i);a[d].pos=0;a[d].addEventListener("timeupdate",function(){this.pos=b.currentTime/b.duration*100});a[d].stat=false;a[d].addEventListener("loadeddata",function(){this.stat=true});a[d].addEventListener("ended",function(){if(e!=-1){j(e);k(e);e=-1}})}this.loadCheck=function(){var b=0;for(var d in a)if(a[d].stat)b++;c=b>=a.length;return c?"Ready":b};var g=0,e=-1,m=false,b=new Audio("sound/"+f[0]+i);this.change=j;function j(d){if(!c)return;b.pause();b.currentTime=0;if(Boolean(f[d])){b=a[d];if(h){a[d].volume=0;a[d].muted=true}else{a[d].volume=1;a[d].muted=false}g=d}}this.play=k;function k(){if(!c)return;if(b.ended)b.currentTime=0;b.play();e=-1}this.effect=l;function l(b){if(!c)return;if(Boolean(f[b])){a[b].currentTime=0;a[b].play()}}this.next=function(a,b){if(Boolean(f[a])){e=a;m=b}};this.info=function(){return a[g].pos};this.running=function(){return!c?void 0:!a[g].ended};this.restart=function(){if(!c)return;b.currentTime=0};this.volume=function(b){if(!c)return;if(h)b=0;for(var d in a)a[d].volume=b}}function spdata(){var d=[["Mayura1",0,0,32,32],["Mayura2",32,0,32,32],["Mayura3",64,0,32,32],["Mayura4",96,0,32,32],["Unyuu1",128,0,32,32],["Unyuu2",160,0,32,32],["Unyuu3",192,0,32,32],["Fire1",0,32,32,32],["Fire2",32,32,32,32],["Down1",0,64,32,32],["Down2",32,64,32,32],["Down3",64,64,32,32],["Down4",96,64,32,32],["Down5",128,64,32,32],["Zap1",0,96,32,32],["Zap2",32,96,32,32],["Zap3",64,96,32,32],["Zap4",96,96,32,32],["Ball1",128,48,16,16],["Ball2",144,48,16,16],["Ball3",160,48,16,16],["BallB1",176,48,16,16],["BallB2",192,48,16,16],["BallB3",208,48,16,16],["BallS1",176,64,16,16],["BallS2",192,64,16,16],["BallS3",208,64,16,16],["BallL1",176,80,16,16],["BallL2",192,80,16,16],["BallL3",208,80,16,16],["Key",64,32,32,32],["TrBox",96,32,32,32],["Space",224,0,32,32],["Coin1",160,96,16,16],["Coin2",176,96,16,16],["Coin3",192,96,16,16],["Coin4",208,96,16,16],["Knife",128,96,32,32],["Lamp",224,0,24,24],["Map",224,24,24,24],["Spear",224,48,16,48],["Boom",224,96,16,16],["Axe",176,112,16,16],["Wand",160,112,16,16],["Dummy",112,32,15,15]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}function Stage1(h){var c=96,b=96,e;e=new Dangeon(h);e.create();var o=e.mapdata,f=[];f=e.ml;var a=e.il;h=Math.floor(Math.random()*1e6);var g=new n(h);this.scenario=m;this.bgImage=k;this.bgLayout=j;this.initial=l;this.bgPtn=i;var d=[];this.colmap=d;function m(){var h=[[7199,240,240,180,"ememy_timeover",33],[7199,240,2e3,180,"ememy_timeover",33],[7199,1500,1500,180,"ememy_timeover",33],[7199,2e3,240,180,"ememy_timeover",33],[7199,2e3,2e3,180,"ememy_timeover",33],[6e5,-1,-1,0,0,0]],f=[];for(var o in h){var e=h[o],d={};d.count=e[0];d.x=e[1];d.y=e[2];d.r=e[3];d.sc=e[4];d.ch=e[5];f.push(d)}for(var n in f){var g=f[n],l=Math.floor(g.x/c),m=Math.floor(g.y/b),j=true;for(var k in a)if(a[k].x==l&&a[k].y==m)j=false;if(j){var i=Math.floor(Math.random()*a.length);g.x=a[i].x*c+c/2;g.y=a[i].y*b+b/2}}return f}function k(a){var c=Math.floor((a-1)%15/5)+1,b="bg"+c;return b}function j(){var m=[],r=e.mapdata,n=[-1,0,1,-1,1,-1,0,1],p=[-1,-1,-1,0,0,1,1,1],h=[];bit_check=function(c){var a=[];for(var b in n)if(Math.floor(c/Math.pow(2,b))%2!=0)a[b]=true;else a[b]=false;return a};d=[];for(var i=1;i<=e.mw-1;i++){d[i*3-3]=[];d[i*3-2]=[];d[i*3-1]=[];for(var j=1;j<=e.mh-1;j++){if(r[i][j]){var o=bit_check(e.type[i][j]);for(var l in n){h=[o[l]?Number(l)+3:12,i*c+32+32*n[l],j*b+32+32*p[l],32,32,false,1+(o[l]?0:-1),true];m.push(h);d[i*3-2+n[l]][j*3-2+p[l]]=o[l]}}else for(var l in n)d[i*3-2+n[l]][j*3-2+p[l]]=null;if(r[i][j]){h=[11,i*c+32,j*b+32,32,32,false,1,true];m.push(h);d[i*3-2][j*3-2]=true}}}for(var i in f){h=[0,f[i].x*c,f[i].y*b,96,96,false,0,true];m.push(h)}var s=Math.floor(g.next()*a.length);h=[13,a[s].x*c+16,a[s].y*b+16,64,64,true,2,true];m.push(h);var q=[];for(var j in m){var h=m[j],k={};k.no=h[0];k.x=h[1];k.y=h[2];k.w=h[3];k.h=h[4];k.c=h[5];k.type=h[6]+10;k.view=false;k.visible=h[7];q.push(k)}this.colmap=d;return q}function l(d){for(var e=[],h=0;h<a.length;h++)e[h]=h;for(h=0;h<3e3;h++){var v=Math.floor(g.next()*e.length),s=Math.floor(g.next()*e.length),f=e[v];e[v]=e[s];e[s]=f}var l=[],x=e[0];l.push([false,a[x].x*c+10,a[x].y*b+10,0,"player",0]);var k=1;if(d%5==0)var r=[["common_vset0",20,20],["common_vset0",21,1],["common_vset0",23,7],["common_vset0",24,7],["common_vset0",25,7],["common_vset0",26,1],["common_vset0",27,1],["common_vset0",15,1],["common_vset0",16,1],["common_vset0",17,1],["common_vset0",18,1],["common_vset0",19,1],["ememy_generator",1,3],["boss_0",34,Math.floor(d/5)-1],["boss_0",14,d%15!=0?1:0],["boss_1",14,d%15==0?1:0]];else{var t=Math.floor(d/4),q=Math.floor(d/3),u=Math.floor(d/4),p=Math.floor(d/4),j=25-t-q-u-p;j=j<5?5:j;var r=[["common_vset0",20,20],["common_vset0",22,1],["common_vset0",23,Math.floor(d/4)+4],["common_vset0",24,Math.floor(d/6)+4],["common_vset0",25,4],["common_vset0",26,1],["common_vset0",27,1],["common_vset0",15,1],["common_vset0",16,1],["common_vset0",17,1],["common_vset0",18,1],["common_vset0",19,1],["ememy_move_std2",1,j],["ememy_generator",1,5],["ememy_moveshot_1",1,t],["sce_ememy_randomshot",1,q],["ememy_turn_r",1,u],["ememy_move_n_l",1,p]]}for(var h in r)for(var m=r[h],n=0;n<m[2];n++){var w=e[k];f=[true,a[w].x*c+c/2,a[w].y*b+b/2,Math.floor(g.next()*4)*90,m[0],m[1]];l.push(f);k++;if(k>=a.length)k=0}var o=[];for(var n in l){var f=l[n],i={};i.s=f[0];i.x=f[1];i.y=f[2];i.r=f[3];i.sc=f[4];i.ch=f[5];o.push(i)}return o}function i(){var d=[[0,128-96,128-128,95,95],[1,224-96,128-128,95,95],[2,128-96,128-128,31,31],[3,224-96,128-128,31,31],[4,256-96,128-128,31,31],[5,288-96,128-128,31,31],[6,224-96,160-128,31,31],[11,256-96,160-128,31,31],[7,288-96,160-128,31,31],[8,224-96,192-128,31,31],[9,256-96,192-128,31,31],[10,288-96,192-128,31,31],[11,256-96,160-128,31,31],[12,96-96,192-128,31,31],[13,0,0,32,32]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}function n(c){var a=c;this.next=b;function b(){var b=(1103515245*a+12345)%32768;a=b;return b/32767.1}}}function stateConfig(){this.lamp_use;this.map_use;this.itemreset;this.shotfree;this.startstage;this.use_audio;this.debug;a();this.load=function(){var c=0;if(Boolean(localStorage)){for(var a=["lamp_use","map_use","itemreset","shotfree","startstage"],d=false,b=0;b<=3;b++)if(Boolean(localStorage.getItem(a[b]))){d=true;this[a[b]]=localStorage.getItem(a[b])=="on"?true:false}if(Boolean(localStorage.getItem(a[4]))){d=true;this[a[4]]=parseInt(localStorage.getItem(a[4]))}c=d?0:1}else c=2;return c};this.save=function(){var a=0;if(Boolean(localStorage)){localStorage.setItem("lamp_use",this.fullpower?"on":"off");localStorage.setItem("map_use",this.sideshot?"on":"off");localStorage.setItem("itemreset",this.itemreset?"on":"off");localStorage.setItem("shotfree",this.option?"on":"off");localStorage.setItem("startstage",new String(this.startstage))}else a=2;return a};this.reset=a;function a(){this.lamp_use=false;this.map_use=false;this.itemreset=true;this.shotfree=false;this.startstage=1;this.debug=false}}function stateControl(){this.Config=new stateConfig;this.Result=new stateResult;this.System=new stateSystem;this.Game=new stateGame}function stateGame(){this.item;this.itemstack;this.nowstage;this.cold;this.player={};this.player.zanki=2;this.player.hp=10;this.player.maxhp=this.player.hp;this.player.weapon=0;this.outviewMove=true;this.outviewCollision=true;this.outviewHit=true;this.load=function(){if(Boolean(localStorage)){var b=false;if(Boolean(localStorage.getItem("savedata"))){b=true;var a=JSON.parse(localStorage.getItem("savedata"));this.item=a.item;this.itemstack=a.itemstack;this.nowstage=a.stage;this.player=a.player}ret_code=b?0:1}else ret_code=2;return ret_code};this.save=function(){var a={};a.item=this.item;a.itemstack=this.itemstack;a.stage=this.nowstage;a.player=this.player;var c=JSON.stringify(a),b=0;if(Boolean(localStorage))localStorage.setItem("savedata",c);else b=2;return b}}function stateResult(){this.highscore=0;this.score=0;this.combo;var a=0;this.load=function(){if(Boolean(localStorage)){var b=false;if(Boolean(localStorage.getItem("highscore"))){b=true;this.highscore=parseInt(localStorage.getItem("highscore"))}a=b?0:1}else a=2;return a};this.save=function(){var a=0;if(Boolean(localStorage))localStorage.setItem("highscore",new String(this.result.highscore));else a=2;return a}}function stateSystem(){this.dev=new deviceControl}function keyEntryManager(c,e,d){var g=c,f=e,b=d,a=[];this.check=function(){b.check(g.check_last());a=b.marge(f.check());return a};this.state=function(){st="";for(var b in a)st+="["+b+"]"+(a[b]?"*":".");return st}}function vartualKeyControl(){var a=[],b=[];this.enable=true;this.lockstate=false;this.init=function(d){b=[];for(var e in d){var c=d[e],a={};a.x=c[0];a.y=c[1];a.w=c[2];a.h=c[3];a.keycode=c[4];b.push(a)}};this.check=function(d){if(!this.lockstate)a=[];if(d.button!=0){for(var e in b){var c=b[e];for(var f in c.keycode)a[c.keycode[f]]=false}return a}for(var e in b){var c=b[e];if(d.x>=c.x&&d.y>=c.y&&d.x<=c.x+c.w&&d.y<=c.y+c.h)for(var f in c.keycode)a[c.keycode[f]]=true}return a};this.shift=function(a){this.lockstate=a};this.marge=function(c){if(!this.enable)return c;var d=[];for(var b in c)d[b]=c[b];for(var b in a)if(a[b])d[b]=a[b];else if(!Boolean(c[b]))if(!c[b])d[b]=a[b];return d};this.draw=function(e){for(var h in b){var c=b[h],d={};d.x=c.x;d.y=c.y;d.w=c.w;d.h=c.h;d.draw=function(a){a.beginPath();a.strokeStyle="white";a.lineWidth=1;a.rect(this.x,this.y,this.w,this.h);a.stroke()};e.putFunc(d);var g="";for(var f in c.keycode)g+="["+c.keycode[f]+"]"+(a[c.keycode[f]]?"On":".");e.print(g,c.x,c.y)}}}