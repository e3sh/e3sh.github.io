function bench(){var j,e=Date.now(),k=0,a=[],c=[],b=0,d=0,i,h,g=0,f=412;this.start=function(){j=e;e=Date.now()};this.end=function(){i=Date.now()-e;h=e-j;if(b>d)d=b;a[b]=h;c[b]=i;b++;if(b>59)b=0;for(var l=0,f=0;f<=d;f++)l+=a[f];k++;g=parseInt(1e3/(l/(d+1)))};this.result=function(){var b={};b.fps=g;b.fps_log=a;b.load_log=c;var e={},d={};b.workload=e;b.interval=d;return b};this.draw=function(m){for(var k=0,l=999,o=0,i=0,j=999,n=0,q=0,p=0,e=0;e<=d;e++){if(k<a[e])k=a[e];if(l>a[e])l=a[e];if(i<c[e])i=c[e];if(j>c[e])j=c[e];q+=c[e];p+=a[e]}o=parseInt(p/(d+1));n=parseInt(q/(d+1));var h=[];h.push("fps : "+g);h.push("intv (ave/min/max) :("+o+"/"+l+"/"+k+")");h.push("load (ave/min/max) :("+n+"/"+j+"/"+i+")");for(var r in h){var t=0+8*r+f;m.putchr8(h[r],0,t)}var s=true;if(s){cl={};cl.x=32;cl.y=60+f;cl.g=a;cl.s=b;cl.col="rgb(0,128,255)";cl.draw=graph_draw;m.putFunc(cl);cl={};cl.x=32;cl.y=60+f;cl.g=c;cl.s=b;cl.col="Red";cl.draw=graph_draw;m.putFunc(cl)}}}function graph_draw(a){a.beginPath();a.moveTo(this.x,this.y+1);a.lineTo(this.x+this.g.length*3,this.y+1);a.strokeStyle="rgb(255,255,255)";a.lineWidth="1";a.stroke();a.beginPath();a.strokeStyle=this.col;for(var b=0;b<this.g.length;b++){var c=(this.s+this.g.length-b)%this.g.length;a.lineTo(this.x+b*3,this.y-this.g[c])}a.stroke()}function sce_boss_0(){this.init=function(b,a){a.vset(8);a.get_target(98);a.w_cnt=0;a.custom_draw_enable=true};this.draw=sce_boss_damage_gr;this.move=function(b,a){switch(a.frame){case 15:a.get_target(98);a.vset(0);break;case 22:a.vector=a.target_v();a.set_object(103);break;case 27:a.set_object(103);break;case 32:a.set_object(103);break;case 35:a.frame=12;a.w_cnt++}a.frame++;if(a.w_cnt>10){a.w_cnt=5;a.vector=90+Math.floor(Math.random()*180);a.vset(1);a.frame=0}return a.sc_move()}}function sce_boss_1(){this.init=function(b,a){a.vset(4);a.mp=12;a.display_size=.001;a.custom_draw_enable=false};this.draw=sce_boss_damage_gr;this.move=function(b,a){if(a.frame<60)a.display_size=2*(a.frame/60);else{a.display_size=2;a.custom_draw_enable=true}switch(a.frame){case 13:a.SIGNAL(6055);case 14:a.vset(0);break;case 60:a.hp>0&&a.set_object(22);a.vector=(a.vector+8+360)%360;a.frame=59}if(a.status==2){a.set_object_ex(14,a.x,a.y,180,50);a.status=2}a.frame++;return a.sc_move()}}function sce_boss_2(){this.init=function(b,a){a.vset(0);a.get_target(98);a.w_cnt=0;a.display_size=.001;a.custom_draw_enable=true};this.draw=sce_boss_damage_gr;this.move=function(b,a){if(a.frame<60)a.display_size=2*(a.frame/60);else a.display_size=2;switch(a.frame){case 65:a.get_target(98);a.vset(0);break;case 82:a.vector=a.target_v();break;case 92:a.set_object_ex(3,a.x,a.y,a.vector,"exev_3way_exp");break;case 95:a.frame=72;a.w_cnt++}a.frame++;if(a.w_cnt%10==0&&a.frame==90){a.set_object_ex(24,a.x,a.y,(a.vector+45)%360,49);a.set_object_ex(24,a.x,a.y,(a.vector+315)%360,49)}if(a.w_cnt%10==5&&a.frame==90){a.set_object_ex(24,a.x-100,a.y,a.vector,51);a.set_object_ex(24,a.x,a.y,a.vector,51);a.set_object_ex(24,a.x+100,a.y,a.vector,51)}if(a.status==2){a.bomb();a.SIGNAL(0)}return a.sc_move()}}function sce_boss_damage_gr(b,a){cl={};cl.x=a.x;cl.y=a.y;cl.sr=(360*((a.maxhp-a.hp)/a.maxhp)-90)*(Math.PI/180);cl.draw=function(a){a.beginPath();a.strokeStyle="white";a.lineWidth="5";a.beginPath();a.arc(this.x,this.y,32+10,this.sr,1.5*Math.PI,false);a.stroke();a.beginPath();a.strokeStyle="silver";a.lineWidth="1";a.arc(this.x,this.y,30+10,0,2*Math.PI,false);a.stroke();a.beginPath();a.arc(this.x,this.y,34+10,0,2*Math.PI,false);a.stroke()};b.putFunc(cl)}function character(){var d=[[0,1,10,98,16,16,16,16,0,0,24,15,15,24,0,0],[1,4,7,2,16,16,24,24,0,0,7,5,5,7,0,1],[2,5,1,3,4,4,2,2,4,4,5,5,5,5,0,0],[3,6,2,3,8,8,6,6,4,4,5,5,5,5,0,0],[4,19,4,2,8,8,6,6,14,14,7,5,5,7,0,10],[5,8,1,3,8,8,8,8,4,4,5,5,5,5,0,0],[6,9,2,1,8,8,16,16,13,13,5,5,5,5,0,0],[7,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[8,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[9,11,1,4,16,8,32,16,4,4,22,5,5,5,0,100],[10,15,10,0,8,8,8,8,21,21,7,15,15,7,1,0],[11,15,10,0,8,8,8,8,21,21,7,15,15,7,1,0],[12,5,1,3,4,4,2,2,18,18,5,5,5,5,0,0],[13,14,3,1,8,8,4,4,20,20,5,5,5,5,0,0],[14,20,70,2,16,16,24,24,0,0,35,5,5,35,0,50],[15,12,70,2,16,16,24,24,0,0,35,5,5,35,0,50],[16,13,99,0,80,16,160,32,0,0,5,5,5,5,0,0],[17,13,99,5,80,16,160,32,26,26,5,5,5,5,0,0],[18,16,0,5,112,16,0,0,28,28,28,5,5,5,0,0],[19,17,0,5,16,48,0,0,29,29,29,5,5,5,0,0],[20,18,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[20,26,1,4,8,8,16,16,30,30,5,5,5,5,0,8],[21,14,1,1,8,8,-99,-99,31,31,5,5,5,5,0,0],[22,8,1,3,8,8,16,16,33,33,5,5,5,5,0,0],[23,21,5,1,8,16,6,6,45,45,5,5,5,5,0,0],[24,23,5,3,8,8,6,6,49,49,5,5,5,5,0,0],[100,8,1,3,8,8,6,6,100,100,5,5,5,5,0,0],[101,8,1,3,8,8,6,6,101,101,5,5,5,5,0,0],[102,8,1,3,8,8,6,6,102,102,5,5,5,5,0,0],[103,8,1,3,8,8,6,6,103,103,5,5,5,5,0,0],[104,8,1,3,8,8,6,6,104,104,5,5,5,5,0,0],[106,8,1,3,8,8,6,6,105,105,5,5,5,5,0,0]],c=[];for(var e in d){var a=d[e],b={};b.mp=a[1];b.hp=a[2];b.type=a[3];b.center_x=a[4];b.center_y=a[5];b.size_x=a[6];b.size_y=a[7];b.senario=[a[8],a[9],a[10],a[11],a[12],a[13]];b.id=a[14];b.score=a[15];c[a[0]]=b}return c}try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{"get":function(){return true}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(b,a){Object.defineProperty(this,b,{"get":a,enumerable:true,configurable:true})}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(b,a){Object.defineProperty(this,b,{"set":a,enumerable:true,configurable:true})}})}}catch(defPropException){}function CLinear4TreeManager(){var d=0;this.level=0;this.w=0;this.h=0;this.l=0;this.t=0;this.unitW=0;this.unitH=0;this.cellNum=0;this.cellAry=null;this.dim=0;this.colList=new h;this.pow=new Array(9+1);this.pow[0]=1;for(var b=1;b<9+1;b++)this.pow[b]=this.pow[b-1]*4;function f(a){this.id=a||0;this.cell=this.obj=this.pre=this.next=null}f.prototype.remove=function(){if(!this.cell||!this.cell.onRemove(this))return false;this.pre&&(this.pre.next=this.next);this.next&&(this.next.pre=this.pre);this.pre=this.next=this.cell=null;return true};function a(){this.latest=null}a.prototype.push=function(a){if(!a)return false;if(a.cell==this)return false;if(!this.latest)this.latest=a;else{a.next=this.latest;this.latest.pre=a;this.latest=a}a.cell=this;d++;return true};a.prototype.getFirstObj=function(){return this.latest};a.prototype.onRemove=function(a){if(this.latest==a)if(this.latest)this.latest=this.latest.next;d--;return true};function h(){var a=[];a.wright=function(a,b){if(a.type!=b.type){this.push(a);this.push(b)}};return a}function j(g,c){var a=this.cellAry[g].getFirstObj();while(a){var d=a.next;while(d){this.colList.wright(a.obj,d.obj);d=d.next}for(var b=0,i=c.length;b<i;b++)this.colList.wright(a.obj,c[b]);a=a.next}for(var e=false,h=0,b=0;b<4;b++){var f=g*4+1+b;if(f<this.cellNum&&this.cellAry[f]){if(!e){a=this.cellAry[g].getFirstObj();while(a){c.push(a.obj);h++;a=a.next}}e=true;arguments.callee.call(this,f,c)}}if(e)for(var b=0;b<h;b++)c.pop();return true}function k(b){while(!this.cellAry[b]){this.cellAry[b]=new a;b=b-1>>2;if(b<0||b>=this.cellNum)break}return true}function e(d,e,b,a){var h=this.l+this.w-1,g=this.t+this.h-1;if(d>h||b<this.l||e>g||a<this.t)return 2147483647;if(d<this.l)d=this.l;if(b>h)b=h;if(e<this.t)e=this.t;if(a>g)a=g;for(var o=c.call(this,d,e),k=c.call(this,b,a),n=k^o,j=0,f=0;f<this.level;f++){var m=n>>f*2&3;if(m!=0)j=f+1}var i=k>>j*2,l=(this.pow[this.level-j]-1)/3;i+=l;return i>this.cellNum?2147483647:i}function g(a){a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;return(a|a<<1)&1431655765}function i(a,b){return g(a)|g(b)<<1}function c(a,b){return i(parseInt((a-this.l)/this.unitW),parseInt((b-this.t)/this.unitH))}this.init=function(a,b,c,e,d){if(a>=9)return false;this.cellNum=(this.pow[a+1]-1)/3;this.cellAry=new Array(this.cellNum);this.l=b;this.t=c;this.w=e-b;this.h=d-c;this.unitW=this.w/(1<<a);this.unitH=this.h/(1<<a);this.level=a;return true};this.register=function(d,g,c,b,f){var a=e.call(this,d,g,c,b);if(a<this.cellNum){!this.cellAry[a]&&k.call(this,a);return this.cellAry[a].push(f)}return false};this.getAllCollisionList=function(){var a=false;if(this.cellAry[0]){var b=[];j.call(this,0,b);a=this.colList;this.colList=new h}return a};this.createObjectForTree=function(a){return new f(a)};this.getMortonNumber=function(b,d,c,a){return e.call(this,b,d,c,a)};this.getPointElem=function(a,b){return c.call(this,a,b)};this.__defineGetter__("objectNum",function(){return d})}function sce_common_vset(a){this.init=function(c,b){b.vset(a)};this.move=function(b,a){return a.sc_move()}}function sce_common_signal(a){this.init=function(b,a){a.vset(0);a.normal_draw_enable=false;a.custom_draw_enable=false};this.move=function(c,b){if(b.frame==0)b.SIGNAL(a);else{b.SIGNAL(0);b.status=0}b.frame++;return b.sc_move()}}function deviceControl(){for(var c=3,a=[],b=0;b<c;b++)a[b]=new Screen("Layer"+b,420,480);var e=new inputControl("Layer2"),d=new inputKeyboard;this.canvas=a[1];this.text=a[2];this.graphics=a[1];this.graphics1=a[1];this.graphics2=a[0];this.text=a[2];this.canvas=a[1];this.canvas1=a[1];this.canvas2=a[0];this.mouse_state=e;this.key_state=d}function sce_effect_vanish(){this.init=function(b,a){a.type=5;a.status=5};this.move=function(){return-1}}function sce_effect_bomb(){this.init=function(b,a){a.vset(1);a.mp=10;a.type=5;a.status=5;a.frame=0;a.alpha=254};this.move=function(b,a){switch(a.frame){case 90:a.status=0}a.frame++;if(a.frame>30)a.alpha-=3;return a.sc_move()}}function sce_effect_billboard(a){this.init=function(c,b){b.vector=a;b.vset(2)};this.move=function(b,a){if(a.alpha>10)a.alpha-=5;else return-1;return a.sc_move()}}function sce_effect_bombcircle(a){this.init=function(b,a){a.vset(0);a.circle_r=20;a.type=5;a.normal_draw_enable=false;a.custom_draw_enable=true};this.move=function(b,a){if(a.frame>10)a.status=0;a.circle_r+=(a.frame+1)*10;a.frame++;return a.sc_move()};this.draw=function(d,c){var b={};b.x=c.x;b.y=c.y;b.r=c.circle_r;b.draw=function(b){b.beginPath();b.globalCompositeOperation="lighter";b.arc(this.x,this.y,this.r,0,Math.PI*2,false);b.fillStyle=a;b.fill();b.globalCompositeOperation="source-over"};d.putFunc(b)}}function sce_effect_warnning_mark(){this.init=function(b,a){a.vset(0);a.type=5;a.mp=28};this.move=function(b,a){if(a.frame>30)a.status=0;a.frame++;return a.sc_move()}}function sce_ememy_move_n(a,b){this.init=function(b,a){a.vset(4)};this.move=function(d,c){switch(c.frame){case 80:c.get_target(98);break;case 100:c.vector=c.target_v();c.set_object(103);break;case 110:c.set_object(3);break;case 120:c.set_object(4);c.vector=a;c.vset(4);break;case 160:c.vector=b;c.vset(4)}c.frame++;c.frame++;return c.sc_move()}}function sce_ememy_turn(a){this.init=function(b,a){a.vset(4)};this.move=function(c,b){switch(b.frame){case 5:b.set_object_ex(3,b.x,b.y,b.vector+Math.floor(Math.random()*40)-20,"exev_5expansion");break;case 15:b.vector+=a;b.vset(4);break;case 25:b.vector+=a;b.vset(4);break;case 35:b.vector+=a;b.vset(4);break;case 45:b.frame=9}b.frame++;return b.sc_move()}}function sce_ememy_change_s(){this.init=function(b,a){a.vset(4);a.vector=180};this.move=function(b,a){if(a.frame==15){a.set_object(102);a.change_sce(9)}a.frame++;return a.sc_move()}}function sce_ememy_moveshot(){this.init=function(b,a){a.vset(8)};this.move=function(b,a){a.frame%10==5&&a.set_object_ex(5,a.x,a.y,a.vector,52);a.frame++;return a.sc_move()}}function sce_ememy_randomshot(){this.init=function(b,a){a.vset(4);a.w_cnt=0;a.display_size=1.5};this.move=function(b,a){switch(a.frame){case 10:a.vset(0);break;case 13:a.set_object(12);break;case 15:a.frame=12;a.w_cnt++}a.frame++;if(a.w_cnt>50){a.w_cnt=0;a.vset(1);a.frame=0}return a.sc_move()}}function sce_en_bullet_homing(){this.init=function(b,a){a.vset(2);a.get_target(98)};this.move=function(b,a){switch(a.frame){case 10:a.target_rotate_r(15);a.vset(2);break;case 15:a.frame=9}a.frame++;return a.sc_move()}}function sce_en_bullet_random(){this.init=function(c,a){var b=Math.floor(Math.random()*50)-25;a.vector=(a.vector+b+360)%360;a.vset(4)};this.move=function(b,a){return a.sc_move()}}function sce_en_bullet_accel(){this.init=function(b,a){a.vset(4)};this.move=function(b,a){switch(a.frame){case 15:a.vx/=2;a.vy/=2;break;case 23:a.vx/=2;a.vy/=2;break;case 30:a.vx/=2;a.vy/=2;break;case 90:a.vset(6)}a.frame++;return a.sc_move()}}function sce_en_bullet_hominglaser(){this.init=function(b,a){a.vset(2);a.get_target(98);a.display_size=2;a.alpha=128;a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 26:a.frame>90&&a.get_target(2);a.target_rotate_r(15+(a.frame<20?15:0));a.vset(2+(a.frame>40?4:0)+(a.frame>50?4:0));break;case 30:a.w_cnt=25}a.set_object_ex(24,a.x,a.y,a.vector,56);a.w_cnt++;a.frame++;return a.sc_move()}}function sce_en_bullet_infolaser(){this.init=function(b,a){a.vset(0);a.msf=false;a.display_size=2;a.alpha=64};this.move=function(c,a){switch(a.frame){case 1:a.normal_draw_enable=false;a.custom_draw_enable=true;break;case 45:a.normal_draw_enable=true;a.custom_draw_enable=false;a.msf=true}if(a.msf)for(var b=1;b<=5;b++){a.vset(12*b);a.set_object_ex(24,a.x+a.vx,a.y+a.vy,a.vector,56)}a.frame++;return a.sc_move()};this.draw=function(c,b){var a={};a.x=b.x;a.y=b.y;b.vset(800);a.tx=b.x+b.vx;a.ty=b.y+b.vy;b.vset(0);a.alpha=b.frame/30;a.alpha=a.alpha>1?1:a.alpha;a.draw=function(b){b.beginPath();b.moveTo(this.x,this.y);b.lineTo(this.tx,this.ty);b.lineWidth="1";b.strokeStyle="rgba( 255, 0, 0,"+a.alpha+")";b.stroke()};c.putFunc(a)}}function sce_en_bullet_turn(){this.init=function(b,a){a.vset(0);a.get_target(98)};this.move=function(b,a){if(a.frame<60)a.vector=(a.vector+24)%360;if(a.frame==60){a.vector=a.target_v();a.vset(8)}a.frame++;return a.sc_move()}}function sce_en_bullet_laser_tail(){this.init=function(b,a){a.vset(0);a.display_size=2};this.move=function(b,a){if(a.frame>10)a.status=0;a.frame++;return a.sc_move()}}function sce_exev_3way(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-5,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+5,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5way_nallow(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-10,12);a.set_object_ex(5,a.x,a.y,a.vector-5,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+5,12);a.set_object_ex(5,a.x,a.y,a.vector+10,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5way_normal(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-30,12);a.set_object_ex(5,a.x,a.y,a.vector-15,12);a.set_object_ex(5,a.x,a.y,a.vector,12);a.set_object_ex(5,a.x,a.y,a.vector+15,12);a.set_object_ex(5,a.x,a.y,a.vector+30,12)};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_5expansion(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(3,a.x,a.y,a.vector,"common_vset2");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset4");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset6");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset8");a.set_object_ex(3,a.x,a.y,a.vector,"common_vset10")};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_exev_3way_exp(){this.init=function(b,a){a.vset(0);this.normal_draw_enable=false;a.set_object_ex(5,a.x,a.y,a.vector-5,"exev_5expansion");a.set_object_ex(5,a.x,a.y,a.vector,"exev_5expansion");a.set_object_ex(5,a.x,a.y,a.vector+5,"exev_5expansion")};this.move=function(b,a){a.status=0;return a.sc_move()}}function sce_friend_rotate(){this.init=function(b,a){a.vector=Math.floor(Math.random()*360);a.vset(0);a.get_target(98);a.startflag=true;a.shot=0;a.triger=0};this.move=function(e,a){if(!a.config.option)a.status=0;var c=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);var b=0;for(var d in a.item)if(d==7)b=a.item[d];if(b!=9)a.status=0;a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}if(eval(a.mouse_state.button)==0)if(a.shot==0){a.shot=1;a.config.sideshot&&a.set_object_ex(10,a.x,a.y,a.vector,41);a.triger=10}if(this.status==0)c=1;a.x=a.target.x+Math.cos((a.vector-90)*(Math.PI/180))*25;a.y=a.target.y+Math.sin((a.vector-90)*(Math.PI/180))*25;a.vector=(a.vector+12+360)%360;return c}}function sce_friend_start(){this.init=function(b,a){a.vset(8)};this.move=function(b,a){if(!a.config.option)a.status=0;a.hp=10;switch(a.frame){case 30:a.vector=180;a.vset(4);a.get_target(98);break;case 58:case 59:a.vector=a.target_v();case 60:a.vset(0);a.change_sce(21)}a.frame++;return a.sc_move()}}function sce_friend_sidearm(){this.init=function(b,a){a.vset(0);a.triger=15;a.m_trig=0;a.frame=60};this.move=function(f,a){if(!a.config.option)a.status=0;var c=a.vector;c=c>180?c+70:c-70;a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}var b=0;for(var e in a.item)if(e==7)b=a.item[e];if(b<10)a.mp=15;else a.mp=24;if(eval(a.mouse_state.button)==0){if(a.shot==0){a.shot=1;(b>=3&&b<=4||b>=8)&&a.set_object_ex(6,a.x,a.y,a.vector>180?a.vector+87:a.vector-87,13);a.m_trig=1-a.m_trig;if(b>=5)a.m_trig==0&&a.set_object(13);if(a.frame>45)if(b>=10){a.set_object(23);a.frame=0}a.triger=15;if(b>=7)a.triger=5}c=a.vector}var d=0;a.target.type!=98&&a.change_sce(7);if(this.status==0)d=1;a.x=a.target.x+Math.cos((c-90)*(Math.PI/180))*32;a.y=a.target.y+Math.sin((c-90)*(Math.PI/180))*32;a.frame++;return d}}function gameScene(o){var f=o.graphics1,c=o.graphics2;this.init=s;this.reset=q;this.step=t;this.draw=r;this.score=0;this.result;this.config;var a,b,p,u=0,k=0,e=new Image,v=false,m=true,d=0,n=0,j=false,h=0,l=0,g=0;this.score_load=function(){if(Boolean(localStorage)){var a=false;if(Boolean(localStorage.getItem("highscore"))){a=true;this.result.highscore=parseInt(localStorage.getItem("highscore"))}}};function s(){a=new gObjectControl(f,o);b=new mapSceControl;b.init();this.result={};this.result.highscore=0;this.result.score=0;this.result.item=a.item;this.result.combo=a.combo;j=false}function q(f){a.config=this.config;if(!Boolean(f))f=false;j=false;if(f){a.reset(true);if(this.config.cold)k=-1}else{a.reset(false);b.change(this.config.startstage);b.reset();k=0;m=true;d=0;n=0}g=0;if((f=true)&&!this.config.cold){w=b.stage;w++;if(w>3)w=1;b.change(w);d=0;n=0}e=b.bgImage();c.clear("darkgreen");c.putImage(e,0,d);c.draw();e.onload=function(){c.putImage(e,0,d);c.draw();var a=true};c.reset();p=new gs_score_effect(a.score);ehighscore=new gs_score_effect(this.result.highscore)}function t(){if(a.interrapt){if(a.SIGNAL==1){b.enable=false;b.counter_runnning=false}if(a.SIGNAL==6055){if(d==0)m=false;b.enable=true;b.counter_runnning=false}if(a.SIGNAL==835){this.result.score=a.score;this.result.item=a.item;this.result.combo=a.combo;this.result.combomax=a.combomax;this.result.obCount=a.obCount;this.result.total=a.total;this.result.hidan=a.hidan;this.config.cold=false;a.interrapt=false;a.SIGNAL=0;a.draw(c);j=true;return 5}if(a.SIGNAL==4649){k++;if(k<3){if(this.config.itemreset)a.item=[];a.combo=[];a.restart()}else{this.result.score=a.score;this.result.item=a.item;this.result.combo=a.combo;this.result.combomax=a.combomax;this.result.obCount=a.obCount;this.result.total=a.total;this.result.hidan=a.hidan;a.draw(c);j=true;Boolean(localStorage)&&localStorage.setItem("highscore",new String(this.result.highscore));return 3}}}else{m=true;b.enable=true;b.counter_runnning=true}var f=0,e=1;for(i in a.combo){if(i==2)f=a.combo[i];if(i==4)e=a.combo[i]}if(h!=f){h=f;if(h>=2)g=60}if(l!=e)l=e;if(!a.interrapt){a.move(b);b.step(a)}else if(a.SIGNAL!=1){a.move(b);b.step(a)}else var p=o.mouse_state.check_last();if(m)d++;if(d>480){d=0;n=1-n}if(this.result.highscore<a.score)this.result.highscore=a.score;return 0}function r(){if(!j){c.putImage(e,0,d-480);c.putImage(e,0,d);c.draw();c.reset()}a.draw();var m=[];wt=ehighscore.read(this.result.highscore);f.putchr("Hi-Sc:"+wt,240,0);wt=p.read(a.score);f.putchr("Score:"+wt,240,16);if(h>=2){var s=0;if(g>0){g--;s=g/60}var n="Combo:";f.putchr(n+h,0,32,1+s)}l>=2&&f.putchr8("item x"+l,0,24);if(this.config.debug){m.push("o:"+a.cnt()+"/"+a.num());m.push("f:"+b.flame);if(a.interrapt)m.push("interrapt:"+a.SIGNAL);else m.push("running:"+a.SIGNAL)}m.push("dead:"+k);if(Boolean(a.item[7])){var n=a.item[7];if(n>=10)n="max";m.push("powerup:"+n)}if(this.config.debug){for(i in a.item)m.push("item["+i+"]:"+a.item[i]);for(i in a.combo)m.push("combo["+i+"]:"+a.combo[i]);for(i in a.combomax)m.push("combomax["+i+"]:"+a.combomax[i]);var o=0;for(i in a.total)if(i==2)o=a.total[i];var q=1;for(i in a.obCount)if(i==2)q=a.obCount[i];m.push("rate:"+Math.floor(o/q*100)+"par");m.push("hidan:"+a.hidan)}for(var r in m)f.putchr8(m[r],300,32+8*r)}}function gs_score_effect(b){var a=b;this.read=function(d){if(d<=a)a=d;else if(d-a>100){c=1;ws_work=a;ts_work=d;for(var b=0;b<7;b++){if(ws_work<ts_work)a+=c;c*=10;ws_work=Math.floor(ws_work/10);ts_work=Math.floor(ts_work/10)}}else a++;var e=a,f=[],g="";for(b=0;b<7;b++){var c=e%10;f[7-b]=c;e=(e-c)/10}for(b in f)g=g+""+f[b];return g}}function geometoryTrance(){this.worldwidth=1920;this.worldheight=1080;this.stagewidth=840;this.stageheight=960;this.viewwidth=420;this.viewheight=480;this.world_x=0;this.world_y=0;var f=this.worldwidth,e=this.worldheight,d=this.stagewidth,c=this.stageheight,b=this.viewwidth,a=this.viewheight;this.viewtoWorld=function(b,c){var a={};a.x=this.world_x+b;a.y=this.world_y+c;return a};this.worldtoView=function(b,c){var a={};a.x=b-this.world_x;a.y=c-this.world_y;return a};this.viewpos=function(c,d){if(c<0)c=0;if(d<0)d=0;if(c>f-b)c=f-b;if(d>e-a)d=e-a;this.world_x=c;this.world_y=d};this.nowstagepos=function(){var e={};e.ltx=this.world_x+b/2-d/2;e.lty=this.world_y+a/2-c/2;e.rtx=this.world_x+b/2+d/2;e.rty=this.world_y+a/2-c/2;e.lbx=this.world_x+b/2-d/2;e.lby=this.world_y+a/2+c/2;e.rbx=this.world_x+b/2+d/2;e.rby=this.world_y+a/2+c/2;e.x=e.ltx;e.y=e.lty;e.w=d;e.h=c;return e}}function gObjectClass(){this.x;this.y;this.vx;this.vy;this.mp;this.vector;this.visible=false;this.center_x;this.center_y;this.hit_x;this.hit_y;this.mp_cnt_frm=0;this.mp_cnt_anm=0;this.type;this.chr;this.frame=0;this.scenario=[];this.status=0;this.hp;this.target=-1;this.crash=-1;this.id;this.score=0;this.triger=0;this.shot=0;this.alpha=255;this.display_size=1;this.message=[];this.normal_draw_enable=true;this.custom_draw_enable=false;this.damegeflag=false;this.damage={count:0,vector:0,dist:0,no:0};this.attack=1;this.mapCollision=false;this.mapColX=false;this.mapColY=false;this.alive=600;this.custom_draw=null;this.old_x=this.x;this.old_y=this.y;}gObjectClass.prototype.test=function(){return 0};gObjectClass.prototype.reset=function(){status=0;type=5;visible=false;mp_cnt_frm=0;mp_cnt_anm=0;scenario=[];this.normal_draw_enable=true;this.custom_draw_enable=false;damegeflag=false};gObjectClass.prototype.init=function(b,a){a.vset(5)};gObjectClass.prototype.draw=function(b,a){b.print(a.mp+"",a.x,a.y)};gObjectClass.prototype.move=function(c,a){a.x+=a.vx;a.y+=a.vy;var b=0;if(a.x<0||a.x>c.cw)b=1;if(a.y<0||a.y>c.ch)b=1;return b!=0?-1:0};gObjectClass.prototype.vset=function(a){this.vx=Math.cos(Math.PI/180*(this.vector-90))*a;this.vy=Math.sin(Math.PI/180*(this.vector-90))*a;this.vx/=1.5;this.vy/=1.5};gObjectClass.prototype.set_object=function(c,b){var a={};a.cmd="set_object";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.set_object_ex=function(d,g,h,f,c,e){var b={},a={};a.x=g;a.y=h;a.vector=f;a.sce=c;a.id=e;b.cmd="set_object_ex";b.src=d;b.dst=a;this.message.push(b)};gObjectClass.prototype.get_target=function(c,b){var a={};a.cmd="get_target";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.change_sce=function(c,b){var a={};a.cmd="change_sce";a.src=c;a.dst=b;this.frame=0;this.normal_draw_enable=true;this.custom_draw_enable=false;this.message.push(a)};gObjectClass.prototype.add_score=function(c,b){var a={};a.cmd="add_score";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.get_item=function(c,b){var a={};a.cmd="get_item";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb=function(c,b){var a={};a.cmd="bomb";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb2=function(c,b){var a={};a.cmd="bomb2";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb3=function(c,b){var a={};a.cmd="bomb3";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.bomb4=function(c,b){var a={};a.cmd="bomb4";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.collect=function(c,b){var a={};a.cmd="collect";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.SIGNAL=function(c,b){var a={};a.cmd="SIGNAL";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.reset_combo=function(c,b){var a={};a.cmd="reset_combo";a.src=c;a.dst=b;this.message.push(a)};gObjectClass.prototype.target_r=function(d,e){var f=this.x,g=this.y,a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=Math.atan(c/b)*(180/Math.PI);if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a};gObjectClass.prototype.target_v=function(){return!Boolean(this.target)?this.vector:this.target_r(this.target.x,this.target.y)};gObjectClass.prototype.target_rotate_r=function(c){if(!Boolean(this.target))return;var a=this.target_r(this.target.x,this.target.y),b=a;if(b>179)b=-360+b;w=this.vector;if(w>179)w=-360+w;a=b-w;if(Math.abs(a)>100){w=(this.vector+180)%360;if(w>179)w=-360+w;a=(b-w)*-1}if(Math.abs(a)<c)c=a;if(a!=0)this.vector=this.vector+a/Math.abs(a)*c;if(this.vector<0)this.vector=360+this.vector;if(this.vector>359)this.vector=this.vector-360};gObjectClass.prototype.target_d=function(a,b){var c=this.x,d=this.y;return Math.sqrt(Math.abs(a-c)*Math.abs(a-c)+Math.abs(b-d)*Math.abs(b-d))};gObjectClass.prototype.Sin=function(a){return Math.sin((a-90)*(Math.PI/180))};gObjectClass.prototype.Cos=function(a){return Math.cos((a-90)*(Math.PI/180))};function gObjectControl(d,o){var g=new CLinear4TreeManager;!g.init(3,0,0,d.cw,d.ch)&&alert("!");var l;delobj=0;this.score=0;this.config={};this.interrapt=false;this.SIGNAL=0;this.item=[];this.combo=[];this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;var k=0,j,m,n,c=character(),e=motionPattern(),h=scenario(),a=[],f=[];f[0]=[0,0,1,1,1,0];f[1]=[0,0,1,0,0,0];f[2]=[1,1,0,0,0,0];f[3]=[1,0,0,0,0,0];f[4]=[2,0,0,0,0,0];f[5]=[0,0,0,0,0,0];this.reset=function(b){g=new CLinear4TreeManager;!g.init(3,0,0,d.cw,d.ch)&&alert("!");delobj=0;k=0;if(this.config.cold){this.score=0;this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;this.combo=[];this.item=[]}if(!b){this.interrapt=false;this.SIGNAL=0;a=[];this.config.cold=true}if(this.config.fullpower)this.item[7]=10};this.move=function(r){j=r;var w=o.mouse_state.check_last();for(var h in a){var c=a[h];c.mouse_state=w;c.colitem&&c.colitem.remove();if(c.move(d,c,r)!=0){delete a[h];delobj++}else if(c.type!=5){if(!c.colitem){c.colitem=g.createObjectForTree();c.colitem.obj=c}g.register(c.x-c.hit_x/2,c.y-c.hit_y/2,c.x+c.hit_x/2,c.y+c.hit_y/2,c.colitem);c.crash=null}for(var y in c.message){var e=c.message[y];if(e.cmd=="add_score")this.score+=e.src;if(e.cmd=="get_item"){if(Boolean(this.item[e.src]))this.item[e.src]++;else this.item[e.src]=1;var q=1;if(e.src==20)q=this.combo_sub(4);this.score+=c.score*q;var A=e.src==7?"Powerup!":c.score*q+"pts.";j.add(c.x,c.y,0,20,43+(e.src==7?1:0),A)}if(e.cmd=="reset_combo")for(var s in this.combo)if(e.src==s)this.combo[s]=0;if(e.cmd=="SIGNAL")if(this.interrapt){this.interrapt=false;this.SIGNAL=0}else{this.interrapt=true;this.SIGNAL=e.src;if(e.src==0)this.interrapt=false}if(e.cmd=="bomb2"||e.cmd=="bomb3")if(Boolean(this.item[7]))if(this.item[7]>0)this.item[7]--;b[e.cmd](c,e.src,e.dst)}c.message=[]}var p=g.getAllCollisionList();l=p.length;for(var h=0;h<p.length;h+=2){var c=p[h],i=p[h+1],u=c.type==98?0:c.type,v=i.type==98?0:i.type,x=f[u][v];if(x==0)continue;if(Math.abs(c.x-i.x)<(c.hit_x+i.hit_x)/2&&Math.abs(c.y-i.y)<(c.hit_y+i.hit_y)/2){c.status=2;i.status=2;c.crash=i;i.crash=c}}for(h in a){c=a[h];if(c.crash)if(!(c.type==1||c.type==3)){var z=c.hp;if(c.type==4)c.hp=0;if(c.crash.type!=4)c.hp-=c.crash.hp>0?c.crash.hp:1;if(c.hp>0){c.status=1;if(z!=c.hp){if(c.type==98)this.hidan++;c.damageflag=true}c.crash=null}else c.type==2&&this.combo_sub(2)}}var t=0;for(h in a)if(a[h].type==98)t++;if(t==0){k++;if(k>90){m=this.interrapt;n=this.SIGNAL;this.interrapt=true;this.SIGNAL=4649}}};this.combo_sub=function(a){if(!Boolean(this.combo[a]))this.combo[a]=1;else this.combo[a]++;if(!Boolean(this.combomax[a]))this.combomax[a]=this.combo[a];else if(this.combo[a]>this.combomax[a])this.combomax[a]=this.combo[a];if(!Boolean(this.total[a]))this.total[a]=1;else this.total[a]++;return this.combo[a]};this.restart=function(){j.start();k=0;this.interrapt=m;this.SIGNAL=n};var b=[];b.set_object=function(a,b){j.add(a.x,a.y,a.vector,b)};b.set_object_ex=function(c,b,a){j.add(a.x,a.y,a.vector,b,a.sce,a.id)};b.get_target=function(b,f){var h=1,d=99999;b.target=null;for(var g in a){var c=a[g];if(c.type!=f)continue;var e=c.target_d(b.x,b.y);if(e<d){b.target=c;d=e}}};b.change_sce=function(a,b){a.init=h.init[b];a.move=h.move[b];a.custom_draw=h.draw[b];a.init(d,a)};b.add_score=function(c,a){return a};b.get_item=function(c,a){return a};b.bomb=function(){for(i in a)a[i].type==3&&a[i].change_sce(7)};b.bomb2=function(b){for(i in a){b=a[i];if(b.type==3){b.type=4;b.mp=18;b.score=8;if(b.chr!=7){var c=[18,22,26,27,29,30];b.mp=c[Math.floor(Math.random()*c.length)]}b.change_sce(30)}}};b.bomb3=function(){for(i in a){if(a[i].type==2){a[i].hp-=10;if(a[i].hp<=0)a[i].status=2}a[i].type==3&&a[i].change_sce(7)}};b.collect=function(b){for(i in a){b=a[i];if(b.type==4)if(!Boolean(b.collection_mode)){b.collection_mode=true;b.change_sce(30)}}};b.SIGNAL=function(){};b.reset_combo=function(){};this.draw=function(c){if(!Boolean(c))c=d;for(var e in a){var b=a[e];if(b.visible){b.normal_draw_enable&&b.draw(c,b);b.custom_draw_enable&&b.custom_draw(c,b)}}c.putchr8("obj:"+g.objectNum,0,32);c.putchr8("col:"+l/2,0,40)};this.set_s=q;function q(l,m,k,e,f,j){var b=new gObjectClass;b.reset();b.scrn=d;b.mouse_state=o.mouse_state.check_last();b.item=this.item;b.config=this.config;b.x=l;b.y=m;b.vector=k;b.chr=e;b.visible=true;b.mp=c[e].mp;b.hp=c[e].hp;b.maxhp=b.hp;b.type=c[e].type;b.center_x=c[e].center_x;b.center_y=c[e].center_y;b.hit_x=c[e].size_x;b.hit_y=c[e].size_y;if(!Boolean(j))j=c[e].id;b.id=j;b.score=c[e].score;b.status=1;if(!Boolean(f))f=c[e].senario[0];b.init=h.init[f];b.move=h.move[f];b.draw=p;b.custom_draw=h.draw[f];b.init(d,b);for(var i=-1,g=0;g<a.length;g++)if(!a[g]){i=g;break}if(i==-1)a.push(b);else a[i]=b;if(Boolean(this.obCount[b.type]))this.obCount[b.type]++;else this.obCount[b.type]=1}this.num=function(){return a.length};this.cnt=function(){var b=0;for(var c in a)b++;return b};function p(f,a){if(Boolean(e[a.mp].wait)){a.mp_cnt_frm++;if(a.mp_cnt_frm>e[a.mp].wait/2){a.mp_cnt_anm++;a.mp_cnt_frm=0;if(a.mp_cnt_anm>=e[a.mp].pattern.length)a.mp_cnt_anm=0}}try{var d=e[a.mp].pattern[a.mp_cnt_anm][0]}catch(g){a.mp_cnt_anm=0;d=e[a.mp].pattern[a.mp_cnt_anm][0]}var b=e[a.mp].pattern[a.mp_cnt_anm][1],c=e[a.mp].pattern[a.mp_cnt_anm][2];if(b==-1&&c==-1){b=0;c=a.vector}f.put(d,a.x,a.y,b,c,a.alpha,a.display_size)}}function inputControl(){var a,b,e,f,g=0,h=0,d,l=-1,k,i=0,j="NaN",n=0,m=0,c=document;this.o_Left=c.offsetLeft;this.o_Top=c.offsetTop;c.onmousemove=t;function t(c){x=c.clientX;y=c.clientY;if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y}c.onmousedown=function(a){d=a.button};c.onmouseup=function(){d=-1};c.onmousewheel=function(a){k=a.wheelDelta};c.addEventListener("DOMMouseScroll",s,false);function s(a){k=a.detail}c.ontouchmove=function(c){c.preventDefault();if(c.touches.length>0)for(var d=0;d<c.touches.length;d++){var e=c.touches[d];x=e.pageX;y=e.pageY}if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y};c.ontouchstart=function(a){a.preventDefault();x=a.pageX;y=a.pageY;d=0};c.ontouchend=function(a){a.preventDefault();d=-1};this.check=function(){if(m>0){m++;g=a;h=b;d=0;i=0}a=e;b=f;e=g;f=h;l=d;if(d!=0)d=-1;i=k;k=0;j=o(a,b,e,f);n=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));if(a-e==0&&b-f==0)j="NaN";var c={};c.x=g;c.y=h;c.button=l;c.wheel=i;c.deg=j;c.distance=n;return c};this.check_last=function(){var a={};a.x=g;a.y=h;a.button=l;a.wheel=i;a.deg=j;a.distance=n;return a};this.input_pause=function(a){if(wait_count>30)a=30;if(wait_count<0)a=0;m=a};this.draw=function(){var c=canvas.width,d=canvas.height,g=j;context.fillStyle="black";context.fillRect(0,0,canvas.width,canvas.height);context.fillStyle="white";context.fillRect(5,5,canvas.width-10,canvas.height-10);context.fillStyle="green";context.fillText(e+" "+f+" "+c+" "+d+" "+g,32,32);var h="OOO";switch(l){case 0:h="@OO";break;case 1:h="O@O";break;case 2:h="OO@"}context.fillText("b:"+h+" w:"+i,32,232);context.beginPath();context.moveTo(c/2,d/2);context.lineTo(e-a+c/2,f-b+d/2);context.strokeStyle="black";context.stroke();context.beginPath();context.arc(c/2,d/2,5,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();r=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));context.beginPath();context.arc(c/2,d/2,r,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();var k=0,m=0;if(g!="NaN"){g=q(g-90);k=Math.cos(g)*50;m=Math.sin(g)*50}context.beginPath();context.arc(c/2+k,d/2+m,20,0,2*Math.PI,true);context.fillStyle="orange";context.fill();var n=context.getImageData(0,0,canvas.width,canvas.height)};function o(f,g,d,e){var a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=p(Math.atan(c/b));if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a}function q(a){return a*(Math.PI/180)}function p(a){return a*(180/Math.PI)}}function inputKeyboard(){var a="NaN";window.onkeypress=function(b){a=b.keyCode};window.onkeyup=function(){a="NaN"};this.check=function(){return a}}function sce_item_direct_homing(){this.init=function(b,a){a.vector=0;a.vset(16);a.display_size=1};this.move=function(c,a){switch(a.frame){case 1:a.get_target(98);break;case 3:a.get_target(98);a.vector=a.target_v();case 4:if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);b=b<15?b+1:16;a.vset(b)}case 8:a.frame=2}a.frame++;return a.sc_move()}}function sce_item_near_homing(){this.init=function(b,a){a.vset(4);a.get_target(98)};this.move=function(c,a){!Boolean(this.target)&&a.get_target(98);if(Boolean(this.target)){var b=a.target_d(a.target.x,a.target.y);if(b<40){a.vector=a.target_v();a.vset(4)}}return a.sc_move()}}function sce_item_movingstop(){this.init=function(b,a){a.vset(1)};this.move=function(b,a){a.frame>100&&a.vset(0);if(a.frame>200){a.vector=180;a.vset(1)}a.frame++;return a.sc_move()}}function main_r(){var l=60,r=true,h=Date.now(),d=0;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){d++;if(d>l){d=1;h=Date.now()}var b=h+Math.round(d*(1e3/l)),e=Date.now(),a=b-e;if(a<=0)a=1;setTimeout(c,a)}}();gObjectClass.prototype.sc_move=ocl_scMove;var c=new deviceControl,b=c.graphics1,a=c.graphics2,j=new sceneControl(c),p=c.mouse_state,o=c.key_state,k=new Number(0),h=Date.now(),d=0,g=0,i=false,m=false,e=new bench,q=true;f();function f(){e.start();if(q){if(!i){waittime=16;m=n()}if(m){i=true;var c=p.check(),r=o.check(),d=[];d.push("mousemove x:"+c.x+" y:"+c.y+" t:"+k);d.push("b:"+c.button+" w:"+c.wheel+" r:"+Math.floor(c.deg)+" d:"+Math.ceil(c.distance));d.push("key:"+r);if(c.wheel!=0)k+=c.wheel>0?1:-1;var s=c.x,t=c.y,h=false;if(c.button==0)h=true;c.button==1;d.push("work :"+b.count());d.push("work2:"+a.count());for(var l in d)b.putchr8(d[l],0,0+8*l);j.step();if(h){cl={};cl.x=s;cl.y=t;g++;cl.mode=g%100;cl.draw=cursur_draw;b.putFunc(cl)}b.clear();b.draw();b.reset();j.draw()}}e.end();e.draw(b);requestAnimationFrame(f)}function n(){b.readystate_check();a.readystate_check();var c=b.sprite_texture_ready,d=b.character_texture_ready,e=a.sprite_texture_ready,f=a.character_texture_ready;a.print("Load_check",0,20);st="w1s_"+(c?"ready":".");a.print(st,0,40);st="w1t_"+(d?"ready":".");a.print(st,0,60);st="w2s_"+(e?"ready":".");a.print(st,0,80);st="w2t_"+(f?"ready":".");a.print(st,0,100);a.clear("black");a.draw();a.reset();return c&&d&&e&&f?true:false}}function cursur_draw(a){a.save();a.setTransform(1,0,0,1,this.x,this.y);a.rotate(3.6*(Math.PI/180)*this.mode);for(var b=0;b<4;b++){a.beginPath();a.moveTo(0,8);a.lineTo(0,24);var c=String(255-this.mode%25*5);a.strokeStyle="rgb("+c+", 128, 255)";a.rotate(45*(Math.PI/180));a.moveTo(0,16);a.lineTo(0,21);a.stroke();a.rotate(45*(Math.PI/180))}a.beginPath();a.arc(0,0,20,0,2*Math.PI,true);a.stroke();a.restore()}function mapSceControl(){var c,b,a=-5;this.enable=true;this.counter_runnning=true;this.flame=a;this.stage=1;var d=[],e=[];d[1]=mapScenro();e[1]=mapBgImage();d[2]=mapSce_stage2();e[2]=mapBgImage_stage2();d[3]=mapSce_stage3();e[3]=mapBgImage_stage3();this.change=function(a){this.stage=a;c=[];b=d[this.stage]};this.bgImage=function(){return e[this.stage]};this.init=function(){this.stage=1;c=[];b=d[this.stage]};this.reset=function(){this.enable=true;this.counter_runnning=true;a=-5};this.step=function(g){if(!this.enable)return;if(this.counter_runnning)a++;a=a>2e3?0:a;for(var f in b){var d=b[f];if(d.count<a)continue;if(d.count==a){if(d.x<0&&d.y<0){a=0;break}this.add(d.x,d.y,d.r,d.ch,d.sc)}if(d.count>a)break}for(f in c){var e=c[f];g.set_s(e.x,e.y,e.r,e.ch,e.sce,e.id)}c=[];this.flame=a};this.add=function(f,g,e,d,b,a){if(!this.enable)return;ev={};ev.x=f;ev.y=g;ev.r=e;ev.ch=d;ev.sce=b;if(Boolean(a))ev.id=a;c.push(ev)};this.start=function(){for(var c in b){var a=b[c];a.count<0&&this.add(a.x,a.y,a.r,a.ch,a.sc)}}}function mapScenro(){var d=[[-1,240,608,0,8,0],[-1,208,608,0,17,10],[-1,272,608,0,17,10],[-1,240,240,0,28,18],[-1,320,320,0,29,19],[50,240,0,180,11,1],[100,440,140,225,10,1],[100,40,140,135,9,1],[120,440,140,225,10,1],[120,40,140,135,9,1],[140,440,140,225,10,1],[140,40,140,135,9,1],[160,440,140,225,10,1],[160,40,140,135,9,1],[180,440,140,225,10,1],[180,40,140,135,9,1],[250,140,0,180,2,1],[250,340,0,180,3,1],[280,140,0,180,2,1],[280,340,0,180,3,1],[310,140,0,180,2,1],[310,340,0,180,3,1],[340,140,0,180,2,1],[340,340,0,180,3,1],[390,464,200,0,"effect_warnning_mark",1],[440,479,200,270,15,1],[450,16,220,0,"effect_warnning_mark",1],[500,1,220,90,15,1],[700,240,0,180,23,14],[900,120,0,180,19,1],[900,360,0,180,19,1],[1120,480,0,180,37,2],[1500,240,40,180,34,14],[1600,480,0,180,53,2],[1700,480,0,180,54,2],[1800,-1,-1,180,0,4],[6e5,-1,-1,0,0,0]],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1]*.875;a.y=b[2]*.75;a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function mapBgImage(){var a=new Image;a.src="pict/sky.jpg";return a}function mapInitial(){}function mapSce_stage2(){var a=[[-1,240*.875,608*.75,0,8,0],[-1,208*.875,608*.75,0,17,10],[-1,272*.875,608*.75,0,17,10],[-1,240*.875,240*.75,0,28,18],[-1,320*.875,320*.75,0,29,19]],e=Math.floor(Math.random()*360)+40;a.push([10,e,0,180+Math.floor(Math.random()*40)-20,"ememy_moveshot_1",1]);for(var b=100;b<500;b+=20){e=Math.floor(Math.random()*360);a.push([b,e,0,180+Math.floor(Math.random()*40)-20,"ememy_moveshot_1",1]);b%180==0&&a.push([b,210,0,180,"common_vset6",7])}for(var b=0;b<500;b+=60){var e=Math.floor(Math.random()*360);b%180==0&&a.push([b+500,210,0,180,"common_vset6",7]);a.push([b+500,e,0,180+Math.floor(Math.random()*40)-20,"sce_ememy_randomshot",1])}a.push([1120,0,0,180,37,2]);a.push([1500,210,40,180,34,14]);a.push([1600,0,0,180,53,2]);a.push([1700,0,0,180,54,2]);a.push([1800,-1,-1,180,0,4]);a.push([6e5,-1,-1,0,0,0]);var f=[];for(var g in a){var d=a[g],c={};c.count=d[0];c.x=d[1];c.y=d[2];c.r=d[3];c.sc=d[4];c.ch=d[5];f.push(c)}return f}function mapBgImage_stage2(){var a=new Image;a.src="pict/space.jpg";return a}function mapSce_stage3(){var a=[[-1,240*.875,608*.75,0,8,0],[-1,208*.875,608*.75,0,17,10],[-1,272*.875,608*.75,0,17,10],[-1,240*.875,240*.75,0,28,18],[-1,320*.875,320*.75,0,29,19]],g=Math.floor(Math.random()*360)+40;a.push([10,g,0,180+Math.floor(Math.random()*40)-20,"ememy_moveshot_1",1]);for(var c=100;c<500;c+=100){for(var b=10;b<300;b+=40){a.push([c-50,16,b,0,"effect_warnning_mark",1]);a.push([c-50,403,b+20,0,"effect_warnning_mark",1])}for(var b=10;b<300;b+=40){a.push([c,0,b,90,"ememy_moveshot_1",1]);a.push([c,419,b+20,270,"ememy_moveshot_1",1]);c%200==0&&a.push([c,210,0,180,"common_vset6",7])}}a.push([600,100,50,180,"boss_0",14]);a.push([600,320,50,180,"boss_0",14]);a.push([800,210,0,180,"boss_0",14]);a.push([1120,0,0,180,37,2]);a.push([1500,210,40,180,34,14]);a.push([1600,0,0,180,53,2]);a.push([1700,0,0,180,54,2]);a.push([1800,-1,-1,180,0,4]);a.push([6e5,-1,-1,0,0,0]);var f=[];for(var b in a){var e=a[b],d={};d.count=e[0];d.x=e[1];d.y=e[2];d.r=e[3];d.sc=e[4];d.ch=e[5];f.push(d)}return f}function mapBgImage_stage3(){var a=new Image;a.src="pict/effect.jpg";return a}function sce_message_billboard(b,a){this.init=function(d,c){c.vset(0);c.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;c.p_count=0;c.mes_col=0;c.mes_line=0;c.p_wait=a;c.p_endflag=false;c.p_st=b};this.move=function(b,a){a.p_count--;if(a.p_count<=0){if(a.p_endflag)a.status=0;a.mes_col++;if(a.mes_col>a.p_st[a.mes_line].length){a.mes_col=0;a.mes_line++;if(a.mes_line>a.p_st.length-1){a.mes_line=a.p_st.length-1;a.mes_col=a.p_st[a.mes_line].length;a.p_endflag=true}}a.p_count=a.p_wait+(a.p_endflag?40:0)}return a.sc_move()};this.draw=function(c,b){for(var a=0;a<=b.mes_line;a++)if(a<b.mes_line)c.putchr(b.p_st[a],95,150+16*a);else{var d=b.p_st[a].slice(0,b.mes_col+1);c.putchr(d,95,150+16*a)}}}function sce_message_small(a){this.init=function(b,a){a.vset(1);a.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;a.w_st=a.id;a.x-=a.w_st.length*8/2;a.display_size=1};this.move=function(b,a){if(a.frame>50)a.status=0;a.display_size=1+a.frame/150;a.frame++;return a.sc_move()};this.draw=function(c,b){c.putchr8c(b.w_st,b.x,b.y,a,b.display_size)}}function sce_message_normal(a){this.init=function(c,b){b.vset(0);b.type=5;this.normal_draw_enable=false;this.custom_draw_enable=true;b.w_st=b.id;b.x-=b.w_st.length*12/2;b.wait=a;b.display_size=1};this.move=function(c,b){if(b.frame>a)b.status=0;b.display_size=1+b.frame/60;b.frame++;return b.sc_move()};this.draw=function(b,a){b.putchr(a.w_st,a.x,a.y,a.display_size)}}function motionPattern(){var b=[],a=0;b[a]={};b[a].wait=0;b[a].pattern=[["Space",0,0]];a=1;b[a]={};b[a].pattern=[["Ship",0,0]];a=2;b[a]={};b[a].pattern=[["Ship_r",2,0]];a=3;b[a]={};b[a].pattern=[["Ship_r",0,0]];a=4;b[a]={};b[a].wait=18;b[a].pattern=[["Enemy1",0,0],["Enemy2",0,0],["Enemy3",0,0]];a=5;b[a]={};b[a].wait=10;b[a].pattern=[["S_Tama",0,0],["S_Tama",2,0],["S_Tama",3,0],["S_Tama",1,0]];a=6;b[a]={};b[a].pattern=[["MoTama",0,0]];a=7;b[a]={};b[a].pattern=[["MbTama",0,0]];a=8;b[a]={};b[a].pattern=[["YaTama",-1,-1]];a=9;b[a]={};b[a].pattern=[["Zanki",0,0]];a=10;b[a]={};b[a].wait=10;b[a].pattern=[["Bomb3",0,0],["Bomb1",0,0],["Bomb2",0,0],["Bomb3",0,0],["Bomb4",0,0],["Bomb5",0,0]];a=11;b[a]={};b[a].wait=5;b[a].pattern=[["Powup1",0,0],["Powup2",0,0],["Powup4",0,0],["Powup3",1,0],["Powup2",1,0],["Powup1",1,0],["Powup2",1,0],["Powup3",1,0],["Powup2",0,0]];a=12;b[a]={};b[a].pattern=[["Boss",-1,-1]];a=13;b[a]={};b[a].pattern=[["Wave",0,0]];a=14;b[a]={};b[a].pattern=[["Missile",-1,-1]];a=15;b[a]={};b[a].pattern=[["Option",0,0]];a=15;b[a]={};b[a].wait=20;b[a].pattern=[["Option1",0,0],["Option1",1,0],["Option2",1,0],["Option3",0,0],["Option2",0,0]];a=16;b[a]={};b[a].pattern=[["Boardw",0,0]];a=17;b[a]={};b[a].pattern=[["Boardh",0,0]];a=18;b[a]={};b[a].pattern=[["Bonus",0,0]];a=19;b[a]={};b[a].pattern=[["MiniB",-1,-1]];a=20;b[a]={};b[a].pattern=[["Wave",-1,-1]];a=21;b[a]={};b[a].pattern=[["Laser",-1,-1]];a=22;b[a]={};b[a].pattern=[["pBall",0,0]];a=23;b[a]={};b[a].pattern=[["Laser2",-1,-1]];a=24;b[a]={};b[a].pattern=[["Gunpod",0,0]];a=25;b[a]={};b[a].pattern=[["Warn",0,0]];a=26;b[a]={};b[a].wait=5;b[a].pattern=[["Coin1",0,0],["Coin2",0,0],["Coin3",0,0],["Coin4",0,0],["Coin3",2,0],["Coin2",2,0],["Coin1",2,0]];a=27;b[a]={};b[a].pattern=[["Kobold",0,0]];a=28;b[a]={};b[a].pattern=[["Warn",0,0]];a=29;b[a]={};b[a].pattern=[["Bonus_r",0,0]];a=30;b[a]={};b[a].pattern=[["Bonus_g",0,0]];return b}function ocl_scMove(){var a=0;if(this.status==2)switch(this.type){case 1:case 3:this.change_sce(7);break;case 2:this.display_size*=2;this.change_sce(7);var b=this.chr==14?7:20;this.set_object_ex(b,this.x,this.y,180,36);this.add_score(this.score);break;case 4:this.change_sce(6);this.get_item(this.chr)}if(this.status==0)a=1;this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>this.scrn.cw)a=2;if(this.y<0||this.y>this.scrn.ch)a=2;if(a!=0){a==2&&this.reset_combo(this.type);return-1}this.damageflag=false;return 0}function sce_player(){this.init=function(b,a){a.triger=10;a.w_powup=-1;a.int_shot=0;a.custom_draw_enable=true;a.move_target_x=a.x;a.move_target_y=a.y};this.draw=a;this.move=function(c,a){a.frame++;if(a.frame<=90){a.hp=10;a.damageflag=false}if(a.mouse_state.distance>0){a.move_target_x+=Math.cos(Math.PI/180*(a.mouse_state.deg-90))*a.mouse_state.distance*1;a.move_target_y+=Math.sin(Math.PI/180*(a.mouse_state.deg-90))*a.mouse_state.distance*1;if(a.move_target_x<0)a.move_target_x=0;if(a.move_target_y<0)a.move_target_y=0;if(a.move_target_x>c.cw)a.move_target_x=c.cw;if(a.move_target_y>c.ch)a.move_target_y=c.ch}if(a.mouse_state.x>=0&&a.mouse_state.x<=c.cw&&a.mouse_state.y>=0&&a.mouse_state.y<=c.ch){a.move_target_x=a.mouse_state.x;a.move_target_y=a.mouse_state.y}a.vector=a.target_r(a.move_target_x,a.move_target_y);a.vset(8);var e=a.vector;a.mp=1;if(e>45&&e<135)a.mp=3;if(e>225&&e<315)a.mp=2;a.triger--;if(a.triger<=0){a.shot=0;a.triger=5;a.y<c.ch*.3&&a.collect()}var b=0;for(var d in a.item)if(d==7)b=a.item[d];if(b!=a.w_powup){a.w_powup=b;b==9&&a.set_object_ex(10,a.x,a.y,0,16);if(b>10){a.bomb2();a.set_object_ex(6,a.x,a.y,0,48)}}if(eval(a.mouse_state.button)==0)if(a.shot==0){a.shot=1;if(a.config.sideshot){a.int_shot=1-a.int_shot;a.int_shot==0&&a.set_object_ex(10,a.x,a.y,a.vector,40)}a.vector=0;(b<=1||b>=4)&&a.set_object(6);if(b==2||b==3||b>=6){a.set_object_ex(6,a.x-12,a.y+2,0,13);a.set_object_ex(6,a.x+12,a.y+2,0,13)}if(b>=4){a.set_object_ex(6,a.x-16,a.y+6,355,13);a.set_object_ex(6,a.x+16,a.y+6,5,13)}a.triger=10;if(b>=1)a.triger=5}if(eval(a.mouse_state.button)==1)if(b>=1){a.bomb3();a.set_object_ex(6,a.x,a.y,0,47)}if(a.x+a.vx-a.center_x<0)a.vx=0;if(a.y+a.vy-a.center_y<0)a.vy=0;if(a.x+a.vx+a.center_x>c.cw)a.vx=0;if(a.y+a.vy+a.center_y>c.ch)a.vy=0;if(a.target_d(a.move_target_x,a.move_target_y)<=8){a.vx=0;a.vy=0}a.damageflag&&a.set_object_ex(20,a.x,a.y,0,42,"Damege!");a.damageflag=false;a.x+=a.vx;a.y+=a.vy;var f=0;if(a.status==2){if(a.config.itemreset){if(b==0)b=1;for(d=1;d<=b;d++)this.set_object_ex(7,a.x,a.y,Math.floor(Math.random()*360),38)}a.display_size=2.5;a.change_sce(7)}if(a.status==0)f=1;return f};function a(c,a){var b={};b.x=a.move_target_x;b.y=a.move_target_y;b.sr=(360*((a.maxhp-a.hp)/a.maxhp)-90)*(Math.PI/180);b.df=a.damageflag;b.r=a.frame<90?105-a.frame:15;b.draw=function(a){a.beginPath();a.strokeStyle="gray";a.lineWidth="2";a.arc(this.x,this.y,this.r,0,2*Math.PI,false);a.stroke();a.beginPath();a.lineWidth=this.df?"10":"3";a.strokeStyle=this.df?"red":"white";a.arc(this.x,this.y,this.r,this.sr,1.5*Math.PI,false);a.stroke();a.lineWidth="1"};c.putFunc(b)}}function sce_player_start(){this.init=function(b,a){a.type=98;a.vector=0;a.vset(8)};this.move=function(b,a){a.hp=10;switch(a.frame){case 30:a.vector=180;a.vset(4);break;case 58:case 60:a.vset(3);a.hp=10;a.change_sce(1)}a.frame++;return a.sc_move()}}function sce_pl_bullet_homing(){this.init=function(b,a){a.vector=a.vector>180?a.vector+80:a.vector-80;a.vset(16);a.get_target(2)};this.move=function(b,a){switch(a.frame){case 2:a.get_target(2);a.target_rotate_r(15);a.vset(16);break;case 5:a.frame=1}a.frame++;return a.sc_move()};this.draw=function(c,b){if(!Boolean(b.target))return;var a={};a.sx=b.x;a.sy=b.y;a.ex=b.target.x;a.ey=b.target.y;a.draw=function(a){a.beginPath();a.moveTo(this.sx,this.sy);a.lineTo(this.ex,this.ey);a.strokeStyle="red";a.stroke()};c.putFunc(a)}}function sce_pl_bullet_homing2(){this.init=function(b,a){a.vector=a.vector>180?a.vector-5:a.vector+5;a.vset(4);a.get_target(2);a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 2:a.frame>90&&a.get_target(2);a.target_rotate_r(15+(a.frame<20?15:0));a.vset(4+(a.frame>20?4:0)+(a.frame>25?8:0));break;case 4:a.w_cnt=1}a.w_cnt++;a.frame++;return a.sc_move()}}function sce_pl_bullet_subshot(a){this.init=function(c,b){b.vset(a);b.mp=7;b.alpha=128};this.move=function(b,a){if(a.frame>12)a.status=0;a.frame++;return a.sc_move()}}function sce_pl_bullet_laser_head(){this.init=function(b,a){a.vector=0;a.y=a.y-20;a.vset(28);a.get_target(2);a.alpha=64;a.w_cnt=0};this.move=function(b,a){switch(a.w_cnt){case 2:a.get_target(2);a.target_rotate_r(3);a.vset(28);break;case 4:a.w_cnt=1}a.set_object_ex(23,a.x,a.y,a.vector,46);a.w_cnt++;a.frame++;return a.sc_move()}}function sce_pl_bullet_laser_tail(){this.init=function(b,a){a.vset(0)};this.move=function(b,a){if(a.frame>10)a.status=0;a.frame++;return a.sc_move()}}function scenario(){for(var d={},a=[],c=[],b=[],e=0;e<=37;e++){a[e]=function(b,a){a.vset(5)};b[e]=function(b,a){return a.sc_move()}}w=new sce_player;a[1]=w.init;b[1]=w.move;c[1]=w.draw;a.player=w.init;b.player=w.move;c.player=w.draw;w=new sce_ememy_move_n(45,180);a[2]=w.init;b[2]=w.move;a.ememy_move_n_r=w.init;b.ememy_move_n_r=w.move;w=new sce_ememy_move_n(315,180);a[3]=w.init;b[3]=w.move;a.ememy_move_n_l=w.init;b.ememy_move_n_l=w.move;w=new sce_common_vset(4);a[4]=w.init;b[4]=w.move;a.common_vset4=w.init;b.common_vset4=w.move;w=new sce_effect_vanish;a[6]=w.init;b[6]=w.move;a.effect_vanish=w.init;b.effect_vanish=w.move;w=new sce_effect_bomb;a[7]=w.init;b[7]=w.move;a.effect_bomb=w.init;b.effect_bomb=w.move;w=new sce_player_start;a[8]=w.init;b[8]=w.move;a.player_start=w.init;b.player_start=w.move;w=new sce_ememy_turn(-10);a[9]=w.init;b[9]=w.move;a.ememy_turn_r=w.init;b.ememy_turn_r=w.move;w=new sce_ememy_turn(10);a[10]=w.init;b[10]=w.move;a.ememy_turn_l=w.init;b.ememy_turn_l=w.move;w=new sce_ememy_change_s;a[11]=w.init;b[11]=w.move;a.ememy_change_s=w.init;b.ememy_change_s=w.move;w=new sce_common_vset(6);a[12]=w.init;b[12]=w.move;a.common_vset6=w.init;b.common_vset6=w.move;w=new sce_common_vset(16);a[13]=w.init;b[13]=w.move;a.common_vset16=w.init;b.common_vset16=w.move;w=new sce_en_bullet_homing;a[14]=w.init;b[14]=w.move;a.en_bullet_homing=w.init;b.en_bullet_homing=w.move;w=new sce_ememy_moveshot;a[15]=w.init;b[15]=w.move;a.ememy_moveshot_1=w.init;b.ememy_moveshot_1=w.move;w=new sce_friend_rotate;a[16]=w.init;b[16]=w.move;a.friend_rotate=w.init;b.friend_rotate=w.move;w=new sce_friend_start;a[17]=w.init;b[17]=w.move;a.friend_start=w.init;b.friend_start=w.move;w=new sce_en_bullet_random;a[18]=w.init;b[18]=w.move;a.en_bullet_random=w.init;b.en_bullet_random=w.move;w=new sce_ememy_randomshot;a[19]=w.init;b[19]=w.move;a.sce_ememy_randomshot=w.init;b.sce_ememy_randomshot=w.move;w=new sce_pl_bullet_homing2;a[20]=w.init;b[20]=w.move;a.pl_bullet_homing=w.init;b.pl_bullet_homing=w.move;w=new sce_friend_sidearm;a[21]=w.init;b[21]=w.move;a.friend_sidearm=w.init;b.friend_sidearm=w.move;w=new sce_boss_0;a[23]=w.init;b[23]=w.move;c[23]=w.draw;a.boss_0=w.init;b.boss_0=w.move;c.boss_0=w.draw;w=new sce_common_vset(2);a[24]=w.init;b[24]=w.move;a.common_vset2=w.init;b.common_vset2=w.move;w=new sce_common_vset(8);a[25]=w.init;b[25]=w.move;a.common_vset8=w.init;b.common_vset8=w.move;w=new sce_common_vset(10);a[26]=w.init;b[26]=w.move;a.common_vset10=w.init;b.common_vset10=w.move;w=new sce_effect_billboard(0);a[28]=w.init;b[28]=w.move;a.effect_billboard_v=w.init;b.effect_billboard_v=w.move;w=new sce_effect_billboard(90);a[29]=w.init;b[29]=w.move;a.effect_billboard_h=w.init;b.effect_billboard_h=w.move;w=new sce_item_direct_homing;a[30]=w.init;b[30]=w.move;a.item_direct_homing=w.init;b.item_direct_homing=w.move;w=new sce_en_bullet_accel;a[33]=w.init;b[33]=w.move;a.en_bullet_accel=w.init;b.en_bullet_accel=w.move;w=new sce_boss_1;a[34]=w.init;b[34]=w.move;c[34]=w.draw;a.boss_1=w.init;b.boss_1=w.move;c.boss_1=w.draw;w=new sce_item_near_homing;a[36]=w.init;b[36]=w.move;a.item_near_homing=w.init;b.item_near_homing=w.move;w=new sce_message_billboard(["Event Message Test","= WARNING MESSAGE =","!! Message Test !!!","!!! Message Test !!","= WARNING MESSAGE ="],3);a[37]=w.init;b[37]=w.move;c[37]=w.draw;a.message_billboard_wm=w.init;b.message_billboard_wm=w.move;c.message_billboard_wm=w.draw;w=new sce_item_movingstop;a[38]=w.init;b[38]=w.move;a.item_movingstop=w.init;b.item_movingstop=w.move;w=new sce_message_small(0);a[39]=w.init;b[39]=w.move;c[39]=w.draw;a.message_small_w=w.init;b.message_small_w=w.move;c.message_small_w=w.draw;w=new sce_message_small(1);a[42]=w.init;b[42]=w.move;c[42]=w.draw;a.message_small_r=w.init;b.message_small_r=w.move;c.message_small_r=w.draw;w=new sce_message_small(2);a[43]=w.init;b[43]=w.move;c[43]=w.draw;a.message_small_g=w.init;b.message_small_g=w.move;c.message_small_g=w.draw;w=new sce_message_small(3);a[44]=w.init;b[44]=w.move;c[44]=w.draw;a.message_small_b=w.init;b.message_small_b=w.move;c.message_small_b=w.draw;w=new sce_pl_bullet_subshot(8);a[40]=w.init;b[40]=w.move;a.pl_bullet_subshot_pl=w.init;b.pl_bullet_subshot_pl=w.move;w=new sce_pl_bullet_subshot(1);a[41]=w.init;b[41]=w.move;a.pl_bullet_subshot_op=w.init;b.pl_bullet_subshot_op=w.move;w=new sce_pl_bullet_laser_head;a[45]=w.init;b[45]=w.move;a.pl_bullet_laser_head=w.init;b.pl_bullet_laser_head=w.move;w=new sce_pl_bullet_laser_tail;a[46]=w.init;b[46]=w.move;a.pl_bullet_laser_tail=w.init;b.pl_bullet_laser_tail=w.move;w=new sce_effect_bombcircle("rgba(255, 64, 64, 0.7)");a[47]=w.init;b[47]=w.move;c[47]=w.draw;a.effect_bombcircle_r=w.init;b.effect_bombcircle_r=w.move;c.effect_bombcircle_r=w.draw;w=new sce_effect_bombcircle("rgba(255, 255, 255, 0.7)");a[48]=w.init;b[48]=w.move;c[48]=w.draw;a.effect_bombcircle_w=w.init;b.effect_bombcircle_w=w.move;c.effect_bombcircle_w=w.draw;w=new sce_en_bullet_hominglaser;a[49]=w.init;b[49]=w.move;a.en_bullet_hominglaser=w.init;b.en_bullet_hominglaser=w.move;w=new sce_boss_2;a[50]=w.init;b[50]=w.move;c[50]=w.draw;a.boss_2=w.init;b.boss_2=w.move;c.boss_2=w.draw;w=new sce_en_bullet_infolaser;a[51]=w.init;b[51]=w.move;c[51]=w.draw;a.en_bullet_infolaser=w.init;b.en_bullet_infolaser=w.move;c.en_bullet_infolaser=w.draw;w=new sce_en_bullet_turn;a[52]=w.init;b[52]=w.move;a.sce_en_bullet_turn=w.init;b.sce_en_bullet_turn=w.move;w=new sce_message_billboard(["Event Message Test","= Mission Complate.\u3000="],0);a[53]=w.init;b[53]=w.move;c[53]=w.draw;a.message_billboard_cp=w.init;b.message_billboard_cp=w.move;c.message_billboard_cp=w.draw;w=new sce_common_signal(835);a[54]=w.init;b[54]=w.move;a.common_signal_result=w.init;b.common_signal_result=w.move;w=new sce_effect_warnning_mark;a[55]=w.init;b[55]=w.move;a.effect_warnning_mark=w.init;b.effect_warnning_mark=w.move;w=new sce_en_bullet_laser_tail;a[56]=w.init;b[56]=w.move;a.en_bullet_laser_tail=w.init;b.en_bullet_laser_tail=w.move;w=new sce_message_normal(60);a[57]=w.init;b[57]=w.move;c[57]=w.draw;a.message_normal_60=w.init;b.message_normal_60=w.move;c.message_normal_60=w.draw;w=new sce_exev_3way;a[100]=w.init;b[100]=w.move;a.exev_3way=w.init;b.exev_3way=w.move;w=new sce_exev_5way_nallow;a[102]=w.init;b[102]=w.move;a.exev_5way_nallow=w.init;b.exev_5way_nallow=w.move;w=new sce_exev_5way_normal;a[103]=w.init;b[103]=w.move;a.exev_5way_normal=w.init;b.exev_5way_normal=w.move;w=new sce_exev_5expansion;a[104]=w.init;b[104]=w.move;a.exev_5expansion=w.init;b.exev_5expansion=w.move;w=new sce_exev_3way_exp;a[104]=w.init;b[104]=w.move;a.exev_3way_exp=w.init;b.exev_3way_exp=w.move;d.init=a;d.draw=c;d.move=b;return d}function sceneBase(a){var g=a.graphics1,f=a.graphics2;this.init=d;this.reset=b;this.step=e;this.draw=c;function d(){}function b(){}function e(){return 0}function c(){}}function sceneConfig(n){var i=n.graphics1,e=n.graphics2,b=n.text,B=n.mouse_state,A=n.key_state;this.init=x;this.reset=v;this.step=y;this.draw=w;var j;this.score=0;this.config={};var d=[],c=[],r=[],l,t=false,s=false,u,k,a=[],h=["FullPower.","SideShot.","ItemReset.","Option.","---.","Stage."],o=["\u30d1\u30ef\u30fc\u30a2\u30c3\u30d7\u6700\u5927\u3067\u958b\u59cb : ","\u5f3e\u6d88\u3057\u5f3e[\u25ce]\u3092\u4f7f\u7528 : ","\u6b7b\u3093\u3060\u3068\u304d\u306b\u30a2\u30a4\u30c6\u30e0\u653e\u51fa : ","\u652f\u63f4\u6a5f(\u30aa\u30d7\u30b7\u30e7\u30f3)\u4f7f\u7528 : ","\u672a\u4f7f\u7528 : ","\u958b\u59cb\u9762\u306e\u9078\u629e : "];c[5]=1;for(var p=60,q=180,f=0;f<h.length-1;f++){m={};m.title=h[f];m.x=p;m.y=q+f*20;m.w=120;m.h=16;m.msg=o[f];m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();return 0};a.push(m);for(var g=0;g<2;g++){m={};m.title=g==0?"  On":"  Off";m.x=p+80+80*(g+1);m.y=q+f*20;m.w=80;m.h=16;m.msg=o[f]+(g==0?"\u6709\u52b9":"\u7121\u52b9");m.sel=false;m.lamp=false;m.num=f;m.sw=g==0?true:false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();d[this.num]=this.sw;return 0};a.push(m)}}m={};m.title=h[h.length-1]+c[h.length-1];m.x=p;m.y=q+(h.length-1)*20;m.w=120;m.h=16;m.msg=o[f];m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();return 0};wm=m;a.push(m);for(var g=0;g<2;g++){m={};m.title=g==0?"  +1":"  -1";m.x=p+80+80*(g+1);m.y=q+f*20;m.w=80;m.h=16;m.msg=o[f];m.sel=false;m.lamp=false;m.num=h.length-1;m.sw=g==0?1:-1;m.func=function(){d[this.num]=this.sw==1?true:false;c[this.num]+=this.sw;if(c[this.num]<1)c[this.num]=1;if(c[this.num]>3)c[this.num]=2;wm.title=h[this.num]+c[this.num];b.clear();b.reset();b.print(this.msg+c[this.num]+"\u9762",100,320,"white");b.draw();return 0};a.push(m)}m={};m.title="Save.";m.x=100;m.y=360;m.w=120;m.h=16;m.jp=2;m.msg="Save.";m.sel=false;m.lamp=false;m.config=this.config;m.result=this.result;m.func=function(){t=true;j=true;return 0};a.push(m);m={};m.title="Reset.";m.x=100;m.y=380;m.w=120;m.h=16;m.jp=2;m.msg="Reset.";m.sel=false;m.lamp=false;m.func=function(){s=true;j=true;return 0};a.push(m);m={};m.title="Exit.";m.x=100;m.y=400;m.w=120;m.h=16;m.jp=2;m.msg="Exit.";m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();return this.jp};a.push(m);var z,C=new Number(0);this.config_load=function(){if(Boolean(localStorage)){for(var b=["fullpower","sideshot","itemreset","option","dummy","startstage"],e=false,a=0;a<=3;a++)if(Boolean(localStorage.getItem(b[a]))){e=true;d[a]=localStorage.getItem(b[a])=="on"?true:false;this.config[b[a]]=d[a]}if(Boolean(localStorage.getItem(b[5]))){e=true;c[5]=parseInt(localStorage.getItem(b[5]));this.config[b[5]]=c[5];wm.title=h[5]+c[5]}}};function x(){this.config.fullpower=false;this.config.sideshot=true;this.config.itemreset=true;this.config.option=true;this.config.startstage=1;this.config.cold=true;this.config.debug=false;d[0]=this.config.fullpower;d[1]=this.config.sideshot;d[2]=this.config.itemreset;d[3]=this.config.option;d[4]=false;d[5]=false;c[5]=this.config.startstage}function v(){for(var b in a){a[b].sel=false;a[b].lamp=false}u=false;k=0;z=0;e.clear("darkblue");cl={};cl.w=i.cw;cl.h=i.ch;cl.draw=function(a){var c=this.h;if(c<this.w)c=this.w;a.beginPath();for(var b=0;b<c;b+=16){a.moveTo(b,0);a.lineTo(b,this.h);a.moveTo(0,b);a.lineTo(this.w,b)}a.strokeStyle="lightgray";a.stroke()};e.putFunc(cl);e.draw();e.reset();for(b in c)if(Boolean(c[b]))r[b]=c[b];j=true}function y(){l=[];var g=B.check_last(),o=A.check(),p=g.x,q=g.y;if(g.button==0&&!j){for(var f in a)if(a[f].sel){var m=a[f].func();if(m!=0)return m}}else for(f in c)if(Boolean(c[f]))r[f]=c[f];if(g.button==-1)j=false;if(u){var i={};i.cw=e.cw;i.ch=e.ch;i.y1=e.ch/2-k;i.y2=e.ch/2+k;i.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};e.putFunc(i);e.draw();e.reset();k+=4;if(e.ch/2-k<0)return 1}var n=-1;for(f in a)if(g.x>=a[f].x&&g.x<=a[f].x+a[f].w&&g.y>=a[f].y&&g.y<=a[f].y+a[f].h){a[f].sel=true;n=f}else a[f].sel=false;l.push("== Configration ==");l.push("-----------------");for(f in d)if(d[f]){a[f*3+1].lamp=true;a[f*3+2].lamp=false}else{a[f*3+1].lamp=false;a[f*3+2].lamp=true}for(f in c)if(Boolean(c[f]))if(c[f]!=r[f]){a[f*3+1].lamp=false;a[f*3+2].lamp=false;a[f*3+1].sel=false;a[f*3+2].sel=false}this.config.fullpower=d[0];this.config.sideshot=d[1];this.config.itemreset=d[2];this.config.option=d[3];this.config.startstage=c[5];if(s){d[0]=false;d[1]=true;d[2]=true;d[3]=true;d[4]=false;d[5]=false;c[5]=1;wm.title=h[5]+c[5];b.clear();b.reset();b.print("\u8a2d\u5b9a\u521d\u671f\u5316\u3057\u307e\u3057\u305f\u3002",100,320,"white");if(Boolean(localStorage)){localStorage.clear();b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u30af\u30ea\u30a2\u3002",100,340,"white")}else b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,340,"white");b.draw();s=false}if(t){b.clear();b.reset();if(Boolean(localStorage)){localStorage.setItem("fullpower",this.config.fullpower?"on":"off");localStorage.setItem("sideshot",this.config.sideshot?"on":"off");localStorage.setItem("itemreset",this.config.itemreset?"on":"off");localStorage.setItem("option",this.config.option?"on":"off");localStorage.setItem("startstage",new String(this.config.startstage));b.print("\u8a2d\u5b9a\u3092\u30bb\u30fc\u30d6\u3057\u307e\u3057\u305f\u3002",100,320,"white")}else b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,320,"white");b.draw();t=false}return 0}function w(){for(var d in l)i.putchr(l[d],0,100+16*d);for(var b in a){if(a[b].lamp){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};i.putFunc(c)}if(a[b].sel)i.putchr(a[b].title,a[b].x-4,a[b].y-1);else i.putchr(a[b].title,a[b].x,a[b].y)}}}function sceneControl(d){var a=[];a[1]=new gameScene(d);a[2]=new sceneTitle(d);a[3]=new sceneGover(d);a[4]=new sceneConfig(d);a[5]=new sceneResult(d);for(var e in a)a[e].init();var f=a[1].result,g=a[4].config;a[1].score_load();a[4].config_load();for(var e in a){a[e].result=f;a[e].config=g}var h=a[2],c=2,b=c;this.step=function(){if(c!=0){var f=a[b].result,e=a[b].config,d=false;if(c>=10){c=c%10;d=true}b=c;a[b].reset(d);a[b].result=f;a[b].config=e}c=a[b].step()};this.draw=function(){a[b].draw()}}function sceneGover(f){var h=f.graphics1,c=f.graphics2,o=f.mouse_state,q=f.key_state;this.init=m;this.reset=k;this.step=n;this.draw=l;var g,e,j,d,i,a=[],b={};b.title="Continue.";b.x=100;b.y=160;b.w=120;b.h=16;b.sel=false;b.func=function(){return 11};a.push(b);b={};b.title="End.";b.x=100;b.y=180;b.w=120;b.h=16;b.sel=false;b.func=function(){return 2};a.push(b);function m(){}function k(){for(var b in a)a[b].sel=false;j=false;d=2;i=0;var l={};l.cw=c.cw;l.ch=c.ch;l.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="black";a.stroke()}};c.putFunc(l);var e=this.result.score,f=[],h="";for(b=0;b<7;b++){var k=e%10;f[7-b]=k;e=(e-k)/10}for(b in f)h=h+""+f[b];c.putchr("Score:"+h,240,16);e=this.result.highscore;f=[];h="";for(b=0;b<7;b++){var k=e%10;f[7-b]=k;e=(e-k)/10}for(b in f)h=h+""+f[b];c.putchr("Hi-Sc:"+h,240,0);c.draw();c.reset();this.config.cold=true;g=true}function n(){e=[];var f=o.check_last();if(f.button==0&&!g)for(var b in a)if(a[b].sel){var k=a[b].func();if(k!=0)return k}if(f.button==-1)g=false;if(j){var h={};h.cw=c.cw;h.ch=c.ch;h.y1=c.ch/2-d;h.y2=c.ch/2+d;h.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};c.putFunc(h);c.draw();c.reset();d+=8;if(c.ch/2-d<0)return i}for(b in a)if(f.x>=a[b].x&&f.x<=a[b].x+a[b].w&&f.y>=a[b].y&&f.y<=a[b].y+a[b].h)a[b].sel=true;else a[b].sel=false;e.push("== Game Over ==");e.push("---------------");return 0}function l(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};h.putFunc(c)}h.putchr(a[b].title,a[b].x,a[b].y)}for(var d in e)h.putchr(e[d],0,132+16*d)}}function sceneResult(f){var i=f.graphics1,b=f.graphics2,e=f.text,p=f.mouse_state,q=f.key_state;this.init=n;this.reset=l;this.step=o;this.draw=m;var h,g,k,d,j,a=[],c={};c.title="[   ok.  ]";c.x=160;c.y=320;c.w=120;c.h=16;c.sel=false;c.func=function(){e.clear();return 11};a.push(c);function n(){}function l(){for(var c in a)a[c].sel=false;k=false;d=2;j=0;var n={};n.cw=b.cw;n.ch=b.ch;n.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="darkblue";a.stroke()}};b.putFunc(n);var f=this.result.score,g=[],i="";for(c=0;c<7;c++){var m=f%10;g[7-c]=m;f=(f-m)/10}for(c in g)i=i+""+g[c];b.putchr("Score:"+i,240,16);f=this.result.highscore;g=[];i="";for(c=0;c<7;c++){var m=f%10;g[7-c]=m;f=(f-m)/10}for(c in g)i=i+""+g[c];b.putchr("Hi-Sc:"+i,240,0);b.draw();b.reset();var o=["dummy","dummy","\u6575\u6a5f\u6483\u7834","dummy","\u30b9\u30b3\u30a2\u30a2\u30a4\u30c6\u30e0\u53d6\u5f97","dummy"],l=[];for(c in this.result.combo)l.push("\u9023\u7d9a"+o[c]+"\u6570 : "+this.result.combo[c]);for(c in this.result.combomax)l.push("\u6700\u5927\u9023\u7d9a"+o[c]+"\u6570 : "+this.result.combomax[c]);var p=0;for(c in this.result.total)if(c==2)p=this.result.total[c];var q=1;for(c in this.result.obCount)if(c==2)q=this.result.obCount[c];l.push("\u6575\u6a5f\u6483\u589c\u7387 : "+Math.floor(p/q*100)+" %");l.push("\u88ab\u5f3e\u56de\u6570 : "+this.result.hidan);e.reset();for(var r in l)e.print(l[r],100,150+16*r,"yellow");e.draw();e.reset();h=true}function o(){g=[];var e=p.check_last();if(e.button==0&&!h)for(var c in a)if(a[c].sel){var i=a[c].func();if(i!=0)return i}if(e.button==-1)h=false;if(k){var f={};f.cw=b.cw;f.ch=b.ch;f.y1=b.ch/2-d;f.y2=b.ch/2+d;f.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(f);b.draw();b.reset();d+=8;if(b.ch/2-d<0)return j}for(c in a)if(e.x>=a[c].x&&e.x<=a[c].x+a[c].w&&e.y>=a[c].y&&e.y<=a[c].y+a[c].h)a[c].sel=true;else a[c].sel=false;g.push(" == Result Scene (Stage Clear) ==");return 0}function m(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};i.putFunc(c)}i.putchr(a[b].title,a[b].x,a[b].y)}for(var d in g)i.putchr(g[d],0,80+16*d)}}function sceneTitle(g){var c=g.graphics1,b=g.graphics2,t=g.mouse_state,r=g.key_state;this.init=p;this.reset=n;this.step=q;this.draw=o;for(var i,e,j,d,a=[],k=["GameStart.","Config"],s=[1,4],f=0;f<k.length;f++){m={};m.title=k[f];m.x=100;m.y=320+f*20;m.w=120;m.h=16;m.jp=s[f];m.sel=false;m.func=function(){return this.jp};a.push(m)}var h,l=new Number(0);function p(){l=0}function n(){for(var e in a)a[e].sel=false;j=false;d=0;h=0;b.clear("black");cl={};cl.w=c.cw;cl.h=c.ch;cl.draw=function(a){var c=this.h;if(c<this.w)c=this.w;a.beginPath();for(var b=0;b<c;b+=16){a.moveTo(b,0);a.lineTo(b,this.h);a.moveTo(0,b);a.lineTo(this.w,b)}a.strokeStyle="lightgray";a.stroke()};b.putFunc(cl);b.draw();b.reset();this.config.cold=true;i=true}function q(){e=[];var c=t.check_last(),k=r.check();if(c.wheel!=0)l+=c.wheel>0?1:-1;var m=c.x,n=c.y;if(c.button==0&&!i)for(var f in a)if(a[f].sel){var h=a[f].func();if(h!=0)return h}c.button==1;if(c.button==-1)i=false;if(j){var g={};g.cw=b.cw;g.ch=b.ch;g.y1=b.ch/2-d;g.y2=b.ch/2+d;g.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(g);b.draw();b.reset();d+=4;if(b.ch/2-d<0)return 1}for(f in a)if(c.x>=a[f].x&&c.x<=a[f].x+a[f].w&&c.y>=a[f].y&&c.y<=a[f].y+a[f].h)a[f].sel=true;else a[f].sel=false;e.push("== Title Scene ==");e.push("-----------------");return 0}function o(){cl={};cl.x=120;cl.y=160;h++;cl.mode=h%200;cl.draw=star_draw;c.putFunc(cl);for(var d in e)c.putchr(e[d],0,132+16*d);for(var b in a)if(a[b].sel)c.putchr(a[b].title,a[b].x-4,a[b].y-1);else c.putchr(a[b].title,a[b].x,a[b].y)}}function star_draw(a){a.save();a.setTransform(1,0,0,1,this.x,this.y);a.rotate(1.8*(Math.PI/180)*this.mode);a.beginPath();a.fillStyle="orange";a.fillRect(-80,-80,160,160);a.rotate(45*(Math.PI/180));a.beginPath();a.fillStyle="orange";a.fillRect(-80,-80,160,160);a.restore()}function Screen(A,F,E){var r=1500,o=new Image;o.src="pict/cha.png";var i=new Image;i.src="pict/aschr.png";var a=[],u=[],f=document.getElementById(A);f.width=F;f.height=E;var c=f.getContext("2d");this.cw=f.width;this.ch=f.height;var m=false,l=false;this.sprite_texture_ready=m;this.character_texture_ready=l;c.font="16px 'Arial'";o.onload=function(){m=true};i.onload=function(){l=true};this.readystate_check=function(){this.sprite_texture_ready=m;this.character_texture_ready=l};var D=spdata(),G=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=12*j;ptn.y=16*b;ptn.w=12;ptn.h=16;u.push(ptn)}var t=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=8*j;ptn.y=8*b+128;ptn.w=8;ptn.h=8;t.push(ptn)}for(var y=[],k=0;k<=3;k++){var z=[];for(b=0;b<7;b++)for(j=0;j<16;j++){ptn={};ptn.x=8*j+(k%2==0?0:128);ptn.y=8*b+128+(k>=2?64:0);ptn.w=8;ptn.h=8;z.push(ptn)}y[k]=z}for(var h=0,w=[],b=0;b<r;b++)w[b]=new d;this.lighter_enable=true;var n=0;function e(){h++;if(h>=r)h=0;return w[h]}this.put=function(k,l,m,i,j,f,d){if(!Boolean(i))i=0;if(!Boolean(j))j=0;if(!Boolean(f))f=255;if(!Boolean(d))d=1;var b=e();b.img=o;var c=D[k];b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=-c.w/2*d;b.dy=-c.h/2*d;b.dw=c.w*d;b.dh=c.h*d;b.tx=l;b.ty=m;b.alpha=f;b.r=j;var h=1,g=1;switch(i){case 1:h=-1;break;case 2:g=-1;break;case 3:h=-1;g=-1}b.m11=g;b.m12=0;b.m21=0;b.m22=h;b.light_enable=this.light_enable;b.mode=x;a[a.length]=b};this.putPattern=function(d,c,i,j,h,f){var b=e();b.img=d;b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=i;b.dy=j;b.dw=h;b.dh=f;b.mode=g;a[a.length]=b};this.print=function(d,f,g,c){if(!Boolean(c))c="limegreen";var b=e();b.text=d;b.sx=f;b.sy=g;b.color=c;b.mode=v;a[a.length]=b};this.putchr=function(k,m,n,d){var j=false;if(!Boolean(d))d=1;else if(d!=1)j=true;for(var f=0,l=k.length;f<l;f++){var h=k.charCodeAt(f);if(h>=32&&h<128){var b=e();b.img=i;var c=u[h-32];b.sx=c.x;b.sy=c.y;b.sw=c.w;b.sh=c.h;b.dx=m+f*(12*d);b.dy=n;if(j){b.dx+=-c.w/2*d;b.dy+=-c.h/2*d}b.dw=c.w*d;b.dh=c.h*d;b.mode=g;a[a.length]=b}}};this.putchr8=B;function B(h,j,k){for(b=0;b<h.length;b++){var f=h.charCodeAt(b);if(f>=32&&f<128){var c=e();c.img=i;var d=t[f-32];c.sx=d.x;c.sy=d.y;c.sw=d.w;c.sh=d.h;c.dx=j+b*8;c.dy=k;c.dw=d.w;c.dh=d.h;c.mode=g;a[a.length]=c}}}this.putchr8c=function(j,l,m,k,f){if(!Boolean(f))f=1;for(b=0;b<j.length;b++){var h=j.charCodeAt(b);if(h>=32&&h<128){var c=e();c.img=i;var d=y[k][h-32];c.sx=d.x;c.sy=d.y;c.sw=d.w;c.sh=d.h;c.dx=l+b*(8*f)+-d.w/2*f;c.dy=m+-d.h/2*f;c.dw=d.w*f;c.dh=d.h*f;c.mode=g;a[a.length]=c}}};this.putImage=function(c,d,f){var b=e();b.img=c;b.sx=d;b.sy=f;b.mode=s;a[a.length]=b};this.putImage2=function(c,g,h,f,d){var b=e();b.img=c;b.sx=g;b.sy=h;b.sw=f;b.sh=d;b.mode=q;a[a.length]=b};this.putImageTransform=function(h,i,j,c,d,f,g){var b=e();b.img=h;b.tx=i;b.ty=j;b.m11=c;b.m12=d;b.m21=f;b.m22=g;b.mode=p;a[a.length]=b};this.transform=function(a,b,d,e){c.setTransform(a,b,d,e,0,0)};this.putFunc=function(b){a[a.length]=b};this.clear=function(a){c.save();c.setTransform(1,0,0,1,0,0);c.clearRect(0,0,f.width,f.height);c.restore();if(Boolean(a)){c.fillStyle=a;c.fillRect(0,0,f.width,f.height)}};this.fill=function(e,f,d,b,a){if(Boolean(a)){c.fillStyle=a;c.fillRect(e,f,d,b)}else c.clearRect(e,f,d,b)};this.reset=function(){a=[];h=0};this.draw=function(){for(var b=0,d=a.length;b<d;b++)a[b].draw(c);if(n<a.length)n=a.length};this.count=function(){return n};var C=0,x=1,g=2,q=3,s=4,v=5,p=6;function d(){this.img;this.text;this.sx;this.sy;this.sw;this.sh;this.dx;this.dy;this.dw;this.dh;this.color;this.use_tranceform;this.light_enable;this.m11;this.m12;this.m21;this.m22;this.tx;this.ty;this.alpha;this.r;this.mode}d.prototype.func=[];d.prototype.func[C]=function(){};d.prototype.func[x]=function(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty);this.r!=0&&a.rotate(Math.PI/180*this.r);if(this.alpha==255)a.globalCompositeOperation="source-over";else{if(this.light_enable)a.globalCompositeOperation="lighter";a.globalAlpha=this.alpha*(1/255)}a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh);a.restore()};d.prototype.func[g]=function(a){a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh)};d.prototype.func[q]=function(a){a.drawImage(this.img,this.sx,this.sy,this.sw,this.sh)};d.prototype.func[s]=function(a){a.drawImage(this.img,this.sx,this.sy)};d.prototype.func[v]=function(a){a.fillStyle=this.color;a.fillText(this.text,this.sx,this.sy)};d.prototype.func[p]=function(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty);a.drawImage(this.img,0,0);a.restore()};d.prototype.draw=function(a){this.func[this.mode].call(this,a)}}function soundControl(){}function spdata(){var d=[["Ship",0,0,31,31],["Ship_r",32,0,31,31],["Enemy1",64,0,31,31],["Enemy2",96,0,31,31],["Enemy3",128,0,31,31],["S_Tama",0,32,7,7],["MoTama",16,32,15,15],["MbTama",32,32,15,15],["YaTama",48,32,15,15],["Zanki",64,32,15,15],["Space",0,48,15,15],["Star1",16,48,15,15],["Star2",32,48,15,15],["Star3",48,48,15,15],["Bomb1",160,0,31,31],["Bomb2",192,0,31,31],["Bomb3",224,0,31,31],["Bomb4",256,0,31,31],["Bomb5",288,0,31,31],["Powup1",128,32,31,15],["Powup2",160,32,31,15],["Powup3",192,32,31,15],["Powup4",224,32,31,15],["Boss",0,64,31,31],["MiniB",32,64,16,16],["Wave",64,64,159,31],["Missile",80,32,15,15],["Laser",48,64,15,31],["Laser2",80,48,15,15],["Option",96,32,15,15],["Option1",96,32,15,15],["Option2",64,144,15,15],["Option3",64,160,15,15],["Gunpod",80,144,15,31],["Boardw",0,96,223,31],["Boardh",288,32,31,95],["pBall",64,48,15,15],["Bonus",112,32,15,15],["Bonus_b",112,32,15,15],["Bonus_r",0,160,15,15],["Bonus_g",16,160,15,15],["Coin1",0,144,15,15],["Coin2",16,144,15,15],["Coin3",32,144,15,15],["Coin4",48,144,15,15],["Kobold",96,48,15,15],["Warn",32,160,15,15],["Dummy",112,32,15,15]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}function TextScreen(){for(var d=30,b=[],c=0;c<d;c++){var a=document.createElement("div");a.id="div"+c;a.style.position="absolute";a.style.display="inline";a.style.top=c+"px";a.style.left=c+"px";a.style.width="24px";a.style.height="20px";var f=document.getElementsByTagName("body").item(0);f.appendChild(a)}var i=0;this.print=function(d,f,g,c){if(!Boolean(c))c="green";var a={};a.text=d;a.x=f;a.y=g;a.color=c;a.draw=e;b.push(a)};function e(a){a.style.color=this.color;a.style.backgroundColor="transparent";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.width=16*this.text.length+"px";a.style.visibility="visible";a.style.display="inline";a.innerHTML=this.text}this.putFunc=function(a){b.push(a)};this.clear=function(){for(var a=0;a<d;a++){var b=document.getElementById("div"+a);b.style.visibility="hidden";b.style.display="none"}};this.reset=function(){b=[]};this.draw=function(){for(var a in b){if(a>=d)break;b[a].draw(document.getElementById("div"+a))}}}