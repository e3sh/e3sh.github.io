function character(){var d=[[0,1,10,98,16,16,24,24,0,0,24,15,15,24,0,0],[1,4,7,2,16,16,24,24,0,0,7,5,5,7,0,100],[5,8,1,3,8,8,12,12,4,4,5,5,5,5,0,0],[6,9,2,1,8,8,12,12,13,13,5,5,5,5,0,0],[10,15,10,0,16,8,20,12,21,21,7,15,15,7,1,0]],c=[];for(var e in d){var a=d[e],b={};b.mp=a[1];b.hp=a[2];b.type=a[3];b.center_x=a[4];b.center_y=a[5];b.size_x=a[6];b.size_y=a[7];b.senario=[a[8],a[9],a[10],a[11],a[12],a[13]];b.id=a[14];b.score=a[15];c[a[0]]=b}return c}function sce_common_vset(a){this.init=function(c,b){b.vset(a)};this.move=function(b,a){return a.sc_move()}}function sce_common_signal(a){this.init=function(b,a){a.vset(0);a.normal_draw_enable=false;a.custom_draw_enable=false;a.x=a.gt.world_x+1;a.y=a.gt.world_y+1};this.move=function(c,b){b.x=b.gt.world_x+1;b.y=b.gt.world_y+1;if(b.frame==0)b.SIGNAL(a);else{b.SIGNAL(0);b.status=0}b.frame++;return b.sc_move()}}function deviceControl(){var b=new Screen("b_canvas"),a=new Screen("a_canvas"),c=new TextScreen("text_div"),f=new inputControl("a_canvas"),d=new inputKeyboard,e=new geometoryTrance;this.graphics=a;this.graphics1=a;this.graphics2=b;this.text=c;this.canvas=a;this.canvas1=a;this.canvas2=b;this.gs=e;this.layout=new gameLayout;this.mouse_state=f;this.key_state=d}function sce_effect_vanish(){this.init=function(b,a){a.type=5;a.status=5};this.move=function(){return-1}}function sce_effect_bomb(){this.init=function(b,a){a.vset(1);a.mp=10;a.type=5;a.status=5;a.frame=0;a.alpha=254};this.move=function(b,a){switch(a.frame){case 90:a.status=0}a.frame++;if(a.frame>30)a.alpha-=3;return a.sc_move()}}function sce_enemy_moveshot(){this.init=function(b,a){a.vset(0);a.display_size=1+a.hp*.1;a.power=30};this.move=function(b,a){Math.floor(Math.random()*a.power)==0&&a.set_object_ex(5,a.x,a.y,180,"common_vset4");a.display_size=1+a.hp*.1;if(a.frame>120*30&&a.power==30){a.vset(2);a.power=20}a.frame++;return a.sc_move()}}function sce_friend_rotate(){this.init=function(b,a){a.vector=0;a.vset(0);a.get_target(98);a.startflag=true;a.shot=0;a.triger=0;a.amove=-1};this.move=function(d,a){a.hp=10;if(!a.config.option)a.status=0;var b=0;if(a.startflag){a.get_target(98);a.startflag=false;return 0}if(!Boolean(a.target))return 0;if(a.target.type!=98)if(a.startflag){a.get_target(98);a.startflag=false}else a.change_sce(7);a.triger--;if(a.triger<=0){a.shot=0;a.triger=0}if(eval(a.mouse_state.button)==0)if(a.shot==0){a.shot=1;a.triger=15;if(a.target.vector!=0)if(a.target.vector<180)a.amove=1;else a.amove=2}if(this.status==0)b=1;a.vector=0;var c=16;if(a.triger>0){if(a.damageflag==true){this.add_score(1);a.set_object(6);a.damageflag=false}if(a.amove==1)a.vector=-45+a.triger*6;else a.vector=45-a.triger*6}a.x=a.target.x+a.Cos(a.vector)*16;a.y=a.target.y+a.Sin(a.vector)*c;return b}}function gameScene(c){var f=c.graphics1,d=c.graphics2;this.init=s;this.reset=q;this.step=t;this.draw=r;this.score=0;this.result;this.config;var a,b,p,x=0,g=0,h=[],v=[],y=false,k=true,u=0,e=0,l=0,j=false,m=0,o=0,n=0;this.score_load=function(){if(Boolean(localStorage)){var a=false;if(Boolean(localStorage.getItem("highscore"))){a=true;this.result.highscore=parseInt(localStorage.getItem("highscore"))}}};function s(){a=new gObjectControl(f,c);b=new mapSceControl;b.init();this.result={};this.result.highscore=0;this.result.score=0;this.result.item=a.item;this.result.combo=a.combo;j=false}function q(c){a.config=this.config;if(!Boolean(c))c=false;j=false;if(c){a.reset(true);if(this.config.cold)g=-1}else{a.reset(false);b.change(this.config.startstage);b.reset();g=0;k=true;u=0;e=0;l=0}n=0;if((c=true)&&!this.config.cold){w=b.stage;w++;if(w>5)w=1;b.change(w);b.start(true);e=0;l=0}h=b.bgImage();v=b.mapChip();d.clear("silver");d.putImage(h[0],0,0);d.draw();h.onload=function(){d.putImage(h[0],0,0);d.draw();var a=true;h.onload=function(){}};d.reset();p=new gs_score_effect(a.score);ehighscore=new gs_score_effect(this.result.highscore)}function t(){if(a.interrapt){if(a.SIGNAL==1){b.enable=false;b.counter_runnning=false}if(a.SIGNAL==6055){if(e==0)k=false;b.enable=true;b.counter_runnning=false}if(a.SIGNAL==835){this.result.score=a.score;this.result.item=a.item;this.result.combo=a.combo;this.result.combomax=a.combomax;this.result.obCount=a.obCount;this.result.total=a.total;this.result.hidan=a.hidan;this.config.cold=false;a.interrapt=false;a.SIGNAL=0;a.draw(d);j=true;return 5}if(a.SIGNAL==4649){g++;if(g<3){if(this.config.itemreset)a.item=[];a.combo=[];a.restart()}else{this.result.score=a.score;this.result.item=a.item;this.result.combo=a.combo;this.result.combomax=a.combomax;this.result.obCount=a.obCount;this.result.total=a.total;this.result.hidan=a.hidan;a.draw(d);j=true;Boolean(localStorage)&&localStorage.setItem("highscore",new String(this.result.highscore));return 3}}}else{k=true;b.enable=true;b.counter_runnning=true}var h=0,f=1;for(i in a.combo){if(i==2)h=a.combo[i];if(i==4)f=a.combo[i]}if(m!=h){m=h;if(m>=2)n=60}if(o!=f)o=f;if(!a.interrapt){a.move(b);b.step(a)}else if(a.SIGNAL!=1){a.move(b);b.step(a)}else var p=c.mouse_state.check_last();if(k)e++;if(e>480){e=0;l=1-l}if(this.result.highscore<a.score)this.result.highscore=a.score;return 0}function r(){a.draw();var e=[];wt=ehighscore.read(this.result.highscore);f.putchr("Hi-Sc:"+wt,c.layout.hiscore_x,c.layout.hiscore_y);wt=p.read(a.score);f.putchr("Score:"+wt,c.layout.score_x,c.layout.score_y);if(this.config.debug){e.push("o:"+a.cnt()+"/"+a.num()+"/"+a.nonmove);e.push("f:"+b.flame);if(a.interrapt)e.push("interrapt:"+a.SIGNAL);else e.push("running:"+a.SIGNAL)}for(var d=0;d<2-g;d++)f.put("Ship",64+d*32,450);if(this.config.debug){for(d in a.item)e.push("item["+d+"]:"+a.item[d]);for(d in a.combo)e.push("combo["+d+"]:"+a.combo[d]);for(d in a.combomax)e.push("combomax["+d+"]:"+a.combomax[d]);var i=0;for(d in a.total)if(d==2)i=a.total[d];var j=1;for(d in a.obCount)if(d==2)j=a.obCount[d];e.push("rate:"+Math.floor(i/j*100)+"par");e.push("hidan:"+a.hidan);e.push("wx,wy:"+Math.floor(c.gs.world_x)+","+Math.floor(c.gs.world_y));var h={};h.x=0;h.y=0;h.w=c.gs.viewwidth;h.h=c.gs.viewheight;h.draw=function(a){a.beginPath();a.strokeStyle="red";a.lineWidth=1;a.rect(150,150,130,180);a.stroke();a.beginPath();a.strokeStyle="red";a.lineWidth=1;a.rect(0,0,420,480);a.stroke();a.strokeStyle="red";a.lineWidth=1;a.rect(0,0,this.w,this.h);a.stroke()};f.putFunc(h)}for(var k in e)f.putchr8(e[k],c.layout.status_x,c.layout.status_y+8*k)}}function gs_score_effect(b){var a=b;this.read=function(d){if(d<=a)a=d;else if(d-a>100){c=1;ws_work=a;ts_work=d;for(var b=0;b<7;b++){if(ws_work<ts_work)a+=c;c*=10;ws_work=Math.floor(ws_work/10);ts_work=Math.floor(ts_work/10)}}else a++;var e=a,f=[],g="";for(b=0;b<7;b++){var c=e%10;f[7-b]=c;e=(e-c)/10}for(b in f)g=g+""+f[b];return g}}function geometoryTrance(){this.worldwidth=420;this.worldheight=480;this.stagewidth=420;this.stageheight=480;this.viewwidth=420;this.viewheight=480;this.world_x=0;this.world_y=0;var f=this.worldwidth,e=this.worldheight,b=this.stagewidth,d=this.stageheight,a=this.viewwidth,c=this.viewheight;this.viewtoWorld=function(b,c){var a={};a.x=this.world_x+b;a.y=this.world_y+c;return a};this.worldtoView=function(b,c){var a={};a.x=b-this.world_x;a.y=c-this.world_y;return a};this.viewpos=function(b,d){if(b<0)b=0;if(d<0)d=0;if(b>f-a)b=f-a;if(d>e-c)d=e-c;this.world_x=b;this.world_y=d};this.nowstagepos=function(){var e={};e.ltx=this.world_x+a/2-b/2;e.lty=this.world_y+c/2-d/2;e.rtx=this.world_x+a/2+b/2;e.rty=this.world_y+c/2-d/2;e.lbx=this.world_x+a/2-b/2;e.lby=this.world_y+c/2+d/2;e.rbx=this.world_x+a/2+b/2;e.rby=this.world_y+c/2+d/2;e.x=e.ltx;e.y=e.lty;e.w=b;e.h=d;return e};this.in_stage=function(f,g){var e=false;if(this.world_x+a/2-b/2<=f&&this.world_x+a/2+b/2>=f&&this.world_y+c/2-d/2<=g&&this.world_y+c/2+d/2>=g)e=true;return e};this.in_view=function(d,e){var b=false;if(this.world_x<=d&&this.world_x+a>=d&&this.world_y<=e&&this.world_y+c>=e)b=true;return b};this.in_view_range=function(e,f,d,c){var b=false;if(Math.abs(this.world_x+a/2-(e+d/2))<(a+d)/2&&Math.abs(this.world_y+a/2-(f+c/2))<(a+c)/2)b=true;return b};this.in_stage_range=function(e,f,d,c){var a=false;if(Math.abs(this.world_x+b/2-(e+d/2))<(b+d)/2&&Math.abs(this.world_y+b/2-(f+c/2))<(b+c)/2)a=true;return a}}function gObjectClass(){this.x;this.y;this.vx;this.vy;this.mp;this.vector;this.visible=false;this.center_x;this.center_y;this.hit_x;this.hit_y;this.mp_cnt_frm=0;this.mp_cnt_anm=0;this.type;this.chr;this.frame=0;this.scenario=[];this.status=0;this.hp;this.target=-1;this.crash=-1;this.id;this.score=0;this.triger=0;this.shot=0;this.alpha=255;this.display_size=1;this.message=[];this.normal_draw_enable=true;this.custom_draw_enable=false;this.damegeflag=false;this.mapCollision=false;this.alive=600;this.reset=function(){status=0;type=5;visible=false;mp_cnt_frm=0;mp_cnt_anm=0;scenario=[];this.normal_draw_enable=true;this.custom_draw_enable=false;damegeflag=false};this.init=b;this.move=c;this.draw=a;this.custom_draw=null;this.vset=function(a){this.vx=Math.cos(Math.PI/180*(this.vector-90))*a;this.vy=Math.sin(Math.PI/180*(this.vector-90))*a};this.set_object=function(c,b){var a={};a.cmd="set_object";a.src=c;a.dst=b;this.message.push(a)};this.set_object_ex=function(d,g,h,f,c,e){var b={},a={};a.x=g;a.y=h;a.vector=f;a.sce=c;a.id=e;b.cmd="set_object_ex";b.src=d;b.dst=a;this.message.push(b)};this.get_target=function(c,b){var a={};a.cmd="get_target";a.src=c;a.dst=b;this.message.push(a)};this.change_sce=function(c,b){var a={};a.cmd="change_sce";a.src=c;a.dst=b;this.frame=0;this.normal_draw_enable=true;this.custom_draw_enable=false;this.message.push(a)};this.add_score=function(c,b){var a={};a.cmd="add_score";a.src=c;a.dst=b;this.message.push(a)};this.get_item=function(c,b){var a={};a.cmd="get_item";a.src=c;a.dst=b;this.message.push(a)};this.bomb=function(c,b){var a={};a.cmd="bomb";a.src=c;a.dst=b;this.message.push(a)};this.bomb2=function(c,b){var a={};a.cmd="bomb2";a.src=c;a.dst=b;this.message.push(a)};this.bomb3=function(c,b){var a={};a.cmd="bomb3";a.src=c;a.dst=b;this.message.push(a)};this.collect=function(c,b){var a={};a.cmd="collect";a.src=c;a.dst=b;this.message.push(a)};this.SIGNAL=function(c,b){var a={};a.cmd="SIGNAL";a.src=c;a.dst=b;this.message.push(a)};this.reset_combo=function(c,b){var a={};a.cmd="reset_combo";a.src=c;a.dst=b;this.message.push(a)};this.sc_move=function(){var a=0;if(this.status==2)switch(this.type){case 1:case 3:this.change_sce(7);break;case 2:this.display_size*=2;this.change_sce(7);this.add_score(this.score);break;case 4:this.change_sce(6)}if(this.status==0)a=1;if(this.type==2){if(this.x+this.vx<0)this.x=this.scrn.cw;if(this.x+this.vx>this.scrn.cw)this.x=0}if(this.mapCollision!=true){this.x+=this.vx;this.y+=this.vy}else switch(this.type){case 1:case 3:a=1;break;default:this.vx*=-1;this.vy*=-1;this.mapCollision=false}if(this.x<0||this.x>this.scrn.cw)a=2;if(this.y<0||this.y>this.scrn.ch)a=2;if(a!=0){a==2&&this.reset_combo(this.type);return-1}this.damageflag=false;return 0};this.target_r=function(e,f){var g=this.x,h=this.y,a,b=e-g,c=f-h;if(b==0)if(c>=0)a=180;else a=0;else{a=d(Math.atan(c/b));if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a};this.target_v=function(){return!Boolean(this.target)?this.vector:this.target_r(this.target.x,this.target.y)};this.target_rotate_r=function(c){if(!Boolean(this.target))return;var a=this.target_r(this.target.x,this.target.y),b=a;if(b>179)b=-360+b;w=this.vector;if(w>179)w=-360+w;a=b-w;if(Math.abs(a)>100){w=(this.vector+180)%360;if(w>179)w=-360+w;a=(b-w)*-1}if(Math.abs(a)<c)c=a;if(a!=0)this.vector=this.vector+a/Math.abs(a)*c;if(this.vector<0)this.vector=360+this.vector;if(this.vector>359)this.vector=this.vector-360};this.target_d=function(a,b){var c=this.x,d=this.y;return Math.sqrt(Math.abs(a-c)*Math.abs(a-c)+Math.abs(b-d)*Math.abs(b-d))};this.Sin=function(a){return Math.sin((a-90)*(Math.PI/180))};this.Cos=function(a){return Math.cos((a-90)*(Math.PI/180))};function d(a){return a*(180/Math.PI)}function b(b,a){a.vset(5)}function a(b,a){b.print(a.mp+"",a.x,a.y)}function c(c,a){a.x+=a.vx;a.y+=a.vy;var b=0;if(a.x<0||a.x>c.cw)b=1;if(a.y<0||a.y>c.ch)b=1;return b!=0?-1:0}}function gObjectControl(j,k){delobj=0;this.score=0;this.config={};this.interrapt=false;this.SIGNAL=0;this.item=[];this.combo=[];this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;this.nonmove=0;var f=0,h,l,m,c=character(),d=motionPattern(),g=scenario(),a=[],e=[];e[0]=[0,0,1,1,1,0];e[1]=[0,0,1,0,0,0];e[2]=[1,1,0,0,0,0];e[3]=[1,0,0,0,0,0];e[4]=[2,0,0,0,0,0];e[5]=[0,0,0,0,0,0];this.reset=function(b){delobj=0;f=0;if(this.config.cold){this.score=0;this.obCount=[];this.combomax=[];this.total=[];this.hidan=0;this.combo=[];this.item=[]}if(!b){this.interrapt=false;this.SIGNAL=0;a=[];this.config.cold=true}if(this.config.fullpower)this.item[7]=10};this.move=function(r){h=r;var x=k.mouse_state.check_last();this.nonmove=0;for(var i in a){var c=a[i];c.alive--;var g=k.gs.nowstagepos();if(c.x<g.x||c.x>g.x+g.w||c.y<g.y||c.y>g.y+g.h){this.nonmove++;if(c.type==1||c.type==3)c.status=0}c.mouse_state=x;if(c.move(j,c,r)!=0){delete a[i];delobj++}for(var z in c.message){var d=c.message[z];if(d.cmd=="add_score")this.score+=d.src;if(d.cmd=="get_item"){if(Boolean(this.item[d.src]))this.item[d.src]++;else this.item[d.src]=1;var q=1;if(d.src==20)q=this.combo_sub(4);this.score+=c.score*q;var B=d.src==7?"Powerup!":c.score*q+"pts.";h.add(c.x,c.y,0,20,43+(d.src==7?1:0),B)}if(d.cmd=="reset_combo")for(var s in this.combo)if(d.src==s)this.combo[s]=0;if(d.cmd=="SIGNAL")if(this.interrapt){this.interrapt=false;this.SIGNAL=0}else{this.interrapt=true;this.SIGNAL=d.src;if(d.src==0)this.interrapt=false}if(d.cmd=="bomb2"||d.cmd=="bomb3")if(Boolean(this.item[7]))if(this.item[7]>0)this.item[7]--;b[d.cmd](c,d.src,d.dst)}c.message=[]}var o=[];for(i in a){o[i]=0;c=a[i];c.crash=null;c.x<g.x||c.x>g.x+g.w||c.y<g.y||c.y>g.y+g.h;var v=c.type==98?0:c.type;for(var p in a){var n=a[p];if(o[p]!=0)continue;if(i==p)continue;var w=n.type==98?0:n.type,y=e[v][w];if(y==0)continue;if(Math.abs(c.x-n.x)<(c.hit_x+n.hit_x)/2&&Math.abs(c.y-n.y)<(c.hit_y+n.hit_y)/2){c.status=2;n.status=2;c.crash=n;n.crash=c;o[p]=1;o[i]=1}}}for(i in a){c=a[i];c.x<g.x||c.x>g.x+g.w||c.y<g.y||c.y>g.y+g.h;if(o[i]!=0)if(!(c.type==1||c.type==3)){var C=true;if(C){var A=c.hp;if(c.type==4)c.hp=0;if(c.crash.type!=4)c.hp-=c.crash.hp>0?c.crash.hp:1;if(c.hp>0){c.status=1;if(A!=c.hp){if(c.type==98)this.hidan++;c.damageflag=true}c.crash=null}else c.type==2&&this.combo_sub(2)}}}var t=0,u=0;for(i in a){if(a[i].type==98)t++;if(a[i].type==2)u++}if(t==0){f++;if(f>90){l=this.interrapt;m=this.SIGNAL;this.interrapt=true;this.SIGNAL=4649}}if(u==0){f++;if(f>90){l=this.interrapt;m=this.SIGNAL;this.interrapt=true;this.SIGNAL=835}}};this.combo_sub=function(a){if(!Boolean(this.combo[a]))this.combo[a]=1;else this.combo[a]++;if(!Boolean(this.combomax[a]))this.combomax[a]=this.combo[a];else if(this.combo[a]>this.combomax[a])this.combomax[a]=this.combo[a];if(!Boolean(this.total[a]))this.total[a]=1;else this.total[a]++;return this.combo[a]};this.restart=function(){h.start(false);f=0;this.interrapt=l;this.SIGNAL=m};var b=[];b.set_object=function(a,b){h.add(a.x,a.y,a.vector,b)};b.set_object_ex=function(c,b,a){h.add(a.x,a.y,a.vector,b,a.sce,a.id)};b.get_target=function(b,f){var h=1,d=99999;b.target=null;for(var g in a){var c=a[g];if(c.type!=f)continue;var e=c.target_d(b.x,b.y);if(e<d){b.target=c;d=e}}};b.change_sce=function(a,b){a.init=g.init[b];a.move=g.move[b];a.custom_draw=g.draw[b];a.init(j,a)};b.add_score=function(c,a){return a};b.get_item=function(c,a){return a};b.bomb=function(){for(i in a)a[i].type==3&&a[i].change_sce(7)};b.bomb2=function(b){for(i in a){b=a[i];if(b.type==3){b.type=4;b.mp=18;b.score=8;if(b.chr!=7){var c=[18,22,26,27,29,30];b.mp=c[Math.floor(Math.random()*c.length)]}b.change_sce(30)}}};b.bomb3=function(){for(i in a){if(a[i].type==2){a[i].hp-=10;if(a[i].hp<=0)a[i].status=2}a[i].type==3&&a[i].change_sce(7)}};b.collect=function(b){for(i in a){b=a[i];if(b.type==4)if(!Boolean(b.collection_mode)){b.collection_mode=true;b.change_sce(30)}}};b.SIGNAL=function(){};b.reset_combo=function(){};this.draw=function(c){if(!Boolean(c))c=j;for(var d in a){var b=a[d];if(b.visible){if(b.normal_draw_enable)k.gs.in_view(b.x,b.y)&&b.draw(c,b);b.custom_draw_enable&&b.custom_draw(c,b)}}};this.set_s=o;function o(m,o,l,d,e,i){var b=new gObjectClass;b.reset();b.scrn=j;b.mouse_state=k.mouse_state.check_last();b.gt=k.gs;b.item=this.item;b.config=this.config;b.x=m;b.y=o;b.vector=l;b.chr=d;b.visible=true;b.mp=c[d].mp;b.hp=c[d].hp;b.maxhp=b.hp;b.type=c[d].type;b.center_x=c[d].center_x;b.center_y=c[d].center_y;b.hit_x=c[d].size_x;b.hit_y=c[d].size_y;if(!Boolean(i))i=c[d].id;b.id=i;b.score=c[d].score;b.status=1;if(!Boolean(e))e=c[d].senario[0];b.init=g.init[e];b.move=g.move[e];b.draw=n;b.custom_draw=g.draw[e];b.init(j,b);for(var h=-1,f=0;f<a.length;f++)if(!a[f]){h=f;break}if(h==-1)a.push(b);else a[h]=b;if(Boolean(this.obCount[b.type]))this.obCount[b.type]++;else this.obCount[b.type]=1;if(b.type==1&&b.type==3)b.alive=90}this.num=function(){return a.length};this.cnt=function(){var b=0;for(var c in a)b++;return b};function n(c,a){if(Boolean(d[a.mp].wait)){a.mp_cnt_frm++;if(a.mp_cnt_frm>d[a.mp].wait/2){a.mp_cnt_anm++;a.mp_cnt_frm=0;if(a.mp_cnt_anm>=d[a.mp].pattern.length)a.mp_cnt_anm=0}}try{var g=d[a.mp].pattern[a.mp_cnt_anm][0]}catch(h){a.mp_cnt_anm=0;g=d[a.mp].pattern[a.mp_cnt_anm][0]}var e=d[a.mp].pattern[a.mp_cnt_anm][1],f=d[a.mp].pattern[a.mp_cnt_anm][2];if(e==-1&&f==-1){e=0;f=a.vector}var b=a.gt.worldtoView(a.x,a.y);b.x>=0&&b.x<=c.cw&&b.y>=0&&b.y<=c.ch&&c.put(g,b.x,b.y,e,f,a.alpha,a.display_size)}}function inputControl(){var a,b,e,f,g=0,h=0,d,l=-1,k,i=0,j="NaN",n=0,m=0,c=document;this.o_Left=c.offsetLeft;this.o_Top=c.offsetTop;c.onmousemove=t;function t(c){x=c.clientX;y=c.clientY;if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y}c.onmousedown=function(a){d=a.button};c.onmouseup=function(){d=-1};c.onmousewheel=function(a){k=a.wheelDelta};c.addEventListener("DOMMouseScroll",s,false);function s(a){k=a.detail}c.ontouchmove=function(c){c.preventDefault();if(c.touches.length>0)for(var d=0;d<c.touches.length;d++){var e=c.touches[d];x=e.pageX;y=e.pageY}if(!Boolean(a))a=x;if(!Boolean(b))b=y;g=x;h=y};c.ontouchstart=function(a){a.preventDefault();x=a.pageX;y=a.pageY;d=0};c.ontouchend=function(a){a.preventDefault();d=-1};this.check=function(){if(m>0){m++;g=a;h=b;d=0;i=0}a=e;b=f;e=g;f=h;l=d;if(d!=0)d=-1;i=k;k=0;j=o(a,b,e,f);n=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));if(a-e==0&&b-f==0)j="NaN";var c={};c.x=g;c.y=h;c.button=l;c.wheel=i;c.deg=j;c.distance=n;return c};this.check_last=function(){var a={};a.x=g;a.y=h;a.button=l;a.wheel=i;a.deg=j;a.distance=n;return a};this.input_pause=function(a){if(wait_count>30)a=30;if(wait_count<0)a=0;m=a};this.draw=function(){var c=canvas.width,d=canvas.height,g=j;context.fillStyle="black";context.fillRect(0,0,canvas.width,canvas.height);context.fillStyle="white";context.fillRect(5,5,canvas.width-10,canvas.height-10);context.fillStyle="green";context.fillText(e+" "+f+" "+c+" "+d+" "+g,32,32);var h="OOO";switch(l){case 0:h="@OO";break;case 1:h="O@O";break;case 2:h="OO@"}context.fillText("b:"+h+" w:"+i,32,232);context.beginPath();context.moveTo(c/2,d/2);context.lineTo(e-a+c/2,f-b+d/2);context.strokeStyle="black";context.stroke();context.beginPath();context.arc(c/2,d/2,5,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();r=Math.sqrt(Math.pow(Math.abs(e-a),2)+Math.pow(Math.abs(f-b),2));context.beginPath();context.arc(c/2,d/2,r,0,2*Math.PI,true);context.strokeStyle="black";context.stroke();var k=0,m=0;if(g!="NaN"){g=q(g-90);k=Math.cos(g)*50;m=Math.sin(g)*50}context.beginPath();context.arc(c/2+k,d/2+m,20,0,2*Math.PI,true);context.fillStyle="orange";context.fill();var n=context.getImageData(0,0,canvas.width,canvas.height)};function o(f,g,d,e){var a,b=d-f,c=e-g;if(b==0)if(c>=0)a=180;else a=0;else{a=p(Math.atan(c/b));if(b>=0&&c>=0)a=90+a;if(b>=0&&c<0)a=90+a;if(b<0&&c<0)a=270+a;if(b<0&&c>=0)a=270+a}return a}function q(a){return a*(Math.PI/180)}function p(a){return a*(180/Math.PI)}}function inputKeyboard(){var a="NaN";window.onkeypress=function(b){a=b.keyCode};window.onkeyup=function(){a="NaN"};this.check=function(){return a}}function gameLayout(){this.score_x=420-180;this.score_y=16;this.hiscore_x=420-180;this.hiscore_y=0;this.status_x=420-120;this.status_y=32;this.combo_x=0;this.combo_y=32;this.itemchain_x=0;this.itemchain_y=24}function main_r(){var g=30,b=new deviceControl,f=b.graphics1,u=b.graphics2,o=new sceneControl(b),s=b.mouse_state,q=b.key_state,r=new Number(0),p=new Date,n=p.getTime(),m=1,c,k,l,i,j=p.getTime(),a=0,e=0,d,t=0;h();function h(){var b=new Date,u=b.getTime(),t=[];t.push("runningtime:"+k);var p=s.check(),x=q.check();if(p.wheel!=0)r+=p.wheel>0?1:-1;var y=p.x,z=p.y,v=false;if(p.button==0)v=true;p.button==1;var w="fps:"+1e3/d;d&&t.push(w.substring(0,8));o.step();f.clear();f.draw();f.reset();o.draw();b=new Date;a++;if(a>g)a=0;i=b.getTime()-j;j=b.getTime();e+=i;m=b.getTime();if(a==0){n=b.getTime();d=e/g;e=0}k=b.getTime()-u;l=Math.round(n+a*(1e3/g));c=l-m;if(c<=0)c=1;setTimeout(h,c)}}function cursur_draw(a){a.save();a.setTransform(1,0,0,1,this.x,this.y);a.rotate(3.6*(Math.PI/180)*this.mode);for(var b=0;b<4;b++){a.beginPath();a.moveTo(0,8);a.lineTo(0,24);var c=String(255-this.mode%25*5);a.strokeStyle="rgb("+c+", 128, 255)";a.rotate(45*(Math.PI/180));a.moveTo(0,16);a.lineTo(0,21);a.stroke();a.rotate(45*(Math.PI/180))}a.beginPath();a.arc(0,0,20,0,2*Math.PI,true);a.stroke();a.restore()}function mapSceControl(){var c,f,e,b=-5;this.enable=true;this.counter_runnning=true;this.flame=b;this.stage=1;for(var d=[],h=[],j=[],i=[],g=[],a=1;a<=5;a++){d[a]=new Stage1;h[a]=d[a].scenario();j[a]=d[a].bgImage();i[a]=d[a].bgLayout();g[a]=d[a].initial(a)}this.change=function(a){this.stage=a;c=[];f=h[this.stage];e=g[this.stage]};this.bgImage=function(){return j[this.stage]};this.mapChip=function(){return i[this.stage]};this.init=function(){this.stage=1;c=[];f=h[this.stage];e=g[this.stage]};this.reset=function(){this.enable=true;this.counter_runnning=true;b=-5;this.start(false);this.start(true)};this.step=function(g){if(!this.enable)return;if(this.counter_runnning)b++;b=b>2e3?0:b;for(var e in f){var a=f[e];if(a.count<b)continue;if(a.count==b){if(a.x<0&&a.y<0){b=0;break}this.add(a.x,a.y,a.r,a.ch,a.sc)}if(a.count>b)break}for(e in c){var d=c[e];g.set_s(d.x,d.y,d.r,d.ch,d.sce,d.id)}c=[];this.flame=b};this.add=function(f,g,e,d,b,a){if(!this.enable)return;ev={};ev.x=f;ev.y=g;ev.r=e;ev.ch=d;ev.sce=b;if(Boolean(a))ev.id=a;c.push(ev)};this.start=function(b){for(var c in e){var a=e[c];b==a.s&&this.add(a.x,a.y,a.r,a.ch,a.sc)}}}function motionPattern(){var b=[],a=0;b[a]={};b[a].wait=0;b[a].pattern=[["Space",0,0]];a=1;b[a]={};b[a].pattern=[["Ship",-1,-1]];a=4;b[a]={};b[a].wait=18;b[a].pattern=[["Enemy1",0,0]];a=8;b[a]={};b[a].pattern=[["YaTama",-1,-1]];a=9;b[a]={};b[a].pattern=[["Zanki",-1,-1]];a=10;b[a]={};b[a].wait=5;b[a].pattern=[["Bomb3",0,0],["Bomb1",0,0],["Bomb2",0,0],["Bomb3",0,0],["Bomb4",0,0],["Bomb5",0,0]];a=15;b[a]={};b[a].pattern=[["Option1",-1,-1]];return b}function sce_player(){this.init=function(b,a){a.triger=10;a.w_powup=-1;a.int_shot=0;a.mp=1;a.custom_draw_enable=true};this.draw=a;this.move=function(b,a){a.frame++;a.vset(0);if(a.frame<=90){a.hp=10;a.damageflag=false}a.move_target_x=a.mouse_state.x;a.vector=a.target_r(a.move_target_x,400);a.vset(8);var f=a.vector;a.mp=1;a.triger--;if(a.triger<=0){a.shot=0;a.triger=5}var e=0;for(var d in a.item)if(d==7)e=a.item[d];if(eval(a.mouse_state.button)==0){a.vset(4);if(a.shot==0)a.shot=1}eval(a.mouse_state.button)==1;if(a.x+a.vx-a.center_x<0)a.vx=0;if(a.y+a.vy-a.center_y<0)a.vy=0;if(a.x+a.vx+a.center_x>b.cw)a.vx=0;if(a.y+a.vy+a.center_y>b.ch)a.vy=0;if(Math.abs(a.x-a.move_target_x)<=8){a.vector=0;a.vx=0;a.vy=0}if(a.mapCollision!=true){a.x+=a.vx;a.y+=a.vy}var c=0;if(a.status==2){a.display_size=2.5;a.change_sce(7)}if(a.status==0)c=1;return c};function a(c,b){var a={};a.x=20;a.y=440;a.sr=(360*((b.maxhp-b.hp)/b.maxhp)-90)*(Math.PI/180);a.df=b.damageflag;a.r=15;a.draw=function(a){a.beginPath();a.strokeStyle="gray";a.lineWidth="10";a.arc(this.x,this.y,this.r,0,2*Math.PI,false);a.stroke();a.beginPath();a.lineWidth=8;a.strokeStyle=this.df?"red":"limegreen";a.arc(this.x,this.y,this.r,this.sr,1.5*Math.PI,false);a.stroke();a.lineWidth="3"};c.putFunc(a);b.damageflag=false}}function scenario(){for(var c={},a=[],e=[],b=[],d=0;d<=37;d++){a[d]=function(b,a){a.vset(5)};b[d]=function(b,a){return a.sc_move()}}w=new sce_player;a[1]=w.init;b[1]=w.move;e[1]=w.draw;a.player=w.init;b.player=w.move;e.player=w.draw;w=new sce_enemy_moveshot;a.enemy_moveshot=w.init;b.enemy_moveshot=w.move;w=new sce_common_vset(6);a.common_vset4=w.init;b.common_vset4=w.move;w=new sce_friend_rotate;a.friend_rotate=w.init;b.friend_rotate=w.move;w=new sce_effect_vanish;a[6]=w.init;b[6]=w.move;a.effect_vanish=w.init;b.effect_vanish=w.move;w=new sce_effect_bomb;a[7]=w.init;b[7]=w.move;a.effect_bomb=w.init;b.effect_bomb=w.move;c.init=a;c.draw=e;c.move=b;return c}function sceneConfig(n){var i=n.graphics1,e=n.graphics2,b=n.text,B=n.mouse_state,A=n.key_state;this.init=x;this.reset=v;this.step=y;this.draw=w;var j;this.score=0;this.config={};var d=[],c=[],r=[],l,t=false,s=false,u,k,a=[],h=["FullPower.","SideShot.","ItemReset.","Option.","---.","Stage."],o=["\u30d1\u30ef\u30fc\u30a2\u30c3\u30d7\u6700\u5927\u3067\u958b\u59cb : ","\u5f3e\u6d88\u3057\u5f3e[\u25ce]\u3092\u4f7f\u7528 : ","\u6b7b\u3093\u3060\u3068\u304d\u306b\u30a2\u30a4\u30c6\u30e0\u653e\u51fa : ","\u652f\u63f4\u6a5f(\u30aa\u30d7\u30b7\u30e7\u30f3)\u4f7f\u7528 : ","\u672a\u4f7f\u7528 : ","\u958b\u59cb\u9762\u306e\u9078\u629e : "];c[5]=1;for(var p=60,q=180,f=0;f<h.length-1;f++){m={};m.title=h[f];m.x=p;m.y=q+f*20;m.w=120;m.h=16;m.msg=o[f];m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();return 0};a.push(m);for(var g=0;g<2;g++){m={};m.title=g==0?"  On":"  Off";m.x=p+80+80*(g+1);m.y=q+f*20;m.w=80;m.h=16;m.msg=o[f]+(g==0?"\u6709\u52b9":"\u7121\u52b9");m.sel=false;m.lamp=false;m.num=f;m.sw=g==0?true:false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();d[this.num]=this.sw;return 0};a.push(m)}}m={};m.title=h[h.length-1]+c[h.length-1];m.x=p;m.y=q+(h.length-1)*20;m.w=120;m.h=16;m.msg=o[f];m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();b.print(this.msg,100,320,"white");b.draw();return 0};wm=m;a.push(m);for(var g=0;g<2;g++){m={};m.title=g==0?"  +1":"  -1";m.x=p+80+80*(g+1);m.y=q+f*20;m.w=80;m.h=16;m.msg=o[f];m.sel=false;m.lamp=false;m.num=h.length-1;m.sw=g==0?1:-1;m.func=function(){d[this.num]=this.sw==1?true:false;c[this.num]+=this.sw;if(c[this.num]<1)c[this.num]=1;if(c[this.num]>3)c[this.num]=2;wm.title=h[this.num]+c[this.num];b.clear();b.reset();b.print(this.msg+c[this.num]+"\u9762",100,320,"white");b.draw();return 0};a.push(m)}m={};m.title="Save.";m.x=100;m.y=360;m.w=120;m.h=16;m.jp=2;m.msg="Save.";m.sel=false;m.lamp=false;m.config=this.config;m.result=this.result;m.func=function(){t=true;j=true;return 0};a.push(m);m={};m.title="Reset.";m.x=100;m.y=380;m.w=120;m.h=16;m.jp=2;m.msg="Reset.";m.sel=false;m.lamp=false;m.func=function(){s=true;j=true;return 0};a.push(m);m={};m.title="Exit.";m.x=100;m.y=400;m.w=120;m.h=16;m.jp=2;m.msg="Exit.";m.sel=false;m.lamp=false;m.func=function(){b.clear();b.reset();return this.jp};a.push(m);var z,C=new Number(0);this.config_load=function(){if(Boolean(localStorage)){for(var b=["fullpower","sideshot","itemreset","option","dummy","startstage"],e=false,a=0;a<=3;a++)if(Boolean(localStorage.getItem(b[a]))){e=true;d[a]=localStorage.getItem(b[a])=="on"?true:false;this.config[b[a]]=d[a]}if(Boolean(localStorage.getItem(b[5]))){e=true;c[5]=parseInt(localStorage.getItem(b[5]));this.config[b[5]]=c[5];wm.title=h[5]+c[5]}}};function x(){this.config.fullpower=false;this.config.sideshot=true;this.config.itemreset=true;this.config.option=true;this.config.startstage=1;this.config.cold=true;this.config.debug=false;d[0]=this.config.fullpower;d[1]=this.config.sideshot;d[2]=this.config.itemreset;d[3]=this.config.option;d[4]=false;d[5]=false;c[5]=this.config.startstage}function v(){for(var b in a){a[b].sel=false;a[b].lamp=false}u=false;k=0;z=0;e.clear("darkblue");cl={};cl.w=i.cw;cl.h=i.ch;cl.draw=function(a){var c=this.h;if(c<this.w)c=this.w;a.beginPath();for(var b=0;b<c;b+=16){a.moveTo(b,0);a.lineTo(b,this.h);a.moveTo(0,b);a.lineTo(this.w,b)}a.strokeStyle="lightgray";a.stroke()};e.putFunc(cl);e.draw();e.reset();for(b in c)if(Boolean(c[b]))r[b]=c[b];j=true}function y(){l=[];var g=B.check_last(),o=A.check(),p=g.x,q=g.y;if(g.button==0&&!j){for(var f in a)if(a[f].sel){var m=a[f].func();if(m!=0)return m}}else for(f in c)if(Boolean(c[f]))r[f]=c[f];if(g.button==-1)j=false;if(u){var i={};i.cw=e.cw;i.ch=e.ch;i.y1=e.ch/2-k;i.y2=e.ch/2+k;i.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};e.putFunc(i);e.draw();e.reset();k+=4;if(e.ch/2-k<0)return 1}var n=-1;for(f in a)if(g.x>=a[f].x&&g.x<=a[f].x+a[f].w&&g.y>=a[f].y&&g.y<=a[f].y+a[f].h){a[f].sel=true;n=f}else a[f].sel=false;l.push("== Configration ==");l.push("-----------------");for(f in d)if(d[f]){a[f*3+1].lamp=true;a[f*3+2].lamp=false}else{a[f*3+1].lamp=false;a[f*3+2].lamp=true}for(f in c)if(Boolean(c[f]))if(c[f]!=r[f]){a[f*3+1].lamp=false;a[f*3+2].lamp=false;a[f*3+1].sel=false;a[f*3+2].sel=false}this.config.fullpower=d[0];this.config.sideshot=d[1];this.config.itemreset=d[2];this.config.option=d[3];this.config.startstage=c[5];if(s){d[0]=false;d[1]=true;d[2]=true;d[3]=true;d[4]=false;d[5]=false;c[5]=1;wm.title=h[5]+c[5];b.clear();b.reset();b.print("\u8a2d\u5b9a\u521d\u671f\u5316\u3057\u307e\u3057\u305f\u3002",100,320,"white");if(Boolean(localStorage)){localStorage.clear();b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u30af\u30ea\u30a2\u3002",100,340,"white")}else b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,340,"white");b.draw();s=false}if(t){b.clear();b.reset();if(Boolean(localStorage)){localStorage.setItem("fullpower",this.config.fullpower?"on":"off");localStorage.setItem("sideshot",this.config.sideshot?"on":"off");localStorage.setItem("itemreset",this.config.itemreset?"on":"off");localStorage.setItem("option",this.config.option?"on":"off");localStorage.setItem("startstage",new String(this.config.startstage));b.print("\u8a2d\u5b9a\u3092\u30bb\u30fc\u30d6\u3057\u307e\u3057\u305f\u3002",100,320,"white")}else b.print("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044?",100,320,"white");b.draw();t=false}return 0}function w(){for(var d in l)i.putchr(l[d],0,100+16*d);for(var b in a){if(a[b].lamp){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};i.putFunc(c)}if(a[b].sel)i.putchr(a[b].title,a[b].x-4,a[b].y-1);else i.putchr(a[b].title,a[b].x,a[b].y)}}}function sceneControl(d){var a=[];a[1]=new gameScene(d);a[2]=new sceneTitle(d);a[3]=new sceneGover(d);a[4]=new sceneConfig(d);a[5]=new sceneResult(d);for(var e in a)a[e].init();var f=a[1].result,g=a[4].config;a[1].score_load();a[4].config_load();for(var e in a){a[e].result=f;a[e].config=g}var h=a[2],c=2,b=c;this.step=function(){if(c!=0){var f=a[b].result,e=a[b].config,d=false;if(c>=10){c=c%10;d=true}b=c;a[b].reset(d);a[b].result=f;a[b].config=e}c=a[b].step()};this.draw=function(){a[b].draw()}}function sceneGover(d){var h=d.graphics1,c=d.graphics2,o=d.mouse_state,q=d.key_state;this.init=m;this.reset=k;this.step=n;this.draw=l;var g,f,j,e,i,a=[],b={};b.title="Continue.";b.x=100;b.y=160;b.w=120;b.h=16;b.sel=false;b.func=function(){return 11};a.push(b);b={};b.title="End.";b.x=100;b.y=180;b.w=120;b.h=16;b.sel=false;b.func=function(){return 2};a.push(b);function m(){}function k(){for(var b in a)a[b].sel=false;j=false;e=2;i=0;var m={};m.cw=c.cw;m.ch=c.ch;m.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="black";a.stroke()}};c.putFunc(m);var f=this.result.score,h=[],k="";for(b=0;b<7;b++){var l=f%10;h[7-b]=l;f=(f-l)/10}for(b in h)k=k+""+h[b];c.putchr("Score:"+k,d.layout.score_x,d.layout.score_y);f=this.result.highscore;h=[];k="";for(b=0;b<7;b++){var l=f%10;h[7-b]=l;f=(f-l)/10}for(b in h)k=k+""+h[b];c.putchr("Hi-Sc:"+k,d.layout.hiscore_x,d.layout.hiscore_y);c.draw();c.reset();this.config.cold=true;g=true}function n(){f=[];var d=o.check_last();if(d.button==0&&!g)for(var b in a)if(a[b].sel){var k=a[b].func();if(k!=0)return k}if(d.button==-1)g=false;if(j){var h={};h.cw=c.cw;h.ch=c.ch;h.y1=c.ch/2-e;h.y2=c.ch/2+e;h.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};c.putFunc(h);c.draw();c.reset();e+=8;if(c.ch/2-e<0)return i}for(b in a)if(d.x>=a[b].x&&d.x<=a[b].x+a[b].w&&d.y>=a[b].y&&d.y<=a[b].y+a[b].h)a[b].sel=true;else a[b].sel=false;f.push("== Game Over ==");f.push("---------------");return 0}function l(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};h.putFunc(c)}h.putchr(a[b].title,a[b].x,a[b].y)}for(var d in f)h.putchr(f[d],0,132+16*d)}}function sceneResult(c){var h=c.graphics1,b=c.graphics2,o=c.text,p=c.mouse_state,q=c.key_state;this.init=m;this.reset=k;this.step=n;this.draw=l;var g,f,j,e,i,a=[],d={};d.title="[   ok.  ]";d.x=160;d.y=320;d.w=120;d.h=16;d.sel=false;d.func=function(){o.clear();return 11};a.push(d);function m(){}function k(){for(var d in a)a[d].sel=false;j=false;e=2;i=0;var m={};m.cw=b.cw;m.ch=b.ch;m.draw=function(a){for(var b=0;b<this.ch;b+=4){a.beginPath();a.moveTo(0,b);a.lineTo(this.cw,b);a.strokeStyle="darkblue";a.stroke()}};b.putFunc(m);var f=this.result.score,h=[],k="";for(d=0;d<7;d++){var l=f%10;h[7-d]=l;f=(f-l)/10}for(d in h)k=k+""+h[d];b.putchr("Score:"+k,c.layout.score_x,c.layout.score_y);f=this.result.highscore;h=[];k="";for(d=0;d<7;d++){var l=f%10;h[7-d]=l;f=(f-l)/10}for(d in h)k=k+""+h[d];b.putchr("Hi-Sc:"+k,c.layout.hiscore_x,c.layout.hiscore_y);b.draw();b.reset();var n=["dummy","dummy","\u6575\u6a5f\u6483\u7834","dummy","\u30b9\u30b3\u30a2\u30a2\u30a4\u30c6\u30e0\u53d6\u5f97","dummy"],o=[];g=true}function n(){f=[];var d=p.check_last();if(d.button==0&&!g)for(var c in a)if(a[c].sel){var k=a[c].func();if(k!=0)return k}if(d.button==-1)g=false;if(j){var h={};h.cw=b.cw;h.ch=b.ch;h.y1=b.ch/2-e;h.y2=b.ch/2+e;h.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(h);b.draw();b.reset();e+=8;if(b.ch/2-e<0)return i}for(c in a)if(d.x>=a[c].x&&d.x<=a[c].x+a[c].w&&d.y>=a[c].y&&d.y<=a[c].y+a[c].h)a[c].sel=true;else a[c].sel=false;f.push("== Stage Clear ==");return 0}function l(){for(var b in a){if(a[b].sel){var c={};c.x=a[b].x;c.y=a[b].y;c.w=a[b].w;c.h=a[b].h;c.draw=function(a){a.beginPath();a.fillStyle="orange";a.fillRect(this.x,this.y,this.w,this.h)};h.putFunc(c)}h.putchr(a[b].title,a[b].x,a[b].y)}for(var d in f)h.putchr(f[d],120,200+16*d)}}function sceneTitle(f){var h=f.graphics1,b=f.graphics2,t=f.mouse_state,r=f.key_state;this.init=o;this.reset=l;this.step=p;this.draw=n;for(var g,d,i,c,a=[],j=["GameStart."],s=[1,4],e=0;e<j.length;e++){m={};m.title=j[e];m.x=100;m.y=320+e*20;m.w=120;m.h=16;m.jp=s[e];m.sel=false;m.func=function(){return this.jp};a.push(m)}var q,k=new Number(0);function o(){k=0}function l(){for(var d in a)a[d].sel=false;i=false;c=0;q=0;b.clear("black");b.reset();this.config.cold=true;g=true}function p(){d=[];var e=t.check_last(),l=r.check();if(e.wheel!=0)k+=e.wheel>0?1:-1;var m=e.x,n=e.y;if(e.button==0&&!g)for(var f in a)if(a[f].sel){var j=a[f].func();if(j!=0)return j}e.button==1;if(e.button==-1)g=false;if(i){var h={};h.cw=b.cw;h.ch=b.ch;h.y1=b.ch/2-c;h.y2=b.ch/2+c;h.draw=function(a){a.strokeStyle="black";a.beginPath();a.moveTo(0,this.y1);a.lineTo(this.cw,this.y1);a.stroke();a.beginPath();a.moveTo(0,this.y2);a.lineTo(this.cw,this.y2);a.stroke()};b.putFunc(h);b.draw();b.reset();c+=4;if(b.ch/2-c<0)return 1}for(f in a)if(e.x>=a[f].x&&e.x<=a[f].x+a[f].w&&e.y>=a[f].y&&e.y<=a[f].y+a[f].h)a[f].sel=true;else a[f].sel=false;d.push("RAIN FIGHTER");d.push("-----------------");return 0}function n(){for(var c in d)h.putchr(d[c],0,132+16*c);for(var b in a)if(a[b].sel)h.putchr(a[b].title,a[b].x-4,a[b].y-1);else h.putchr(a[b].title,a[b].x,a[b].y)}}function star_draw(a){a.save();a.setTransform(1,0,0,1,this.x,this.y);a.rotate(1.8*(Math.PI/180)*this.mode);a.beginPath();a.fillStyle="orange";a.fillRect(-80,-80,160,160);a.rotate(45*(Math.PI/180));a.beginPath();a.fillStyle="orange";a.fillRect(-80,-80,160,160);a.restore()}function Screen(m){var k=new Image;k.src="pict/cha.png";var f=new Image;f.src="pict/aschr.png";var a=[],h=[],b=document.createElement("canvas");b.id=m;b.width="420";b.height="480";b.style.margin="0";b.style.padding="0";b.style.position="absolute";b.style.top=0;b.style.left=0;var x=document.getElementsByTagName("body").item(0);x.appendChild(b);var c=document.getElementById(m),d=c.getContext("2d");this.cw=c.width;this.ch=c.height;this.sprite_texture_ready=false;this.character_texture_ready=false;d.font="24px 'Arial'";k.onload=function(){this.sprite_texture_ready=true};f.onload=function(){this.character_texture_ready=true};var e=spdata();for(i=0;i<7;i++)for(j=0;j<16;j++){ptn={};ptn.x=12*j;ptn.y=16*i;ptn.w=12;ptn.h=16;h.push(ptn)}var l=[];for(i=0;i<7;i++)for(j=0;j<16;j++){ptn={};ptn.x=8*j;ptn.y=8*i+128;ptn.w=8;ptn.h=8;l.push(ptn)}for(var n=[],g=0;g<=3;g++){var o=[];for(i=0;i<7;i++)for(j=0;j<16;j++){ptn={};ptn.x=8*j+(g%2==0?0:128);ptn.y=8*i+128+(g>=2?64:0);ptn.w=8;ptn.h=8;o.push(ptn)}n[g]=o}this.lighter_enable=true;this.put=function(g,h,i,d,e,c,f){if(!Boolean(d))d=0;if(!Boolean(e))e=0;if(!Boolean(c))c=255;if(!Boolean(f))f=1;var b={};b.sp=g;b.x=h;b.y=i;b.m=d;b.r=e;b.alpha=c;b.z=f;b.draw=y;b.le=this.lighter_enable;a.push(b)};function y(b){b.save();var d=1,c=1;switch(this.m){case 1:d=-1;break;case 2:c=-1;break;case 3:d=-1;c=-1}var a=e[this.sp];b.setTransform(c,0,0,d,this.x,this.y);this.r!=0&&b.rotate(Math.PI/180*this.r);a=e[this.sp];if(this.alpha==255)b.globalCompositeOperation="source-over";else if(this.le)b.globalCompositeOperation="lighter";b.globalAlpha=this.alpha*(1/255);b.drawImage(k,a.x,a.y,a.w,a.h,-a.w/2*this.z,-a.h/2*this.z,(0+a.w)*this.z,(0+a.h)*this.z);b.restore()}this.putPattern=function(g,f,d,e,c,b){var a={};a.sp=sp;a.x=d;a.y=e;a.w=c;a.h=b};this.print=function(d,e,f,c){if(!Boolean(c))c="green";var b={};b.text=d;b.x=e;b.y=f;b.color=c;b.draw=w;a.push(b)};function w(a){a.fillStyle=this.color;a.fillText(this.text,this.x,this.y)}this.putchr=function(f,g,h,c){var e=false;if(!Boolean(c))c=1;else if(c!=1)e=true;for(i=0;i<f.length;i++){var d=f.charCodeAt(i);if(d>=32&&d<128){var b={};b.chrno=d-32;b.x=g+i*(12*c);b.y=h;if(!e)b.draw=v;else{b.z=c;b.draw=u}a.push(b)}}};function v(b){var a=h[this.chrno];b.drawImage(f,a.x,a.y,a.w,a.h,this.x,this.y,a.w,a.h)}function u(b){var a=h[this.chrno];b.drawImage(f,a.x,a.y,a.w,a.h,this.x,this.y,a.w*this.z,a.h*this.z)}this.putchr8=function(d,e,f){for(i=0;i<d.length;i++){var c=d.charCodeAt(i);if(c>=32&&c<128){var b={};b.chrno=c-32;b.x=e+i*8;b.y=f;b.draw=t;a.push(b)}}};function t(b){var a=l[this.chrno];b.drawImage(f,a.x,a.y,a.w,a.h,this.x,this.y,a.w,a.h)}this.putchr8c=function(e,g,h,f,c){if(!Boolean(c))c=1;for(i=0;i<e.length;i++){var d=e.charCodeAt(i);if(d>=32&&d<128){var b={};b.chrno=d-32;b.x=g+i*(8*c);b.y=h;b.c=f;b.z=c;b.draw=r;a.push(b)}}};function r(b){var a=n[this.c][this.chrno];b.drawImage(f,a.x,a.y,a.w,a.h,this.x+-a.w/2*this.z,this.y+-a.h/2*this.z,a.w*this.z,a.h*this.z)}this.putImage=function(c,d,e){var b={};b.g=c;b.x=d;b.y=e;b.draw=s;a.push(b)};function s(a){a.drawImage(this.g,this.x,this.y)}this.putImage2=function(c,f,g,e,d){var b={};b.g=c;b.x=f;b.y=g;b.w=e;b.h=d;b.draw=q;a.push(b)};function q(a){a.drawImage(this.g,this.x,this.y,this.w,this.h)}this.putImageTransform=function(g,h,i,c,d,e,f){var b={};b.g=g;b.x=h;b.y=i;b.m11=c;b.m12=d;b.m21=e;b.m22=f;b.draw=p;a.push(b)};function p(a){a.save();a.setTransform(this.m11,this.m12,this.m21,this.m22,this.x,this.y);a.drawImage(this.g,0,0);a.restore()}this.transform=function(a,b,c,e){d.setTransform(a,b,c,e,0,0)};this.putFunc=function(b){a.push(b)};this.clear=function(a){d.save();d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,c.width,c.height);d.restore();if(Boolean(a)){d.fillStyle=a;d.fillRect(0,0,c.width,c.height)}};this.reset=function(){a=[]};this.draw=function(){for(var b in a)a[b].draw(d)};this.spptn_test=function(){var b=0,d=16;for(var a in e){this.put(a,b+e[a].w/2,d);b+=e[a].w;if(b+e[a].w>c.width){b=0;d+=32;if(d>c.height)d=0}}}}function spdata(){var d=[["Ship",0,0,31,31],["Enemy1",80,0,31,31],["YaTama",32,0,15,15],["Zanki",48,0,15,15],["Bomb1",160,0,31,31],["Bomb2",192,0,31,31],["Bomb3",224,0,31,31],["Bomb4",256,0,31,31],["Bomb5",288,0,31,31],["Option1",112,0,47,31]],c=[];for(var e in d){var b=d[e],a={};a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];c[b[0]]=a}return c}function Stage1(){this.scenario=d;this.bgImage=b;this.bgLayout=a;this.initial=c;function d(){var d=[],c=[];for(var e in d){var b=d[e],a={};a.count=b[0];a.x=b[1]*.875;a.y=b[2]*.75;a.r=b[3];a.sc=b[4];a.ch=b[5];c.push(a)}return c}function b(){var a=[];a[0]=new Image;a[0].src="pict/sky.jpg";a[1]=new Image;a[1].src="pict/space.jpg";a[2]=new Image;a[2].src="pict/effect.jpg";return a}function a(){var c=[],b=[0,0,0,420,480,false,0,true];c.push(b);var d=[];for(var e in c){var b=c[e],a={};a.no=b[0];a.x=b[1];a.y=b[2];a.w=b[3];a.h=b[4];a.c=b[5];a.type=b[6];a.view=false;a.visible=b[7];d.push(a)}return d}function c(f){var c=[];c.push([false,210,400,0,"player",0]);c.push([false,210,400,0,"friend_rotate",10]);for(var d=10;d<410;d+=Math.floor(Math.random()*(100-f*10)))c.push([true,d,Math.floor(Math.random()*100)+20,90+180*Math.floor(Math.random()*2),"enemy_moveshot",1]);var e=[];for(var g in c){var b=c[g],a={};a.s=b[0];a.x=b[1];a.y=b[2];a.r=b[3];a.sc=b[4];a.ch=b[5];e.push(a)}return e}}function TextScreen(){for(var d=30,b=[],c=0;c<d;c++){var a=document.createElement("div");a.id="div"+c;a.style.position="absolute";a.style.display="inline";a.style.top=c+"px";a.style.left=c+"px";a.style.width="24px";a.style.height="20px";var f=document.getElementsByTagName("body").item(0);f.appendChild(a)}var i=0;this.print=function(d,f,g,c){if(!Boolean(c))c="green";var a={};a.text=d;a.x=f;a.y=g;a.color=c;a.draw=e;b.push(a)};function e(a){a.style.color=this.color;a.style.backgroundColor="transparent";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.width=16*this.text.length+"px";a.style.visibility="visible";a.style.display="inline";a.innerHTML=this.text}this.putFunc=function(a){b.push(a)};this.clear=function(){for(var a=0;a<d;a++){var b=document.getElementById("div"+a);b.style.visibility="hidden";b.style.display="none"}};this.reset=function(){b=[]};this.draw=function(){for(var a in b){if(a>=d)break;b[a].draw(document.getElementById("div"+a))}}}